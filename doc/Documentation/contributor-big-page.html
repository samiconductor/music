<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- Copyright C 2007-2012 by the authors.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.1
or any later version published by the Free Software Foundation;
with no Invariant Sections.
A copy of the license is included in the section entitled "GNU
Free Documentation License".

 -->
<!-- Created on January 1, 2014 by texi2html 1.82
texi2html was written by: 
            Lionel Cons <Lionel.Cons@cern.ch> (original author)
            Karl Berry  <karl@freefriends.org>
            Olaf Bachmann <obachman@mathematik.uni-kl.de>
            and many others.
Maintained by: Many creative people.
Send bugs and suggestions to <texi2html-bug@nongnu.org>
-->
<head>
<title>LilyPond Contributor's Guide</title>

<meta name="description" content="LilyPond Contributor's Guide">
<meta name="keywords" content="LilyPond Contributor's Guide">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="texi2html 1.82">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link href="#index" rel="start" title="LilyPond &mdash; Contributor's Guide">
<link href="#SEC_Contents" rel="contents" title="Table of Contents">
<link href="#SEC_About" rel="help" title="About This Document">
<link rel="stylesheet" type="text/css" title="Default style" href="../Documentation/css/lilypond-manuals.css">
<!--[if lte IE 7]>
<link href="../Documentation/css/lilypond-ie-fixes.css" rel="stylesheet" type="text/css">
<![endif]-->


</head>

<body lang="en" bgcolor="#FFFFFF" text="#000000" link="#0000FF" vlink="#800080" alink="#FF0000">


<div id="main">
<a name="Top"></a>
<table class="nav_table">
<tr><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td></tr></table>
<a name="index"></a>
<h1 class="settitle">LilyPond &mdash; Contributor&rsquo;s Guide</h1>

<table class="cartouche" border="1"><tr><td>
<p>This manual documents contributing to LilyPond version
2.16.2.  It discusses technical issues and policies that
contributors should follow.
</p>
<p>This manual is not intended to be read sequentially; new contributors
should only read the sections which are relevant to them.  For more
information about different jobs, see <a name="index-Help-us"></a>
<a href="web-big-page.html#help-us">Help us</a>.
</p></td></tr></table>







<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#introduction-to-contributing" accesskey="1">1. Introduction to contributing</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#quick-start" accesskey="2">2. Quick start</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#working-with-source-code" accesskey="3">3. Working with source code</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#compiling" accesskey="4">4. Compiling</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#documentation-work" accesskey="5">5. Documentation work</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#website-work" accesskey="6">6. Website work</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#lsr-work" accesskey="7">7. LSR work</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#issues" accesskey="8">8. Issues</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#regression-tests" accesskey="9">9. Regression tests</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#programming-work">10. Programming work</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#release-work">11. Release work</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#build-system-notes">12. Build system notes</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#modifying-the-feta-font">13. Modifying the feta font</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#administrative-policies">14. Administrative policies</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><th colspan="3" align="left" valign="top"><pre class="menu-comment">
Appendices

</pre></th></tr><tr><td align="left" valign="top"><a href="#gnu-free-documentation-license">A. GNU Free Documentation License</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top"> License of this document.
</td></tr>
</table>

<table class="cartouche" border="1"><tr><td>
<p>For more information about how this manual fits with the other
documentation, or to read this manual in other formats, see
<a name="index-Manuals"></a>
<a href="web-big-page.html#manuals">Manuals</a>.
</p>
<p>If you are missing any manuals, the complete documentation can be
found at <a href="http://www.lilypond.org">http://www.lilypond.org/</a>.
</p></td></tr></table>













<hr size="1">
<a name="Introduction-to-contributing"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#index" title="Beginning of this chapter or previous chapter"> &lt;&lt; Top&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#quick-start" title="Next chapter">&nbsp;Quick start &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#index" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Top&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#index" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Top&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#help-us" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Help us &gt; </a>]</td></tr></table>
<a name="introduction-to-contributing"></a>
<h1 class="chapter">1. Introduction to contributing</h1>

<p>This chapter presents a quick overview of ways that people can
help LilyPond.
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#help-us" accesskey="1">1.1 Help us</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#overview-of-work-flow" accesskey="2">1.2 Overview of work flow</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#summary-for-experienced-developers" accesskey="3">1.3 Summary for experienced developers</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#mentors" accesskey="4">1.4 Mentors</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>


<hr size="6">
<a name="Help-us"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#introduction-to-contributing" title="Beginning of this chapter or previous chapter"> &lt;&lt; Introduction to contributing&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#quick-start" title="Next chapter">&nbsp;Quick start &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#introduction-to-contributing" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Introduction to contributing&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#introduction-to-contributing" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Introduction to contributing&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#overview-of-work-flow" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Overview of work flow &gt; </a>]</td></tr></table>
<a name="help-us"></a>
<h2 class="section">1.1 Help us</h2>

<a name="We-need-you_0021"></a>
<h3 class="subheading">We need you!</h3>

<p>Thank you for your interest in helping us &mdash; we would love to see
you get involved!  Your contribution will help a large group of users
make beautifully typeset music.
</p>
<p>Even working on small tasks can have a big impact: taking care of
them allows experienced developers work on advanced tasks, instead
of spending time on those simple tasks.
</p>
<p>For a multi-faceted project like LilyPond, sometimes it&rsquo;s tough to know
where to begin.  In addition to the avenues proposed below, you can send
an e-mail to the <a href="mailto:mike@mikesolomon.org">Frog meister</a>
letting him know your skill set and asking how you can help or proposing a
project.  He&rsquo;ll be able to give you guidance on how to get started.
</p>

<a name="Simple-tasks"></a>
<h3 class="subheading">Simple tasks</h3>

<p><strong>No programming skills</strong> required!
</p>
<ul>
<li>
Mailing list support: answer questions from fellow users.

</li><li>
Bug reporting: help users create proper <a name="index-Bug-reports"></a>
<a href="web-big-page.html#bug-reports">Bug reports</a>, and/or
join the Bug Squad to organize <a name="index-Issues"></a>
<a href="contributor-big-page.html#issues">Issues</a>.

</li><li>
<a name="index-Grand-Regression-Test-Checking"></a>
<a href="contributor-big-page.html#grand-regression-test-checking">Grand Regression Test Checking</a>: verify that LilyPond works correctly
by examining output of test snippets.  Checking one snippet takes less
than a minute!

</li><li>
Documentation: small changes can be proposed by following the
guidelines for <a name="index-Documentation-suggestions"></a>
<a href="contributor-big-page.html#documentation-suggestions">Documentation suggestions</a>.

</li><li>
LilyPond Snippet Repository (LSR): create and fix snippets
following the guidelines in
<a name="index-Adding-and-editing-snippets"></a>
<a href="contributor-big-page.html#adding-and-editing-snippets">Adding and editing snippets</a>.

</li><li>
Discussions, reviews, and testing: the developers often ask for
feedback about new documentation, potential syntax changes, and
testing new features.  Please contribute to these discussions!

</li></ul>


<a name="Advanced-tasks"></a>
<h3 class="subheading">Advanced tasks</h3>

<p>These jobs generally require that you have the source code and can
compile LilyPond.
</p>
<div class="warning"><p><strong>Note:</strong> We suggest that contributors using Windows or MacOS X do
<strong>not</strong> attempt to set up their own development environment;
instead, use Lilydev as discussed in <a name="index-Quick-start"></a>
<a href="contributor-big-page.html#quick-start">Quick start</a>.
</p>
</div>
<p>Contributors using Linux or FreeBSD may also use Lilydev, but if
they prefer their own development environment, they should read
<a name="index-Working-with-source-code"></a>
<a href="contributor-big-page.html#working-with-source-code">Working with source code</a>, and <a name="index-Compiling"></a>
<a href="contributor-big-page.html#compiling">Compiling</a>.
</p>
<p>Begin by reading <a name="index-Summary-for-experienced-developers"></a>
<a href="contributor-big-page.html#summary-for-experienced-developers">Summary for experienced developers</a>.
</p>
<ul>
<li>
Documentation: for large changes, see
<a name="index-Documentation-work"></a>
<a href="contributor-big-page.html#documentation-work">Documentation work</a>.

</li><li>
Website: the website is built from the normal documentation
source.  See the info about documentation, and also
<a name="index-Website-work"></a>
<a href="contributor-big-page.html#website-work">Website work</a>.

</li><li>
Translations: see <a name="index-Translating-the-documentation"></a>
<a href="contributor-big-page.html#translating-the-documentation">Translating the documentation</a>, and
<a name="index-Translating-the-website"></a>
<a href="contributor-big-page.html#translating-the-website">Translating the website</a>.

</li><li>
Bugfixes or new features: the best way to begin is to join the
Frogs, and read <a name="index-Programming-work"></a>
<a href="contributor-big-page.html#programming-work">Programming work</a>.

</li></ul>



<hr size="6">
<a name="Overview-of-work-flow"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#introduction-to-contributing" title="Beginning of this chapter or previous chapter"> &lt;&lt; Introduction to contributing&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#quick-start" title="Next chapter">&nbsp;Quick start &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#help-us" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Help us&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#introduction-to-contributing" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Introduction to contributing&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#summary-for-experienced-developers" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Summary for experienced developers &gt; </a>]</td></tr></table>
<a name="overview-of-work-flow"></a>
<h2 class="section">1.2 Overview of work flow</h2>

<div class="advanced"><p><strong>Advanced note:</strong> Experienced developers should skip to
<a href="#summary-for-experienced-developers">Summary for experienced developers</a>.
</p>
</div>
<p>Git is a <em>version control system</em> that tracks the history of
a program&rsquo;s source code.  The LilyPond source code is maintained
as a Git repository, which contains:
</p>
<ul>
<li>
all of the source files needed to build LilyPond, and

</li><li>
a record of the entire history of every change made to every file
since the program was born.
</li></ul>

<p>The &lsquo;official&rsquo; LilyPond Git repository is hosted by the GNU
Savannah software forge at <a href="http://git.sv.gnu.org">http://git.sv.gnu.org</a>.
Although, since Git uses a <em>distributed</em> model, technically
there is no central repository.  Instead, each contributor keeps a
complete copy of the entire repository (about 116MB).
</p>
<p>Changes made within one contributor&rsquo;s copy of the repository can
be shared with other contributors using <em>patches</em>.  A patch
is a simple text file generated by the <code>git</code> program that
indicates what changes have been made (using a special format).
If a contributor&rsquo;s patch is approved for inclusion (usually
through the mailing list), someone on the current development team
will <em>push</em> the patch to the official repository.
</p>
<p>The Savannah software forge provides two separate interfaces for
viewing the LilyPond Git repository online: <em>cgit</em> and
<em>gitweb</em>.  The cgit interface should work faster than gitweb
in most situations, but only gitweb allows you to search through
the source code using <code>grep</code>, which you may find useful.
The cgit interface is at
<a href="http://git.sv.gnu.org/cgit/lilypond.git">http://git.sv.gnu.org/cgit/lilypond.git/</a> and the gitweb
interface is at
<a href="http://git.sv.gnu.org/gitweb/?p=lilypond.git">http://git.sv.gnu.org/gitweb/?p=lilypond.git</a>.
</p>
<p>Git is a complex and powerful tool, but tends to be confusing at
first, particularly for users not familiar with the command line
and/or version control systems.  We have created the
<code>lily-git</code> graphical user interface to ease this
difficulty.
</p>
<p><em>Compiling</em> (&lsquo;building&rsquo;) LilyPond allows developers to see
how changes to the source code affect the program itself.
Compiling is also needed to package the program for specific
operating systems or distributions.  LilyPond can be compiled from
a local Git repository (for developers), or from a downloaded
tarball (for packagers).  Compiling LilyPond is a rather involved
process, and most contributor tasks do not require it.
</p>
<p>Contributors can contact the developers through the
&lsquo;lilypond-devel&rsquo; mailing list.  The mailing list archive is
located at
<a href="http://lists.gnu.org/archive/html/lilypond-devel">http://lists.gnu.org/archive/html/lilypond-devel/</a>.  If you
have a question for the developers, search the archives first to
see if the issue has already been discussed.  Otherwise, send an
email to <a href="mailto:lilypond-devel@gnu.org">lilypond-devel@gnu.org</a>.  You can subscribe to
the developers&rsquo; mailing list here:
<a href="http://lists.gnu.org/mailman/listinfo/lilypond-devel">http://lists.gnu.org/mailman/listinfo/lilypond-devel</a>.
</p>
<div class="warning"><p><strong>Note:</strong> Contributors on Windows or MacOS X wishing to compile
code or documentation are strongly advised to use our Ubuntu
LilyPond Developer Remix, as discussed in <a href="#quick-start">Quick start</a>.
</p>
</div>

<hr size="6">
<a name="Summary-for-experienced-developers"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#introduction-to-contributing" title="Beginning of this chapter or previous chapter"> &lt;&lt; Introduction to contributing&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#quick-start" title="Next chapter">&nbsp;Quick start &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#overview-of-work-flow" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Overview of work flow&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#introduction-to-contributing" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Introduction to contributing&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#mentors" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Mentors &gt; </a>]</td></tr></table>
<a name="summary-for-experienced-developers"></a>
<h2 class="section">1.3 Summary for experienced developers</h2>

<p>If you are already familiar with typical open-source tools, here&rsquo;s
what you need to know:
</p>
<ul>
<li> <strong>source repository</strong>:
hosted by GNU savannah.

<blockquote><pre class="example"><a href="http://git.savannah.gnu.org/gitweb/?p=lilypond.git">http://git.savannah.gnu.org/gitweb/?p=lilypond.git</a>
</pre></blockquote>

</li><li> <strong>environment variables</strong>:
many maintenance scripts, and many instructions in this guide rely on
predefined <a href="#environment-variables">Environment variables</a>.

</li><li> <strong>mailing lists</strong>:
given on <a name="index-Contacts"></a>
<a href="web-big-page.html#contacts">Contacts</a>.

</li><li> <strong>branches</strong>:

<ul>
<li> <code>master</code>:
base your work from this, but do <strong>not push</strong> to it.

</li><li> <code>staging</code>:
after a successful review (see below), push here.

</li><li> <code>translation</code>:
translators should base their work from this, and also push to it.

</li><li> <code>dev/foo</code>:
feel free to push any new branch name under <code>dev/</code>.

</li></ul>

</li><li> <strong>regression tests</strong>:
also known as &ldquo;regtests&rdquo;; this is a collection of more than a
thousand .ly files.  We track the output of those files between
versions.

<p>If a patch introduces any unintentional changes to the regtests,
we will likely reject it &ndash; make sure that you are aware and can
explain any regtest changes.  More info in <a href="#regression-tests">Regression tests</a>.
</p>
</li><li> <strong>reviews</strong>:
after finishing work on a patch or branch:

<ol>
<li>
upload it with our custom <code>git-cl</code>.  In addition to uploading
it to the google rietveld code review tool, this adds a tracker
issue so that we don&rsquo;t lose your patch.  The &ldquo;status&rdquo; of your
patch is kept on the issue tracker; see <a href="#issues">Issues</a>.

<blockquote><pre class="example"><a href="https://github.com/gperciva/git-cl">https://github.com/gperciva/git-cl</a>
</pre></blockquote>

<p>Your patch will be given <code>Patch-new</code> status.  More info in
<a href="#uploading-a-patch-for-review">Uploading a patch for review</a>.
</p>
</li><li>
If your patch passes some automatic tests, it will be given
<code>Patch-review</code> status.  This generally happens within 24
hours.

</li><li>
After that, the patch must wait for the next &ldquo;patch countdown&rdquo;,
which occur 3 times a week.  If there are a lot of patches waiting
for a countdown, a subset of patches are chosen randomly.  When
your patch is put on a countdown, it will be given
<code>Patch-countdown</code> status.

</li><li>
The countdown is a 48-hour period which gives other developers one
last chance to review the patch.  If no significant problems are
found, your patch will be given <code>Patch-push</code> status.

</li><li>
You may now either push it to the <code>staging</code> branch, or email
your patch (created with <code>git format-patch</code>) to somebody
who will push it for you.

</li></ol>

<div class="advanced"><p><strong>Advanced note:</strong> Yes, this process means that most patches wait between
60-120 hours before reaching <code>master</code>.  This is unfortunate, but
given our limited resources for reviewing patches and a history of
unintended breakage in <code>master</code>, this is the best compromise
we have found.
</p>
</div>

</li></ul>


<hr size="6">
<a name="Mentors"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#introduction-to-contributing" title="Beginning of this chapter or previous chapter"> &lt;&lt; Introduction to contributing&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#quick-start" title="Next chapter">&nbsp;Quick start &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#summary-for-experienced-developers" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Summary for experienced developers&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#introduction-to-contributing" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Introduction to contributing&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#quick-start" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Quick start &gt; </a>]</td></tr></table>
<a name="mentors"></a>
<h2 class="section">1.4 Mentors</h2>

<p>We have a semi-formal system of mentorship, similar to the
medieval &ldquo;journeyman/master&rdquo; training system.  New contributors
will have a dedicated mentor to help them &ldquo;learn the ropes&rdquo;.
</p>
<div class="warning"><p><strong>Note:</strong> This is subject to the availability of mentors; certain
jobs have more potential mentors than others.
</p>
</div>
<a name="Contributor-responsibilities"></a>
<h3 class="subheading">Contributor responsibilities</h3>

<ol>
<li>
Ask your mentor which sections of the CG you should read.

</li><li>
If you get stuck for longer than 10 minutes, ask your mentor.
They might not be able to help you with all problems, but we find
that new contributors often get stuck with something that could be
solved/explained with 2 or 3 sentences from a mentor.

</li><li>
If you have been working on a task much longer than was originally
estimated, stop and ask your mentor.  There may have been a
miscommunication, or there may be some time-saving tips that could
vastly simply your task.

</li><li>
Send patches to your mentor for initial comments.

</li><li>
Inform your mentor if you&rsquo;re going to be away for a month, or if
you leave entirely.  Contributing to lilypond isn&rsquo;t for everybody;
just let your mentor know so that we can reassign that work to
somebody else.

</li><li>
Inform your mentor if you&rsquo;re willing to do more work &ndash; we always
have way more work than we have helpers available.  We try to
avoid overwhelming new contributors, so you&rsquo;ll be given less work
than we think you can handle.

</li></ol>


<a name="Mentor-responsibilities"></a>
<h3 class="subheading">Mentor responsibilities</h3>

<ol>
<li>
Respond to questions from your contributor(s) promptly, even if
the response is just &ldquo;sorry, I don&rsquo;t know&rdquo; or &ldquo;sorry, I&rsquo;m
very busy for the next 3 days; I&rsquo;ll get back to you then&rdquo;.  Make
sure they feel valued.

</li><li>
Inform your contributor(s) about the expected turnaround for your
emails &ndash; do you work on lilypond every day, or every weekend, or
what?  Also, if you&rsquo;ll be unavailable for longer than usual (say,
if you normally reply within 24 hours, but you&rsquo;ll be at a
conference for a week), let your contributors know.  Again, make
sure they feel valued, and that your silence (if they ask a
question during that period) isn&rsquo;t their fault.

</li><li>
Inform your contributor(s) if they need to do anything unusual for
the builds, such as doing a &ldquo;make clean / doc-clean&rdquo; or
switching git branches (not expected, but just in case...)

</li><li>
You don&rsquo;t need to be able to completely approve patches.  Make
sure the patch meets whatever you know of the guidelines (for doc
style, code indentation, whatever), and then send it on to the
frog list or -devel for more comments.  If you feel confident
about the patch, you can push it directly (this is mainly intended
for docs and translations; code patches should almost always go to
-devel before being pushed).

</li><li>
Keep track of patches from your contributor.  Either upload them
to Rietveld yourself, or help+encourage them to upload the patches
themselves.  When a patch is on Rietveld, it&rsquo;s your responbility
to get comments for it, and to add a link to the patch to the
google tracker.  (tag it &ldquo;patch-new&rdquo;, or &ldquo;patch-review&rdquo; if
you feel very confident in it)

</li><li>
Encourage your contributor to review patches, particularly your
own!  It doesn&rsquo;t matter if they&rsquo;re not familiar with C++ / scheme
/ build system / doc stuff &ndash; simply going through the process is
valuable.  Besides, anybody can find a typo!

</li><li>
Contact your contributor at least once a week.  The goal is just
to get a conversation started &ndash; there&rsquo;s nothing wrong with simply
copy&amp;pasting this into an email:

<blockquote><pre class="example">Hey there,

How are things going?  If you sent a patch and got a review, do
you know what you need to fix?  If you sent a patch but have no
reviews yet, do you know when you will get reviews?  If you are
working on a patch, what step(s) are you working on?
</pre></blockquote>


</li></ol>



<hr size="6">
<a name="Quick-start"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#introduction-to-contributing" title="Beginning of this chapter or previous chapter"> &lt;&lt; Introduction to contributing&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#working-with-source-code" title="Next chapter">&nbsp;Working with source code &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#mentors" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Mentors&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#index" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Top&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#lilydev" title="Next section in reading order" accesskey="n" rel="next">&nbsp;LilyDev &gt; </a>]</td></tr></table>
<a name="quick-start"></a>
<h1 class="chapter">2. Quick start</h1>

<p>Want to submit a patch for LilyPond?  Great!  Never created a patch
before? Never compiled software before? No problem!  This chapter is
for you and will help you do this as quickly and easily as possible.
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#lilydev" accesskey="1">2.1 LilyDev</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#lily_002dgit" accesskey="2">2.2 lily-git</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#compiling-with-lilydev" accesskey="3">2.3 Compiling with LilyDev</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#now-start-work_0021" accesskey="4">2.4 Now start work!</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr size="6">
<a name="LilyDev"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#quick-start" title="Beginning of this chapter or previous chapter"> &lt;&lt; Quick start&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#working-with-source-code" title="Next chapter">&nbsp;Working with source code &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#quick-start" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Quick start&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#quick-start" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Quick start&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#where-to-get-lilydev" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Where to get LilyDev &gt; </a>]</td></tr></table>
<a name="lilydev"></a>
<h2 class="section">2.1 LilyDev</h2>

<p>There is a disk image of a &lsquo;remix&rsquo; of Ubuntu GNU/Linux available for
download which includes all the necessary software and tools to compile
both LilyPond and the documentation.  Called the
&ldquo;Ubuntu LilyPond Developer Remix&rdquo;, but known simply as &ldquo;LilyDev&rdquo;
for short.  Although it is not possible to compile LilyPond on Windows
and extremely difficult on MacOS, LilyDev can be installed and run
inside a &lsquo;virtual machine&rsquo; on any of these operating systems without
disturbing your main operating system.  The LilyDev disk image can also
be burnt to a DVD and installed like any other Ubuntu GNU/Linux
distribution.
</p>
<p>Most virtualization software can be used but we recommend VirtualBox as
it is available for all major operating systems and is easy to install
&amp; configure.
</p>
<p>If you are not familiar with GNU/Linux, it may be beneficial to read a
couple of &ldquo;introduction to Ubuntu&rdquo; web pages.
</p>
<p>Some contributors have recommended a free PDF:
</p>
<blockquote><pre class="example"><a href="http://www.ubuntupocketguide.com">http://www.ubuntupocketguide.com/</a>
</pre></blockquote>

<p>For those interested, the LilyDev remix is currently based on a 32bit
version of 10.04 LTS Ubuntu (Lucid Lynx).
</p>
<div class="warning"><p><strong>Note:</strong> Apart from installing and configuring LilyDev in VirtualBox,
the rest of the chapter on assumes that you are comfortable using the
command-line.  While this chapter is intended for users who may have
never created a patch or compiled software before, experienced
developers (who prefer to use their own development environment) may
still find it instructive to skim over this section.
</p>
</div>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#where-to-get-lilydev" accesskey="1">Where to get LilyDev</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#installing-lilydev-in-virtualbox" accesskey="2">Installing LilyDev in VirtualBox</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#configuring-lilydev-in-virtualbox" accesskey="3">Configuring LilyDev in VirtualBox</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>


<hr size="6">
<a name="Where-to-get-LilyDev"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#quick-start" title="Beginning of this chapter or previous chapter"> &lt;&lt; Quick start&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#working-with-source-code" title="Next chapter">&nbsp;Working with source code &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#lilydev" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; LilyDev&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#lilydev" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;LilyDev&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#installing-lilydev-in-virtualbox" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Installing LilyDev in VirtualBox &gt; </a>]</td></tr></table>
<a name="where-to-get-lilydev"></a>
<h3 class="unnumberedsubsec">Where to get LilyDev</h3>

<p>Download the Ubuntu LilyPond Developer Remix CD image file
(approximately 1 GB) from here:
</p>
<table><tr><td>&nbsp;</td><td><pre class="smallexample"><a href="http://www.philholmes.net/lilypond/LilyDev/ubuntu-LilyDev-remix-2.6.iso">http://www.philholmes.net/lilypond/LilyDev/ubuntu-LilyDev-remix-2.6.iso</a>
</pre></td></tr></table>

<p>Some advanced users might want this file too:
</p><table><tr><td>&nbsp;</td><td><pre class="smallexample"><a href="http://www.philholmes.net/lilypond/LilyDev/ubuntu-LilyDev-remix-2.6.iso.md5">http://www.philholmes.net/lilypond/LilyDev/ubuntu-LilyDev-remix-2.6.iso.md5</a>
</pre></td></tr></table>
<p>(If you don&rsquo;t recognize what this file is, then you don&rsquo;t need it.)
</p>

<hr size="6">
<a name="Installing-LilyDev-in-VirtualBox"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#quick-start" title="Beginning of this chapter or previous chapter"> &lt;&lt; Quick start&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#working-with-source-code" title="Next chapter">&nbsp;Working with source code &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#where-to-get-lilydev" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Where to get LilyDev&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#lilydev" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;LilyDev&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#configuring-lilydev-in-virtualbox" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Configuring LilyDev in VirtualBox &gt; </a>]</td></tr></table>
<a name="installing-lilydev-in-virtualbox"></a>
<h3 class="unnumberedsubsec">Installing LilyDev in VirtualBox</h3>

<p>This section discusses how to install and use LilyDev with VirtualBox.
</p>
<div class="warning"><p><strong>Note:</strong> If you already know how to install a virtual machine using a
disc image inside VirtualBox (or your own virtualization software) then
you can skip this section and go straight to <a href="#lily_002dgit">lily-git</a>.
</p>
</div>
<ol>
<li>
Download Virtualbox from here:

<blockquote><pre class="example"><a href="http://www.virtualbox.org/wiki/Downloads">http://www.virtualbox.org/wiki/Downloads</a>
</pre></blockquote>

<div class="warning"><p><strong>Note:</strong> In virtualization terminology, the operating system where
Virtualbox is installed, is the known as the <strong>host</strong>.  LilyDev
will be installed &lsquo;inside&rsquo; Virtualbox as a <strong>guest</strong>.
</p>
</div>
</li><li>
Start the VirtualBox software and click &lsquo;New&rsquo; to create a new
&ldquo;virtual machine&rdquo;.

<p>The &lsquo;New Virtual Machine Wizard&rsquo; will walk you through setting up your
guest virtual machine.  Choose an appropriate name for your LilyDev
installation and select the &lsquo;Linux&rsquo; operating system.  When selecting
the &lsquo;version&rsquo; use &lsquo;Ubuntu&rsquo; if available (but not the &lsquo;64 bit&rsquo;
option).  If you do not have that specific option choose &lsquo;Linux 2.6&rsquo;
(again do not choose any option that has 64 bit next to it).
</p>
</li><li>
Select the amount of RAM you will allow the LilyDev guest to use from
your host operating system when it is running.  If possible, use at
least 700 MB of RAM; the more RAM you can spare from your host the
better, although LilyDev will currently use no more than 4 GB (4096 MB)
even if you are able to assign more.

</li><li>
For your &lsquo;Virtual Hard Disk&rsquo;, leave the &lsquo;Create new hard disk&rsquo;
option checked, use the default &lsquo;VDI&rsquo; and
&ldquo;Dynamically allocated&rdquo; options for the virtual hard drive.  A
complete compile of everything (code, docs, regression tests) can reach
10 GB so size your virtual disk and its location accordingly.

</li><li>
Verify the summary details and click &lsquo;Create&rsquo;, when you are satisfied.
Your new guest will be displayed in the Virtualbox window.  Click the
&lsquo;Start&rsquo; button and the &lsquo;First Run Wizard&rsquo; will prompt you for
the installation media.  Click the browse icon and locate the LilyDev
disk image and click through the wizard to start the installation
process.

</li><li>
When the LilyDev disk image boots, it shows a prompt:

<blockquote><pre class="example">ISOLINUX <code>boot:</code>
</pre></blockquote>

<p>Hit the Return key (or wait 30 seconds) and then when the installer
screen loads, using the arrow keys select
&lsquo;Install - start the installer directly&rsquo; to begin the install process
of LilyDev on your virtual hard disk.  The Ubuntu software will walk you
through the complete installation process.
</p>
</li><li>
At the &ldquo;Prepare disk space&rdquo; stage, do not be afraid to select
&ldquo;Erase and use the entire disk&rdquo;, since this refers to your
<strong><em>virtual disk</em></strong>, not your machine&rsquo;s actual hard
disk.

</li><li>
Click through the rest of the wizard, filling in any appropriate details
when asked and wait for the install to complete.

<div class="warning"><p><strong>Note:</strong> This will take anywhere from 10 minutes to up to an hour
depending on the speed of your computer and if Ubuntu detects you are
connected to the internet and needs to download any additional
security updates or patches, although these updates are not required to
compile LilyPond and it is possible to skip the additional downloads to
speed up the install process.
</p>
</div>
</li><li>
When prompted by the Ubuntu installer wizard, restart the virtual
machine and then when prompted to &lsquo;eject the CD&rsquo; by virtual box, just
click inside the virtual machine window and hit the return key to
reboot the virtual machine.  It will not try to restart the installer
but start the virtual machine proper. LilyDev is now installed and
running!

</li></ol>

<a name="Known-issues-and-warnings-1"></a>
<h4 class="subsubheading">Known issues and warnings</h4>
<p>Not all hardware is supported in all virtualization tools.  In
particular, some contributors have reported problems with USB network
adapters.  If you have problems with network connection (for example
Internet connection in the host system is lost when you launch virtual
system), try installing and running LilyDev with your computer&rsquo;s
built-in network adapter used to connect to the network.  Refer to the
help documentation that comes with your virtualization software.
</p>

<hr size="6">
<a name="Configuring-LilyDev-in-VirtualBox"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#quick-start" title="Beginning of this chapter or previous chapter"> &lt;&lt; Quick start&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#working-with-source-code" title="Next chapter">&nbsp;Working with source code &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#installing-lilydev-in-virtualbox" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Installing LilyDev in VirtualBox&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#lilydev" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;LilyDev&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#lily_002dgit" title="Next section in reading order" accesskey="n" rel="next">&nbsp;lily-git &gt; </a>]</td></tr></table>
<a name="configuring-lilydev-in-virtualbox"></a>
<h3 class="unnumberedsubsec">Configuring LilyDev in VirtualBox</h3>

<p>VirtualBox has extra &lsquo;guest additions&rsquo; which although are not
necessary to use LilyDev or compile Lilypond, do provide some additional
features to your Virtual Machine to make it easier to work with.  Such
as being able to dynamically resize the LilyDev window, allow seamless
interaction with your mouse pointer on both the host and guest and let
you copy/paste between your host and guest if needed.
</p>
<ol>
<li>
Select the &lsquo;Devices&rsquo; menu from the virtual machine window and choose
&lsquo;Install Guest Additions...&rsquo;.  This will automount a CD which will
prompt you to autorun it.  Click OK and follow the instructions.  It is
recommended to reboot the guest when the installation is complete.

<p>Other virtualization software will also have their own &lsquo;guest&rsquo;
additions, follow the normal procedures for your virtualization software
with Ubuntu as the client.
</p>
</li><li>
Restart Ubuntu to complete the installation of the guest additions.

<div class="advanced"><p><strong>Advanced note:</strong> If you do any kernel upgrades, you may need to reinstall
the additional software.  Just follow the step above again and reboot
when the reinstallation is complete.
</p>
</div>
</li></ol>

<p>Other items that may be helpful:
</p>
<ul>
<li>
In the settings for the virtual machine, set the network to
Bridged mode to allow you to access shared folders when using Windows
hosts.

</li><li>
Set up any additional features, such as &lsquo;Shared Folders&rsquo; between
your main operating system and Ubuntu.  This is distinct from the
networked share folders in Windows.  Consult the external
documentation for this.

<p>Some longtime contributors have reported that &lsquo;shared folders&rsquo;
are rarely useful and not worth the fuss, particularly since files
can be shared over a network instead.
</p>
</li><li>
Pasting into a terminal is done with <code>Ctrl+Shift+v</code>.

</li><li>
The &ldquo;Places&rdquo; top-menu has shortcuts to a graphical
&ldquo;navigator&rdquo; like Windows Explorer or the MacOS X Finder.

</li><li>
Right-click allows you to edit a file with gedit.  We recommend
using gedit.

</li><li>
One particular change from Windows and MacOS X is that most
software should be installed with your &ldquo;package manager&rdquo;; this
vastly simplifies the process of installing and configuring
software.  Go to Applications &rarr; Ubuntu
Software Center.

</li></ul>


<hr size="6">
<a name="lily_002dgit"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#quick-start" title="Beginning of this chapter or previous chapter"> &lt;&lt; Quick start&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#working-with-source-code" title="Next chapter">&nbsp;Working with source code &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#configuring-lilydev-in-virtualbox" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Configuring LilyDev in VirtualBox&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#quick-start" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Quick start&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#where-to-get-lily_002dgit" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Where to get lily-git &gt; </a>]</td></tr></table>
<a name="lily_002dgit"></a>
<h2 class="section">2.2 lily-git</h2>

<p>The &lsquo;LilyPond Contributor&rsquo;s Git Interface&rsquo; (otherwise known as
<code>lily-git.tcl</code>) is a simple-to-use GUI to help you download and
update the LilyPond source code as well as an aid to making software
patches.
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#where-to-get-lily_002dgit" accesskey="1">Where to get lily-git</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#configuring-lily_002dgit-and-downloading-the-source-code" accesskey="2">Configuring lily-git and downloading the source code</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#how-to-use-lily_002dgit" accesskey="3">How to use lily-git</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr size="6">
<a name="Where-to-get-lily_002dgit"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#quick-start" title="Beginning of this chapter or previous chapter"> &lt;&lt; Quick start&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#working-with-source-code" title="Next chapter">&nbsp;Working with source code &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#lily_002dgit" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; lily-git&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#lily_002dgit" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;lily-git&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#configuring-lily_002dgit-and-downloading-the-source-code" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Configuring lily-git and downloading the source code &gt; </a>]</td></tr></table>
<a name="where-to-get-lily_002dgit"></a>
<h3 class="unnumberedsubsec">Where to get lily-git</h3>

<p>Depending on your development environment, lily-git may already be
installed on your computer.
</p>
<ul>
<li>
If you are using LilyDev (see <a href="#lilydev">LilyDev</a>) then lily-git is already
installed and ready to run.

</li><li>
For those not using LilyDev then lily-git can be obtained by downloading
the software directly. See <a href="#manually-installing-lily_002dgit_002etcl">Manually installing lily-git.tcl</a>.

</li><li>
Finally, lily-git is always part of the LilyPond source code and is
located in &lsquo;<tt>~/lilypond-git/scripts/auxillar/lily-git.tcl</tt>&rsquo;.

</li></ul>


<hr size="6">
<a name="Configuring-lily_002dgit-and-downloading-the-source-code"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#quick-start" title="Beginning of this chapter or previous chapter"> &lt;&lt; Quick start&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#working-with-source-code" title="Next chapter">&nbsp;Working with source code &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#where-to-get-lily_002dgit" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Where to get lily-git&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#lily_002dgit" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;lily-git&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#how-to-use-lily_002dgit" title="Next section in reading order" accesskey="n" rel="next">&nbsp;How to use lily-git &gt; </a>]</td></tr></table>
<a name="configuring-lily_002dgit-and-downloading-the-source-code"></a>
<h3 class="unnumberedsubsec">Configuring lily-git and downloading the source code</h3>

<div class="warning"><p><strong>Note:</strong> The rest of this manual assumes that you are using the
command-line within a terminal.
</p>
</div>
<ol>
<li>
Type (or copy&amp;paste) into the Terminal:

<blockquote><pre class="example">lily-git.tcl
</pre></blockquote>

<p>You will be prompted to enter your name and your email address.  This
information is used only to identify and label any patches you create.
This information can be edited if required later.  See
<a href="#configuring-git">Configuring Git</a>.  Click on the <em>Submit</em> button to update
lily-git with this information.
</p>
</li><li>
Click on the &ldquo;Get source&rdquo; button.

<p>A directory called &lsquo;<tt>lilypond-git/</tt>&rsquo; is now created within
your home directory and the complete source code will start to be
downloaded into it.
</p>
<div class="warning"><p><strong>Note:</strong> Be patient! The complete source is around 150&nbsp;Mb.
</p>
</div>
<p>When the source code has been downloaded, the &ldquo;Command output&rdquo; window
in lily-git will update and display &ldquo;Done&rdquo; on the very last line.
The button label will change to say &ldquo;Update source&rdquo;.
</p>
<div class="warning"><p><strong>Note:</strong> Some contributors have reported that occasionally nothing
happens at this step at all.  If this occurs, then try again in a few
minutes &ndash; it could be an intermittant network problem.  If the
problem persists, please ask for help.
</p>
</div>
</li><li>
Close the lily-git GUI and navigate to the &lsquo;<tt>lilypond-git/</tt>&rsquo;
directory to view and edit the source files.

</li></ol>

<p>If this is the first time you have compiled LilyPond then please go
to <a href="#compiling-with-lilydev">Compiling with LilyDev</a> before reading on.
</p>

<hr size="6">
<a name="How-to-use-lily_002dgit"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#quick-start" title="Beginning of this chapter or previous chapter"> &lt;&lt; Quick start&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#working-with-source-code" title="Next chapter">&nbsp;Working with source code &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#configuring-lily_002dgit-and-downloading-the-source-code" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Configuring lily-git and downloading the source code&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#lily_002dgit" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;lily-git&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#compiling-with-lilydev" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Compiling with LilyDev &gt; </a>]</td></tr></table>
<a name="how-to-use-lily_002dgit"></a>
<h3 class="unnumberedsubsec">How to use lily-git</h3>

<div class="warning"><p><strong>Note:</strong> Throughout the rest of this manual, most command-line
input should be entered from &lsquo;<tt>~/lilypond-git/</tt>&rsquo;.  This is
known as the <em>top source directory</em> and is often referred to as
<var>$LILYPOND_GIT</var>.
</p>
</div>
<div class="warning"><p><strong>Note:</strong> Only work on one set of changes at once.  Do not start
work on any new changes until your first set has been accepted.
</p>
</div>
<a name="g_t1_002e-Update-source"></a>
<h4 class="subsubheading">1. Update source</h4>

<p>At the beginning of each session of lilypond work, you should
click the &ldquo;Update source&rdquo; button to get the latest changes to
the source code.
</p>
<div class="warning"><p><strong>Note:</strong> In some rare and unfortunate circumstances, this will
result in a <em>merge conflict</em>.  If this occurs, follow the
instructions for &ldquo;Abort changes&rdquo;, below.  Your work will not be
lost.
</p>
</div>

<a name="g_t2a_002e-New-local-commit"></a>
<h4 class="subsubheading">2a. New local commit</h4>

<p>A single commit typically represents one logical set of related
changes (such as a bug-fix), and may incorporate changes to
multiple files at the same time.
</p>
<p>When you&rsquo;re finished making the changes for a commit, click the
&ldquo;New local commit&rdquo; button.  This will open the &ldquo;Git Commit
Message&rdquo; window.  The message header is required, and the message
body is optional.
</p>
<p>After entering a commit message, click &ldquo;OK&rdquo; to finalize the
commit.
</p>
<div class="advanced"><p><strong>Advanced note:</strong> for more information regarding commits and commit
messages, see <a href="#commits-and-patches">Commits and patches</a>.
</p>
</div>

<a name="g_t2b_002e-Amend-previous-commit"></a>
<h4 class="subsubheading">2b. Amend previous commit</h4>

<p>You can go back and make changes to the most recent commit with
the &ldquo;Amend previous commit&rdquo; button.  This is useful if a
mistake is found after you have clicked the &ldquo;New local commit&rdquo;
button.
</p>
<p>To amend the most recent commit, re-edit the source files as
needed and then click the &ldquo;Amend previous commit&rdquo; button.  The
earlier version of the commit is not saved, but is replaced by the
new one.
</p>
<div class="warning"><p><strong>Note:</strong> This does not update the patch <strong>files</strong>; if you
have a patch file from an earlier version of the commit, you will
need to make another patch set when using this feature.  The old
patch file will not be saved, but will be replaced by the new one
after you click on &ldquo;Make patch set&rdquo;.
</p>
</div>

<a name="g_t3_002e-Make-patch-set"></a>
<h4 class="subsubheading">3. Make patch set</h4>

<p>Before making a patch set from any commits, you should click the
&ldquo;Update source&rdquo; button to make sure the commits are based on
the most recent remote snapshot.
</p>
<p>When you click the &ldquo;Make patch set&rdquo; button,
<code>lily-git.tcl</code> will produce patch files for any new
commits, saving them to the current directory.  The command output
will display the name of the new patch files near the end of the
output:
</p>
<blockquote><pre class="example">0001-CG-add-lily-git-instructions.patch
Done.
</pre></blockquote>

<p>Send patch files to the appropriate place:
</p>
<ul>
<li>
If you have a mentor, send it to them via email.

</li><li>
New contributors should send the patch attached to an email to
<a href="mailto:frogs@lilynet.net">frogs@lilynet.net</a>.  Please add &ldquo;[PATCH]&rdquo; to the
subject line.

</li><li>
Translators should send patches to
<a href="mailto:translations@lilynet.net">translations@lilynet.net</a>.

</li><li>
More experienced contributors should upload the patch for
web-based review.  This requires additional software and use of
the command-line; see <a href="#uploading-a-patch-for-review">Uploading a patch for review</a>.

</li></ul>


<a name="The-_201cAbort-changes-_002d_002d-Reset-to-origin_201d-button"></a>
<h4 class="subsubheading">The &ldquo;Abort changes &ndash; Reset to origin&rdquo; button</h4>

<div class="warning"><p><strong>Note:</strong> Only use this if your local commit history gets
hopelessly confused!
</p>
</div>
<p>The button labeled &ldquo;Abort changes &ndash; Reset to origin&rdquo; will copy
all changed files to a subdirectory of &lsquo;<tt>lilypond-git/</tt>&rsquo; named
&lsquo;<tt>aborted_edits/</tt>&rsquo;, and will reset the repository to the
current state of the remote repository (at <code>git.sv.gnu.org</code>).
</p>


<hr size="6">
<a name="Compiling-with-LilyDev"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#quick-start" title="Beginning of this chapter or previous chapter"> &lt;&lt; Quick start&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#working-with-source-code" title="Next chapter">&nbsp;Working with source code &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#how-to-use-lily_002dgit" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; How to use lily-git&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#quick-start" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Quick start&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#now-start-work_0021" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Now start work! &gt; </a>]</td></tr></table>
<a name="compiling-with-lilydev"></a>
<h2 class="section">2.3 Compiling with LilyDev</h2>

<p>LilyDev is our &lsquo;remix&rsquo; of Ubuntu which contains all the
necessary dependencies to do lilypond development; for more
information, see <a name="index-LilyDev"></a>
<a href="contributor-big-page.html#lilydev">LilyDev</a>.
</p>
<a name="Preparing-the-build"></a>
<h4 class="subsubheading">Preparing the build</h4>

<p>To prepare the build directory, enter (or copy&amp;paste) the below
text.  This should take less than a minute.
</p>

<blockquote><pre class="example">cd ~/lilypond-git/
sh autogen.sh --noconfigure
mkdir -p build/
cd build/
../configure
</pre></blockquote>

<a name="Building-lilypond"></a>
<h4 class="subsubheading">Building <code>lilypond</code></h4>

<p>Compiling lilypond will likely take between 5 and 60 minutes,
depending on your computer&rsquo;s speed and available RAM.  We
recommend that you minimize the terminal window while it is
building; this can have a non-negligible effect on compilation
speed.
</p>
<blockquote><pre class="example">cd ~/lilypond-git/build/
make
</pre></blockquote>

<p>You may run the compiled <code>lilypond</code> with:
</p>
<blockquote><pre class="example">cd ~/lilypond-git/build/
out/bin/lilypond my-file.ly
</pre></blockquote>

<a name="Building-the-documentation"></a>
<h4 class="subsubheading">Building the documentation</h4>

<p>Compiling the documentation is a much more involved process, and
will likely take 2 to 10 hours.
</p>
<blockquote><pre class="example">cd ~/lilypond-git/build/
make
make doc
</pre></blockquote>

<p>The documentation is put in &lsquo;<tt>out-www/offline-root/</tt>&rsquo;.  You may
view the html files by entering the below text; we recommend that
you bookmark the resulting page:
</p>
<blockquote><pre class="example">firefox ~/lilypond-git/build/out-www/offline-root/index.html
</pre></blockquote>

<a name="Installing"></a>
<h4 class="subsubheading">Installing</h4>

<p>Don&rsquo;t.  There is no reason to install lilypond within LilyDev.
All development work can (and should) stay within the
&lsquo;<tt>$HOME/lilypond-git/</tt>&rsquo; directory, and any personal composition
or typesetting work should be done with an official GUB release.
</p>

<a name="Problems-and-other-options"></a>
<h4 class="subsubheading">Problems and other options</h4>

<p>To select different build options, or isolate certain parts of the
build, or to use multiple CPUs while building, read
<a href="#compiling">Compiling</a>.
</p>
<p>In particular, contributors working on the documentation should be
aware of some bugs in the build system, and should read the
workarounds in <a href="#generating-documentation">Generating documentation</a>.
</p>

<hr size="6">
<a name="Now-start-work_0021"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#quick-start" title="Beginning of this chapter or previous chapter"> &lt;&lt; Quick start&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#working-with-source-code" title="Next chapter">&nbsp;Working with source code &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#compiling-with-lilydev" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Compiling with LilyDev&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#quick-start" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Quick start&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#working-with-source-code" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Working with source code &gt; </a>]</td></tr></table>
<a name="now-start-work_0021"></a>
<h2 class="section">2.4 Now start work!</h2>

<p>LilyDev users may now skip to the chapter which is aimed at
their intended contributions:
</p>
<ul>
<li> <a href="#documentation-work">Documentation work</a>
</li><li> <a href="#translating-the-documentation">Translating the documentation</a>
</li><li> <a href="#website-work">Website work</a>
</li><li> <a href="#regression-tests">Regression tests</a>
</li><li> <a href="#programming-work">Programming work</a>
</li></ul>

<p>These chapters are mainly intended for people not using LilyDev,
but they contain extra information about the
&ldquo;behind-the-scenes&rdquo; activities.  We recommend that you read
these at your leisure, a few weeks after beginning work with
LilyDev.
</p>
<ul>
<li> <a href="#working-with-source-code">Working with source code</a>
</li><li> <a href="#compiling">Compiling</a>
</li></ul>





<hr size="6">
<a name="Working-with-source-code"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#quick-start" title="Beginning of this chapter or previous chapter"> &lt;&lt; Quick start&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#compiling" title="Next chapter">&nbsp;Compiling &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#now-start-work_0021" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Now start work!&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#index" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Top&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#manually-installing-lily_002dgit_002etcl" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Manually installing lily-git.tcl &gt; </a>]</td></tr></table>
<a name="working-with-source-code"></a>
<h1 class="chapter">3. Working with source code</h1>

<div class="warning"><p><strong>Note:</strong> New contributors should read <a href="#quick-start">Quick start</a>, and in
particular <a href="#lily_002dgit">lily-git</a>, instead of this chapter.
</p>
</div>
<p>Advanced contributors will find this material quite useful,
particularly if they are working on major new features.
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#manually-installing-lily_002dgit_002etcl" accesskey="1">3.1 Manually installing lily-git.tcl</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#starting-with-git" accesskey="2">3.2 Starting with Git</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#basic-git-procedures" accesskey="3">3.3 Basic Git procedures</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#advanced-git-procedures" accesskey="4">3.4 Advanced Git procedures</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#git-on-windows" accesskey="5">3.5 Git on Windows</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#repository-directory-structure" accesskey="6">3.6 Repository directory structure</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#other-git-documentation" accesskey="7">3.7 Other Git documentation</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>


<hr size="6">
<a name="Manually-installing-lily_002dgit_002etcl"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#working-with-source-code" title="Beginning of this chapter or previous chapter"> &lt;&lt; Working with source code&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#compiling" title="Next chapter">&nbsp;Compiling &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#working-with-source-code" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Working with source code&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#working-with-source-code" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Working with source code&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#starting-with-git" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Starting with Git &gt; </a>]</td></tr></table>
<a name="manually-installing-lily_002dgit_002etcl"></a>
<h2 class="section">3.1 Manually installing lily-git.tcl</h2>

<p>We have created an easy-to-use GUI to simplify git for new
contributors.  If you are comfortable with the command-line, then
skip ahead to <a href="#starting-with-git">Starting with Git</a>.
</p>
<div class="warning"><p><strong>Note:</strong> These instructions are only for people who are <em>not</em>
using <a href="#lilydev">LilyDev</a>.
</p>
</div>

<ol>
<li>
If you haven&rsquo;t already, download and install Git.

<ul>
<li> Windows users: download the <code>.exe</code> file labeled
&ldquo;Full installer for official Git&rdquo; from:

<blockquote><pre class="example"><a href="http://code.google.com/p/msysgit/downloads/list">http://code.google.com/p/msysgit/downloads/list</a>
</pre></blockquote>

</li><li> Other operating systems: either install <code>git</code> with
your package manager, or download it from the &ldquo;Binaries&rdquo;
section of:

<blockquote><pre class="example"><a href="http://git-scm.com/download">http://git-scm.com/download</a>
</pre></blockquote>

</li></ul>


</li><li>
Download the <code>lily-git.tcl</code> script from:


<table><tr><td>&nbsp;</td><td><pre class="smallexample"><a href="http://git.sv.gnu.org/cgit/lilypond.git/plain/scripts/auxiliar/lily-git.tcl">http://git.sv.gnu.org/cgit/lilypond.git/plain/scripts/auxiliar/lily-git.tcl</a>
</pre></td></tr></table>

</li><li>
To run the program from the command line, navigate to the
directory containing <code>lily-git.tcl</code> and enter:

<blockquote><pre class="example">wish lily-git.tcl
</pre></blockquote>

</li><li>
Click on the &ldquo;Get source&rdquo; button.

<p>This will create a directory called &lsquo;<tt>lilypond-git/</tt>&rsquo; within
your home directory, and will download the source code into that
directory (around 150&nbsp;Mb).  When the process is finished, the
&ldquo;Command output&rdquo; window will display &ldquo;Done&rdquo;, and the button
label will change to say &ldquo;Update source&rdquo;.
</p>
</li><li>
Navigate to the &lsquo;<tt>lilypond-git/</tt>&rsquo; directory to view the source
files.

</li></ol>

<div class="warning"><p><strong>Note:</strong> Throughout the rest of this manual, most command-line
input should be entered from &lsquo;<tt>~/lilypond-git/</tt>&rsquo;.  This is
referred to as the <em>top source directory</em>.
</p>
</div>
<p>Further instructions are in <a href="#how-to-use-lily_002dgit">How to use lily-git</a>.
</p>

<hr size="6">
<a name="Starting-with-Git"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#working-with-source-code" title="Beginning of this chapter or previous chapter"> &lt;&lt; Working with source code&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#compiling" title="Next chapter">&nbsp;Compiling &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#manually-installing-lily_002dgit_002etcl" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Manually installing lily-git.tcl&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#working-with-source-code" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Working with source code&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#setting-up" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Setting up &gt; </a>]</td></tr></table>
<a name="starting-with-git"></a>
<h2 class="section">3.2 Starting with Git</h2>

<p>Using the Git program directly (as opposed to using the
<code>lily-git.tcl</code> GUI) allows you to have much greater control
over the contributing process.  You should consider using Git if
you want to work on complex projects, or if you want to work on
multiple projects concurrently.
</p>

<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#setting-up" accesskey="1">3.2.1 Setting up</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#git-for-the-impatient" accesskey="2">3.2.2 Git for the impatient</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#other-repositories" accesskey="3">3.2.3 Other repositories</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#downloading-remote-branches" accesskey="4">3.2.4 Downloading remote branches</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>


<hr size="6">
<a name="Setting-up"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#working-with-source-code" title="Beginning of this chapter or previous chapter"> &lt;&lt; Working with source code&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#compiling" title="Next chapter">&nbsp;Compiling &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#starting-with-git" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Starting with Git&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#starting-with-git" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Starting with Git&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#installing-git" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Installing Git &gt; </a>]</td></tr></table>
<a name="setting-up"></a>
<h3 class="subsection">3.2.1 Setting up</h3>

<div class="warning"><p><strong>Note:</strong> These instructions assume that you are using the
command-line version of Git 1.5 or higher.  Windows users should
skip to <a href="#git-on-windows">Git on Windows</a>.
</p>
</div>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#installing-git" accesskey="1">Installing Git</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#initializing-a-repository" accesskey="2">Initializing a repository</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#configuring-git" accesskey="3">Configuring Git</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>


<hr size="6">
<a name="Installing-Git"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#working-with-source-code" title="Beginning of this chapter or previous chapter"> &lt;&lt; Working with source code&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#compiling" title="Next chapter">&nbsp;Compiling &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#setting-up" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Setting up&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#setting-up" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Setting up&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#initializing-a-repository" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Initializing a repository &gt; </a>]</td></tr></table>
<a name="installing-git"></a>
<h4 class="unnumberedsubsubsec">Installing Git</h4>

<p>If you are using a Unix-based machine, the easiest way to download
and install Git is through a package manager such as <code>rpm</code>
or <code>apt-get</code> &ndash; the installation is generally automatic.
The only required package is (usually) called <code>git-core</code>,
although some of the auxiliary <code>git<var>*</var></code> packages are
also useful (such as <code>gitk</code>).
</p>
<p>Alternatively, you can visit the Git website
(<a href="http://git-scm.com">http://git-scm.com/</a>) for downloadable binaries and
tarballs.
</p>

<hr size="6">
<a name="Initializing-a-repository"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#working-with-source-code" title="Beginning of this chapter or previous chapter"> &lt;&lt; Working with source code&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#compiling" title="Next chapter">&nbsp;Compiling &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#installing-git" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Installing Git&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#setting-up" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Setting up&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#configuring-git" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Configuring Git &gt; </a>]</td></tr></table>
<a name="initializing-a-repository"></a>
<h4 class="unnumberedsubsubsec">Initializing a repository</h4>

<p>Once Git is installed, get a copy of the source code:
</p>
<blockquote><pre class="example">git clone git://git.sv.gnu.org/lilypond.git ~/lilypond-git
</pre></blockquote>

<p>The above command will put the it in &lsquo;<tt>~/lilypond-git</tt>&rsquo;, where
<code>~</code> represents your home directory.
</p>
<a name="Technical-details-3"></a>
<h4 class="subsubheading">Technical details</h4>

<p>This creates (within the &lsquo;<tt>~/lilypond-git/</tt>&rsquo; directory) a
subdirectory called &lsquo;<tt>.git/</tt>&rsquo;, which Git uses to keep track of
changes to the repository, among other things.  Normally you don&rsquo;t
need to access it, but it&rsquo;s good to know it&rsquo;s there.
</p>

<hr size="6">
<a name="Configuring-Git"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#working-with-source-code" title="Beginning of this chapter or previous chapter"> &lt;&lt; Working with source code&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#compiling" title="Next chapter">&nbsp;Compiling &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#initializing-a-repository" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Initializing a repository&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#setting-up" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Setting up&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#git-for-the-impatient" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Git for the impatient &gt; </a>]</td></tr></table>
<a name="configuring-git"></a>
<h4 class="unnumberedsubsubsec">Configuring Git</h4>

<div class="warning"><p><strong>Note:</strong> Throughout the rest of this manual, all command-line
input should be entered from the top directory of the Git
repository being discussed (eg. &lsquo;<tt>~/lilypond-git/</tt>&rsquo;).  This is
referred to as the <em>top source directory</em>.
</p>
</div>
<p>Before working with the copy of the main LilyPond repository, you
should configure some basic settings with the
<code>git&nbsp;config</code> command.  Git allows you to set both
global and repository-specific options.
</p>
<p>To configure settings that affect all repositories, use the
&lsquo;<samp>--global</samp>&rsquo; command line option.  For example, the first
two options that you should always set are your <var>name</var> and
<var>email</var>, since Git needs these to keep track of commit
authors:
</p>
<blockquote><pre class="example">git config --global user.name &quot;<var>John Smith</var>&quot;
git config --global user.email <var>john@example.com</var>
</pre></blockquote>

<p>To configure Git to use colored output where possible, use:
</p>
<blockquote><pre class="example">git config --global color.ui auto
</pre></blockquote>

<p>The text editor that opens when using <code>git&nbsp;commit</code>
can also be changed.  If none of your editor-related environment
variables are set ($GIT_EDITOR, $VISUAL, or $EDITOR), the default
editor is usually <code>vi</code> or <code>vim</code>.  If you&rsquo;re not
familiar with either of these, you should probably change the
default to an editor that you know how to use.  For example, to
change the default editor to <code>nano</code>, enter:
</p>
<blockquote><pre class="example">git config --global core.editor <var>nano</var>
</pre></blockquote>

<p>Finally, and in some ways most importantly, let&rsquo;s make sure that
we know what branch we&rsquo;re on.  If you&rsquo;re not using LilyDev, add
this to your &lsquo;<tt>~/.bashrc</tt>&rsquo;:
</p>
<pre class="verbatim">export PS1=&quot;\u@\h \w\$(__git_ps1)$ &quot;
</pre>
<p>If you are not using LilyDev, you may need to install the
additional <code>git-completion</code> package, but it is definitely
worth it.
</p>

<a name="Technical-details"></a>
<h4 class="subsubheading">Technical details</h4>

<p>Git stores the information entered with
<code>git&nbsp;config&nbsp;--global</code> in the file
&lsquo;<tt>.gitconfig</tt>&rsquo;, located in your home directory.  This file can
also be modified directly, without using
<code>git&nbsp;config</code>.  The &lsquo;<tt>.gitconfig</tt>&rsquo; file generated
by the above commands would look like this:
</p>
<blockquote><pre class="example">[user]
        name = John Smith
        email = john@example.com
[color]
        ui = auto
[core]
        editor = nano
</pre></blockquote>

<p>Using the <code>git&nbsp;config</code> command <em>without</em> the
&lsquo;<samp>--global</samp>&rsquo; option configures repository-specific settings,
which are stored in the file &lsquo;<tt>.git/config</tt>&rsquo;.  This file is
created when a repository is initialized (using
<code>git&nbsp;init</code>), and by default contains these lines:
</p>
<blockquote><pre class="example">[core]
        repositoryformatversion = 0
        filemode = true
        bare = false
        logallrefupdates = true
</pre></blockquote>

<p>However, since different repository-specific options are
recommended for different development tasks, it is best to avoid
setting any now.  Specific recommendations will be mentioned later
in this manual.
</p>

<hr size="6">
<a name="Git-for-the-impatient"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#working-with-source-code" title="Beginning of this chapter or previous chapter"> &lt;&lt; Working with source code&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#compiling" title="Next chapter">&nbsp;Compiling &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#configuring-git" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Configuring Git&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#starting-with-git" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Starting with Git&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#other-repositories" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Other repositories &gt; </a>]</td></tr></table>
<a name="git-for-the-impatient"></a>
<h3 class="subsection">3.2.2 Git for the impatient</h3>

<div class="advanced"><p><strong>Advanced note:</strong> The intent of this subsection is to get you working on lilypond as
soon as possible.  If you want to learn about git, go read
<a href="#other-git-documentation">Other Git documentation</a>.
<br>
Also, these instructions are designed to eliminate the most common
problems we have found in using git.  If you already know git and
have a different way of working, great!  Feel free to ignore the
advice in this subsection.
</p>
</div>

<p>Ok, so you&rsquo;ve been using <code>lily-git.tcl</code> for a while, but
it&rsquo;s time to take the next step.  Since our review process delays
patches by 60-120 hours, and you want to be able to work on other
stuff while your previous work is getting reviewed, you&rsquo;re going
to use <strong>branches</strong>.
</p>
<p>You can think of a branch as being a separate copy of the source
code.  But don&rsquo;t worry about it.
</p>
<a name="Start-work_003a-make-a-new-branch"></a>
<h4 class="subsubheading">Start work: make a new branch</h4>

<p>Let&rsquo;s pretend you want to add a section to the Contributor&rsquo;s Guide
about using branches.
</p>
<p>Start by updating the repository, then making a new branch.  Call
the branch anything you want as long as the name starts with
<code>dev/</code>.  Branch names that don&rsquo;t begin with <code>dev/</code> are
reserved for special things in lilypond.
</p>
<blockquote><pre class="example">git checkout master
git pull -r origin master
git branch dev/cg
</pre></blockquote>

<a name="Switch-to-that-branch"></a>
<h4 class="subsubheading">Switch to that branch</h4>

<p>Nothing has happened to the files yet.  Let&rsquo;s change into the new
branch.  You can think of this as &ldquo;loading a file&rdquo;, although in
this case it&rsquo;s really &ldquo;loading a directory and subdirectories
full of files&rdquo;.
</p>
<blockquote><pre class="example">git checkout dev/cg
</pre></blockquote>

<p>Your prompt now shows you that you&rsquo;re on the other branch:
</p>
<blockquote><pre class="example">gperciva@LilyDev:~/lilypond-git (dev/cg)$
</pre></blockquote>

<p>To be able to manage multiple lilypond issues at once, you&rsquo;ll need to switch
branches.  You should have each lilypond issue on a separate branch.
Switching branches is easy:
</p>
<blockquote><pre class="example">git checkout master
git checkout origin/staging
git checkout origin/release/unstable
git checkout dev/cg
</pre></blockquote>

<p>Branches that begin with <code>origin/</code> are part of the remote repository,
rather than your local repository, so when you check them out you get a 
temporary local branch.  You should never make changes directly on a
branch beginning with <code>origin/</code>.  You get changes into the remote
repository by making them in local branches, and then pushing them to
<code>origin/staging</code> as described below. 
</p>
<a name="Make-your-changes"></a>
<h4 class="subsubheading">Make your changes</h4>

<p>Edit files, then commit them.
</p>
<blockquote><pre class="example">git commit -a
</pre></blockquote>


<p>Remember how I said that switching to a branch was like
&ldquo;loading a directory&rdquo;?  Well, you&rsquo;ve just &ldquo;saved a
directory&rdquo;, so that you can &ldquo;load&rdquo; it later.
</p>
<div class="advanced"><p><strong>Advanced note:</strong> If you have used <code>cvs</code> or <code>svn</code>, you may
be very confused: those programs use &ldquo;commit&rdquo; to mean
&ldquo;upload my changes to the shared source repository&rdquo;.
Unfortunately, just to be different, <code>git commit</code>
means &ldquo;save my changes to the files&rdquo;.
</p>
</div>
<p>When you create a new file, you need to add it to git, then commit it:
</p>
<blockquote><pre class="example">git add input/regression/avoid-crash-on-condition.ly
git commit -a
</pre></blockquote>


<p>Edit more files.  Commit them again.  Edit yet more files, commit
them again.  Go eat dinner.  Switch to <code>master</code> so you can
play with the latest changes from other developers.  Switch back
to your branch and edit some more.  Commit those changes.
</p>
<p>At this stage, don&rsquo;t worry about how many commits you have.
</p>

<a name="Save-commits-to-external-files"></a>
<h4 class="subsubheading">Save commits to external files</h4>

<p>Branches are nerve-wracking until you get used to them.  You can
save your hard work as individual &lsquo;<tt>.patch</tt>&rsquo; files.  Be sure to
commit your changes first.
</p>
<blockquote><pre class="example">git commit -a
git format-patch master
</pre></blockquote>

<p>I personally have between 4 and 20 of those files saved in a
special folder at any point in time.  Git experts might laugh as
that behavior, but I feel a <em>lot</em> better knowing that I&rsquo;ve
got those backups.
</p>

<a name="Prepare-your-branch-for-review"></a>
<h4 class="subsubheading">Prepare your branch for review</h4>

<p>After committing, you can update your branch with the latest master:
</p>
<blockquote><pre class="example">git commit -a
git checkout master
git pull -r origin master
git checkout dev/cg
git rebase master
</pre></blockquote>


<p>Due to the speed of lilypond development, sometimes
<code>master</code> has changed so much that your branch can no
longer be applied to it.  In that happens, you will have a merge
conflict.  Stop for a moment to either cry or have a stiff drink,
then proceed to <a href="#merge-conflicts">Merge conflicts</a>.
</p>

<a name="Upload-your-branch"></a>
<h4 class="subsubheading">Upload your branch</h4>

<p>Finally, you&rsquo;re finished your changes.  Time to upload for review.
Make sure that you&rsquo;re on your branch, then upload:
</p>
<blockquote><pre class="example">git checkout dev/cg
git-cl upload master
</pre></blockquote>


<a name="Wait-for-reviews"></a>
<h4 class="subsubheading">Wait for reviews</h4>

<p>While you&rsquo;re waiting for a countdown and reviews, go back to
master, make a <code>dev/doc-beams</code> branch, and start adding doc
suggestions from issue 12345 from the tracker.  Or make a
<code>dev/page-breaks</code> and fix bug in page breaking.  Or whatever.
Don&rsquo;t worry, your <code>dev/cg</code> is safe.
</p>

<a name="Combining-commits-_0028optional-unless-you-have-broken-commits_0029"></a>
<h4 class="subsubheading">Combining commits (optional unless you have broken commits)</h4>

<p>Does the history of your branch look good?
</p>
<blockquote><pre class="example">gitk
</pre></blockquote>

<p>If you have a lot of commits on your branch, you might want to
combine some of them.  Alternately, you may like your commits, but
want to edit the commit messages.
</p>
<blockquote><pre class="example">git rebase -i master
</pre></blockquote>

<p>Follow instructions on the screen.
</p>
<div class="warning"><p><strong>Note:</strong> This step gives you the power to completely lose your
work.  Make a backup of your commits by saving them to
&lsquo;<tt>.patch</tt>&rsquo; files before playing with this.  If you do lose
your work, don&rsquo;t despair.  You can get it back by using <code>git reflog</code>.
The use of <code>git reflog</code> is not covered here.
</p>
</div>
<div class="warning"><p><strong>Note:</strong> If any of the commits on your branch represent partial work that will
not pass <var>make &amp;&amp; make doc</var>, you <strong>must</strong> squash these 
commits into a working commit.  Otherwise, your push will break staging
and will not be able to be merged to master.  In general, you will
be safer to have one commit per push.
</p>
</div>

<a name="Push-to-staging"></a>
<h4 class="subsubheading">Push to staging</h4>

<p>When you&rsquo;ve got the coveted <code>Patch-push</code> status, time to
prepare your upload:
</p>
<blockquote><pre class="example">git fetch
git rebase origin/staging dev/cg~0
gitk HEAD 
</pre></blockquote>

<div class="warning"><p><strong>Note:</strong> Do not skip the <code>gitk</code> step; a quick 5-second
check of the visual history can save a great deal of frustration
later on.  You should see a set of your commits that are ahead of
<code>origin/staging</code>, with no label for the top commit &ndash; only a
SHA1 id.
</p>
</div>
<div class="warning"><p><strong>Note:</strong> If <code>origin/staging</code> and <code>origin/master</code> are the
same commit, your branch (<code>dev/cg</code> in the example) will also
be at the top of the <code>gitk</code> tree.  This is normal.
</p>
</div>
<p>If everything looks good, push it:
</p>
<blockquote><pre class="example">git push origin HEAD:staging
</pre></blockquote>

<p>Then change back to your working branch:
</p>
<blockquote><pre class="example">git checkout dev/cg
</pre></blockquote>

<div class="warning"><p><strong>Note:</strong> It is a best practice to avoid rebasing any of your branches
to <code>origin/staging</code>.  If <code>origin/staging</code> is broken, it
will be deleted and rebuilt.  If you have rebased one of your branches
to <code>origin/staging</code>, the broken commits can end up in your branch.
The commands given above do the rebase on a temporary branch, and avoid
changing your working branch.
</p>
</div>

<a name="Delete-your-branch-_0028safe_0029"></a>
<h4 class="subsubheading">Delete your branch (safe)</h4>

<p>After a few hours, if there&rsquo;s nothing wrong with your branch, it
should be automatically moved to <code>origin/master</code>.  Update,
then try removing your branch:
</p>
<blockquote><pre class="example">git checkout master
git pull -r origin master
git branch -d dev/cg
</pre></blockquote>

<p>The last command will fail if the contents of <code>dev/cg</code> are
not present in <code>origin/master</code>.
</p>

<a name="Delete-your-branch-_0028UNSAFE_0029"></a>
<h4 class="subsubheading">Delete your branch (UNSAFE)</h4>

<p>Sometimes everything goes wrong.  If you want to remove a branch even though 
it will cause your work to be lost (that is, if the contents of <code>dev/cg</code>
are <strong>not</strong> present in master), follow the instructions in &ldquo;Delete
your branch (safe)&rdquo;, but replace the <code>-d</code> on the final line with 
a <code>-D</code>.
</p>

<hr size="6">
<a name="Other-repositories"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#working-with-source-code" title="Beginning of this chapter or previous chapter"> &lt;&lt; Working with source code&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#compiling" title="Next chapter">&nbsp;Compiling &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#git-for-the-impatient" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Git for the impatient&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#starting-with-git" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Starting with Git&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#lilypond_002dextra" title="Next section in reading order" accesskey="n" rel="next">&nbsp;lilypond-extra &gt; </a>]</td></tr></table>
<a name="other-repositories"></a>
<h3 class="subsection">3.2.3 Other repositories</h3>

<p>We have a few other code repositories.
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#lilypond_002dextra" accesskey="1">lilypond-extra</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#grand-unified-builder-_0028gub_0029" accesskey="2">Grand Unified Builder (GUB)</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#lilypad" accesskey="3">lilypad</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#yet-more-repositories" accesskey="4">yet more repositories</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr size="6">
<a name="lilypond_002dextra"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#working-with-source-code" title="Beginning of this chapter or previous chapter"> &lt;&lt; Working with source code&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#compiling" title="Next chapter">&nbsp;Compiling &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#other-repositories" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Other repositories&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#other-repositories" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Other repositories&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#grand-unified-builder-_0028gub_0029" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Grand Unified Builder (GUB) &gt; </a>]</td></tr></table>
<a name="lilypond_002dextra"></a>
<h4 class="unnumberedsubsubsec">lilypond-extra</h4>

<p>There is a separate repository for general administrative scripts,
as well as pictures and media files for the website.  People
interested in working on the website should download this
repository, and set their <code>$LILYPOND_WEB_MEDIA_GIT</code>
environment variable to point to that repository.
</p>
<blockquote><pre class="example"><a href="https://github.com/gperciva/lilypond-extra">https://github.com/gperciva/lilypond-extra</a>
</pre></blockquote>

<p>To configure an environment variable in bash (the default for most
GNU/Linux distributions),
</p>
<blockquote><pre class="example">export LILYPOND_WEB_MEDIA_GIT=$HOME/dir/of/lilypond-extra/
</pre></blockquote>

<hr size="6">
<a name="Grand-Unified-Builder-_0028GUB_0029"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#working-with-source-code" title="Beginning of this chapter or previous chapter"> &lt;&lt; Working with source code&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#compiling" title="Next chapter">&nbsp;Compiling &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#lilypond_002dextra" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; lilypond-extra&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#other-repositories" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Other repositories&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#lilypad" title="Next section in reading order" accesskey="n" rel="next">&nbsp;lilypad &gt; </a>]</td></tr></table>
<a name="grand-unified-builder-_0028gub_0029"></a>
<h4 class="unnumberedsubsubsec">Grand Unified Builder (GUB)</h4>

<p>Another item of interest might be the Grand Unified Builder, our
cross-platform building tool.  Since it is used by other projects as
well, it is not stored in our gub repository.  For more info, see
<a href="http://lilypond.org/gub">http://lilypond.org/gub</a>.
</p>
<p>There are two locations for this repository: the version being used to
build lilypond, which is at
</p>
<blockquote><pre class="example"><a href="http://github.com/gperciva/gub">http://github.com/gperciva/gub</a>
</pre></blockquote>

<p>and the original version by Jan Nieuwenhuizen, kept at
</p>
<blockquote><pre class="example"><a href="http://github.com/janneke/gub">http://github.com/janneke/gub</a>
</pre></blockquote>


<hr size="6">
<a name="lilypad"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#working-with-source-code" title="Beginning of this chapter or previous chapter"> &lt;&lt; Working with source code&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#compiling" title="Next chapter">&nbsp;Compiling &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#grand-unified-builder-_0028gub_0029" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Grand Unified Builder (GUB)&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#other-repositories" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Other repositories&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#yet-more-repositories" title="Next section in reading order" accesskey="n" rel="next">&nbsp;yet more repositories &gt; </a>]</td></tr></table>
<a name="lilypad"></a>
<h4 class="unnumberedsubsubsec">lilypad</h4>

<p>Our binary releases on MacOS X and Windows contain a lightweight
text editor.  This code is here:
</p>
<blockquote><pre class="example">https://github.com/gperciva/lilypad
</pre></blockquote>


<hr size="6">
<a name="yet-more-repositories"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#working-with-source-code" title="Beginning of this chapter or previous chapter"> &lt;&lt; Working with source code&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#compiling" title="Next chapter">&nbsp;Compiling &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#lilypad" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; lilypad&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#other-repositories" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Other repositories&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#downloading-remote-branches" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Downloading remote branches &gt; </a>]</td></tr></table>
<a name="yet-more-repositories"></a>
<h4 class="unnumberedsubsubsec">yet more repositories</h4>

<p>There are a few other repositories floating around, which will
hopefully be documented in the near future.
</p>

<hr size="6">
<a name="Downloading-remote-branches"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#working-with-source-code" title="Beginning of this chapter or previous chapter"> &lt;&lt; Working with source code&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#compiling" title="Next chapter">&nbsp;Compiling &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#yet-more-repositories" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; yet more repositories&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#starting-with-git" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Starting with Git&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#organization-of-remote-branches" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Organization of remote branches &gt; </a>]</td></tr></table>
<a name="downloading-remote-branches"></a>
<h3 class="subsection">3.2.4 Downloading remote branches</h3>

<div class="warning"><p><strong>Note:</strong> contains obsolete + misleading info
</p>
</div>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#organization-of-remote-branches" accesskey="1">Organization of remote branches</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#lilypond-repository-sources" accesskey="2">LilyPond repository sources</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#downloading-individual-branches" accesskey="3">Downloading individual branches</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#downloading-all-remote-branches" accesskey="4">Downloading all remote branches</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#other-branches" accesskey="5">Other branches</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>


<hr size="6">
<a name="Organization-of-remote-branches"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#working-with-source-code" title="Beginning of this chapter or previous chapter"> &lt;&lt; Working with source code&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#compiling" title="Next chapter">&nbsp;Compiling &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#downloading-remote-branches" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Downloading remote branches&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#downloading-remote-branches" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Downloading remote branches&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#lilypond-repository-sources" title="Next section in reading order" accesskey="n" rel="next">&nbsp;LilyPond repository sources &gt; </a>]</td></tr></table>
<a name="organization-of-remote-branches"></a>
<h4 class="unnumberedsubsubsec">Organization of remote branches</h4>


<p>The main LilyPond repository is organized into <em>branches</em> to
facilitate development.  These are often called <em>remote</em>
branches to distinguish them from <em>local</em> branches you might
create yourself (see <a href="#using-local-branches">Using local branches</a>).
</p>
<p>The <code>master</code> branch contains all the source files used to
build LilyPond, which includes the program itself (both stable and
development releases), the documentation (and its translations),
and the website.  Generally, the <code>master</code> branch is expected
to compile successfully.
</p>
<p>The <code>translation</code> branch is a side branch that
allows translators to work without needing to worry about
compilation problems.  Periodically, the Translation Meister
(after verifying that it doesn&rsquo;t break compilation), will
<em>merge</em> this branch into <code>staging</code> to incorporate
recent translations.  Similarly, the <code>master</code> branch is
usually merged into the <code>translation</code> branch after
significant changes to the English documentation.  See
<a href="#translating-the-documentation">Translating the documentation</a> for details.
</p>

<hr size="6">
<a name="LilyPond-repository-sources"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#working-with-source-code" title="Beginning of this chapter or previous chapter"> &lt;&lt; Working with source code&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#compiling" title="Next chapter">&nbsp;Compiling &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#organization-of-remote-branches" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Organization of remote branches&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#downloading-remote-branches" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Downloading remote branches&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#downloading-individual-branches" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Downloading individual branches &gt; </a>]</td></tr></table>
<a name="lilypond-repository-sources"></a>
<h4 class="unnumberedsubsubsec">LilyPond repository sources</h4>


<p>The recommended source for downloading a copy of the main
repository is:
</p>
<blockquote><pre class="example">git://git.sv.gnu.org/lilypond.git
</pre></blockquote>

<p>However, if your internet router filters out connections using the
GIT protocol, or if you experience difficulty connecting via GIT,
you can try these other sources:
</p>
<blockquote><pre class="example">ssh://git.sv.gnu.org/srv/git/lilypond.git
http://git.sv.gnu.org/r/lilypond.git
</pre></blockquote>

<p>The SSH protocol can only be used if your system is properly set
up to use it.  Also, the HTTP protocol is slowest, so it should
only be used as a last resort.
</p>

<hr size="6">
<a name="Downloading-individual-branches"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#working-with-source-code" title="Beginning of this chapter or previous chapter"> &lt;&lt; Working with source code&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#compiling" title="Next chapter">&nbsp;Compiling &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#lilypond-repository-sources" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; LilyPond repository sources&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#downloading-remote-branches" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Downloading remote branches&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#downloading-all-remote-branches" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Downloading all remote branches &gt; </a>]</td></tr></table>
<a name="downloading-individual-branches"></a>
<h4 class="unnumberedsubsubsec">Downloading individual branches</h4>

<div class="warning"><p><strong>Note:</strong> obsolete, should be deleted!
</p>
</div>

<p>Once you have initialized an empty Git repository on your system
(see <a href="#initializing-a-repository">Initializing a repository</a>), you can download a remote
branch into it.  Make sure you know which branch you want to start
with.
</p>
<p>To download the <code>master</code> branch, enter the following:
</p>
<blockquote><pre class="example">git remote add -ft master -m master \
  origin git://git.sv.gnu.org/lilypond.git/
</pre></blockquote>

<p>To download the <code>translation</code> branch, enter:
</p>
<blockquote><pre class="example">git remote add -ft translation -m \
  translation origin git://git.sv.gnu.org/lilypond.git/
</pre></blockquote>

<p>The <code>git&nbsp;remote&nbsp;add</code> process could take up to
ten minutes, depending on the speed of your connection.  The
output will be something like this:
</p>
<blockquote><pre class="example">Updating origin
remote: Counting objects: 235967, done.
remote: Compressing objects: 100% (42721/42721), done.
remote: Total 235967 (delta 195098), reused 233311 (delta 192772)
Receiving objects: 100% (235967/235967), 68.37 MiB | 479 KiB/s, done.
Resolving deltas: 100% (195098/195098), done.
From git://git.sv.gnu.org/lilypond
 * [new branch]      master     -&gt; origin/master
From git://git.sv.gnu.org/lilypond
 * [new tag]         flower/1.0.1 -&gt; flower/1.0.1
 * [new tag]         flower/1.0.10 -&gt; flower/1.0.10

 * [new tag]         release/2.9.6 -&gt; release/2.9.6
 * [new tag]         release/2.9.7 -&gt; release/2.9.7
</pre></blockquote>

<p>When <code>git&nbsp;remote&nbsp;add</code> is finished, the remote
branch should be downloaded into your repository&mdash;though not yet
in a form that you can use.  In order to browse the source code
files, you need to <em>create</em> and <em>checkout</em> your own
local branch.  In this case, however, it is easier to have Git
create the branch automatically by using the <code>checkout</code>
command on a non-existent branch.  Enter the following:
</p>
<blockquote><pre class="example">git checkout -b <var>branch</var> origin/<var>branch</var>
</pre></blockquote>

<p>where <code><var>branch</var></code> is the name of your tracking branch,
either <code>master</code> or <code>translation</code>.
</p>
<p>Git will issue some warnings; this is normal:
</p>
<blockquote><pre class="example">warning: You appear to be on a branch yet to be born.
warning: Forcing checkout of origin/master.
Branch master set up to track remote branch master from origin.
Already on 'master'
</pre></blockquote>

<p>By now the source files should be accessible&mdash;you should be able
to edit any files in the &lsquo;<tt>lilypond-git/</tt>&rsquo; directory using a
text editor of your choice.  But don&rsquo;t start just yet!  Before
editing any source files, learn how to keep your changes organized
and prevent problems later&mdash;read <a href="#basic-git-procedures">Basic Git procedures</a>.
</p>
<a name="Technical-Details"></a>
<h4 class="subsubheading">Technical Details</h4>

<p>The <code>git&nbsp;remote&nbsp;add</code> command should add some
lines to your local repository&rsquo;s &lsquo;<tt>.git/config</tt>&rsquo; file:
</p>
<blockquote><pre class="example">[remote &quot;origin&quot;]
        url = git://git.sv.gnu.org/lilypond.git/
        fetch = +refs/heads/master:refs/remotes/origin/master
</pre></blockquote>


<hr size="6">
<a name="Downloading-all-remote-branches"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#working-with-source-code" title="Beginning of this chapter or previous chapter"> &lt;&lt; Working with source code&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#compiling" title="Next chapter">&nbsp;Compiling &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#downloading-individual-branches" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Downloading individual branches&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#downloading-remote-branches" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Downloading remote branches&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#other-branches" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Other branches &gt; </a>]</td></tr></table>
<a name="downloading-all-remote-branches"></a>
<h4 class="unnumberedsubsubsec">Downloading all remote branches</h4>


<p>To download all remote branches at once, you can <code>clone</code>
the entire repository:
</p>
<blockquote><pre class="example">git clone git://git.sv.gnu.org/lilypond.git
</pre></blockquote>


<hr size="6">
<a name="Other-branches"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#working-with-source-code" title="Beginning of this chapter or previous chapter"> &lt;&lt; Working with source code&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#compiling" title="Next chapter">&nbsp;Compiling &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#downloading-all-remote-branches" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Downloading all remote branches&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#downloading-remote-branches" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Downloading remote branches&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#basic-git-procedures" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Basic Git procedures &gt; </a>]</td></tr></table>
<a name="other-branches"></a>
<h4 class="unnumberedsubsubsec">Other branches</h4>

<p>Most contributors will never need to touch the other branches.  If
you wish to do so, you will need more familiarity with Git; please
see <a href="#other-git-documentation">Other Git documentation</a>.
</p>
<ul>
<li> <code>dev/XYZ</code>:
These branches are for individual developers.  They store code
which is not yet stable enough to be added to the <code>master</code>
branch.

</li><li> <code>stable/XYZ</code>:
The branches are kept for archival reasons.

</li><li> <code>archive/XYZ</code>:
The branches are kept for archival reasons.

</li></ul>


<hr size="6">
<a name="Basic-Git-procedures"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#working-with-source-code" title="Beginning of this chapter or previous chapter"> &lt;&lt; Working with source code&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#compiling" title="Next chapter">&nbsp;Compiling &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#other-branches" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Other branches&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#working-with-source-code" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Working with source code&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#the-git-contributor_0027s-cycle" title="Next section in reading order" accesskey="n" rel="next">&nbsp;The Git contributor's cycle &gt; </a>]</td></tr></table>
<a name="basic-git-procedures"></a>
<h2 class="section">3.3 Basic Git procedures</h2>


<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#the-git-contributor_0027s-cycle" accesskey="1">3.3.1 The Git contributor&rsquo;s cycle</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#pulling-and-rebasing" accesskey="2">3.3.2 Pulling and rebasing</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#using-local-branches" accesskey="3">3.3.3 Using local branches</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#commits-and-patches" accesskey="4">3.3.4 Commits and patches</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>


<hr size="6">
<a name="The-Git-contributor_0027s-cycle"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#working-with-source-code" title="Beginning of this chapter or previous chapter"> &lt;&lt; Working with source code&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#compiling" title="Next chapter">&nbsp;Compiling &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#basic-git-procedures" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Basic Git procedures&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#basic-git-procedures" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Basic Git procedures&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#pulling-and-rebasing" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Pulling and rebasing &gt; </a>]</td></tr></table>
<a name="the-git-contributor_0027s-cycle"></a>
<h3 class="subsection">3.3.1 The Git contributor&rsquo;s cycle</h3>


<p>Here is a simplified view of the contribution process on Git:
</p>
<ol>
<li>
Update your local repository by <em>pulling</em> the most recent
updates from the remote repository.

</li><li>
Edit source files within your local repository&rsquo;s <em>working
directory</em>.

</li><li>
<em>Commit</em> the changes you&rsquo;ve made to a local <em>branch</em>.

</li><li>
Generate a <em>patch</em> to share your changes with the developers.
</li></ol>


<hr size="6">
<a name="Pulling-and-rebasing"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#working-with-source-code" title="Beginning of this chapter or previous chapter"> &lt;&lt; Working with source code&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#compiling" title="Next chapter">&nbsp;Compiling &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#the-git-contributor_0027s-cycle" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; The Git contributor's cycle&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#basic-git-procedures" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Basic Git procedures&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#using-local-branches" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Using local branches &gt; </a>]</td></tr></table>
<a name="pulling-and-rebasing"></a>
<h3 class="subsection">3.3.2 Pulling and rebasing</h3>


<p>When developers push new patches to the <code>git.sv.gnu.org</code>
repository, your local repository is <strong>not</strong> automatically
updated.  It is important to keep your repository up-to-date by
periodically <em>pulling</em> the most recent <em>commits</em> from
the remote branch.  Developers expect patches to be as current as
possible, since outdated patches require extra work before they
can be used.
</p>
<p>Occasionally you may need to rework some of your own modifications
to match changes made to the remote branch (see <a href="#resolving-conflicts">Resolving conflicts</a>), and it&rsquo;s considerably easier to rework things
incrementally.  If you don&rsquo;t update your repository along the way,
you may have to spend a lot of time resolving branch conflicts and
reconfiguring much of the work you&rsquo;ve already done.
</p>
<p>Fortunately, Git is able to resolve certain types of branch
conflicts automatically with a process called <em>rebasing</em>.
When rebasing, Git tries to modify your old commits so they appear
as new commits (based on the latest updates).  For a more involved
explanation, see the <code>git-rebase</code> man page.
</p>
<p>To pull without rebasing (recommended for translators), use the
following command:
</p>
<blockquote><pre class="example">git pull    # recommended for translators
</pre></blockquote>

<p>If you&rsquo;re tracking the remote <code>master</code> branch, you should add
the &lsquo;<samp>-r</samp>&rsquo; option (short for &lsquo;<samp>--rebase</samp>&rsquo;) to keep commits
on your local branch current:
</p>
<blockquote><pre class="example">git pull -r # use with caution when translating
</pre></blockquote>

<p>If you don&rsquo;t edit translated documentation and don&rsquo;t want to type
&lsquo;<samp>-r</samp>&rsquo; every time, configure the master branch to rebase by
default with this command:
</p>
<blockquote><pre class="example">git config branch.master.rebase true
</pre></blockquote>

<p>If pull fails because of a message like
</p>
<blockquote><pre class="example">error: Your local changes to 'Documentation/learning/tutorial.itely'
would be overwritten by merge.  Aborting.
</pre></blockquote>

<p>or
</p>
<blockquote><pre class="example">Documentation/learning/tutorial.itely: needs update
refusing to pull with rebase: your working tree is not up-to-date
</pre></blockquote>

<p>it means that you have modified some files in you working tree
without committing changes (see <a href="#commits-and-patches">Commits and patches</a>); you
can use the <code>git&nbsp;stash</code> command to work around this:
</p>
<blockquote><pre class="example">git stash      # save uncommitted changes
git pull -r    # pull using rebase (translators omit &quot;-r&quot;)
git stash pop  # reapply previously saved changes
</pre></blockquote>

<p>Note that <code>git&nbsp;stash&nbsp;pop</code> will try to apply a
patch, and this may create a conflict.  If this happens, see
<a href="#resolving-conflicts">Resolving conflicts</a>.
</p>
<p>TODO: I think the next paragraph is confusing.  Perhaps prepare
the reader for new terms &lsquo;committish&rsquo; and &lsquo;head&rsquo;?  -mp
</p>
<div class="warning"><p><strong>Note:</strong> translators and documentation editors, if you have
changed committishes in the head of translated files using commits
you have not yet pushed to <code>git.sv.gnu.org</code>, please do not
rebase.  If you want to avoid wondering whether you should rebase
each time you pull, please always use committishes from master
and/or translation branch on <code>git.sv.gnu.org</code>, which
in particular implies that you must push your changes to
documentation except committishes updates (possibly after having
rebased), then update the committishes and push them.
</p>
</div>
<p>TODO: when committishes automatic conditional update have been
tested and documented, append the following to the warning above:
Note that using update-committishes make target generally touches
committishes.
</p>
<a name="Technical-details-1"></a>
<h4 class="subsubheading">Technical details</h4>

<p>The <code>git&nbsp;config</code> command mentioned above adds the
line <code>rebase = true</code> to the master branch in your local
repository&rsquo;s &lsquo;<tt>.git/config</tt>&rsquo; file:
</p>
<blockquote><pre class="example">[branch &quot;master&quot;]
        remote = origin
        merge = refs/heads/master
        rebase = true
</pre></blockquote>


<hr size="6">
<a name="Using-local-branches"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#working-with-source-code" title="Beginning of this chapter or previous chapter"> &lt;&lt; Working with source code&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#compiling" title="Next chapter">&nbsp;Compiling &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#pulling-and-rebasing" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Pulling and rebasing&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#basic-git-procedures" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Basic Git procedures&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#creating-and-removing-branches" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Creating and removing branches &gt; </a>]</td></tr></table>
<a name="using-local-branches"></a>
<h3 class="subsection">3.3.3 Using local branches</h3>


<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#creating-and-removing-branches" accesskey="1">Creating and removing branches</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#listing-branches-and-remotes" accesskey="2">Listing branches and remotes</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#checking-out-branches" accesskey="3">Checking out branches</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#merging-branches" accesskey="4">Merging branches</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>


<hr size="6">
<a name="Creating-and-removing-branches"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#working-with-source-code" title="Beginning of this chapter or previous chapter"> &lt;&lt; Working with source code&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#compiling" title="Next chapter">&nbsp;Compiling &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#using-local-branches" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Using local branches&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#using-local-branches" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Using local branches&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#listing-branches-and-remotes" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Listing branches and remotes &gt; </a>]</td></tr></table>
<a name="creating-and-removing-branches"></a>
<h4 class="unnumberedsubsubsec">Creating and removing branches</h4>


<p>Local branches are useful when you&rsquo;re working on several different
projects concurrently.  To create a new branch, enter:
</p>
<blockquote><pre class="example">git branch <var>name</var>
</pre></blockquote>

<p>To delete a branch, enter:
</p>
<blockquote><pre class="example">git branch -d <var>name</var>
</pre></blockquote>

<p>Git will ask you for confirmation if it sees that data would be
lost by deleting the branch.  Use &lsquo;<samp>-D</samp>&rsquo; instead of &lsquo;<samp>-d</samp>&rsquo;
to bypass this.  Note that you cannot delete a branch if it is
currently checked out.
</p>

<hr size="6">
<a name="Listing-branches-and-remotes"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#working-with-source-code" title="Beginning of this chapter or previous chapter"> &lt;&lt; Working with source code&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#compiling" title="Next chapter">&nbsp;Compiling &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#creating-and-removing-branches" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Creating and removing branches&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#using-local-branches" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Using local branches&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#checking-out-branches" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Checking out branches &gt; </a>]</td></tr></table>
<a name="listing-branches-and-remotes"></a>
<h4 class="unnumberedsubsubsec">Listing branches and remotes</h4>

<p>You can get the exact path or URL of all remote branches by
running:
</p>
<blockquote><pre class="example">git remote -v
</pre></blockquote>

<p>To list Git branches on your local repositories, run
</p>
<blockquote><pre class="example">git branch     # list local branches only
git branch -r  # list remote branches
git branch -a  # list all branches
</pre></blockquote>


<hr size="6">
<a name="Checking-out-branches"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#working-with-source-code" title="Beginning of this chapter or previous chapter"> &lt;&lt; Working with source code&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#compiling" title="Next chapter">&nbsp;Compiling &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#listing-branches-and-remotes" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Listing branches and remotes&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#using-local-branches" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Using local branches&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#merging-branches" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Merging branches &gt; </a>]</td></tr></table>
<a name="checking-out-branches"></a>
<h4 class="unnumberedsubsubsec">Checking out branches</h4>

<p>To know the currently checked out branch, i.e. the branch whose
source files are present in your working tree, read the first line
of the output of
</p>
<blockquote><pre class="example">git status
</pre></blockquote>

<p>The currently checked out branch is also marked with an asterisk
in the output of <code>git branch</code>.
</p>
<p>You can check out another branch <code><var>other_branch</var></code>, i.e.
check out <code><var>other_branch</var></code> to the working tree, by
running
</p>
<blockquote><pre class="example">git checkout <var>other_branch</var>
</pre></blockquote>

<p>Note that it is possible to check out another branch while having
uncommitted changes, but it is not recommended unless you know
what you are doing; it is recommended to run <code>git status</code>
to check this kind of issue before checking out another branch.
</p>
<hr size="6">
<a name="Merging-branches"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#working-with-source-code" title="Beginning of this chapter or previous chapter"> &lt;&lt; Working with source code&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#compiling" title="Next chapter">&nbsp;Compiling &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#checking-out-branches" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Checking out branches&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#using-local-branches" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Using local branches&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#commits-and-patches" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Commits and patches &gt; </a>]</td></tr></table>
<a name="merging-branches"></a>
<h4 class="unnumberedsubsubsec">Merging branches</h4>

<p>To merge branch <code><var>foo</var></code> into branch <code><var>bar</var></code>,
i.e. to &ldquo;add&rdquo; all changes made in branch <code><var>foo</var></code> to
branch <code><var>bar</var></code>, run
</p>
<blockquote><pre class="example">git checkout <var>bar</var>
git merge <var>foo</var>
</pre></blockquote>

<p>If any conflict happens, see <a href="#resolving-conflicts">Resolving conflicts</a>.
</p>
<p>There are common usage cases for merging: as a translator, you will
often want the Translations meister to merge <code>master</code> into
<code>translation</code>; on the other hand, the Translations meister wants
to merge <code>translation</code> into <code>staging</code> whenever he has
checked that <code>translation</code> builds successfully.
</p>

<hr size="6">
<a name="Commits-and-patches"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#working-with-source-code" title="Beginning of this chapter or previous chapter"> &lt;&lt; Working with source code&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#compiling" title="Next chapter">&nbsp;Compiling &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#merging-branches" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Merging branches&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#basic-git-procedures" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Basic Git procedures&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#understanding-commits" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Understanding commits &gt; </a>]</td></tr></table>
<a name="commits-and-patches"></a>
<h3 class="subsection">3.3.4 Commits and patches</h3>


<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#understanding-commits" accesskey="1">Understanding commits</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#making-commits" accesskey="2">Making commits</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#commit-messages" accesskey="3">Commit messages</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#making-patches" accesskey="4">Making patches</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#uploading-a-patch-for-review" accesskey="5">Uploading a patch for review</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>


<hr size="6">
<a name="Understanding-commits"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#working-with-source-code" title="Beginning of this chapter or previous chapter"> &lt;&lt; Working with source code&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#compiling" title="Next chapter">&nbsp;Compiling &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#commits-and-patches" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Commits and patches&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#commits-and-patches" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Commits and patches&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#making-commits" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Making commits &gt; </a>]</td></tr></table>
<a name="understanding-commits"></a>
<h4 class="unnumberedsubsubsec">Understanding commits</h4>

<p>Technically, a <em>commit</em> is a single point in the history of a
branch, but most developers use the term to mean a <em>commit
object</em>, which stores information about a particular revision.  A
single commit can record changes to multiple source files, and
typically represents one logical set of related changes (such as a
bug-fix).  You can list the ten most recent commits in your
current branch with this command:
</p>
<blockquote><pre class="example">git log -10 --oneline
</pre></blockquote>

<p>If you&rsquo;re using an older version of Git and get an &lsquo;unrecognized
argument&rsquo; error, use this instead:
</p>
<blockquote><pre class="example">git log -10 --pretty=oneline --abbrev-commit
</pre></blockquote>

<p>More interactive lists of the commits on the remote <code>master</code>
branch are available at
<a href="http://git.sv.gnu.org/gitweb/?p=lilypond.git;a=shortlog">http://git.sv.gnu.org/gitweb/?p=lilypond.git;a=shortlog</a> and
<a href="http://git.sv.gnu.org/cgit/lilypond.git/log">http://git.sv.gnu.org/cgit/lilypond.git/log/</a>.
</p>

<hr size="6">
<a name="Making-commits"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#working-with-source-code" title="Beginning of this chapter or previous chapter"> &lt;&lt; Working with source code&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#compiling" title="Next chapter">&nbsp;Compiling &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#understanding-commits" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Understanding commits&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#commits-and-patches" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Commits and patches&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#commit-messages" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Commit messages &gt; </a>]</td></tr></table>
<a name="making-commits"></a>
<h4 class="unnumberedsubsubsec">Making commits</h4>


<p>Once you have modified some source files in your working
directory, you can make a commit with the following procedure:
</p>
<ol>
<li>
Make sure you&rsquo;ve configured Git properly (see <a href="#configuring-git">Configuring Git</a>).  Check that your changes meet the requirements described in
<a href="#code-style">Code style</a> and/or <a href="#documentation-policy">Documentation policy</a>.  For advanced
edits, you may also want to verify that the changes don&rsquo;t break
the compilation process.

</li><li>
Run the following command:

<blockquote><pre class="example">git status
</pre></blockquote>

<p>to make sure you&rsquo;re on the right branch, and to see which files
have been modified, added or removed, etc.  You may need to tell
Git about any files you&rsquo;ve added by running one of these:
</p>
<blockquote><pre class="example">git add <var>file</var>  # add untracked <var>file</var> individually
git add .     # add all untracked files in current directory
</pre></blockquote>

<p>After <code>git&nbsp;add</code>, run <code>git&nbsp;status</code> again
to make sure you got everything.  You may also need to modify
&lsquo;<tt>GNUmakefile</tt>&rsquo;.
</p>
</li><li>
Preview the changes about to be committed (to make sure everything
looks right) with:

<blockquote><pre class="example">git diff HEAD
</pre></blockquote>

<p>The <code>HEAD</code> argument refers to the most recent commit on the
currently checked-out branch.
</p>
</li><li>
Generate the commit with:

<blockquote><pre class="example">git commit -a
</pre></blockquote>

<p>The &lsquo;<samp>-a</samp>&rsquo; is short for &lsquo;<samp>--all</samp>&rsquo; which includes modified
and deleted files, but only those newly created files that have
previously been added.
</p>
</li></ol>


<hr size="6">
<a name="Commit-messages"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#working-with-source-code" title="Beginning of this chapter or previous chapter"> &lt;&lt; Working with source code&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#compiling" title="Next chapter">&nbsp;Compiling &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#making-commits" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Making commits&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#commits-and-patches" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Commits and patches&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#making-patches" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Making patches &gt; </a>]</td></tr></table>
<a name="commit-messages"></a>
<h4 class="unnumberedsubsubsec">Commit messages</h4>


<p>When you run the <code>git&nbsp;commit&nbsp;-a</code> command, Git
automatically opens the default text editor so you can enter a
<em>commit message</em>.  If you find yourself in a foreign editing
environment, you&rsquo;re probably in <code>vi</code> or <code>vim</code>.  If
you want to switch to an editor you&rsquo;re more familiar with, quit by
typing <code>:q!</code> and pressing <code>&lt;Enter&gt;</code>.  See
<a href="#configuring-git">Configuring Git</a> for instructions on changing the default
editor.
</p>
<p>In any case, Git will open a text file for your commit message
that looks like this:
</p>
<blockquote><pre class="example">
# Please enter the commit message for your changes.  Lines starting
# with '#' will be ignored, and an empty message aborts the commit.
# On branch master
# Changes to be committed:
#   (use &quot;git reset HEAD &lt;file&gt;...&quot; to unstage)
#
#	modified:   working.itexi
#
</pre></blockquote>

<p>Your commit message should begin with a one-line summary
describing the change (no more than 50 characters long), and if
necessary a blank line followed by several lines giving the
details:
</p>
<blockquote><pre class="example">Doc: add Baerenreiter and Henle solo cello suites

Added comparison of solo cello suite engravings to new essay with
high-res images, fixed cropping on Finale example.
</pre></blockquote>

<p>Commit messages often start with a short prefix describing the
general location of the changes.  If a commit affects the
documentation in English (or in several languages simultaneously)
the commit message should be prefixed with &ldquo;Doc:&nbsp;&rdquo;.  If
the commit affects only one of the translations, the commit
message should be prefixed with &ldquo;Doc-<var>**</var>:&nbsp;&rdquo;, where
<var>**</var> is the two-letter language code.  Commits that affect the
website should use &ldquo;Web:&nbsp;&rdquo; for English, and
&ldquo;Web-<var>**</var>:&nbsp;&rdquo; for the other languages.  Also, changes
to a single file are often prefixed with the name of the file
involved.  Visit the links listed in <a href="#understanding-commits">Understanding commits</a>
for examples.
</p>

<hr size="6">
<a name="Making-patches"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#working-with-source-code" title="Beginning of this chapter or previous chapter"> &lt;&lt; Working with source code&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#compiling" title="Next chapter">&nbsp;Compiling &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#commit-messages" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Commit messages&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#commits-and-patches" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Commits and patches&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#uploading-a-patch-for-review" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Uploading a patch for review &gt; </a>]</td></tr></table>
<a name="making-patches"></a>
<h4 class="unnumberedsubsubsec">Making patches</h4>

<p>If you want to share your changes with other contributors and
developers, you need to generate <em>patches</em> from your commits.
We prefer it if you follow the instructions in
<a href="#uploading-a-patch-for-review">Uploading a patch for review</a>.  However, we present an
alternate method here.
</p>
<p>You should always run <code>git&nbsp;pull&nbsp;-r</code> (translators
should leave off the &lsquo;<samp>-r</samp>&rsquo;) before doing this to ensure that
your patches are as current as possible.
</p>
<p>Once you have made one or more commits in your local repository,
and pulled the most recent commits from the remote branch, you can
generate patches from your local commits with the command:
</p>
<blockquote><pre class="example">git format-patch origin
</pre></blockquote>

<p>The <code>origin</code> argument refers to the remote tracking branch at
<code>git.sv.gnu.org</code>.  This command generates a separate patch
for each commit that&rsquo;s in the current branch but not in the remote
branch.  Patches are placed in the current working directory and
will have names that look something like this:
</p>
<blockquote><pre class="example">0001-Doc-Fix-typos.patch
0002-Web-Remove-dead-links.patch

</pre></blockquote>

<p>Send an email (must be less than 64 KB) to
<a href="mailto:lilypond-devel@gnu.org">lilypond-devel@gnu.org</a> briefly explaining your work, with
the patch files attached.  Translators should send patches to
<a href="mailto:translations@lilynet.net">translations@lilynet.net</a>.  After your patches are
reviewed, the developers may push one or more of them to the main
repository or discuss them with you.
</p>

<hr size="6">
<a name="Uploading-a-patch-for-review"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#working-with-source-code" title="Beginning of this chapter or previous chapter"> &lt;&lt; Working with source code&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#compiling" title="Next chapter">&nbsp;Compiling &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#making-patches" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Making patches&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#commits-and-patches" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Commits and patches&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#advanced-git-procedures" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Advanced Git procedures &gt; </a>]</td></tr></table>
<a name="uploading-a-patch-for-review"></a>
<h4 class="unnumberedsubsubsec">Uploading a patch for review</h4>

<p>Any non-trivial change should be uploaded to our &ldquo;Rietveld&rdquo;
code review website:
</p>
<blockquote><pre class="example"><a href="http://codereview.appspot.com">http://codereview.appspot.com/</a>
</pre></blockquote>

<a name="git_002dcl-install"></a>
<h4 class="subsubheading"><code>git-cl</code> install</h4>

<p>LilyDev users should skip over these &lsquo;install&rsquo; instructions.
</p>
<ol>
<li>
Install <code>git-cl</code> by entering:

<blockquote><pre class="example">git clone https://github.com/gperciva/git-cl.git
</pre></blockquote>

<p>If that command fails for some reason, try this instead:
</p>
<blockquote><pre class="example">git clone git://github.com/gperciva/git-cl.git
</pre></blockquote>

</li><li>
Add the &lsquo;<tt>git-cl/</tt>&rsquo; directory to your PATH,
or create a symbolic link to the <code>git-cl</code>
and <code>upload.py</code> scripts in one of your PATH
directories (such as &lsquo;<tt>$HOME/bin</tt>&rsquo;).

<p>In Ubuntu (and LilyDev), you can add directories to PATH
by adding this line to a hidden file &lsquo;<tt>.bashrc</tt>&rsquo;,
located in your home directory:
</p>
<blockquote><pre class="example">PATH=~/type-here-directory-containing-git-cl:&quot;${PATH}&quot;
</pre></blockquote>

</li></ol>

<a name="git_002dcl-configuration"></a>
<h4 class="subsubheading"><code>git-cl</code> configuration</h4>

<p>LilyDev users should perform these &lsquo;configuration&rsquo; instructions.
</p>
<ol>
<li>
You must have a google account; please create one if you do not
have one already.

<p>Note that a google account does not need to be a gmail account; you can
use any email address for your google account when you sign up.
</p>
</li><li>
Move into the top source directory and then configure <code>git
cl</code> with the following commands.  If you do not understand any
question, just answer with a newline (CR).

<blockquote><pre class="example">cd $HOME/lilypond-git/
git cl config
</pre></blockquote>

<p>The &ldquo;CC list&rdquo; question should be answered with:
</p>
<blockquote><pre class="example">lilypond-devel@gnu.org
</pre></blockquote>

</li></ol>

<a name="Uploading-patch-set"></a>
<h4 class="subsubheading">Uploading patch set</h4>

<div class="warning"><p><strong>Note:</strong> Unless you are familiar with branches, only work on one
set of changes at once.
</p>
</div>
<p>There are two methods, depending on your git setup.
</p>
<ul>
<li>
<strong>Master branch</strong>: (easy option, and used in <code>lily-git.tcl</code>)

<p>If you added your patch to <code>master</code>, then:
</p>
<blockquote><pre class="example">git pull -r
git cl upload origin/master
</pre></blockquote>

<p>If you have git push ability, make sure that you <em>remove</em>
your patch (with <code>git rebase</code> or <code>git reset</code>)
before pushing other stuff.
</p>
<p>Notifications of patches are automatically added to our issue
tracker to reduce the chance of patches getting lost.  To suppress
this (not recommended), add the <code>-n / --no-code-issue</code>
option.
</p>
</li><li>
<strong>Separate branch</strong>: (complicated option)

<p>Ensure your changes are committed in a separate branch, which
should differ from the reference branch to be used by just the
changes to be uploaded.  If the reference branch is to be
origin/master, ensure this is up-to-date.  If necessary, use git
rebase to rebase the branch containing the changes to the head of
origin/master.  Finally, check out branch with the changes and
enter the command:
</p>
<blockquote><pre class="example">git cl upload &lt;reference SHA1 ID&gt;
</pre></blockquote>

<p>where &lt;reference SHA1 ID&gt; is the SHA1 ID of the commit to be used
as a reference source for the patch.  Generally, this will be the
SHA1 ID of origin/master, and in that case the command:
</p>
<blockquote><pre class="example">git cl upload origin/master
</pre></blockquote>

<p>can be used.
</p>
</li></ul>

<p>After prompting for your Google email address and password, the
patch set will be posted to Rietveld, and you will be given a URL
for your patch.
</p>
<div class="warning"><p><strong>Note:</strong> Some installations of git-cl fail when uploading a patch
with certain filename extensions.  If this happens, it can
generally be fixed by editing the list of exceptions at top of
&lsquo;<tt>git-cl.py</tt>&rsquo;.
</p>
</div>
<a name="Announcing-your-patch-set"></a>
<h4 class="subsubheading">Announcing your patch set</h4>

<p>You should then announce the patch by logging into the code review
issue webpage and using &ldquo;Publish + Mail Comments&rdquo; to add a
(mostly bogus) comment to your issue.  The text of your comment
will be sent to our developer mailing list.
</p>
<div class="warning"><p><strong>Note:</strong> There is no automatic notification of a new patch; you
must add a comment yourself.
</p>
</div>
<a name="Revisions"></a>
<h4 class="subsubheading">Revisions</h4>

<p>As revisions are made in response to comments, successive patch sets
for the same issue can be uploaded by reissuing the git-cl command
with the modified branch checked out.
</p>
<p>Sometimes in response to comments on revisions, the best way to
work may require creation of a new branch in git.  In order to
associate the new branch with an existing Rietveld issue,
the following command can be used:
</p>
<blockquote><pre class="example">git cl issue issue-number
</pre></blockquote>

<p>where <code>issue-number</code> is the number of the existing Rietveld
issue.
</p>
<a name="Resetting-git-cl"></a>
<h4 class="subsubheading">Resetting git cl</h4>

<p>If <code>git cl</code> becomes confused, you can &ldquo;reset&rdquo; it by
running:
</p>
<blockquote><pre class="example">git cl issue 0
</pre></blockquote>

<a name="Wait-for-a-countdown"></a>
<h4 class="subsubheading">Wait for a countdown</h4>

<p>Your patch will be available for reviews for the next few hours or
days.  Three times a week, patches with no known problems are
gathered into a &ldquo;patch countdown&rdquo; and their status changed to
<code>patch-countdown</code>.  The countdown is a 48-hour waiting period
in which any final reviews or complaints should be made.
</p>
<p>During the countdown, your patch may be set to
<code>patch-needs_work</code>, indicating that you should fix something
(or at least discuss why the patch needs no modification).  If no
problems are found, the patch will be set to <code>patch-push</code>.
</p>
<p>Once a patch has <code>patch-push</code>, it should be sent to your
mentor for uploading.  If you have git push ability, look at
<a href="#pushing-to-staging">Pushing to staging</a>.
</p>

<hr size="6">
<a name="Advanced-Git-procedures"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#working-with-source-code" title="Beginning of this chapter or previous chapter"> &lt;&lt; Working with source code&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#compiling" title="Next chapter">&nbsp;Compiling &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#uploading-a-patch-for-review" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Uploading a patch for review&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#working-with-source-code" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Working with source code&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#merge-conflicts" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Merge conflicts &gt; </a>]</td></tr></table>
<a name="advanced-git-procedures"></a>
<h2 class="section">3.4 Advanced Git procedures</h2>


<div class="warning"><p><strong>Note:</strong> This section is not necessary for normal contributors;
these commands are presented for information for people interested
in learning more about git.
</p>
</div>
<p>It is possible to work with several branches on the same local Git
repository; this is especially useful for translators who may have
to deal with both <code>translation</code> and a stable branch,
e.g. <code>stable/2.12</code>.
</p>
<p>Some Git commands are introduced first, then a workflow with
several Git branches of LilyPond source code is presented.
</p>

<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#merge-conflicts" accesskey="1">3.4.1 Merge conflicts</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#advanced-git-concepts" accesskey="2">3.4.2 Advanced Git concepts</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#resolving-conflicts" accesskey="3">3.4.3 Resolving conflicts</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#reverting-all-local-changes" accesskey="4">3.4.4 Reverting all local changes</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#working-with-remote-branches" accesskey="5">3.4.5 Working with remote branches</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#git-log" accesskey="6">3.4.6 Git log</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#applying-remote-patches" accesskey="7">3.4.7 Applying remote patches</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#sending-and-receiving-patches-via-email" accesskey="8">3.4.8 Sending and receiving patches via email</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#cleaning-up-multiple-patches" accesskey="9">3.4.9 Cleaning up multiple patches</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#commit-access">3.4.10 Commit access</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#pushing-to-staging">3.4.11 Pushing to staging</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>


<hr size="6">
<a name="Merge-conflicts"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#working-with-source-code" title="Beginning of this chapter or previous chapter"> &lt;&lt; Working with source code&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#compiling" title="Next chapter">&nbsp;Compiling &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#advanced-git-procedures" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Advanced Git procedures&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#advanced-git-procedures" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Advanced Git procedures&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#advanced-git-concepts" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Advanced Git concepts &gt; </a>]</td></tr></table>
<a name="merge-conflicts"></a>
<h3 class="subsection">3.4.1 Merge conflicts</h3>

<p>To be filled in later, and/or moved to a different section.  I
just wanted to make sure that I had a stub ready somewhere.
</p>

<hr size="6">
<a name="Advanced-Git-concepts"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#working-with-source-code" title="Beginning of this chapter or previous chapter"> &lt;&lt; Working with source code&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#compiling" title="Next chapter">&nbsp;Compiling &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#merge-conflicts" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Merge conflicts&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#advanced-git-procedures" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Advanced Git procedures&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#resolving-conflicts" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Resolving conflicts &gt; </a>]</td></tr></table>
<a name="advanced-git-concepts"></a>
<h3 class="subsection">3.4.2 Advanced Git concepts</h3>


<p>A bit of Git vocabulary will be explained below.  The following is
only introductory; for a better understanding of Git concepts, you
may wish to read <a href="#other-git-documentation">Other Git documentation</a>.
</p>
<p>The <code>git&nbsp;pull&nbsp;origin</code> command above is just a
shortcut for this command:
</p>
<blockquote><pre class="example">git pull git://git.sv.gnu.org/lilypond.git/ <var>branch</var>:origin/<var>branch</var>
</pre></blockquote>

<p>where <code><var>branch</var></code> is typically <code>master</code> or
<code>translation</code>; if you do not know or remember, see
<a href="#downloading-remote-branches">Downloading remote branches</a> to remember which commands you
issued or which source code you wanted to get.
</p>
<p>A <em>commit</em> is a set of changes made to the sources; it also
includes the committish of the parent commit, the name and e-mail
of the <em>author</em> (the person who wrote the changes), the name
and e-mail of the <em>committer</em> (the person who brings these
changes into the Git repository), and a commit message.
</p>
<p>A <em>committish</em> is the SHA1 checksum of a commit, a number
made of 40 hexadecimal digits, which acts as the internal unique
identifier for this commit.  To refer to a particular revision,
don&rsquo;t use vague references like the (approximative) date, simply
copy and paste the committish.
</p>
<p>A <em>branch</em> is nothing more than a pointer to a particular
commit, which is called the <em>head</em> of the branch; when
referring to a branch, one often actually thinks about its head
and the ancestor commits of the head.
</p>
<p>Now we will explain the two last commands you used to get the
source code from Git&mdash;see <a href="#downloading-individual-branches">Downloading individual branches</a>.
</p>
<blockquote><pre class="example">git remote add -ft <var>branch</var> -m <var>branch</var> \
  origin git://git.sv.gnu.org/lilypond.git/

git checkout -b <var>branch</var> origin/<var>branch</var>
</pre></blockquote>

<p>The <code>git&nbsp;remote</code> has created a branch called
<code>origin/<var>branch</var></code> in your local Git repository.  As this
branch is a copy of the remote branch web from git.sv.gnu.org
LilyPond repository, it is called a <em>remote branch</em>, and is
meant to track the changes on the branch from git.sv.gnu.org: it
will be updated every time you run
<code>git&nbsp;pull&nbsp;origin</code> or
<code>git&nbsp;fetch&nbsp;origin</code>.
</p>
<p>The <code>git&nbsp;checkout</code> command has created a branch named
<code><var>branch</var></code>.  At the beginning, this branch is identical
to <code>origin/<var>branch</var></code>, but it will differ as soon as you
make changes, e.g. adding newly translated pages or editing some
documentation or code source file.  Whenever you pull, you merge
the changes from <code>origin/<var>branch</var></code> and
<code><var>branch</var></code> since the last pulling.  If you do not have
push (i.e. &ldquo;write&rdquo;) access on git.sv.gnu.org, your
<code><var>branch</var></code> will always differ from
<code>origin/<var>branch</var></code>.  In this case, remember that other
people working like you with the remote branch <code><var>branch</var></code>
of git://git.sv.gnu.org/lilypond.git/ (called
<code>origin/<var>branch</var></code> on your local repository) know nothing
about your own <code><var>branch</var></code>: this means that whenever you
use a committish or make a patch, others expect you to take the
latest commit of <code>origin/<var>branch</var></code> as a reference.
</p>
<p>Finally, please remember to read the man page of every Git command
you will find in this manual in case you want to discover
alternate methods or just understand how it works.
</p>

<hr size="6">
<a name="Resolving-conflicts"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#working-with-source-code" title="Beginning of this chapter or previous chapter"> &lt;&lt; Working with source code&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#compiling" title="Next chapter">&nbsp;Compiling &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#advanced-git-concepts" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Advanced Git concepts&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#advanced-git-procedures" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Advanced Git procedures&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#reverting-all-local-changes" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Reverting all local changes &gt; </a>]</td></tr></table>
<a name="resolving-conflicts"></a>
<h3 class="subsection">3.4.3 Resolving conflicts</h3>


<p>Occasionally an update may result in conflicts &ndash; this happens
when you and somebody else have modified the same part of the same
file and git cannot figure out how to merge the two versions
together.  When this happens, you must manually merge the two
versions.
</p>
<p>If you need some documentation to understand and resolve
conflicts, see paragraphs <em>How conflicts are presented</em> and
<em>How to resolve conflicts</em> in <code>git merge</code> man page.
</p>
<p>If all else fails, you can follow the instructions in
<a href="#reverting-all-local-changes">Reverting all local changes</a>.  Be aware that this eliminates
any changes you have made!
</p>

<hr size="6">
<a name="Reverting-all-local-changes"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#working-with-source-code" title="Beginning of this chapter or previous chapter"> &lt;&lt; Working with source code&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#compiling" title="Next chapter">&nbsp;Compiling &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#resolving-conflicts" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Resolving conflicts&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#advanced-git-procedures" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Advanced Git procedures&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#working-with-remote-branches" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Working with remote branches &gt; </a>]</td></tr></table>
<a name="reverting-all-local-changes"></a>
<h3 class="subsection">3.4.4 Reverting all local changes</h3>

<p>Sometimes git will become hopelessly confused, and you just want
to get back to a known, stable state.  This command destroys any
local changes you have made in the currently checked-out branch,
but at least you get back to the current online version:
</p>
<blockquote><pre class="example">git reset --hard origin/master
</pre></blockquote>


<hr size="6">
<a name="Working-with-remote-branches"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#working-with-source-code" title="Beginning of this chapter or previous chapter"> &lt;&lt; Working with source code&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#compiling" title="Next chapter">&nbsp;Compiling &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#reverting-all-local-changes" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Reverting all local changes&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#advanced-git-procedures" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Advanced Git procedures&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#git-log" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Git log &gt; </a>]</td></tr></table>
<a name="working-with-remote-branches"></a>
<h3 class="subsection">3.4.5 Working with remote branches</h3>


<a name="Fetching-new-branches-from-git_002esv_002egnu_002eorg"></a>
<h4 class="subsubheading">Fetching new branches from git.sv.gnu.org</h4>

<p>To fetch and check out a new branch named <code><var>branch</var></code> on
git.sv.gnu.org, run from top of the Git repository
</p>
<blockquote><pre class="example">git config --add remote.origin.fetch \
  +refs/heads/<var>branch</var>:refs/remotes/origin/<var>branch</var>

git checkout --track -b <var>branch</var> origin/<var>branch</var>
</pre></blockquote>

<p>After this, you can pull <code><var>branch</var></code> from git.sv.gnu.org
with:
</p>
<blockquote><pre class="example">git pull
</pre></blockquote>

<p>Note that this command generally fetches all branches you added
with <code>git&nbsp;remote&nbsp;add</code> (when you initialized the
repository) or <code>git&nbsp;config&nbsp;--add</code>, i.e. it
updates all remote branches from remote <code>origin</code>, then it
merges the remote branch tracked by the current branch into the
current branch.  For example, if your current branch is
<code>master</code>, <code>origin/master</code> will be merged into
<code>master</code>.
</p>

<a name="Local-clones_002c-or-having-several-working-trees"></a>
<h4 class="subsubheading">Local clones, or having several working trees</h4>

<p>If you play with several Git branches, e.g. <code>master</code>,
<code>translation</code>, <code>stable/2.12</code>), you may want to
have one source and build tree for each branch; this is possible
with subdirectories of your local Git repository, used as local
cloned subrepositories.  To create a local clone for the branch
named <code><var>branch</var></code>, run
</p>
<blockquote><pre class="example">git checkout <var>branch</var>
git clone -lsn . <var>subdir</var>
cd <var>subdir</var>
git reset --hard
</pre></blockquote>

<p>Note that <code><var>subdir</var></code> must be a directory name which does
not already exist.  In <code><var>subdir</var></code>, you can use all Git
commands to browse revisions history, commit and uncommit changes;
to update the cloned subrepository with changes made on the main
repository, cd into <code><var>subdir</var></code> and run
<code>git&nbsp;pull</code>; to send changes made on the subrepository
back to the main repository, run <code>git&nbsp;push</code> from
<code><var>subdir</var></code>.  Note that only one branch (the currently
checked out branch) is created in the subrepository by default; it
is possible to have several branches in a subrepository and do
usual operations (checkout, merge, create, delete...) on these
branches, but this possibility is not detailed here.
</p>
<p>When you push <code><var>branch</var></code> from <code><var>subdir</var></code> to the
main repository, and <code><var>branch</var></code> is checked out in the
main repository, you must save uncommitted changes (see
<code>git&nbsp;stash</code>) and do
<code>git&nbsp;reset&nbsp;--hard</code> in the main repository in
order to apply pushed changes in the working tree of the main
repository.
</p>

<hr size="6">
<a name="Git-log"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#working-with-source-code" title="Beginning of this chapter or previous chapter"> &lt;&lt; Working with source code&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#compiling" title="Next chapter">&nbsp;Compiling &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#working-with-remote-branches" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Working with remote branches&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#advanced-git-procedures" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Advanced Git procedures&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#applying-remote-patches" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Applying remote patches &gt; </a>]</td></tr></table>
<a name="git-log"></a>
<h3 class="subsection">3.4.6 Git log</h3>


<p>The commands above don&rsquo;t only bring you the latest version of the
sources, but also the full history of revisions (revisions, also
called commits, are changes made to the sources), stored in the
&lsquo;<tt>.git</tt>&rsquo; directory.  You can browse this history with
</p>
<blockquote><pre class="example">git log     # only shows the logs (author, committish and commit message)
git log -p  # also shows diffs
gitk        # shows history graphically
</pre></blockquote>

<div class="warning"><p><strong>Note:</strong> The <code>gitk</code> command may require a separate
<code>gitk</code> package, available in the appropriate distribution&rsquo;s
repositories.
</p>
</div>

<hr size="6">
<a name="Applying-remote-patches"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#working-with-source-code" title="Beginning of this chapter or previous chapter"> &lt;&lt; Working with source code&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#compiling" title="Next chapter">&nbsp;Compiling &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#git-log" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Git log&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#advanced-git-procedures" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Advanced Git procedures&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#sending-and-receiving-patches-via-email" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Sending and receiving patches via email &gt; </a>]</td></tr></table>
<a name="applying-remote-patches"></a>
<h3 class="subsection">3.4.7 Applying remote patches</h3>


<p>TODO: Explain how to determine if a patch was created with
<code>git&nbsp;format-patch</code>.
</p>
<p>Well-formed git patches created with <code>git&nbsp;format-patch</code>
should be committed with the following command:
</p>
<blockquote><pre class="example">git am <var>patch</var>
</pre></blockquote>

<p>Patches created without <code>git&nbsp;format-patch</code> can be
applied in two steps.  The first step is to apply the patch to the
working tree and the index:
</p>
<blockquote><pre class="example">git apply --index <var>patch</var>
</pre></blockquote>

<p>The second step is to commit the changes and give credit to the
author of the patch.  This can be done with the following command:
</p>
<blockquote><pre class="example">git commit --author=&quot;<var>John Smith</var> &lt;<var>john@example.com</var>&gt;&quot;
</pre></blockquote>

<p>Please note that using the <code>--index</code> option for patching is quite
important here and <em>cannot</em> reliably be replaced by using the
<code>-a</code> option when committing: that would only commit files from the
working tree that are already registered with git, so every file that
the patch actually <em>adds</em>, like a regtest for a fixed bug, would
get lost.  For the same reason, you should not use the git-independent
&lsquo;<samp>patch</samp>&rsquo; program for applying patches.
</p>
<hr size="6">
<a name="Sending-and-receiving-patches-via-email"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#working-with-source-code" title="Beginning of this chapter or previous chapter"> &lt;&lt; Working with source code&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#compiling" title="Next chapter">&nbsp;Compiling &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#applying-remote-patches" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Applying remote patches&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#advanced-git-procedures" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Advanced Git procedures&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#cleaning-up-multiple-patches" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Cleaning up multiple patches &gt; </a>]</td></tr></table>
<a name="sending-and-receiving-patches-via-email"></a>
<h3 class="subsection">3.4.8 Sending and receiving patches via email</h3>


<p>The default <code>x-diff</code> MIME type associated with patch files
(i.e., files whose name ends in <code>.patch</code>) means that the
encoding of line endings may be changed from UNIX to DOS format
when they are sent as attachments.  Attempting to apply such an
inadvertently altered patch will cause git to fail with a message
about &lsquo;whitespace errors&rsquo;.
</p>
<p>The solution to such problems is surprisingly simple&mdash;just change
the default file extension of patches generated by git to end in
<code>.txt</code>, for example:
</p>
<blockquote><pre class="example">git config format.suffix '.patch.txt'
</pre></blockquote>

<p>This should cause email programs to apply the correct base64
encoding to attached patches.
</p>
<p>If you receive a patch with DOS instead of UNIX line-endings, it
can be converted back using the <code>dos2unix</code> utility.
</p>
<p>Lots of useful information on email complications with patches is
provided on the Wine wiki at
<a href="http://wiki.winehq.org/GitWine">http://wiki.winehq.org/GitWine</a>.
</p>

<hr size="6">
<a name="Cleaning-up-multiple-patches"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#working-with-source-code" title="Beginning of this chapter or previous chapter"> &lt;&lt; Working with source code&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#compiling" title="Next chapter">&nbsp;Compiling &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#sending-and-receiving-patches-via-email" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Sending and receiving patches via email&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#advanced-git-procedures" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Advanced Git procedures&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#commit-access" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Commit access &gt; </a>]</td></tr></table>
<a name="cleaning-up-multiple-patches"></a>
<h3 class="subsection">3.4.9 Cleaning up multiple patches</h3>

<p>If you have been developing on your own branch for a while, you
may have more commmits than is really sensible.  To revise your
work and condense commits, use:
</p>
<blockquote><pre class="example">git rebase origin/master
git rebase -i origin/master
</pre></blockquote>

<div class="warning"><p><strong>Note:</strong> Be a bit cautious &ndash; if you completely remove commits
during the interactive session, you will... err... completely
remove those commits.
</p>
</div>

<hr size="6">
<a name="Commit-access"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#working-with-source-code" title="Beginning of this chapter or previous chapter"> &lt;&lt; Working with source code&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#compiling" title="Next chapter">&nbsp;Compiling &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#cleaning-up-multiple-patches" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Cleaning up multiple patches&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#advanced-git-procedures" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Advanced Git procedures&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#pushing-to-staging" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Pushing to staging &gt; </a>]</td></tr></table>
<a name="commit-access"></a>
<h3 class="subsection">3.4.10 Commit access</h3>

<p>Most contributors are not able to commit patches directly to the
main repository&mdash;only members of the LilyPond development team
have <em>commit access</em>.  If you are a contributor and are
interested in joining the development team, contact the Project
Manager through the mailing list
(<a href="mailto:lilypond-devel@gnu.org">lilypond-devel@gnu.org</a>).  Generally, only contributors
who have already provided a number of patches which have been
pushed to the main repository will be considered for membership.
</p>
<p>If you have been approved by the Project Manager, use the
following procedure to obtain commit access:
</p>
<ol>
<li>
If you don&rsquo;t already have one, set up a Savannah user account at
<a href="https://savannah.gnu.org/account/register.php">https://savannah.gnu.org/account/register.php</a>.  If your web
browser responds with an &ldquo;untrusted connection&rdquo; message when
you visit the link, follow the steps for including the CAcert root
certificate in your browser, given at
<a href="http://savannah.gnu.org/tls/tutorial">http://savannah.gnu.org/tls/tutorial/</a>.

<div class="warning"><p><strong>Note:</strong> Savannah will silently put your username in lower-case &ndash;
do not try to use capital letters.
</p>
</div>

</li><li>
After registering, if you are not logged in automatically, login
at <a href="https://savannah.gnu.org/account/login.php">https://savannah.gnu.org/account/login.php</a>&mdash;this should
take you to your &ldquo;my&rdquo; page
(<a href="https://savannah.gnu.org/my">https://savannah.gnu.org/my/</a>).


</li><li>
Click on the &ldquo;My Groups&rdquo; link to access the &ldquo;My Group
Membership&rdquo; page.  From there, find the &ldquo;Request for Inclusion&rdquo;
box and search for &ldquo;LilyPond&rdquo;.  Among the search results, check
the box labeled &ldquo;GNU LilyPond Music Typesetter&rdquo; and write a
brief (required) message for the Project Manager (&ldquo;Hey it&rsquo;s
me!&rdquo; should be fine).

<p>Note that you will not have commit access until the Project
Manager activates your membership.  Once your membership is
activated, LilyPond should appear under the heading &ldquo;Groups I&rsquo;m
Contributor of&rdquo; on your &ldquo;My Group Membership&rdquo; page.
</p>

</li><li>
Generate an SSH &lsquo;rsa&rsquo; key pair.  Enter the following at the
command prompt:

<blockquote><pre class="example">ssh-keygen -t rsa
</pre></blockquote>

<p>When prompted for a location to save the key, press &lt;ENTER&gt; to
accept the default location (&lsquo;<tt>~/.ssh/id_rsa</tt>&rsquo;).
</p>
<p>Next you are asked to enter an optional passphrase.  On most
systems, if you use a passphrase, you will likely be prompted for
it every time you use <code>git&nbsp;push</code> or
<code>git&nbsp;pull</code>.  You may prefer this since it can protect
you from your own mistakes (like pushing when you mean to pull),
though you may find it tedious to keep re-entering it.
</p>
<p>You can change/enable/disable your passphrase at any time with:
</p>
<blockquote><pre class="example">ssh-keygen -f ~/.ssh/id_rsa -p
</pre></blockquote>

<p>Note that the GNOME desktop has a feature which stores your
passphrase for you for an entire GNOME session.  If you use a
passphrase to &ldquo;protect you from yourself&rdquo;, you will want to
disable this feature, since you&rsquo;ll only be prompted once.  Run the
following command, then logout of GNOME and log back in:
</p>
<blockquote><pre class="example">gconftool-2 --set -t bool \
  /apps/gnome-keyring/daemon-components/ssh false
</pre></blockquote>

<p>After setting up your passphrase, your private key is saved as
&lsquo;<tt>~/.ssh/id_rsa</tt>&rsquo; and your public key is saved as
&lsquo;<tt>~/.ssh/id_rsa.pub</tt>&rsquo;.
</p>

</li><li>
Register your public SSH &lsquo;rsa&rsquo; key with Savannah.  From the
&ldquo;My Account Configuration&rdquo; page, click on &ldquo;Edit SSH Keys&rdquo;,
then paste the contents of your &lsquo;<tt>~/.ssh/id_rsa.pub</tt>&rsquo; file into
one of the &ldquo;Authorized keys&rdquo; text fields, and click
&ldquo;Update&rdquo;.

<p>Savannah should respond with something like:
</p>
<blockquote><pre class="example">Success: Key #1 seen Keys registered
</pre></blockquote>


</li><li>
Configure Git to use the SSH protocol (instead of the GIT
protocol).  From your local Git repository, enter:

<blockquote><pre class="example">git config remote.origin.url \
  ssh://<var>user</var>@git.sv.gnu.org/srv/git/lilypond.git
</pre></blockquote>

<p>replacing <var>user</var> with your Savannah username.
</p>

</li><li>
After your membership has been activated and you&rsquo;ve configured Git
to use SSH, test the connection with:

<blockquote><pre class="example">git pull --verbose
</pre></blockquote>

<p>SSH should issue the following warning:
</p>
<blockquote><pre class="example">The authenticity of host 'git.sv.gnu.org (140.186.70.72)' can't
be established.
RSA key fingerprint is
80:5a:b0:0c:ec:93:66:29:49:7e:04:2b:fd:ba:2c:d5.
Are you sure you want to continue connecting (yes/no)?
</pre></blockquote>

<p>Make sure the RSA key fingerprint displayed matches the one above.
If it doesn&rsquo;t, respond &ldquo;no&rdquo; and check that you configured Git
properly in the previous step.  If it does match, respond
&ldquo;yes&rdquo;.  SSH should then issue another warning:
</p>
<blockquote><pre class="example">Warning: Permanently added 'git.sv.gnu.org,140.186.70.72' (RSA) to
the list of known hosts.
</pre></blockquote>

<p>The list of known hosts is stored in the file
&lsquo;<tt>~/.ssh/known_hosts</tt>&rsquo;.
</p>
<p>At this point, you are prompted for your passphrase if you have
one, then Git will attempt a pull.
</p>
<p>If <code>git&nbsp;pull&nbsp;--verbose</code> fails, you should see
error messages like these:
</p>
<blockquote><pre class="example">Permission denied (publickey).
fatal: The remote end hung up unexpectedly
</pre></blockquote>

<p>If you get the above error, you may have made a mistake when
registering your SSH key at Savannah.  If the key is properly
registered, you probably just need to wait for the Savannah server
to activate it.  It usually takes a few minutes for the key to be
active after registering it, but if it still doesn&rsquo;t work after an
hour, ask for help on the mailing list.
</p>
<p>If <code>git&nbsp;pull&nbsp;--verbose</code> succeeds, the output
will include a &lsquo;From&rsquo; line that shows &lsquo;ssh&rsquo; as the protocol:
</p>
<blockquote><pre class="example">From ssh://git.sv.gnu.org/srv/git/lilypond
</pre></blockquote>

<p>If the protocol shown is not &lsquo;ssh&rsquo;, check that you configured
Git properly in the previous step.
</p>

</li><li>
Test your commit access with a dry run:

<div class="warning"><p><strong>Note:</strong> Do not push directly to master; instead, push to staging.
See <a href="#pushing-to-staging">Pushing to staging</a>.
</p>
</div>
<blockquote><pre class="example">git push --dry-run --verbose
</pre></blockquote>

<p>Note that recent versions of Git (Git 1.6.3 or later) will issue a
big warning if the above command is used.  The simplest solution
is to tell Git to push all matching branches by default:
</p>
<blockquote><pre class="example">git config push.default matching
</pre></blockquote>

<p>Then <code>git&nbsp;push</code> should work as before.  For more
details, consult the <code>git&nbsp;push</code> man page.
</p>

</li><li>
Repeat the steps from generating an RSA key through to testing
your commit access, for each machine from which you will be
making commits, or you may simply copy the files from your
local &lsquo;<tt>~/.ssh</tt>&rsquo; folder to the same folder on the other
machine.

</li></ol>

<a name="Technical-details-2"></a>
<h4 class="subsubheading">Technical details</h4>

<ul>
<li>
On Firefox, to view or remove the CAcert root certificate, go to:
Edit &gt; Preferences &gt; Advanced &gt; Encryption &gt; View Certificates &gt;
Authorities &gt; Certificate Name &gt; Root CA &gt; CA Cert Signing
Authority.

</li><li>
The <code>git&nbsp;config</code> commands above should modify your
local repository&rsquo;s &lsquo;<tt>.git/config</tt>&rsquo; file.  These lines:

<blockquote><pre class="example">[remote &quot;origin&quot;]
        url = git://git.sv.gnu.org/lilypond.git/
</pre></blockquote>

<p>should now be changed to:
</p>
<blockquote><pre class="example">[remote &quot;origin&quot;]
        url = ssh://<var>user</var>@git.sv.gnu.org/srv/git/lilypond.git
</pre></blockquote>

<p>where <var>user</var> is your login name on Savannah.
</p>
</li><li>
Similarly, the
<code>git&nbsp;config&nbsp;push.default&nbsp;matching</code> command
should add these lines to &lsquo;<tt>.git/config</tt>&rsquo;:

<blockquote><pre class="example">[push]
        default = matching
</pre></blockquote>
</li></ul>

<a name="Known-issues-and-warnings-2"></a>
<h4 class="subsubheading">Known issues and warnings</h4>
<p>Encryption protocols, including ssh, generally do not permit packet
fragmentation to avoid introducing a point of insecurity.  This
means that the maximum packet size must not exceed the smallest
MTU (Maximum Transmission Unit) set in the routers along the path.
This smallest MTU is determined by a procedure during call set-up
which relies on the transmission over the path of ICMP packets.
If any of the routers in the path block ICMP packets this mechanism
fails, resulting in the possibility of packets being transmitted
which exceed the MTU of one of the routers.  If this happens the
packet is discarded, causing the ssh session to hang, timeout or
terminate with the error message
</p>
<blockquote><pre class="example">ssh: connect to host &lt;host ip addr&gt; port 22: Bad file number
fatal: The remote end hung up unexpectedly
</pre></blockquote>

<p>depending on precisely when in the proceedings the first large
packet is transmitted.  Most routers on the internet have MTU
set to 1500, but routers installed in homes to connect via
broadband may use a slightly smaller MTU for efficient transmission
over ATM.  If this problem is encountered a possible work-around is
to set the MTU in the local router to 1500.
</p>

<hr size="6">
<a name="Pushing-to-staging"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#working-with-source-code" title="Beginning of this chapter or previous chapter"> &lt;&lt; Working with source code&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#compiling" title="Next chapter">&nbsp;Compiling &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#commit-access" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Commit access&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#advanced-git-procedures" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Advanced Git procedures&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#git-on-windows" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Git on Windows &gt; </a>]</td></tr></table>
<a name="pushing-to-staging"></a>
<h3 class="subsection">3.4.11 Pushing to staging</h3>

<p>Do not push directly to the git <code>master</code> branch.  Instead,
push to <code>staging</code>.
</p>
<p>You will not see your patch on <code>origin/master</code> until some
automatic tests have been run.  These tests are run every couple
of hours; please wait at least 12 hours before wondering if your
patch has been lost.  Note that you can check the commits on
<code>origin/staging</code> by looking at the git web interface on
savannah.
</p>
<p>It may happen occasionally that the staging branch breaks automated
testing.  In this case the automatic move of staging material to
master gets halted in order to avoid broken material entering master.
This is a safety net.  Please do not try breaking out from it by
adding fixes on top of staging: in that case the whole sequence will
end up in master after all, defeating the purpose of the system.  The
proper fix usually involves rewriting the staging branch and is best
left to core developers after discussion on the developer list.
</p>
<a name="If-your-work-is-in-a-patch-file"></a>
<h4 class="subsubheading">If your work is in a patch file</h4>

<p>Assuming that your patch is in a file called
&lsquo;<tt>0001-my-patch.patch</tt>&rsquo;, and you are currently on git master,
do:
</p>
<blockquote><pre class="example">git checkout staging
git pull -r
git am 0001-my-patch.patch
gitk
git push origin staging
git checkout master
</pre></blockquote>

<div class="warning"><p><strong>Note:</strong> Do not skip the <code>gitk</code> step; a quick 5-second
check of the visual history can save a great deal of frustration
later on.  You should only see that <code>staging</code> is only 1
commit ahead of <code>origin/staging</code>.
</p>
</div>
<a name="If-your-work-is-in-a-branch"></a>
<h4 class="subsubheading">If your work is in a branch</h4>

<p>If you are working on branches and your work in is
<code>my_branch_name</code>, then do:
</p>
<blockquote><pre class="example">git checkout staging
git pull -r
git merge my_branch_name
gitk
git push origin staging
</pre></blockquote>

<div class="warning"><p><strong>Note:</strong> Do not skip the <code>gitk</code> step; a quick 5-second
check of the visual history can save a great deal of frustration
later on.  You should see that <code>staging</code> is only ahead of
<code>origin/staging</code> by the commits from your branch.
</p>
</div>


<hr size="6">
<a name="Git-on-Windows"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#working-with-source-code" title="Beginning of this chapter or previous chapter"> &lt;&lt; Working with source code&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#compiling" title="Next chapter">&nbsp;Compiling &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#pushing-to-staging" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Pushing to staging&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#working-with-source-code" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Working with source code&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#git-on-windows" title="Next section in reading order" accesskey="n" rel="next">&nbsp; &gt; </a>]</td></tr></table>
<a name="git-on-windows"></a>
<h2 class="section">3.5 Git on Windows</h2>

<div class="warning"><p><strong>Note:</strong> We heavily recommend that development be done with our
virtual machine <a href="#lilydev">LilyDev</a>.
</p>
</div>

<p>TODO: Decide what to do with this...  Pare it down?  Move
paragraphs next to analogous Unix instructions? -mp
</p>
<hr size="6">
<a name="git-on-windows"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#working-with-source-code" title="Beginning of this chapter or previous chapter"> &lt;&lt; Working with source code&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#compiling" title="Next chapter">&nbsp;Compiling &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#git-on-windows" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Git on Windows&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#git-on-windows" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Git on Windows&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#git-on-windows" title="Next section in reading order" accesskey="n" rel="next">&nbsp; &gt; </a>]</td></tr></table>
<h3 class="subsection">3.5.1 Background to nomenclature</h3>

<p>Git is a system for tracking the changes made to source files by a
distributed set of editors.  It is designed to work without a
master repository, but we have chosen to have a master repository
for LilyPond files.  Editors hold a local copy of the master
repository together with any changes they have made locally.
Local changes are held in a local &lsquo;branch&rsquo;, of which there may
be several, but these instructions assume you are using just one.
The files visible in the local repository always correspond to
those on the currently &lsquo;checked out&rsquo; local branch.
</p>
<p>Files are edited on a local branch, and in that state the changes
are said to be &lsquo;unstaged&rsquo;.  When editing is complete, the
changes are moved to being &lsquo;staged for commit&rsquo;, and finally the
changes are &lsquo;committed&rsquo; to the local branch.  Once committed,
the changes (called a &lsquo;commit&rsquo;) are given a unique 40-digit
hexadecimal reference number called the &lsquo;Committish&rsquo; or &lsquo;SHA1
ID&rsquo; which identifies the commit to Git.  Such committed changes
can be sent to the master repository by &lsquo;pushing&rsquo; them (if you
have write permission) or by sending them by email to someone who
has, either as a complete file or as a &lsquo;diff&rsquo; or &lsquo;patch&rsquo;
(which send just the differences from the master repository).
</p>
<hr size="6">
<a name="git-on-windows"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#working-with-source-code" title="Beginning of this chapter or previous chapter"> &lt;&lt; Working with source code&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#compiling" title="Next chapter">&nbsp;Compiling &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#git-on-windows" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; &nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#git-on-windows" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Git on Windows&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#git-on-windows" title="Next section in reading order" accesskey="n" rel="next">&nbsp; &gt; </a>]</td></tr></table>
<h3 class="subsection">3.5.2 Installing git</h3>

<p>Obtain Git from
<a href="http://code.google.com/p/msysgit/downloads/list">http://code.google.com/p/msysgit/downloads/list</a> (note, not
msysGit, which is for Git developers and not PortableGit, which is
not a full git installation) and install it.
</p>
<p>Note that most users will not need to install SSH.  That is not
required until you have been granted direct push permissions to
the master git repository.
</p>
<p>Start Git by clicking on the desktop icon.  This will bring up a
command line bash shell.  This may be unfamiliar to Windows users.
If so, follow these instructions carefully.  Commands are entered
at a $ prompt and are terminated by keying a newline.
</p>
<hr size="6">
<a name="git-on-windows"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#working-with-source-code" title="Beginning of this chapter or previous chapter"> &lt;&lt; Working with source code&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#compiling" title="Next chapter">&nbsp;Compiling &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#git-on-windows" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; &nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#git-on-windows" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Git on Windows&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#git-on-windows" title="Next section in reading order" accesskey="n" rel="next">&nbsp; &gt; </a>]</td></tr></table>
<h3 class="subsection">3.5.3 Initialising Git</h3>

<p>Decide where you wish to place your local Git repository, creating
the folders in Windows as necessary.  Here we call the folder to
contain the repository <code>[path]/Git</code>, but if you intend using
Git for other projects a directory name like <code>lilypond-git</code>
might be better.  You will need to have space for around
100Mbytes.
</p>
<p>Start the Git bash shell by clicking on the desk-top icon
installed with Git and type
</p>
<blockquote><pre class="example">cd [path]/Git
</pre></blockquote>

<p>to position the shell at your new Git repository.
</p>
<p>Note: if [path] contains folders with names containing spaces use
</p>
<blockquote><pre class="example">cd &quot;[path]/Git&quot;
</pre></blockquote>

<p>Then type
</p>
<blockquote><pre class="example">git init
</pre></blockquote>

<p>to initialize your Git repository.
</p>
<p>Then type (all on one line; the shell will wrap automatically)
</p>
<blockquote><pre class="example">git remote add -ft master origin git://git.sv.gnu.org/lilypond.git
</pre></blockquote>

<p>to download the lilypond master files.
</p>
<div class="warning"><p><strong>Note:</strong> Be patient!  Even on a broadband connection this can take
10 minutes or more.  Wait for lots of [new tag] messages and the $
prompt.
</p>
</div>
<p>We now need to generate a local copy of the downloaded files in a
new local branch.  Your local branch needs to have a name.  It is
usual to call it &lsquo;master&rsquo; and we shall do that here.
</p>
<p>To do this, type
</p>
<blockquote><pre class="example">git checkout -b master origin/master
</pre></blockquote>

<p>This creates a second branch called &lsquo;master&rsquo;.  You will see two
warnings (ignore these), and a message advising you that your
local branch &lsquo;master&rsquo; has been set up to track the remote
branch.  You now have two branches, a local branch called
&lsquo;master&rsquo;, and a tracking branch called &lsquo;origin/master&rsquo;, which
is a shortened form of &lsquo;remotes/origin/master&rsquo;.
</p>
<p>Return to Windows Explorer and look in your Git repository.  You
should see lots of folders.  For example, the LilyPond
documentation can be found in [path]/Git/Documentation/.
</p>
<p>The Git bash shell is terminated by typing <code>exit</code> or by
clicking on the usual Windows close-window widget.
</p>
<hr size="6">
<a name="git-on-windows"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#working-with-source-code" title="Beginning of this chapter or previous chapter"> &lt;&lt; Working with source code&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#compiling" title="Next chapter">&nbsp;Compiling &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#git-on-windows" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; &nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#git-on-windows" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Git on Windows&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#git-on-windows" title="Next section in reading order" accesskey="n" rel="next">&nbsp; &gt; </a>]</td></tr></table>
<h3 class="subsection">3.5.4 Git GUI</h3>

<p>Almost all subsequent work will use the Git Graphical User
Interface, which avoids having to type command line commands.  To
start Git GUI first start the Git bash shell by clicking on the
desktop icon, and type
</p>
<blockquote><pre class="example">cd [path]/Git
git gui
</pre></blockquote>

<p>The Git GUI will open in a new window.  It contains four panels
and 7 pull-down menus.  At this stage do not use any of the
commands under Branch, Commit, Merge or Remote.  These will be
explained later.
</p>
<p>The top panel on the left contains the names of files which you
are in the process of editing (Unstaged Changes), and the lower
panel on the left contains the names of files you have finished
editing and have staged ready for committing (Staged Changes).  At
present, these panels will be empty as you have not yet made any
changes to any file.  After a file has been edited and saved the
top panel on the right will display the differences between the
edited file selected in one of the panels on the left and the last
version committed on the current branch.
</p>
<p>The panel at bottom right is used to enter a descriptive message
about the change before committing it.
</p>
<p>The Git GUI is terminated by entering CNTL-Q while it is the
active window or by clicking on the usual Windows close-window
widget.
</p>
<hr size="6">
<a name="git-on-windows"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#working-with-source-code" title="Beginning of this chapter or previous chapter"> &lt;&lt; Working with source code&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#compiling" title="Next chapter">&nbsp;Compiling &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#git-on-windows" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; &nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#git-on-windows" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Git on Windows&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#git-on-windows" title="Next section in reading order" accesskey="n" rel="next">&nbsp; &gt; </a>]</td></tr></table>
<h3 class="subsection">3.5.5 Personalising your local git repository</h3>

<p>Open the Git GUI, click on
</p>
<blockquote><pre class="example">Edit -&gt; Options
</pre></blockquote>

<p>and enter your name and email address in the left-hand (Git
Repository) panel.  Leave everything else unchanged and save it.
</p>
<p>Note that Windows users must leave the default setting for line
endings unchanged.  All files in a git repository must have lines
terminated by just a LF, as this is required for Merge to work,
but Windows files are terminated by CRLF by default.  The git
default setting causes the line endings of files in a Windows git
repository to be flipped automatically between LF and CRLF as
required.  This enables files to be edited by any Windows editor
without causing problems in the git repository.
</p>
<hr size="6">
<a name="git-on-windows"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#working-with-source-code" title="Beginning of this chapter or previous chapter"> &lt;&lt; Working with source code&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#compiling" title="Next chapter">&nbsp;Compiling &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#git-on-windows" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; &nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#git-on-windows" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Git on Windows&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#git-on-windows" title="Next section in reading order" accesskey="n" rel="next">&nbsp; &gt; </a>]</td></tr></table>
<h3 class="subsection">3.5.6 Checking out a branch</h3>

<p>At this stage you have two branches in your local repository,
both identical.  To see them click on
</p>
<blockquote><pre class="example">Branch -&gt; Checkout
</pre></blockquote>

<p>You should have one local branch called &lsquo;master&rsquo; and one
tracking branch called &lsquo;origin/master&rsquo;.  The latter is your
local copy of the &lsquo;remotes/origin/master&rsquo; branch in the master
LilyPond repository.  The local &lsquo;master&rsquo; branch is where you
will make your local changes.
</p>
<p>When a particular branch is selected, i.e., checked out, the files
visible in your repository are changed to reflect the state of the
files on that branch.
</p>
<hr size="6">
<a name="git-on-windows"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#working-with-source-code" title="Beginning of this chapter or previous chapter"> &lt;&lt; Working with source code&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#compiling" title="Next chapter">&nbsp;Compiling &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#git-on-windows" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; &nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#git-on-windows" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Git on Windows&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#git-on-windows" title="Next section in reading order" accesskey="n" rel="next">&nbsp; &gt; </a>]</td></tr></table>
<h3 class="subsection">3.5.7 Updating files from &lsquo;remote/origin/master&rsquo;</h3>

<p>Before starting the editing of a file, ensure your local
repository contains the latest version of the files in the remote
repository by first clicking
</p>
<blockquote><pre class="example">Remote -&gt; Fetch from -&gt; origin
</pre></blockquote>

<p>in the Git GUI.
</p>
<p>This will place the latest version of every file, including all
the changes made by others, into the &lsquo;origin/master&rsquo; branch of
the tracking branches in your git repository.  You can see these
files by checking out this branch, but you must <em>never</em> edit
any files while this branch is checked out.  Check out your local
&lsquo;master&rsquo; branch again.
</p>
<p>You then need to merge these fetched files into your local
&lsquo;master&rsquo; branch by clicking on
</p>
<blockquote><pre class="example">Merge -&gt; Local Merge
</pre></blockquote>

<p>and if necessary select the local &lsquo;master&rsquo; branch.
</p>
<p>Note that a merge cannot be completed if you have made any local
changes which have not yet been committed.
</p>
<p>This merge will update all the files in the &lsquo;master&rsquo; branch to
reflect the current state of the &lsquo;origin/master&rsquo; branch.  If any
of the changes conflict with changes you have made yourself
recently you will be notified of the conflict (see below).
</p>
<hr size="6">
<a name="git-on-windows"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#working-with-source-code" title="Beginning of this chapter or previous chapter"> &lt;&lt; Working with source code&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#compiling" title="Next chapter">&nbsp;Compiling &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#git-on-windows" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; &nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#git-on-windows" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Git on Windows&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#git-on-windows" title="Next section in reading order" accesskey="n" rel="next">&nbsp; &gt; </a>]</td></tr></table>
<h3 class="subsection">3.5.8 Editing files</h3>

<p>First ensure your &lsquo;master&rsquo; branch is checked out, then simply
edit the files in your local Git repository with your favourite
editor and save them back there.  If any file contains non-ASCII
characters ensure you save it in UTF-8 format.  Git will detect
any changes whenever you restart Git GUI and the file names will
then be listed in the Unstaged Changes panel.  Or you can click
the Rescan button to refresh the panel contents at any time.  You
may break off and resume editing any time.
</p>
<p>The changes you have made may be displayed in diff form in the top
right-hand panel of Git GUI by clicking on the file name shown in
one of the left panels.
</p>
<p>When your editing is complete, move the files from being Unstaged
to Staged by clicking the document symbol to the left of each
name.  If you change your mind it can be moved back by clicking on
the ticked box to the left of the name.
</p>
<p>Finally the changes you have made may be committed to your
&lsquo;master&rsquo; branch by entering a brief message in the Commit
Message box and clicking the Commit button.
</p>
<p>If you wish to amend your changes after a commit has been made,
the original version and the changes you made in that commit may
be recovered by selecting
</p>
<blockquote><pre class="example">Commit -&gt; Amend Last Commit
</pre></blockquote>

<p>or by checking the Amend Last Commit radio button at bottom right.
This will return the changes to the Staged state, so further
editing made be carried out within that commit.  This must only be
done <em>before</em> the changes have been Pushed or sent to your
mentor for Pushing - after that it is too late and corrections
have to be made as a separate commit.
</p>

<hr size="6">
<a name="git-on-windows"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#working-with-source-code" title="Beginning of this chapter or previous chapter"> &lt;&lt; Working with source code&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#compiling" title="Next chapter">&nbsp;Compiling &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#git-on-windows" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; &nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#git-on-windows" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Git on Windows&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#git-on-windows" title="Next section in reading order" accesskey="n" rel="next">&nbsp; &gt; </a>]</td></tr></table>
<h3 class="subsection">3.5.9 Sending changes to &lsquo;remotes/origin/master&rsquo;</h3>

<p>If you do not have write access to &lsquo;remotes/origin/master&rsquo; you
will need to send your changes by email to someone who does.
</p>
<p>First you need to create a diff or patch file containing your
changes.  To create this, the file must first be committed.  Then
terminate the Git GUI.  In the git bash shell first cd to your Git
repository with
</p>
<blockquote><pre class="example">cd [path]/Git
</pre></blockquote>

<p>if necessary, then produce the patch with
</p>
<blockquote><pre class="example">git format-patch origin
</pre></blockquote>

<p>This will create a patch file for all the locally committed files
which differ from &lsquo;origin/master&rsquo;.  The patch file can be found
in [path]/Git and will have a name formed from the commit message.
</p>
<hr size="6">
<a name="git-on-windows"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#working-with-source-code" title="Beginning of this chapter or previous chapter"> &lt;&lt; Working with source code&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#compiling" title="Next chapter">&nbsp;Compiling &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#git-on-windows" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; &nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#git-on-windows" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Git on Windows&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#git-on-windows" title="Next section in reading order" accesskey="n" rel="next">&nbsp; &gt; </a>]</td></tr></table>
<h3 class="subsection">3.5.10 Resolving merge conflicts</h3>

<p>As soon as you have committed a changed file your local
<code>master</code> branch has diverged from <code>origin/master</code>, and
will remain diverged until your changes have been committed in
<code>remotes/origin/master</code> and Fetched back into your
<code>origin/master</code> branch.  Similarly, if a new commit has been
made to <code>remotes/origin/master</code> by someone else and Fetched,
your local <code>master</code> branch is divergent.  You can detect a
divergent branch by clicking on
</p>
<blockquote><pre class="example">Repository -&gt; Visualise all branch history
</pre></blockquote>

<p>This opens up a very useful new window called &lsquo;gitk&rsquo;.  Use this
to browse all the commits made by yourself and others.
</p>
<p>If the diagram at top left of the resulting window does not show
your <code>master</code> tag on the same node as the
<code>remotes/origin/master</code> tag your branch has diverged from
<code>origin/master</code>.  This is quite normal if files you have
modified yourself have not yet been Pushed to
<code>remotes/origin/master</code> and Fetched, or if files modified and
committed by others have been Fetched since you last Merged
<code>origin/master</code> into your local <code>master</code> branch.
</p>
<p>If a file being merged from <code>origin/master</code> differs from one
you have modified in a way that cannot be resolved automatically
by git, Merge will report a Conflict which you must resolve by
editing the file to create the version you wish to keep.
</p>
<p>This could happen if the person updating
<code>remotes/origin/master</code> for you has added some changes of his
own before committing your changes to
<code>remotes/origin/master</code>, or if someone else has changed the
same file since you last fetched the file from
<code>remotes/origin/master</code>.
</p>
<p>Open the file in your editor and look for sections which are
delimited with ...
</p>
<p>[to be completed when I next have a merge conflict to be sure I
give the right instructions  -td]
</p>

<hr size="6">
<a name="git-on-windows"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#working-with-source-code" title="Beginning of this chapter or previous chapter"> &lt;&lt; Working with source code&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#compiling" title="Next chapter">&nbsp;Compiling &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#git-on-windows" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; &nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#git-on-windows" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Git on Windows&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#repository-directory-structure" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Repository directory structure &gt; </a>]</td></tr></table>
<h3 class="subsection">3.5.11 Other actions</h3>

<p>The instructions above describe the simplest way of using git on
Windows.  Other git facilities which may usefully supplement these
include
</p>
<ul>
<li> Using multiple local branches (Create, Rename, Delete)
</li><li> Resetting branches
</li><li> Cherry-picking commits
</li><li> Pushing commits to remote/origin/master
</li><li> Using gitk to review history
</li></ul>

<p>Once familiarity with using git on Windows has been gained the
standard git manuals can be used to learn about these.
</p>

<hr size="6">
<a name="Repository-directory-structure"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#working-with-source-code" title="Beginning of this chapter or previous chapter"> &lt;&lt; Working with source code&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#compiling" title="Next chapter">&nbsp;Compiling &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#git-on-windows" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; &nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#working-with-source-code" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Working with source code&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#other-git-documentation" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Other Git documentation &gt; </a>]</td></tr></table>
<a name="repository-directory-structure"></a>
<h2 class="section">3.6 Repository directory structure</h2>


<pre class="verbatim">Prebuilt Documentation and packages are available from:

    http://www.lilypond.org

LilyPond development is hosted at:

    http://savannah.gnu.org/projects/lilypond

Here is a simple explanation of the directory layout for
LilyPond's source files.


.                        Toplevel READMEs, ChangeLog,
|                          build bootstrapping, patches
|                          for third party programs
|
|-- Documentation/       Top sources for manuals
|   |
|   |
|   |   INDIVIDUAL CHAPTERS FOR EACH MANUAL:
|   |
|   |-- contributor/     Contributor's Guide
|   |-- essay/           Essay on automated music engraving
|   |-- extending/       Extending
|   |-- learning/        Learning Manual
|   |-- notation/        Notation Reference
|   |-- usage/           Usage
|   |-- web/             The website
|   |
|   |
|   |   TRANSLATED MANUALS:
|   |     Each language's directory can contain...
|   |       1) translated versions of:
|   |          * top sources for manuals
|   |          * individual chapters for each manual
|   |       2) a texidocs/ directory for snippet translations
|   |
|   |-- cs/              Czech
|   |-- de/              German
|   |-- es/              Spanish
|   |-- fr/              French
|   |-- hu/              Hungarian
|   |-- it/              Italian
|   |-- ja/              Japanese
|   |-- nl/              Dutch
|   |-- zh/              Chinese
|   |
|   |
|   |   MISCELLANEOUS DOC STUFF:
|   |
|   |-- css/             CSS files for HTML docs
|   |-- included/        .ly files used in the manuals
|   |-- logo/            Web logo and &quot;note&quot; icon
|   |-- ly-examples/     .ly files for the &quot;Examples&quot; webpage
|   |-- misc/            Old announcements, ChangeLogs and NEWS
|   |-- pictures/        Images used (eps/jpg/png/svg)
|   |   `-- pdf/         (pdf)
|   |-- po/              Translated build/maintenance scripts
|   |-- snippets/        Auto-generated .ly snippets (from the LSR)
|   |   `-- new/         Snippets too new for the LSR
|   `-- topdocs/         AUTHORS, INSTALL, README
|
|
|   C++ SOURCES:
|
|-- flower/              A simple C++ library
|-- lily/                C++ sources for the LilyPond binary
|
|
|   LIBRARIES:
|
|-- ly/                  .ly \include files
|-- mf/                  MetaFont sources for Emmentaler fonts
|-- ps/                  PostScript library files
|-- scm/                 Scheme sources for LilyPond and subroutine files
|-- tex/                 TeX and texinfo library files
|
|
|   SCRIPTS:
|
|-- python/              Python modules, MIDI module
|   `-- auxiliar/        Python modules for build/maintenance
|-- scripts/             End-user scripts (--&gt; lilypond/usr/bin/)
|   |-- auxiliar/        Maintenance and non-essential build scripts
|   `-- build/           Essential build scripts
|
|
|   BUILD PROCESS:
|   (also see SCRIPTS section above)
|
|-- make/                Specific make subroutine files
|-- stepmake/            Generic make subroutine files
|
|
|   REGRESSION TESTS:
|
|-- input/
|   `-- regression/      .ly regression tests
|       |-- abc2ly/      .abc regression tests
|       |-- lilypond-book/  lilypond-book regression tests
|       |-- midi/        midi2ly regression tests
|       `-- musicxml/    .xml and .itexi regression tests
|
|
|   MISCELLANEOUS:
|
|-- elisp/               Emacs LilyPond mode and syntax coloring
|-- vim/                 Vi(M) LilyPond mode and syntax coloring
`-- po/                  Translations for binaries and end-user scripts
</pre>

<hr size="6">
<a name="Other-Git-documentation"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#working-with-source-code" title="Beginning of this chapter or previous chapter"> &lt;&lt; Working with source code&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#compiling" title="Next chapter">&nbsp;Compiling &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#repository-directory-structure" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Repository directory structure&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#working-with-source-code" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Working with source code&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#compiling" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Compiling &gt; </a>]</td></tr></table>
<a name="other-git-documentation"></a>
<h2 class="section">3.7 Other Git documentation</h2>

<ul>
<li>
Official git man pages:
<a href="http://www.kernel.org/pub/software/scm/git/docs">http://www.kernel.org/pub/software/scm/git/docs/</a>

</li><li>
More in-depth tutorials: <a href="http://git-scm.com/documentation">http://git-scm.com/documentation</a>

</li><li>
Book about git: <a href="http://progit.org">Pro Git</a>

</li><li>
Github help: <a href="http://help.github.com">http://help.github.com/</a>
(very highly recommended by Graham)

</li></ul>


<hr size="6">
<a name="Compiling"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#working-with-source-code" title="Beginning of this chapter or previous chapter"> &lt;&lt; Working with source code&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#documentation-work" title="Next chapter">&nbsp;Documentation work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#other-git-documentation" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Other Git documentation&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#index" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Top&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#overview-of-compiling" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Overview of compiling &gt; </a>]</td></tr></table>
<a name="compiling"></a>
<h1 class="chapter">4. Compiling</h1>

<p>This chapter describes the process of compiling the LilyPond
program from source files.
</p>




<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#overview-of-compiling" accesskey="1">4.1 Overview of compiling</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#requirements" accesskey="2">4.2 Requirements</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#getting-the-source-code" accesskey="3">4.3 Getting the source code</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#configuring-make" accesskey="4">4.4 Configuring <code>make</code></a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#compiling-lilypond" accesskey="5">4.5 Compiling LilyPond</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#post_002dcompilation-options" accesskey="6">4.6 Post-compilation options</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#problems" accesskey="7">4.7 Problems</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#concurrent-stable-and-development-versions" accesskey="8">4.8 Concurrent stable and development versions</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#build-system" accesskey="9">4.9 Build system</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>


<hr size="6">
<a name="Overview-of-compiling"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#compiling" title="Beginning of this chapter or previous chapter"> &lt;&lt; Compiling&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#documentation-work" title="Next chapter">&nbsp;Documentation work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#compiling" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Compiling&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#compiling" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Compiling&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#requirements" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Requirements &gt; </a>]</td></tr></table>
<a name="overview-of-compiling"></a>
<h2 class="section">4.1 Overview of compiling</h2>

<p>Compiling LilyPond from source is an involved process, and is only
recommended for developers and packagers.  Typical program users
are instead encouraged to obtain the program from a package
manager (on Unix) or by downloading a precompiled binary
configured for a specific operating system.  Pre-compiled binaries
are available on the <a name="index-Download"></a>
<a href="web-big-page.html#download">Download</a> page.
</p>
<p>Compiling LilyPond from source is necessary if you want to build,
install, or test your own version of the program.
</p>
<p>A successful compile can also be used to generate and install the
documentation, incorporating any changes you may have made.
However, a successful compile is not a requirement for generating
the documentation.  The documentation can be built using a Git
repository in conjunction with a locally installed copy of the
program.  For more information, see <a href="#building-documentation-without-compiling">Building documentation without compiling</a>.
</p>
<p>Attempts to compile LilyPond natively on Windows have been
unsuccessful, though a workaround is available (see
<a name="index-LilyDev-1"></a>
<a href="contributor-big-page.html#lilydev">LilyDev</a>).
</p>

<hr size="6">
<a name="Requirements"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#compiling" title="Beginning of this chapter or previous chapter"> &lt;&lt; Compiling&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#documentation-work" title="Next chapter">&nbsp;Documentation work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#overview-of-compiling" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Overview of compiling&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#compiling" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Compiling&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#requirements-for-running-lilypond" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Requirements for running LilyPond &gt; </a>]</td></tr></table>
<a name="requirements"></a>
<h2 class="section">4.2 Requirements</h2>


<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#requirements-for-running-lilypond" accesskey="1">4.2.1 Requirements for running LilyPond</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#requirements-for-compiling-lilypond" accesskey="2">4.2.2 Requirements for compiling LilyPond</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#requirements-for-building-documentation" accesskey="3">4.2.3 Requirements for building documentation</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>


<hr size="6">
<a name="Requirements-for-running-LilyPond"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#compiling" title="Beginning of this chapter or previous chapter"> &lt;&lt; Compiling&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#documentation-work" title="Next chapter">&nbsp;Documentation work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#requirements" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Requirements&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#requirements" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Requirements&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#requirements-for-compiling-lilypond" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Requirements for compiling LilyPond &gt; </a>]</td></tr></table>
<a name="requirements-for-running-lilypond"></a>
<h3 class="subsection">4.2.1 Requirements for running LilyPond</h3>

<p>Running LilyPond requires proper installation of the following
software:
</p>
<ul>
<li> <a href="http://www.dejavu-fonts.org">DejaVu fonts</a> (normally
installed by default)

</li><li> <a href="http://www.fontconfig.org">FontConfig</a> (2.4.0 or newer)

</li><li> <a href="http://www.freetype.org">Freetype</a> (2.1.10 or newer)

</li><li> <a href="http://www.ghostscript.com">Ghostscript</a> (8.60 or
newer)

</li><li> <a href="http://www.gnu.org/software/guile/guile.html">Guile</a>
(1.8.2 or newer)

</li><li> <a href="http://www.pango.org">Pango</a> (1.12 or newer)

</li><li> <a href="http://www.python.org">Python</a> (2.4 or newer)
</li></ul>

<p>International fonts are required to create music with
international text or lyrics.
</p>

<hr size="6">
<a name="Requirements-for-compiling-LilyPond"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#compiling" title="Beginning of this chapter or previous chapter"> &lt;&lt; Compiling&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#documentation-work" title="Next chapter">&nbsp;Documentation work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#requirements-for-running-lilypond" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Requirements for running LilyPond&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#requirements" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Requirements&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#requirements-for-building-documentation" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Requirements for building documentation &gt; </a>]</td></tr></table>
<a name="requirements-for-compiling-lilypond"></a>
<h3 class="subsection">4.2.2 Requirements for compiling LilyPond</h3>

<p>Below is a full list of packages needed to build LilyPond.
However, for most common distributions there is an easy way of
installing most all build dependencies in one go:
</p>
<table>
<thead><tr><th width="50%">Distribution</th><th width="50%">Command</th></tr></thead>
<tr><td width="50%">Debian, Ubuntu</td><td width="50%"><code>sudo apt-get build-dep lilypond</code></td></tr>
<tr><td width="50%">Fedora, RHEL</td><td width="50%"><code>sudo yum-builddep lilypond</code></td></tr>
<tr><td width="50%">openSUSE, SLED</td><td width="50%"><code>sudo zypper --build-deps-only source-install lilypond</code></td></tr>
</table>

<ul>
<li> Everything listed in <a href="#requirements-for-running-lilypond">Requirements for running LilyPond</a>

</li><li> Development packages for the above items (which should
include header files and libraries).

<p>Red Hat Fedora:
</p>
<blockquote><pre class="example">guile-devel-<var>version</var>
fontconfig-devel-<var>version</var>
freetype-devel-<var>version</var>
pango-devel-<var>version</var>
python-devel-<var>version</var>
</pre></blockquote>

<p>Debian GNU/Linux:
</p>
<blockquote><pre class="example">guile-<var>version</var>-dev
libfontconfig1-dev
libfreetype6-dev
libpango1.0-dev
python<var>version</var>-dev
</pre></blockquote>

</li><li> <a href="http://flex.sourceforge.net">Flex</a>

</li><li> <a href="http://fontforge.sf.net">FontForge</a> (20060125 or
newer; 20100501 or newer is recommended; must be compiled
with &lsquo;<samp>--enable-double</samp>&rsquo;.  Failure to do so can lead to
poor intersection calculations and poorly-rendered glyphs.)

</li><li> <a href="http://www.gnu.org/software/bison">GNU Bison</a>

</li><li> <a href="http://gcc.gnu.org">GNU Compiler Collection</a> (3.4 or
newer, 4.<var>x</var> recommended)

</li><li> <a href="http://www.gnu.org/software/gettext/gettext.html">GNU gettext</a> (0.17 or newer)

</li><li> <a href="http://www.gnu.org/software/make">GNU Make</a> (3.78 or
newer)

</li><li> <a href="http://metafont.tutorial.free.fr">MetaFont</a>
(mf-nowin, mf, mfw or mfont binaries), usually packaged with
<a href="http://www.latex-project.org/ftp.html">TeX</a>.

</li><li> <a href="http://cm.bell-labs.com/who/hobby/MetaPost.html">MetaPost</a> (mpost binary), usually packaged with
<a href="http://www.latex-project.org/ftp.html">TeX</a>.

</li><li> <a href="http://www.perl.org">Perl</a>

</li><li> <a href="http://www.gnu.org/software/texinfo">Texinfo</a> (4.11
or newer)

</li><li> <a href="http://www.lcdf.org/~eddietwo/type/#t1utils">Type 1 utilities</a> (1.33 or newer recommended)
</li></ul>


<hr size="6">
<a name="Requirements-for-building-documentation"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#compiling" title="Beginning of this chapter or previous chapter"> &lt;&lt; Compiling&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#documentation-work" title="Next chapter">&nbsp;Documentation work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#requirements-for-compiling-lilypond" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Requirements for compiling LilyPond&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#requirements" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Requirements&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#getting-the-source-code" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Getting the source code &gt; </a>]</td></tr></table>
<a name="requirements-for-building-documentation"></a>
<h3 class="subsection">4.2.3 Requirements for building documentation</h3>

<p>You can view the documentation online at
<a href="http://www.lilypond.org/doc">http://www.lilypond.org/doc/</a>, but you can also build it
locally.  This process requires some additional tools and
packages:
</p>
<ul>
<li> Everything listed in <a href="#requirements-for-compiling-lilypond">Requirements for compiling LilyPond</a>

</li><li> <a href="http://www.imagemagick.org">ImageMagick</a>

</li><li> <a href="http://netpbm.sourceforge.net">Netpbm</a>

</li><li> <a href="http://gzip.org">gzip</a>

</li><li> <a href="http://rsync.samba.org">rsync</a>

</li><li> <a href="http://www.nongnu.org/texi2html">Texi2HTML</a> (1.82)

</li><li> International fonts

<p>Red Hat Fedora:
</p>
<blockquote><pre class="example">fonts-arabic
fonts-hebrew
fonts-ja
fonts-xorg-truetype
taipeifonts
ttfonts-ja
ttfonts-zh_CN
</pre></blockquote>

<p>Debian GNU/Linux:
</p>
<blockquote><pre class="example">emacs-intl-fonts
ttf-kochi-gothic
ttf-kochi-mincho
xfonts-bolkhov-75dpi
xfonts-cronyx-75dpi
xfonts-cronyx-100dpi
xfonts-intl-.*
</pre></blockquote>
</li></ul>


<hr size="6">
<a name="Getting-the-source-code"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#compiling" title="Beginning of this chapter or previous chapter"> &lt;&lt; Compiling&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#documentation-work" title="Next chapter">&nbsp;Documentation work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#requirements-for-building-documentation" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Requirements for building documentation&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#compiling" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Compiling&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#configuring-make" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Configuring make &gt; </a>]</td></tr></table>
<a name="getting-the-source-code"></a>
<h2 class="section">4.3 Getting the source code</h2>


<a name="Downloading-the-Git-repository"></a>
<h3 class="subheading">Downloading the Git repository</h3>

<p>In general, developers compile LilyPond from within a local Git
repository.  Setting up a local Git repository is explained in
<a name="index-Starting-with-Git"></a>
<a href="contributor-big-page.html#starting-with-git">Starting with Git</a>.
</p>

<a name="Downloading-a-source-tarball"></a>
<h3 class="subheading">Downloading a source tarball</h3>

<p>Packagers are encouraged to use source tarballs for compiling.
</p>
<p>The tarball for the latest stable release is available on the
<a name="index-Source"></a>
<a href="web-big-page.html#source">Source</a> page.
</p>
<p>The latest
<a href="http://git.savannah.gnu.org/gitweb/?p=lilypond.git;a=snapshot">source code snapshot</a>
is also available as a tarball from the GNU Savannah Git server.
</p>
<p>All tagged releases (including legacy stable
versions and the most recent development release) are available
here:
</p>
<blockquote><pre class="example"><a href="http://download.linuxaudio.org/lilypond/source">http://download.linuxaudio.org/lilypond/source/</a>
</pre></blockquote>

<p>Download the tarball to your &lsquo;<tt>~/src/</tt>&rsquo; directory, or some
other appropriate place.
</p>
<div class="warning"><p><strong>Note:</strong> Be careful where you unpack the tarball!  Any
subdirectories of the current folder named &lsquo;<tt>lilypond/</tt>&rsquo; or
&lsquo;<tt>lilypond-<var>x.y.z</var>/</tt>&rsquo; (where <var>x.y.z</var> is the release
number) will be overwritten if there is a name clash with the
tarball.
</p>
</div>
<p>Unpack the tarball with this command:
</p>
<blockquote><pre class="example">tar -xzf lilypond-<var>x.y.z</var>.tar.gz
</pre></blockquote>

<p>This creates a subdirectory within the current directory called
&lsquo;<tt>lilypond-<var>x.y.z</var>/</tt>&rsquo;.  Once unpacked, the source files
occupy about 40 MB of disk space.
</p>
<p>Windows users wanting to look at the source code may have to
download and install the free-software
<a href="http://www.7-zip.org">7zip archiver</a> to extract the tarball.
</p>

<hr size="6">
<a name="Configuring-make"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#compiling" title="Beginning of this chapter or previous chapter"> &lt;&lt; Compiling&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#documentation-work" title="Next chapter">&nbsp;Documentation work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#getting-the-source-code" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Getting the source code&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#compiling" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Compiling&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#running-_002e_002fautogen_002esh" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Running ./autogen.sh &gt; </a>]</td></tr></table>
<a name="configuring-make"></a>
<h2 class="section">4.4 Configuring <code>make</code></h2>


<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#running-_002e_002fautogen_002esh" accesskey="1">4.4.1 Running <code>./autogen.sh</code></a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#running-_002e_002e_002fconfigure" accesskey="2">4.4.2 Running <code>../configure</code></a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>


<hr size="6">
<a name="Running-_002e_002fautogen_002esh"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#compiling" title="Beginning of this chapter or previous chapter"> &lt;&lt; Compiling&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#documentation-work" title="Next chapter">&nbsp;Documentation work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#configuring-make" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Configuring make&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#configuring-make" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Configuring make&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#running-_002e_002e_002fconfigure" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Running ../configure &gt; </a>]</td></tr></table>
<a name="running-_002e_002fautogen_002esh"></a>
<h3 class="subsection">4.4.1 Running <code>./autogen.sh</code></h3>

<p>After you unpack the tarball (or download the Git repository), the
contents of your top source directory should be similar to the
current source tree listed at
<a href="http://git.sv.gnu.org/gitweb/?p=lilypond.git;a=tree">http://git.sv.gnu.org/gitweb/?p=lilypond.git;a=tree</a>.
</p>
<p>Next, you need to create the generated files; enter the following
command from your top source directory:
</p>
<blockquote><pre class="example">./autogen.sh --noconfigure
</pre></blockquote>

<p>This will generate a number of files and directories to aid
configuration, such as &lsquo;<tt>configure</tt>&rsquo;, &lsquo;<tt>README.txt</tt>&rsquo;, etc.
</p>
<p>Next, create the build directory with:
</p>
<blockquote><pre class="example">mkdir build/
cd build/
</pre></blockquote>

<p>We heavily recommend building lilypond inside a separate directory
with this method.
</p>

<hr size="6">
<a name="Running-_002e_002e_002fconfigure"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#compiling" title="Beginning of this chapter or previous chapter"> &lt;&lt; Compiling&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#documentation-work" title="Next chapter">&nbsp;Documentation work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#running-_002e_002fautogen_002esh" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Running ./autogen.sh&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#configuring-make" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Configuring make&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#configuration-options" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Configuration options &gt; </a>]</td></tr></table>
<a name="running-_002e_002e_002fconfigure"></a>
<h3 class="subsection">4.4.2 Running <code>../configure</code></h3>


<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#configuration-options" accesskey="1">Configuration options</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#checking-build-dependencies" accesskey="2">Checking build dependencies</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#configuring-target-directories" accesskey="3">Configuring target directories</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>


<hr size="6">
<a name="Configuration-options"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#compiling" title="Beginning of this chapter or previous chapter"> &lt;&lt; Compiling&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#documentation-work" title="Next chapter">&nbsp;Documentation work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#running-_002e_002e_002fconfigure" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Running ../configure&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#running-_002e_002e_002fconfigure" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Running ../configure&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#checking-build-dependencies" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Checking build dependencies &gt; </a>]</td></tr></table>
<a name="configuration-options"></a>
<h4 class="unnumberedsubsubsec">Configuration options</h4>

<div class="warning"><p><strong>Note:</strong> make sure that you are in the &lsquo;<tt>build/</tt>&rsquo; subdirectory
of your source tree.
</p>
</div>
<p>The <code>../configure</code> command (generated by
<code>./autogen.sh</code>) provides many options for configuring
<code>make</code>.  To see them all, run:
</p>
<blockquote><pre class="example">../configure --help
</pre></blockquote>


<hr size="6">
<a name="Checking-build-dependencies"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#compiling" title="Beginning of this chapter or previous chapter"> &lt;&lt; Compiling&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#documentation-work" title="Next chapter">&nbsp;Documentation work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#configuration-options" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Configuration options&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#running-_002e_002e_002fconfigure" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Running ../configure&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#configuring-target-directories" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Configuring target directories &gt; </a>]</td></tr></table>
<a name="checking-build-dependencies"></a>
<h4 class="unnumberedsubsubsec">Checking build dependencies</h4>

<div class="warning"><p><strong>Note:</strong> make sure that you are in the &lsquo;<tt>build/</tt>&rsquo; subdirectory
of your source tree.
</p>
</div>
<p>When <code>../configure</code> is run without any arguments, it will
check to make sure your system has everything required for
compilation:
</p>
<blockquote><pre class="example">../configure
</pre></blockquote>

<p>If any build dependency is missing, <code>../configure</code> will
return with:
</p>
<blockquote><pre class="example">ERROR: Please install required programs:  <var>foo</var>
</pre></blockquote>

<p>The following message is issued if you are missing programs that
are only needed for building the documentation:
</p>
<blockquote><pre class="example">WARNING: Please consider installing optional programs:  <var>bar</var>
</pre></blockquote>

<p>If you intend to build the documentation locally, you will need to
install or update these programs accordingly.
</p>
<div class="warning"><p><strong>Note:</strong> <code>../configure</code> may fail to issue warnings for
certain documentation build requirements that are not met.  If you
experience problems when building the documentation, you may need
to do a manual check of <a href="#requirements-for-building-documentation">Requirements for building documentation</a>.
</p>
</div>

<hr size="6">
<a name="Configuring-target-directories"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#compiling" title="Beginning of this chapter or previous chapter"> &lt;&lt; Compiling&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#documentation-work" title="Next chapter">&nbsp;Documentation work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#checking-build-dependencies" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Checking build dependencies&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#running-_002e_002e_002fconfigure" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Running ../configure&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#compiling-lilypond" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Compiling LilyPond &gt; </a>]</td></tr></table>
<a name="configuring-target-directories"></a>
<h4 class="unnumberedsubsubsec">Configuring target directories</h4>

<div class="warning"><p><strong>Note:</strong> make sure that you are in the &lsquo;<tt>build/</tt>&rsquo; subdirectory
of your source tree.
</p>
</div>
<p>If you intend to use your local build to install a local copy of
the program, you will probably want to configure the installation
directory.  Here are the relevant lines taken from the output of
<code>../configure&nbsp;--help</code>:
</p>
<blockquote><p>By default, &lsquo;<code>make&nbsp;install</code>&rsquo; will install all the
files in &lsquo;<tt>/usr/local/bin</tt>&rsquo;, &lsquo;<tt>/usr/local/lib</tt>&rsquo; etc.  You
can specify an installation prefix other than &lsquo;<tt>/usr/local</tt>&rsquo;
using &lsquo;&lsquo;<samp>--prefix</samp>&rsquo;&rsquo;, for instance &lsquo;&lsquo;<samp>--prefix=$HOME</samp>&rsquo;&rsquo;.
</p></blockquote>

<p>A typical installation prefix is &lsquo;<tt>$HOME/usr</tt>&rsquo;:
</p>
<blockquote><pre class="example">../configure --prefix=$HOME/usr
</pre></blockquote>

<p>Note that if you plan to install a local build on a system where
you do not have root privileges, you will need to do something
like this anyway&mdash;<code>make&nbsp;install</code> will only succeed
if the installation prefix points to a directory where you have
write permission (such as your home directory).  The installation
directory will be automatically created if necessary.
</p>
<p>The location of the <code>lilypond</code> command installed by this
process will be &lsquo;<tt><var>prefix</var>/bin/lilypond</tt>&rsquo;; you may want to
add &lsquo;<tt><var>prefix</var>/bin/</tt>&rsquo; to your <code>$PATH</code> if it is not
already included.
</p>
<p>It is also possible to specify separate installation directories
for different types of program files.  See the full output of
<code>../configure&nbsp;--help</code> for more information.
</p>
<p>If you encounter any problems, please see <a href="#problems">Problems</a>.
</p>

<hr size="6">
<a name="Compiling-LilyPond"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#compiling" title="Beginning of this chapter or previous chapter"> &lt;&lt; Compiling&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#documentation-work" title="Next chapter">&nbsp;Documentation work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#configuring-target-directories" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Configuring target directories&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#compiling" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Compiling&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#using-make" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Using make &gt; </a>]</td></tr></table>
<a name="compiling-lilypond"></a>
<h2 class="section">4.5 Compiling LilyPond</h2>


<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#using-make" accesskey="1">4.5.1 Using <code>make</code></a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#saving-time-with-the-_002dj-option" accesskey="2">4.5.2 Saving time with the &lsquo;<samp>-j</samp>&rsquo; option</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#compiling-for-multiple-platforms" accesskey="3">4.5.3 Compiling for multiple platforms</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#useful-make-variables" accesskey="4">4.5.4 Useful <code>make</code> variables</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>


<hr size="6">
<a name="Using-make"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#compiling" title="Beginning of this chapter or previous chapter"> &lt;&lt; Compiling&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#documentation-work" title="Next chapter">&nbsp;Documentation work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#compiling-lilypond" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Compiling LilyPond&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#compiling-lilypond" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Compiling LilyPond&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#saving-time-with-the-_002dj-option" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Saving time with the -j option &gt; </a>]</td></tr></table>
<a name="using-make"></a>
<h3 class="subsection">4.5.1 Using <code>make</code></h3>

<div class="warning"><p><strong>Note:</strong> make sure that you are in the &lsquo;<tt>build/</tt>&rsquo; subdirectory
of your source tree.
</p>
</div>
<p>LilyPond is compiled with the <code>make</code> command.  Assuming
<code>make</code> is configured properly, you can simply run:
</p>
<blockquote><pre class="example">make
</pre></blockquote>

<p>&lsquo;<samp>make</samp>&rsquo; is short for &lsquo;<samp>make all</samp>&rsquo;.  To view a list of <code>make</code>
targets, run:
</p>
<blockquote><pre class="example">make help
</pre></blockquote>

<p>TODO: Describe what <code>make</code> actually does.
</p>
<a name="See-also-2"></a>
<h4 class="subsubheading">See also</h4>
<p><a href="#generating-documentation">Generating documentation</a> provides more info on the <code>make</code> targets
used to build the LilyPond documentation.
</p>

<hr size="6">
<a name="Saving-time-with-the-_002dj-option"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#compiling" title="Beginning of this chapter or previous chapter"> &lt;&lt; Compiling&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#documentation-work" title="Next chapter">&nbsp;Documentation work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#using-make" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Using make&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#compiling-lilypond" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Compiling LilyPond&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#compiling-for-multiple-platforms" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Compiling for multiple platforms &gt; </a>]</td></tr></table>
<a name="saving-time-with-the-_002dj-option"></a>
<h3 class="subsection">4.5.2 Saving time with the &lsquo;<samp>-j</samp>&rsquo; option</h3>

<p>If your system has multiple CPUs, you can speed up compilation by
adding &lsquo;<samp>-j<var>X</var></samp>&rsquo; to the <code>make</code> command, where
&lsquo;<samp><var>X</var></samp>&rsquo; is one more than the number of cores you have.  For
example, a typical Core2Duo machine would use:
</p>
<blockquote><pre class="example">make -j3
</pre></blockquote>

<p>If you get errors using the &lsquo;<samp>-j</samp>&rsquo; option, and &lsquo;<samp>make</samp>&rsquo;
succeeds without it, try lowering the <code><var>X</var></code> value.
</p>
<p>Because multiple jobs run in parallel when &lsquo;<samp>-j</samp>&rsquo; is used, it can
be difficult to determine the source of an error when one occurs.  In
that case, running &lsquo;<samp>make</samp>&rsquo; without the &lsquo;<samp>-j</samp>&rsquo; is advised.
</p>
<hr size="6">
<a name="Compiling-for-multiple-platforms"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#compiling" title="Beginning of this chapter or previous chapter"> &lt;&lt; Compiling&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#documentation-work" title="Next chapter">&nbsp;Documentation work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#saving-time-with-the-_002dj-option" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Saving time with the -j option&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#compiling-lilypond" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Compiling LilyPond&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#useful-make-variables" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Useful make variables &gt; </a>]</td></tr></table>
<a name="compiling-for-multiple-platforms"></a>
<h3 class="subsection">4.5.3 Compiling for multiple platforms</h3>

<p>If you want to build multiple versions of LilyPond with different
configuration settings, you can use the
&lsquo;<samp>--enable-config=<var>conf</var></samp>&rsquo; option of <code>configure</code>.
You should use <code>make&nbsp;conf=<var>conf</var></code> to generate the
output in &lsquo;<tt>out-<var>conf</var></tt>&rsquo;.  For example, suppose you want to
build with and without profiling, then use the following for the
normal build
</p>
<blockquote><pre class="example">./configure --prefix=$HOME/usr/ --enable-checking
make
</pre></blockquote>

<p>and for the profiling version, specify a different configuration
</p>
<blockquote><pre class="example">./configure --prefix=$HOME/usr/ --enable-profiling \
  --enable-config=prof --disable-checking
make conf=prof
</pre></blockquote>

<p>If you wish to install a copy of the build with profiling, don&rsquo;t
forget to use <code>conf=<var>CONF</var></code> when issuing
<code>make&nbsp;install</code>:
</p>
<blockquote><pre class="example">make conf=prof install
</pre></blockquote>


<a name="See-also"></a>
<h4 class="subsubheading">See also</h4>
<p><a href="#installing-lilypond-from-a-local-build">Installing LilyPond from a local build</a>
</p>

<hr size="6">
<a name="Useful-make-variables"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#compiling" title="Beginning of this chapter or previous chapter"> &lt;&lt; Compiling&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#documentation-work" title="Next chapter">&nbsp;Documentation work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#compiling-for-multiple-platforms" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Compiling for multiple platforms&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#compiling-lilypond" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Compiling LilyPond&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#post_002dcompilation-options" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Post-compilation options &gt; </a>]</td></tr></table>
<a name="useful-make-variables"></a>
<h3 class="subsection">4.5.4 Useful <code>make</code> variables</h3>

<p>If a less verbose build output if desired, the variable
<code>QUIET_BUILD</code> may be set to <code>1</code> on <code>make</code>
command line, or in &lsquo;<tt>local.make</tt>&rsquo; at top of the build tree.
</p>

<hr size="6">
<a name="Post_002dcompilation-options"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#compiling" title="Beginning of this chapter or previous chapter"> &lt;&lt; Compiling&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#documentation-work" title="Next chapter">&nbsp;Documentation work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#useful-make-variables" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Useful make variables&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#compiling" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Compiling&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#installing-lilypond-from-a-local-build" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Installing LilyPond from a local build &gt; </a>]</td></tr></table>
<a name="post_002dcompilation-options"></a>
<h2 class="section">4.6 Post-compilation options</h2>


<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#installing-lilypond-from-a-local-build" accesskey="1">4.6.1 Installing LilyPond from a local build</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#generating-documentation" accesskey="2">4.6.2 Generating documentation</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#testing-lilypond-binary" accesskey="3">4.6.3 Testing LilyPond binary</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>


<hr size="6">
<a name="Installing-LilyPond-from-a-local-build"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#compiling" title="Beginning of this chapter or previous chapter"> &lt;&lt; Compiling&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#documentation-work" title="Next chapter">&nbsp;Documentation work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#post_002dcompilation-options" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Post-compilation options&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#post_002dcompilation-options" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Post-compilation options&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#generating-documentation" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Generating documentation &gt; </a>]</td></tr></table>
<a name="installing-lilypond-from-a-local-build"></a>
<h3 class="subsection">4.6.1 Installing LilyPond from a local build</h3>

<p>If you configured <code>make</code> to install your local build in a
directory where you normally have write permission (such as your
home directory), and you have compiled LilyPond by running
<code>make</code>, you can install the program in your target
directory by running:
</p>
<blockquote><pre class="example">make install
</pre></blockquote>

<p>If instead, your installation directory is not one that you can
normally write to (such as the default &lsquo;<tt>/usr/local/</tt>&rsquo;, which
typically is only writeable by the superuser), you will need to
temporarily become the superuser when running
<code>make&nbsp;install</code>:
</p>
<blockquote><pre class="example">sudo make install
</pre></blockquote>

<p>or...
</p>
<blockquote><pre class="example">su -c 'make install'
</pre></blockquote>

<p>If you don&rsquo;t have superuser privileges, then you need to configure
the installation directory to one that you can write to, and then
re-install.  See <a href="#configuring-target-directories">Configuring target directories</a>.
</p>

<hr size="6">
<a name="Generating-documentation"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#compiling" title="Beginning of this chapter or previous chapter"> &lt;&lt; Compiling&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#documentation-work" title="Next chapter">&nbsp;Documentation work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#installing-lilypond-from-a-local-build" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Installing LilyPond from a local build&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#post_002dcompilation-options" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Post-compilation options&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#documentation-editor_0027s-edit_002fcompile-cycle" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Documentation editor's edit/compile cycle &gt; </a>]</td></tr></table>
<a name="generating-documentation"></a>
<h3 class="subsection">4.6.2 Generating documentation</h3>


<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#documentation-editor_0027s-edit_002fcompile-cycle" accesskey="1">Documentation editor&rsquo;s edit/compile cycle</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#building-documentation" accesskey="2">Building documentation</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#building-a-single-document" accesskey="3">Building a single document</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#saving-time-with-cpu_005fcount" accesskey="4">Saving time with <code>CPU_COUNT</code></a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#ajax-search" accesskey="5">AJAX search</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#installing-documentation" accesskey="6">Installing documentation</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#building-documentation-without-compiling" accesskey="7">Building documentation without compiling</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>


<hr size="6">
<a name="Documentation-editor_0027s-edit_002fcompile-cycle"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#compiling" title="Beginning of this chapter or previous chapter"> &lt;&lt; Compiling&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#documentation-work" title="Next chapter">&nbsp;Documentation work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#generating-documentation" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Generating documentation&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#generating-documentation" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Generating documentation&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#building-documentation" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Building documentation &gt; </a>]</td></tr></table>
<a name="documentation-editor_0027s-edit_002fcompile-cycle"></a>
<h4 class="unnumberedsubsubsec">Documentation editor&rsquo;s edit/compile cycle</h4>

<ul>
<li>
Initial documentation build:

<blockquote><pre class="example">make [-j<var>X</var>]
make [-j<var>X</var> CPU_COUNT=<var>X</var>] doc          <em>## can take an hour or more</em>
make [-j<var>X</var> CPU_COUNT=<var>X</var>] doc-stage-1  <em>## to build only PDF documentation</em>
</pre></blockquote>

</li><li>
Edit/compile cycle:

<blockquote><pre class="example"><em>## edit source files, then...</em>

make [-j<var>X</var>]                  <em>## needed if editing outside</em>
                            <em>##   Documentation/, but useful anyway</em>
                            <em>##   for finding Texinfo errors.</em>
make [-j<var>X</var> CPU_COUNT=<var>X</var>] doc  <em>## usually faster than initial build.</em>
</pre></blockquote>

</li><li>
Reset:

<p>It is generally possible to remove the compiled documentation from
your system
with &lsquo;<samp>make&nbsp;doc-clean</samp>&rsquo;, but this method is not 100%
guaranteed.  Instead, if you want to be sure you have a clean
system, we recommend that you delete your
&lsquo;<tt>build/</tt>&rsquo; directory, and begin compiling from scratch.  Since
the documentation compile takes much longer than the
non-documentation compile, this does not increase the overall time
by a great deal.
</p>
</li></ul>

<hr size="6">
<a name="Building-documentation"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#compiling" title="Beginning of this chapter or previous chapter"> &lt;&lt; Compiling&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#documentation-work" title="Next chapter">&nbsp;Documentation work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#documentation-editor_0027s-edit_002fcompile-cycle" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Documentation editor's edit/compile cycle&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#generating-documentation" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Generating documentation&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#building-a-single-document" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Building a single document &gt; </a>]</td></tr></table>
<a name="building-documentation"></a>
<h4 class="unnumberedsubsubsec">Building documentation</h4>

<p>After a successful compile (using <code>make</code>), the
documentation can be built by issuing:
</p>
<blockquote><pre class="example">make doc
</pre></blockquote>

<p>or, to build only the PDF documentation and not the HTML,
</p>
<blockquote><pre class="example">make doc-stage-1
</pre></blockquote>

<div class="warning"><p><strong>Note:</strong> The first time you run <code>make&nbsp;doc</code>, the
process can easily take an hour or more with not much output
on the command line.
</p>
</div>
<p>After this initial build, <code>make&nbsp;doc</code> only makes
changes to the documentation where needed, so it may only take
a minute or two to test changes if the documentation is already
built.
</p>
<p>If <code>make&nbsp;doc</code> succeeds, the HTML documentation tree
is available in &lsquo;<tt>out-www/offline-root/</tt>&rsquo;, and can be browsed
locally.  Various portions of the documentation can be found by
looking in &lsquo;<tt>out/</tt>&rsquo; and &lsquo;<tt>out-www</tt>&rsquo; subdirectories in other
places in the source tree, but these are only <em>portions</em> of
the docs.  Please do not complain about anything which is broken
in those places; the only complete set of documentation is in
&lsquo;<tt>out-www/offline-root/</tt>&rsquo; from the top of the source tree.
</p>
<p><code>make&nbsp;doc</code> sends the output from most of the
compilation to logfiles.  If the build fails for any reason, it
should prompt you with the name of a logfile which will provide
information to help you work out why the build failed.  These
logfiles are not deleted with <code>make&nbsp;doc-clean</code>.  To
remove all the logfiles generated by the compilation process, use:
</p>
<blockquote><pre class="example">make log-clean
</pre></blockquote>

<p><code>make&nbsp;doc</code> compiles the documents for all languages.  To
save some compile time, the English language documents can be
compiled on their own with:
</p>
<blockquote><pre class="example">make LANGS='' doc
</pre></blockquote>

<p>Similarly, it is possible to compile a subset of the
translated documentation by specifying their language codes on the
command line.  For example, the French and German translations are
compiled with:
</p>
<blockquote><pre class="example">make LANGS='de fr' doc
</pre></blockquote>

<p>Note that this will also compile the English version.
</p>
<p>Compilation of documentation in Info format with images can be
done separately by issuing:
</p>
<blockquote><pre class="example">make info
</pre></blockquote>

<p>An issue when switching branches between master and translation
is the appearance/disappearance of translated versions of some manuals.
If you see such a warning from make:
</p>
<blockquote><pre class="example">No rule to make target `X', needed by `Y'
</pre></blockquote>

<p>Your best bet is to delete the file Y.dep and to try again.
</p>
<hr size="6">
<a name="Building-a-single-document"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#compiling" title="Beginning of this chapter or previous chapter"> &lt;&lt; Compiling&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#documentation-work" title="Next chapter">&nbsp;Documentation work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#building-documentation" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Building documentation&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#generating-documentation" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Generating documentation&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#saving-time-with-cpu_005fcount" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Saving time with CPU_COUNT &gt; </a>]</td></tr></table>
<a name="building-a-single-document"></a>
<h4 class="unnumberedsubsubsec">Building a single document</h4>
<p>It&rsquo;s possible to build a single document.  For example, to rebuild
only &lsquo;<tt>contributor.pdf</tt>&rsquo;, do the following:
</p>
<blockquote><pre class="example">cd build/
cd Documentation/
touch ../../Documentation/contributor.texi
make out=www out-www/contributor.pdf
</pre></blockquote>

<p>If you are only working on a single document, test-building it in
this way can give substantial time savings - recreating
&lsquo;<tt>contributor.pdf</tt>&rsquo;, for example, takes a matter of seconds.
</p>
<hr size="6">
<a name="Saving-time-with-CPU_005fCOUNT"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#compiling" title="Beginning of this chapter or previous chapter"> &lt;&lt; Compiling&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#documentation-work" title="Next chapter">&nbsp;Documentation work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#building-a-single-document" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Building a single document&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#generating-documentation" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Generating documentation&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#ajax-search" title="Next section in reading order" accesskey="n" rel="next">&nbsp;AJAX search &gt; </a>]</td></tr></table>
<a name="saving-time-with-cpu_005fcount"></a>
<h4 class="unnumberedsubsubsec">Saving time with <code>CPU_COUNT</code></h4>

<p>The most time consuming task for building the documentation is
running LilyPond to build images of music, and there cannot be
several simultaneously running <code>lilypond-book</code> instances,
so the &lsquo;<samp>-j</samp>&rsquo; <code>make</code> option does not significantly
speed up the build process.  To help speed it up, the makefile
variable &lsquo;<samp>CPU_COUNT</samp>&rsquo; may be set in &lsquo;<tt>local.make</tt>&rsquo; or on
the command line to the number of <code>.ly</code> files that LilyPond
should process simultaneously, e.g. on a bi-processor or dual core
machine:
</p>
<blockquote><pre class="example">make -j3 CPU_COUNT=3 doc
</pre></blockquote>

<p>The recommended value of &lsquo;<samp>CPU_COUNT</samp>&rsquo; is one plus the number
of cores or processors, but it is advisable to set it to a smaller
value unless your system has enough RAM to run that many
simultaneous LilyPond instances.  Also, values for the &lsquo;<samp>-j</samp>&rsquo;
option that pose problems with &lsquo;<samp>make</samp>&rsquo; are less likely to pose
problems with &lsquo;<samp>make doc</samp>&rsquo; (this applies to both &lsquo;<samp>-j</samp>&rsquo;
and &lsquo;<samp>CPU_COUNT</samp>&rsquo;).  For example, with a quad-core processor,
it is possible for &lsquo;<samp>make -j5 CPU_COUNT=5 doc</samp>&rsquo; to work
consistently even if &lsquo;<samp>make -j5</samp>&rsquo; rarely succeeds.
</p>

<hr size="6">
<a name="AJAX-search"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#compiling" title="Beginning of this chapter or previous chapter"> &lt;&lt; Compiling&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#documentation-work" title="Next chapter">&nbsp;Documentation work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#saving-time-with-cpu_005fcount" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Saving time with CPU_COUNT&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#generating-documentation" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Generating documentation&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#installing-documentation" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Installing documentation &gt; </a>]</td></tr></table>
<a name="ajax-search"></a>
<h4 class="unnumberedsubsubsec">AJAX search</h4>

<p>To build the documentation with interactive searching, use:
</p>
<blockquote><pre class="example">make doc AJAX_SEARCH=1
</pre></blockquote>

<p>This requires PHP, and you must view the docs via a http
connection (you cannot view them on your local filesystem).
</p>
<div class="warning"><p><strong>Note:</strong> Due to potential security or load issues, this option is
not enabled in the official documentation builds.  Enable at your
own risk.
</p>
</div>

<hr size="6">
<a name="Installing-documentation"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#compiling" title="Beginning of this chapter or previous chapter"> &lt;&lt; Compiling&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#documentation-work" title="Next chapter">&nbsp;Documentation work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#ajax-search" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; AJAX search&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#generating-documentation" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Generating documentation&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#building-documentation-without-compiling" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Building documentation without compiling &gt; </a>]</td></tr></table>
<a name="installing-documentation"></a>
<h4 class="unnumberedsubsubsec">Installing documentation</h4>

<p>The HTML, PDF and if available Info files can be installed into
the standard documentation path by issuing
</p>
<blockquote><pre class="example">make install-doc
</pre></blockquote>

<p>This also installs Info documentation with images if the
installation prefix is properly set; otherwise, instructions to
complete proper installation of Info documentation are printed on
standard output.
</p>
<p>To install the Info documentation separately, run:
</p>
<blockquote><pre class="example">make install-info
</pre></blockquote>

<p>Note that to get the images in Info documentation, <code>install-doc</code>
target creates symbolic links to HTML and PDF installed documentation
tree in &lsquo;<tt><var>prefix</var>/share/info</tt>&rsquo;, in order to save disk space,
whereas <code>install-info</code> copies images in
&lsquo;<tt><var>prefix</var>/share/info</tt>&rsquo; subdirectories.
</p>
<p>It is possible to build a documentation tree in
&lsquo;<tt>out-www/online-root/</tt>&rsquo;, with special processing, so it can be
used on a website with content negotiation for automatic language
selection; this can be achieved by issuing
</p>
<blockquote><pre class="example">make WEB_TARGETS=online doc
</pre></blockquote>

<p>and both &lsquo;offline&rsquo; and &lsquo;online&rsquo; targets can be generated by issuing
</p>
<blockquote><pre class="example">make WEB_TARGETS=&quot;offline online&quot; doc
</pre></blockquote>

<p>Several targets are available to clean the documentation build and
help with maintaining documentation; an overview of these targets is
available with
</p>
<blockquote><pre class="example">make help
</pre></blockquote>

<p>from every directory in the build tree.  Most targets for
documentation maintenance are available from
&lsquo;<tt>Documentation/</tt>&rsquo;; for more information, see
<a name="index-Documentation-work-1"></a>
<a href="contributor-big-page.html#documentation-work">Documentation work</a>.
</p>
<p>The makefile variable <code>QUIET_BUILD</code> may be set to <code>1</code>
for a less verbose build output, just like for building the
programs.
</p>

<hr size="6">
<a name="Building-documentation-without-compiling"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#compiling" title="Beginning of this chapter or previous chapter"> &lt;&lt; Compiling&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#documentation-work" title="Next chapter">&nbsp;Documentation work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#installing-documentation" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Installing documentation&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#generating-documentation" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Generating documentation&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#testing-lilypond-binary" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Testing LilyPond binary &gt; </a>]</td></tr></table>
<a name="building-documentation-without-compiling"></a>
<h4 class="unnumberedsubsubsec">Building documentation without compiling</h4>


<p>The documentation can be built locally without compiling LilyPond
binary, if LilyPond is already installed on your system.
</p>
<p>From a fresh Git checkout, do
</p>
<blockquote><pre class="example">./autogen.sh   # ignore any warning messages
cp GNUmakefile.in GNUmakefile
make -C scripts &amp;&amp; make -C python
nice make LILYPOND_EXTERNAL_BINARY=/path/to/bin/lilypond doc
</pre></blockquote>

<p>Please note that this may break sometimes &ndash; for example, if a new
feature is added with a test file in input/regression, even the latest
development release of LilyPond will fail to build the docs.
</p>
<p>You may build the manual without building all the &lsquo;<tt>input/*</tt>&rsquo; stuff
(i.e. mostly regression tests): change directory, for example to
&lsquo;<tt>Documentation/</tt>&rsquo;, issue <code>make doc</code>, which will build
documentation in a subdirectory &lsquo;<tt>out-www</tt>&rsquo; from the source files in
current directory.  In this case, if you also want to browse the
documentation in its post-processed form, change back to top directory
and issue
</p>
<blockquote><pre class="example">make out=www WWW-post
</pre></blockquote>

<a name="Known-issues-and-warnings"></a>
<h4 class="subsubheading">Known issues and warnings</h4>

<p>You may also need to create a script for <code>pngtopnm</code> and
<code>pnmtopng</code>.  On GNU/Linux, I use this:
</p>
<pre class="verbatim">export LD_LIBRARY_PATH=/usr/lib
exec /usr/bin/pngtopnm &quot;$@&quot;
</pre>
<p>On MacOS X with fink, I use this:
</p>
<pre class="verbatim">export DYLD_LIBRARY_PATH=/sw/lib
exec /sw/bin/pngtopnm &quot;$@&quot;
</pre>
<p>On MacOS X with macports, you should use this:
</p>
<pre class="verbatim">export DYLD_FALLBACK_LIBRARY_PATH=/opt/local/lib
exec /opt/local/bin/pngtopnm &quot;$@&quot;
</pre>

<hr size="6">
<a name="Testing-LilyPond-binary"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#compiling" title="Beginning of this chapter or previous chapter"> &lt;&lt; Compiling&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#documentation-work" title="Next chapter">&nbsp;Documentation work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#building-documentation-without-compiling" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Building documentation without compiling&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#post_002dcompilation-options" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Post-compilation options&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#problems" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Problems &gt; </a>]</td></tr></table>
<a name="testing-lilypond-binary"></a>
<h3 class="subsection">4.6.3 Testing LilyPond binary</h3>


<p>LilyPond comes with an extensive suite that exercises the entire
program.  This suite can be used to test that the binary has
been built correctly.
</p>
<p>The test suite can be executed with:
</p>
<pre class="verbatim">make test
</pre>
<p>If the test suite completes successfully, the LilyPond binary
has been verified.
</p>
<p>More information on the regression test suite is found at
<a name="index-Regression-tests"></a>
<a href="contributor-big-page.html#regression-tests">Regression tests</a>.
</p>
<hr size="6">
<a name="Problems"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#compiling" title="Beginning of this chapter or previous chapter"> &lt;&lt; Compiling&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#documentation-work" title="Next chapter">&nbsp;Documentation work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#testing-lilypond-binary" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Testing LilyPond binary&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#compiling" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Compiling&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#problems" title="Next section in reading order" accesskey="n" rel="next">&nbsp; &gt; </a>]</td></tr></table>
<a name="problems"></a>
<h2 class="section">4.7 Problems</h2>

<p>For help and questions use <a href="mailto:lilypond-user@gnu.org">lilypond-user@gnu.org</a>.  Send
bug reports to <a href="mailto:bug-lilypond@gnu.org">bug-lilypond@gnu.org</a>.
</p>
<p>Bugs that are not fault of LilyPond are documented here.
</p>
<hr size="6">
<a name="problems"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#compiling" title="Beginning of this chapter or previous chapter"> &lt;&lt; Compiling&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#documentation-work" title="Next chapter">&nbsp;Documentation work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#problems" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Problems&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#problems" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Problems&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#problems" title="Next section in reading order" accesskey="n" rel="next">&nbsp; &gt; </a>]</td></tr></table>
<h3 class="unnumberedsubsec">Bison 1.875</h3>

<p>There is a bug in bison-1.875: compilation fails with &quot;parse error
before &lsquo;goto&rsquo;&quot; in line 4922 due to a bug in bison.  To fix, please
recompile bison 1.875 with the following fix
</p>
<blockquote><pre class="example">$ cd lily; make out/parser.cc
$ vi +4919 out/parser.cc
# append a semicolon to the line containing &quot;__attribute__ ((__unused__))
# save
$ make
</pre></blockquote>


<hr size="6">
<a name="problems"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#compiling" title="Beginning of this chapter or previous chapter"> &lt;&lt; Compiling&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#documentation-work" title="Next chapter">&nbsp;Documentation work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#problems" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; &nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#problems" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Problems&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#problems" title="Next section in reading order" accesskey="n" rel="next">&nbsp; &gt; </a>]</td></tr></table>
<h3 class="unnumberedsubsec">Compiling on MacOS&nbsp;X</h3>

<p>Here are special instructions for compiling under MacOS&nbsp;X.
These instructions assume that dependencies are installed using
<a href="http://www.macports.org">MacPorts.</a> The instructions have
been tested using OS X 10.5 (Leopard).
</p>
<p>First, install the relevant dependencies using MacPorts.
</p>
<p>Next, add the following to your relevant shell initialization
files.  This is <code>~/.profile</code> by default.  You should create
this file if it does not exist.
</p>
<blockquote><pre class="example">export PATH=/opt/local/bin:/opt/local/sbin:$PATH
export DYLD_FALLBACK_LIBRARY_PATH=/opt/local/lib:$DYLD_FALLBACK_LIBRARY_PATH
</pre></blockquote>

<p>Now you must edit the generated &lsquo;<tt>config.make</tt>&rsquo; file.  Change
</p>
<blockquote><pre class="example">FLEXLEXER_FILE = /usr/include/FlexLexer.h
</pre></blockquote>

<p>to:
</p>
<blockquote><pre class="example">FLEXLEXER_FILE = /opt/local/include/FlexLexer.h
</pre></blockquote>

<p>At this point, you should verify that you have the appropriate
fonts installed with your ghostscript installation.  Check <code>ls
/opt/local/share/ghostscript/fonts</code> for: &rsquo;c0590*&rsquo; files (.pfb,
.pfb and .afm).  If you don&rsquo;t have them, run the following
commands to grab them from the ghostscript SVN server and install
them in the appropriate location:
</p>
<blockquote><pre class="example">svn export http://svn.ghostscript.com/ghostscript/tags/urw-fonts-1.0.7pre44/
sudo mv urw-fonts-1.0.7pre44/* /opt/local/share/ghostscript/fonts/
rm -rf urw-fonts-1.07pre44
</pre></blockquote>

<p>Now run the <code>./configure</code> script.  To avoid complications with
automatic font detection, add
</p>
<blockquote><pre class="example">--with-ncsb-dir=/opt/local/share/ghostscript/fonts
</pre></blockquote>


<hr size="6">
<a name="problems"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#compiling" title="Beginning of this chapter or previous chapter"> &lt;&lt; Compiling&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#documentation-work" title="Next chapter">&nbsp;Documentation work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#problems" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; &nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#problems" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Problems&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#problems" title="Next section in reading order" accesskey="n" rel="next">&nbsp; &gt; </a>]</td></tr></table>
<h3 class="unnumberedsubsec">Solaris</h3>

<p>Solaris7, ./configure
</p>
<p>&lsquo;<tt>./configure</tt>&rsquo; needs a POSIX compliant shell.  On Solaris7,
&lsquo;<tt>/bin/sh</tt>&rsquo; is not yet POSIX compliant, but &lsquo;<tt>/bin/ksh</tt>&rsquo; or bash
is.  Run configure like
</p>
<blockquote><pre class="example">CONFIG_SHELL=/bin/ksh ksh -c ./configure
</pre></blockquote>

<p>or
</p>
<blockquote><pre class="example">CONFIG_SHELL=/bin/bash bash -c ./configure
</pre></blockquote>

<hr size="6">
<a name="problems"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#compiling" title="Beginning of this chapter or previous chapter"> &lt;&lt; Compiling&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#documentation-work" title="Next chapter">&nbsp;Documentation work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#problems" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; &nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#problems" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Problems&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#problems" title="Next section in reading order" accesskey="n" rel="next">&nbsp; &gt; </a>]</td></tr></table>
<h3 class="unnumberedsubsec">FreeBSD</h3>

<p>To use system fonts, dejaview must be installed.  With the default
port, the fonts are installed in &lsquo;<tt>usr/X11R6/lib/X11/fonts/dejavu</tt>&rsquo;.
</p>
<p>Open the file &lsquo;<tt>$LILYPONDBASE/usr/etc/fonts/local.conf</tt>&rsquo; and add the
following line just after the <code>&lt;fontconfig&gt;</code> line.  (Adjust as necessary
for your hierarchy.)
</p>
<blockquote><pre class="example">&lt;dir&gt;/usr/X11R6/lib/X11/fonts&lt;/dir&gt;
</pre></blockquote>


<hr size="6">
<a name="problems"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#compiling" title="Beginning of this chapter or previous chapter"> &lt;&lt; Compiling&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#documentation-work" title="Next chapter">&nbsp;Documentation work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#problems" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; &nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#problems" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Problems&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#problems" title="Next section in reading order" accesskey="n" rel="next">&nbsp; &gt; </a>]</td></tr></table>
<h3 class="unnumberedsubsec">International fonts</h3>

<p>On Mac OS X, all fonts are installed by default.  However, finding all
system fonts requires a bit of configuration; see
<a href="http://lists.gnu.org/archive/html/lilypond-user/2007-03/msg00472.html">this post</a> on the <code>lilypond-user</code> mailing list.
</p>
<p>On Linux, international fonts are installed by different means on
every distribution.  We cannot list the exact commands or packages
that are necessary, as each distribution is different, and the exact
package names within each distribution changes.  Here are some
hints, though:
</p>
<pre class="verbatim">Red Hat Fedora

    taipeifonts fonts-xorg-truetype ttfonts-ja fonts-arabic \
         ttfonts-zh_CN fonts-ja fonts-hebrew

Debian GNU/Linux

   apt-get install emacs-intl-fonts xfonts-intl-.* \
        ttf-kochi-gothic ttf-kochi-mincho \
        xfonts-bolkhov-75dpi xfonts-cronyx-100dpi xfonts-cronyx-75dpi
</pre>

<hr size="6">
<a name="problems"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#compiling" title="Beginning of this chapter or previous chapter"> &lt;&lt; Compiling&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#documentation-work" title="Next chapter">&nbsp;Documentation work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#problems" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; &nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#problems" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Problems&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#concurrent-stable-and-development-versions" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Concurrent stable and development versions &gt; </a>]</td></tr></table>
<h3 class="unnumberedsubsec">Using lilypond python libraries</h3>

<p>If you want to use lilypond&rsquo;s python libraries (either running
certain build scripts manually, or using them in other programs),
set <code>PYTHONPATH</code> to &lsquo;<tt>python/out</tt>&rsquo; in your build
directory, or &lsquo;<tt>.../usr/lib/lilypond/current/python</tt>&rsquo; in the
installation directory structure.
</p>



<hr size="6">
<a name="Concurrent-stable-and-development-versions"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#compiling" title="Beginning of this chapter or previous chapter"> &lt;&lt; Compiling&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#documentation-work" title="Next chapter">&nbsp;Documentation work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#problems" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; &nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#compiling" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Compiling&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#build-system" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Build system &gt; </a>]</td></tr></table>
<a name="concurrent-stable-and-development-versions"></a>
<h2 class="section">4.8 Concurrent stable and development versions</h2>


<p>It can be useful to have both the stable and the development versions
of Lilypond available at once.  One way to do this on GNU/Linux is to
install the stable version using the precompiled binary, and run the
development version from the source tree.  After running <code>make
all</code> from the top directory of the Lilypond source files, there will
be a binary called <code>lilypond</code> in the <code>out</code> directory:
</p>
<blockquote><pre class="example">&lt;<var>path to</var>&gt;/lilypond/out/bin/lilypond
</pre></blockquote>

<p>This binary can be run without actually doing the <code>make
install</code> command.  The advantage to this is that you can have all
of the latest changes available after pulling from git and running
<code>make all</code>, without having to uninstall the old version and
reinstall the new.
</p>
<p>So, to use the stable version, install it as usual and use the
normal commands:
</p>
<blockquote><pre class="example">lilypond foobar.ly
</pre></blockquote>

<p>To use the development version, create a link to the binary in the
source tree by saving the following line in a file somewhere in your
<code>$PATH</code>:
</p>
<blockquote><pre class="example">exec &lt;<var>path to</var>&gt;/lilypond/out/bin/lilypond &quot;$@&quot;
</pre></blockquote>

<p>Save it as <code>Lilypond</code> (with a capital L to distinguish it
from the stable <code>lilypond</code>), and make it executable:
</p>
<blockquote><pre class="example">chmod +x Lilypond
</pre></blockquote>

<p>Then you can invoke the development version this way:
</p>
<blockquote><pre class="example">Lilypond foobar.ly
</pre></blockquote>


<p>TODO: ADD
</p>
<p>- other compilation tricks for developers
</p>

<hr size="6">
<a name="Build-system"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#compiling" title="Beginning of this chapter or previous chapter"> &lt;&lt; Compiling&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#documentation-work" title="Next chapter">&nbsp;Documentation work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#concurrent-stable-and-development-versions" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Concurrent stable and development versions&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#compiling" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Compiling&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#documentation-work" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Documentation work &gt; </a>]</td></tr></table>
<a name="build-system"></a>
<h2 class="section">4.9 Build system</h2>


<p>We currently use make and stepmake, which is complicated and only
used by us.  Hopefully this will change in the future.
</p>

<a name="Version_002dspecific-texinfo-macros"></a>
<h3 class="subheading">Version-specific texinfo macros</h3>

<ul>
<li>
made with <code>scripts/build/create-version-itexi.py</code> and<br>
<code>scripts/build/create-weblinks-itexi.py</code>

</li><li>
used extensively in the <code>WEBSITE_ONLY_BUILD</code> version of the
website (made with &lsquo;<tt>website.make</tt>&rsquo;, used on lilypond.org)

</li><li>
not (?) used in the main docs?

</li><li>
the numbers in VERSION file: MINOR_VERSION should be 1 more than
the last release, VERSION_DEVEL should be the last <strong>online</strong>
release.  Yes, VERSION_DEVEL is less than VERSION.

</li></ul>
<hr size="6">
<a name="Documentation-work"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#compiling" title="Beginning of this chapter or previous chapter"> &lt;&lt; Compiling&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#website-work" title="Next chapter">&nbsp;Website work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#build-system" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Build system&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#index" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Top&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#introduction-to-documentation-work" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Introduction to documentation work &gt; </a>]</td></tr></table>
<a name="documentation-work"></a>
<h1 class="chapter">5. Documentation work</h1>

<p>There are currently 11 manuals for LilyPond, not including the
translations.  Each book is available in HTML, PDF, and info.  The
documentation is written in a language called <code>texinfo</code> &ndash;
this allows us to generate different output formats from a single
set of source files.
</p>
<p>To organize multiple authors working on the documentation, we use a
Version Control System (VCS) called git, previously discussed in
<a href="#starting-with-git">Starting with Git</a>.
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#introduction-to-documentation-work" accesskey="1">5.1 Introduction to documentation work</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#documentation-suggestions" accesskey="2">5.2 Documentation suggestions</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#texinfo-introduction-and-usage-policy" accesskey="3">5.3 Texinfo introduction and usage policy</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#documentation-policy" accesskey="4">5.4 Documentation policy</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#tips-for-writing-docs" accesskey="5">5.5 Tips for writing docs</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#scripts-to-ease-doc-work" accesskey="6">5.6 Scripts to ease doc work</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#docstrings-in-scheme" accesskey="7">5.7 Docstrings in scheme</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#translating-the-documentation" accesskey="8">5.8 Translating the documentation</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>


<hr size="6">
<a name="Introduction-to-documentation-work"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#documentation-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Documentation work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#website-work" title="Next chapter">&nbsp;Website work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#documentation-work" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Documentation work&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#documentation-work" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Documentation work&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#documentation-suggestions" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Documentation suggestions &gt; </a>]</td></tr></table>
<a name="introduction-to-documentation-work"></a>
<h2 class="section">5.1 Introduction to documentation work</h2>

<p>Our documentation tries to adhere to our <a href="#documentation-policy">Documentation policy</a>.  This policy contains a few items which may seem odd.
One policy in particular is often questioned by potential
contributors: we do not repeat material in the Notation Reference,
and instead provide links to the &ldquo;definitive&rdquo; presentation of
that information.  Some people point out, with good reason, that
this makes the documentation harder to read.  If we repeated
certain information in relevant places, readers would be less
likely to miss that information.
</p>
<p>That reasoning is sound, but we have two counter-arguments.
First, the Notation Reference &ndash; one of <em>five</em> manuals for
users to read &ndash; is already over 500 pages long.  If we repeated
material, we could easily exceed 1000 pages!  Second, and much
more importantly, LilyPond is an evolving project.  New features
are added, bugs are fixed, and bugs are discovered and documented.
If features are discussed in multiple places, the documentation
team must find every instance.  Since the manual is so large, it
is impossible for one person to have the location of every piece
of information memorized, so any attempt to update the
documentation will invariably omit a few places.  This second
concern is not at all theoretical; the documentation used to be
plagued with inconsistent information.
</p>
<p>If the documentation were targeted for a specific version &ndash; say,
LilyPond 2.10.5 &ndash; and we had unlimited resources to spend on
documentation, then we could avoid this second problem.  But since
LilyPond evolves (and that is a very good thing!), and since we
have quite limited resources, this policy remains in place.
</p>
<p>A few other policies (such as not permitting the use of tweaks in
the main portion of NR 1+2) may also seem counter-intuitive, but
they also stem from attempting to find the most effective use of
limited documentation help.
</p>
<p>Before undertaking any large documentation work, contributors are
encouraged to contact the <a href="#meisters">Documentation Meister</a>.
</p>

<hr size="6">
<a name="Documentation-suggestions"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#documentation-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Documentation work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#website-work" title="Next chapter">&nbsp;Website work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#introduction-to-documentation-work" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Introduction to documentation work&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#documentation-work" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Documentation work&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#texinfo-introduction-and-usage-policy" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Texinfo introduction and usage policy &gt; </a>]</td></tr></table>
<a name="documentation-suggestions"></a>
<h2 class="section">5.2 Documentation suggestions</h2>

<a name="Small-additions"></a>
<h3 class="subheading">Small additions</h3>

<p>For additions to the documentation,
</p>
<ol>
<li>
Tell us where the addition should be placed.  Please include both
the section number and title (i.e. &quot;LM 2.13 Printing lyrics&quot;).

</li><li>
Please write exact changes to the text.

</li><li>
A formal patch to the source code is <em>not</em> required; we can
take care of the technical details.

</li><li>
Send the suggestions to the <code>bug-lilypond</code> mailing list as
discussed in <a name="index-Contact"></a>
<a href="web-big-page.html#contact">Contact</a>.

</li><li>
Here is an example of a perfect documentation report:

<pre class="verbatim">To: bug-lilypond@gnu.org
From: helpful-user@example.net
Subject: doc addition

In LM 2.13 (printing lyrics), above the last line (&quot;More options,
like...&quot;), please add:

----
To add lyrics to a divided part, use blah blah blah.  For example,

\score {
  \notes {blah &lt;&lt;blah&gt;&gt; }
  \lyrics {blah &lt;&lt;blah&gt;&gt; }
  blah blah blah
}
----

In addition, the second sentence of the first paragraph is
confusing.  Please delete that sentence (it begins &quot;Users
often...&quot;) and replace it with this:
----
To align lyrics with something, do this thing.
----

Have a nice day,
Helpful User
</pre>
</li></ol>


<a name="Larger-contributions"></a>
<h3 class="subheading">Larger contributions</h3>

<p>To replace large sections of the documentation, the guidelines are
stricter.  We cannot remove parts of the current documentation
unless we are certain that the new version is an improvement.
</p>
<ol>
<li>
Ask on the lilypond-devel mailing list if such a rewrite is necessary;
somebody else might already be working on this issue!

</li><li>
Split your work into small sections; this makes it much easier to
compare the new and old documentation.

</li><li>
Please prepare a formal git patch.

</li></ol>

<p>Once you have followed these guidelines, please send a message to
lilypond-devel with your documentation submissions.  Unfortunately
there is a strict no top-posting check on the mailing list; to avoid
this, add:
</p>
<p>&gt; I&rsquo;m not top posting.
</p>
<p>(you must include the &gt; ) to the top of your documentation
addition.
</p>
<p>We may edit your suggestion for spelling, grammar, or style, and
we may not place the material exactly where you suggested, but if
you give us some material to work with, we can improve the manual
much faster.  Thanks for your interest!
</p>

<hr size="6">
<a name="Texinfo-introduction-and-usage-policy"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#documentation-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Documentation work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#website-work" title="Next chapter">&nbsp;Website work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#documentation-suggestions" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Documentation suggestions&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#documentation-work" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Documentation work&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#texinfo-introduction" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Texinfo introduction &gt; </a>]</td></tr></table>
<a name="texinfo-introduction-and-usage-policy"></a>
<h2 class="section">5.3 Texinfo introduction and usage policy</h2>

<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#texinfo-introduction" accesskey="1">5.3.1 Texinfo introduction</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#documentation-files" accesskey="2">5.3.2 Documentation files</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#sectioning-commands" accesskey="3">5.3.3 Sectioning commands</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#lilypond-formatting" accesskey="4">5.3.4 LilyPond formatting</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#text-formatting" accesskey="5">5.3.5 Text formatting</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#syntax-survey" accesskey="6">5.3.6 Syntax survey</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#other-text-concerns" accesskey="7">5.3.7 Other text concerns</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>


<hr size="6">
<a name="Texinfo-introduction"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#documentation-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Documentation work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#website-work" title="Next chapter">&nbsp;Website work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#texinfo-introduction-and-usage-policy" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Texinfo introduction and usage policy&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#texinfo-introduction-and-usage-policy" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Texinfo introduction and usage policy&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#documentation-files" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Documentation files &gt; </a>]</td></tr></table>
<a name="texinfo-introduction"></a>
<h3 class="subsection">5.3.1 Texinfo introduction</h3>

<p>The language is called Texinfo; you can see its manual here:
</p>
<p><a href="http://www.gnu.org/software/texinfo/manual/texinfo">http://www.gnu.org/software/texinfo/manual/texinfo/</a>
</p>
<p>However, you don&rsquo;t need to read those docs.  The most important
thing to notice is that text is text.  If you see a mistake in the
text, you can fix it.  If you want to change the order of
something, you can cut-and-paste that stuff into a new location.
</p>
<div class="warning"><p><strong>Note:</strong> Rule of thumb: follow the examples in the existing docs.
You can learn most of what you need to know from this; if you want
to do anything fancy, discuss it on <code>lilypond-devel</code> first.
</p>
</div>

<hr size="6">
<a name="Documentation-files"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#documentation-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Documentation work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#website-work" title="Next chapter">&nbsp;Website work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#texinfo-introduction" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Texinfo introduction&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#texinfo-introduction-and-usage-policy" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Texinfo introduction and usage policy&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#sectioning-commands" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Sectioning commands &gt; </a>]</td></tr></table>
<a name="documentation-files"></a>
<h3 class="subsection">5.3.2 Documentation files</h3>

<p>All manuals live in &lsquo;<tt>Documentation/</tt>&rsquo;.
</p>
<p>In particular, there are four user manuals, their respective master
source files are &lsquo;<tt>learning.tely</tt>&rsquo; (LM, Learning Manual),
&lsquo;<tt>notation.tely</tt>&rsquo; (NR, Notation Reference),
&lsquo;<tt>music-glossary.tely</tt>&rsquo; (MG, Music Glossary), and
&lsquo;<tt>lilypond-program</tt>&rsquo; (AU).  Each chapter is written in a separate
file, ending in &lsquo;<tt>.itely</tt>&rsquo; for files containing lilypond code, and
&lsquo;<tt>.itexi</tt>&rsquo; for files without lilypond code, located in a subdirectory
associated to the manual (&lsquo;<tt>learning/</tt>&rsquo; for &lsquo;<tt>learning.tely</tt>&rsquo;, and
so on); list the subdirectory of each manual to determine the filename
of the specific chapter you wish to modify.
</p>
<p>Developer manuals live in &lsquo;<tt>Documentation/</tt>&rsquo; too.  Currently there is
only one: the Contributor&rsquo;s Guide &lsquo;<tt>contrib-guide.texi</tt>&rsquo; you are
reading.
</p>
<p>Snippet files are part of documentation, and the Snippet List (SL) lives
in &lsquo;<tt>Documentation/</tt>&rsquo; just like the manuals.  For information about
how to modify the snippet files and SL, see <a href="#lsr-work">LSR work</a>.
</p>

<hr size="6">
<a name="Sectioning-commands"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#documentation-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Documentation work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#website-work" title="Next chapter">&nbsp;Website work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#documentation-files" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Documentation files&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#texinfo-introduction-and-usage-policy" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Texinfo introduction and usage policy&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#lilypond-formatting" title="Next section in reading order" accesskey="n" rel="next">&nbsp;LilyPond formatting &gt; </a>]</td></tr></table>
<a name="sectioning-commands"></a>
<h3 class="subsection">5.3.3 Sectioning commands</h3>

<p>The Notation Reference uses section headings at four, occasionally
five, levels.
</p>
<ul>
<li> Level 1: @chapter
</li><li> Level 2: @section
</li><li> Level 3: @subsection
</li><li> Level 4: @unnumberedsubsubsec
</li><li> Level 5: @subsubsubheading
</li></ul>

<p>The first three levels are numbered in html, the last two are not.
Numbered sections correspond to a single html page in the split html
documents.
</p>
<p>The first four levels always have accompanying nodes so they can be
referenced and are also included in the ToC in html.
</p>
<p>Most of the manual is written at level 4 under headings created with
</p>
<blockquote><pre class="example">@node Foo
@unnumberedsubsubsec Foo
</pre></blockquote>

<p>Level 3 subsections are created with
</p>
<blockquote><pre class="example">@node Foo
@subsection Foo
</pre></blockquote>

<ul>
<li>
Please leave two blank lines above a <code>@node</code>; this makes it
easier to find sections in texinfo.

</li><li>
Do not use any <code>@</code> commands for a <code>@node</code>.  They may be
used for any <code>@sub...</code> sections or headings however.

<blockquote><pre class="example">not:
@node @code{Foo} Bar
@subsection @code{Foo} Bar

but instead:
@node Foo Bar
@subsection @code{Foo} Bar
</pre></blockquote>

</li><li>
With the exception of <code>@</code> commands, the section name must
match the node name exactly.

</li><li>
No commas may be used in the node names.

</li><li>
If a heading is desired without creating a <code>@node</code>, please use:

<blockquote><pre class="example">@subsubsubheading Foo
</pre></blockquote>

</li><li>
Sectioning commands (<code>@node</code> and <code>@section</code>) must not appear
inside an <code>@ignore</code>.  Separate those commands with a space, ie
<code>@n</code>&nbsp;<code>ode</code>.

</li></ul>

<p>Nodes must be included inside a
</p>
<blockquote><pre class="example">@menu
* foo::
* bar::
@end menu
</pre></blockquote>

<p>construct.  These are easily constructed with automatic tools; see
<a href="#scripts-to-ease-doc-work">Scripts to ease doc work</a>.
</p>

<hr size="6">
<a name="LilyPond-formatting"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#documentation-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Documentation work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#website-work" title="Next chapter">&nbsp;Website work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#sectioning-commands" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Sectioning commands&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#texinfo-introduction-and-usage-policy" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Texinfo introduction and usage policy&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#text-formatting" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Text formatting &gt; </a>]</td></tr></table>
<a name="lilypond-formatting"></a>
<h3 class="subsection">5.3.4 LilyPond formatting</h3>

<ul>
<li>
Most LilyPond examples throughout the documentation can be produced
with:

<blockquote><pre class="example">@lilypond[verbatim,quote,relative=1]
</pre></blockquote>

<p>or
</p>
<blockquote><pre class="example">@lilypond[verbatim,quote,relative=2]
</pre></blockquote>

<p>If using any combination of <code>\header{}</code>, <code>\score{}</code> or
<code>\layout{}</code> in your example, then you must omit the
<code>relative</code> variable and either use absolute entry mode or an
explicit <code>\relative{}</code> construction.
</p>
<p>If using <code>\book{}</code> in your example then you must also omit the
<code>relative</code> variable and either use absolute entry mode or an
explicit <code>\relative{}</code> construction.  However, you must also
include the <code>papersize=X</code> variable, where <code>X</code> is a defined
paper size from within &lsquo;<tt>scm/paper.scm</tt>&rsquo;.  This is to avoid the
default <code>a4</code> paper size being used and leaving too much unnecessary
whitespace and potentially awkward page breaks in the PDFs.
</p>
<p>The preferred <code>papersize</code>s are <code>a5</code>, <code>a6</code> or
<code>a8landscape</code>.
</p>
<p><code>a8landscape</code> works best for a single measure with a single title
and/or single <code>tagline</code>:
</p>
<blockquote><pre class="example">@lilypond[papersize=a8landscape,verbatim]
\book {
  \header {
    title = &quot;A scale in LilyPond&quot;
  }
  \relative {
    c d e f
  }
}
@end lilypond
</pre></blockquote>

<p>and can also be used to easily show features that require page breaks
(i.e. page numbers) without taking large amounts of space within the
documentation.  Do not use the <code>quote</code> option with this paper size.
</p>
<p><code>a5</code> or <code>a6</code> paper sizes are best used for examples that have
more than two measures of music or require multiple staves (i.e. to
illustrate cross-staff features, RH and LH parts etc.) and where
<code>\book{}</code> constructions are required or where <code>a8landscape</code>
produces an example that is too cramped.  Depending on the example the
<code>quote</code> option may need to be omitted.
</p>
<p>In rare cases, other options may be used (or omitted), but ask first.
</p>
</li><li>
Please avoid using extra spacing either after or within the
<code>@lilypond</code> parameters.

<blockquote><pre class="example">not:          @lilypond [verbatim, quote, relative=1]
but instead:  @lilypond[verbatim,quote,relative=1]
</pre></blockquote>

</li><li>
Inspirational headwords are produced with:

<blockquote><pre class="example">@lilypondfile[quote,ragged-right,line-width=16\cm,staffsize=16]
{pitches-headword.ly}
</pre></blockquote>

</li><li>
LSR snippets are linked with:

<blockquote><pre class="example">@lilypondfile[verbatim,quote,ragged-right,texidoc,doctitle]
{filename.ly}
</pre></blockquote>

</li><li>
Use two spaces for indentation in lilypond examples (no tabs).

</li><li>
All engravers should have double-quotes around them:

<blockquote><pre class="example">\consists &quot;Spans_arpeggio_engraver&quot;
</pre></blockquote>

<p>LilyPond does not strictly require this, but it is a useful
convention to follow.
</p>
</li><li>
All context or layout object strings should be prefaced with <code>#</code>.
Again, LilyPond does not strictly require this, but it is helpful
to get users accustomed to this scheme construct, i.e. <code>\set
Staff.instrumentName = #&quot;cello&quot;</code>

</li><li>
Try to avoid using <code>#'</code> or <code>#`</code> within when describing
context or layout properties outside of an <code>@example</code> or <code>@lilypond</code>, unless
the description explicitly requires it.

<p>i.e. &ldquo;...setting the <code>transparent</code> property leaves the object where it
is, but makes it invisible.&rdquo;
</p>
</li><li>
If possible, only write one bar per line.

</li><li>
If you only have one bar per line, omit bar checks.  If you
must put more than one bar per line (not recommended), then include bar
checks.

</li><li>
Tweaks should, if possible, also occur on their own line.
<blockquote><pre class="example">not:          \override TextScript #'padding = #3 c1^&quot;hi&quot;
but instead:  \override TextScript #'padding = #3
              c1^&quot;hi&quot;
</pre></blockquote>

<p>excepted in Templates, where &lsquo;doctitle&rsquo; may be omitted.
</p>
</li><li>
Avoid long stretches of input code.  Nobody is going to read
them in print.  Create small examples.  However, this does not mean
it has be minimal.

</li><li>
Specify durations for at least the first note of every bar.

</li><li>
If possible, end with a complete bar.

</li><li>
Comments should go on their own line, and be placed before
the line(s) to which they refer.

</li><li>
For clarity, always use { } marks even if they are not technically
required; i.e.

<blockquote><pre class="example">not:

\context Voice \repeat unfold 2 \relative c' {
  c2 d
}

but instead:

\context Voice {
  \repeat unfold 2 {
    \relative c' {
      c2 d
    }
  }
}
</pre></blockquote>

</li><li>
Add a space around { } marks; i.e.

<blockquote><pre class="example">not:          \chordmode{c e g}
but instead:  \chordmode { c e g }
</pre></blockquote>

</li><li>
Use { } marks for additional <code>\markup</code> format commands; i.e.

<blockquote><pre class="example">not:          c^\markup \tiny\sharp
but instead:  c^\markup { \tiny \sharp }
</pre></blockquote>

</li><li>
Remove any space around <code>&lt;</code> <code>&gt;</code> marks; i.e.

<blockquote><pre class="example">not:           &lt; c e g &gt; 4
but instead:   &lt;c e g&gt;4
</pre></blockquote>

</li><li>
Beam, slur and tie marks should begin immediately after the first
note with beam and phrase marks ending immediately after the last.

<blockquote><pre class="example">a8\( ais16[ b cis( d] b) cis4~ b' cis,\)
</pre></blockquote>

</li><li>
If you want to work on an example outside of the manual (for
easier/faster processing), use this header:

<blockquote><pre class="example">\paper {
  indent = 0\mm
  line-width = 160\mm - 2.0 * 0.4\in
  line-width = #(- line-width (* mm  3.000000))
}

\layout {
}
</pre></blockquote>

<p>You may not change any of these values.  If you are making an
example demonstrating special <code>\paper{}</code> values, contact the
Documentation Editor.
</p>
</li></ul>


<hr size="6">
<a name="Text-formatting"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#documentation-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Documentation work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#website-work" title="Next chapter">&nbsp;Website work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#lilypond-formatting" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; LilyPond formatting&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#texinfo-introduction-and-usage-policy" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Texinfo introduction and usage policy&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#syntax-survey" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Syntax survey &gt; </a>]</td></tr></table>
<a name="text-formatting"></a>
<h3 class="subsection">5.3.5 Text formatting</h3>

<ul>
<li>
Lines should be less than 72 characters long.  (We personally
recommend writing with 66-char lines, but do not bother modifying
existing material).  Also see the recommendations for fixed-width
fonts in the <a href="#syntax-survey">Syntax survey</a>.

</li><li>
Do not use tabs.

</li><li>
Do not use spaces at the beginning of a line (except in
<code>@example</code> or <code>@verbatim</code> environments), and do not
use more than a single space between words.  &lsquo;makeinfo&rsquo; copies
the input lines verbatim without removing those spaces.

</li><li>
Use two spaces after a period.

</li><li>
In examples of syntax, use <code>@var{<var>musicexpr</var>}</code> for a
music expression.

</li><li>
Don&rsquo;t use <code>@rinternals{}</code> in the main text.  If you&rsquo;re
tempted to do so, you&rsquo;re probably getting too close to &ldquo;talking
through the code&rdquo;.  If you really want to refer to a context, use
<code>@code{}</code> in the main text and <code>@rinternals{}</code> in
the <code>@seealso</code>.
</li></ul>


<hr size="6">
<a name="Syntax-survey"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#documentation-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Documentation work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#website-work" title="Next chapter">&nbsp;Website work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#text-formatting" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Text formatting&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#texinfo-introduction-and-usage-policy" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Texinfo introduction and usage policy&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#comments" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Comments &gt; </a>]</td></tr></table>
<a name="syntax-survey"></a>
<h3 class="subsection">5.3.6 Syntax survey</h3>


<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#comments" accesskey="1">Comments</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#cross-references" accesskey="2">Cross references</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#external-links" accesskey="3">External links</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#fixed_002dwidth-font" accesskey="4">Fixed-width font</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#indexing" accesskey="5">Indexing</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#lists" accesskey="6">Lists</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#special-characters" accesskey="7">Special characters</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#miscellany" accesskey="8">Miscellany</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>


<hr size="6">
<a name="Comments"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#documentation-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Documentation work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#website-work" title="Next chapter">&nbsp;Website work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#syntax-survey" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Syntax survey&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#syntax-survey" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Syntax survey&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#cross-references" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Cross references &gt; </a>]</td></tr></table>
<a name="comments"></a>
<h4 class="unnumberedsubsubsec">Comments</h4>

<ul>
<li>
<code>@c &hellip;</code> &mdash; single line comment.  &lsquo;<samp>@c NOTE:</samp>&rsquo; is a
comment which should remain in the final version.  (gp only
command ;)

</li><li>
<code>@ignore</code> &mdash; multi-line comment:

<blockquote><pre class="example">@ignore
&hellip;
@end ignore
</pre></blockquote>
</li></ul>


<hr size="6">
<a name="Cross-references"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#documentation-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Documentation work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#website-work" title="Next chapter">&nbsp;Website work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#comments" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Comments&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#syntax-survey" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Syntax survey&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#external-links" title="Next section in reading order" accesskey="n" rel="next">&nbsp;External links &gt; </a>]</td></tr></table>
<a name="cross-references"></a>
<h4 class="unnumberedsubsubsec">Cross references</h4>

<p>Enter the exact <code>@node</code> name of the target reference between
the brackets (eg.&nbsp;&lsquo;<samp>@ref{Syntax survey}</samp>&rsquo;).  Do not
split a cross-reference across two lines &ndash; this causes the
cross-reference to be rendered incorrectly in html documents.
</p>
<ul>
<li>
<code>@ref{&hellip;}</code> &mdash; link within current manual.

</li><li>
<code>@rchanges{&hellip;}</code> &mdash; link to Changes.

</li><li>
<code>@rcontrib{&hellip;}</code> &mdash; link to Contributor&rsquo;s Guide.

</li><li>
<code>@ressay{&hellip;}</code> &mdash; link to Engraving Essay.

</li><li>
<code>@rextend{&hellip;}</code> &mdash; link to Extending LilyPond.

</li><li>
<code>@rglos{&hellip;}</code> &mdash; link to the Music Glossary.

</li><li>
<code>@rinternals{&hellip;}</code> &mdash; link to the Internals Reference.

</li><li>
<code>@rlearning{&hellip;}</code> &mdash; link to Learning Manual.

</li><li>
<code>@rlsr{&hellip;}</code> &mdash; link to a Snippet section.

</li><li>
<code>@rprogram{&hellip;}</code> &mdash; link to Application Usage.

</li><li>
<code>@ruser{&hellip;}</code> &mdash; link to Notation Reference.

</li><li>
<code>@rweb{&hellip;}</code> &mdash; link to General Information.
</li></ul>


<hr size="6">
<a name="External-links"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#documentation-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Documentation work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#website-work" title="Next chapter">&nbsp;Website work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#cross-references" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Cross references&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#syntax-survey" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Syntax survey&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#fixed_002dwidth-font" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Fixed-width font &gt; </a>]</td></tr></table>
<a name="external-links"></a>
<h4 class="unnumberedsubsubsec">External links</h4>

<ul>
<li>
<code>@email{&hellip;}</code> &mdash; create a <code>mailto:</code> E-mail link.

</li><li>
<code>@uref{<var>URL</var>[, <var>link text</var>]}</code> &mdash; link to an
external url.  Use within an <code>@example ... @end example</code>.

<blockquote><pre class="example">@example
@uref{URL [, link text ]}
@end example
</pre></blockquote>
</li></ul>


<hr size="6">
<a name="Fixed_002dwidth-font"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#documentation-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Documentation work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#website-work" title="Next chapter">&nbsp;Website work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#external-links" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; External links&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#syntax-survey" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Syntax survey&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#indexing" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Indexing &gt; </a>]</td></tr></table>
<a name="fixed_002dwidth-font"></a>
<h4 class="unnumberedsubsubsec">Fixed-width font</h4>

<ul>
<li>
<code>@code{&hellip;}</code>, <code>@samp{&hellip;}</code> &mdash;

<p>Use the <code>@code{&hellip;}</code> command when referring to
individual language-specific tokens (keywords, commands,
engravers, scheme symbols, etc.) in the text.  Ideally, a single
<code>@code{&hellip;}</code> block should fit within one line in the
PDF output.
</p>
<p>Use the <code>@samp{&hellip;}</code> command when you have a short
example of user input, unless it constitutes an entire
<code>@item</code> by itself, in which case <code>@code{&hellip;}</code> is
preferable.  Otherwise, both should only be used when part of a
larger sentence within a paragraph or <code>@item</code>.  Do not use
<code>@code{&hellip;}</code> or <code>@samp{&hellip;}</code> inside an
<code>@example</code> block, and do not use either as a free-standing
paragraph; use <code>@example</code> instead.
</p>
<p>A single unindented line in the PDF has space for about 79
fixed-width characters (76 if indented).  Within an <code>@item</code>
there is space for about 75 fixed-width characters.  Each
additional level of <code>@itemize</code> or <code>@enumerate</code>
shortens the line by about 4 columns.
</p>
<p>However, even short blocks of <code>@code{&hellip;}</code> and
<code>@samp{&hellip;}</code> can run into the margin if the Texinfo
line-breaking algorithm gets confused.  Additionally, blocks that
are longer than this may in fact print nicely; it all depends
where the line breaks end up.  If you compile the docs yourself,
check the PDF output to make sure the line breaks are
satisfactory.
</p>
<p>The Texinfo setting <code>@allowcodebreaks</code> is set to
<code>false</code> in the manuals, so lines within
<code>@code{&hellip;}</code> or <code>@samp{&hellip;}</code> blocks will
only break at spaces, not at hyphens or underscores.  If the block
contains spaces, use <code>@w{@code{&hellip;}}</code> or
<code>@w{@samp{&hellip;}}</code> to prevent unexpected line breaks.
</p>
<p>The Texinfo settings <code>txicodequoteundirected</code> and
<code>txicodequotebacktick</code> are both set in the manuals, so
backticks (<code>`</code>) and apostrophes (<code>'</code>) placed within
blocks of <code>@code</code>, <code>@example</code>, or <code>@verbatim</code>
are not converted to left- and right-angled quotes
(<code>&lsquo; &rsquo;</code>) as they normally are within
the text, so the apostrophes in
&lsquo;<code>@w{@code{\relative c''}}</code>&rsquo; will display
correctly.  However, these settings do not affect the PDF output
for anything within a <code>@samp</code> block (even if it includes a
nested <code>@code</code> block), so entering
&lsquo;<code>@w{@samp{\relative c''}}</code>&rsquo; wrongly produces
&lsquo;<code>\relative c&rsquo;&rsquo;</code>&rsquo; in PDF.
Consequently, if you want to use a <code>@samp{&hellip;}</code> block
which contains backticks or apostrophes, you should instead use
&lsquo;<code>@q{@code{&hellip;}}</code>&rsquo; (or
&lsquo;<code>@q{@w{@code{&hellip;}}}</code>&rsquo; if the block also
contains spaces).  Note that backslashes within
<code>@q{&hellip;}</code> blocks must be entered as &lsquo;<samp>@bs{}</samp>&rsquo;,
so the example above would be coded as
&lsquo;<code>@q{@w{@code{@bs{}relative c''}}}</code>&rsquo;.
</p>
</li><li>
<code>@command{&hellip;}</code> &mdash; Use when referring to command-line
commands within the text (eg. &lsquo;<samp>@command{convert-ly}</samp>&rsquo;).  Do
not use inside an <code>@example</code> block.

</li><li>
<code>@example</code> &mdash; Use for examples of program code.  Do not add
extraneous indentation (i.e. don&rsquo;t start every line with
whitespace).  Use the following layout (notice the use of blank
lines).  Omit the <code>@noindent</code> if the text following the
example starts a new paragraph:

<blockquote><pre class="example"><var>&hellip;text leading into the example&hellip;</var>

@example
&hellip;
@end example

@noindent
<var>continuation of the text&hellip;</var>
</pre></blockquote>

<p>Individual lines within an <code>@example</code> block should not
exceed 74 characters; otherwise they will run into the margin in
the PDF output, and may get clipped.  If an <code>@example</code> block
is part of an <code>@item</code>, individual lines in the
<code>@example</code> block should not exceed 70 columns.  Each
additional level of <code>@itemize</code> or <code>@enumerate</code>
shortens the line by about 4 columns.
</p>
<p>For long command line examples, if possible, use a trailing
backslash to break up a single line, indenting the next line with
2 spaces.  If this isn&rsquo;t feasible, use &lsquo;<samp>@smallexample
&hellip; @end&nbsp;smallexample</samp>&rsquo; instead, which uses a smaller
fontsize.  Use <code>@example</code> whenever possible, but if needed,
<code>@smallexample</code> can fit up to 90 characters per line before
running into the PDF margin.  Each additional level of
<code>@itemize</code> or <code>@enumerate</code> shortens a
<code>@smallexample</code> line by about 5 columns.
</p>
</li><li>
<code>@file{&hellip;}</code> &mdash; Use when referring to filenames and
directories in the text.  Do not use inside an <code>@example</code>
block.

</li><li>
<code>@option{&hellip;}</code> &mdash; Use when referring to command-line
options in the text (eg. &lsquo;<samp>@option{--format}</samp>&rsquo;).  Do not use
inside an <code>@example</code> block.

</li><li>
<code>@verbatim</code> &mdash; Prints the block exactly as it appears in
the source file (including whitespace, etc.).  For program code
examples, use <code>@example</code> instead.  <code>@verbatim</code> uses
the same format as <code>@example</code>.

<p>Individual lines within an <code>@verbatim</code> block should not
exceed 74 characters; otherwise they will run into the margin in
the PDF output, and may get clipped.  If an <code>@verbatim</code>
block is part of an <code>@item</code>, individual lines in the
<code>@verbatim</code> block should not exceed 70 columns.  Each
additional level of <code>@itemize</code> or <code>@enumerate</code>
shortens the line by about 4 columns.
</p></li></ul>


<hr size="6">
<a name="Indexing"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#documentation-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Documentation work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#website-work" title="Next chapter">&nbsp;Website work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#fixed_002dwidth-font" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Fixed-width font&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#syntax-survey" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Syntax survey&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#lists" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Lists &gt; </a>]</td></tr></table>
<a name="indexing"></a>
<h4 class="unnumberedsubsubsec">Indexing</h4>

<ul>
<li>
<code>@cindex &hellip;</code> &mdash; General index.  Please add as many as you can.
Don&rsquo;t capitalize the first word.

</li><li>
<code>@funindex &hellip;</code> &mdash; is for a \lilycommand.
</li></ul>


<hr size="6">
<a name="Lists"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#documentation-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Documentation work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#website-work" title="Next chapter">&nbsp;Website work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#indexing" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Indexing&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#syntax-survey" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Syntax survey&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#special-characters" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Special characters &gt; </a>]</td></tr></table>
<a name="lists"></a>
<h4 class="unnumberedsubsubsec">Lists</h4>

<ul>
<li>
<code>@enumerate</code> &mdash; Create an ordered list (with numbers).
Always put &lsquo;<samp>@item</samp>&rsquo; on its own line.  As an exception, if all
the items in the list are short enough to fit on single lines, placing
them on the &lsquo;<samp>@item</samp>&rsquo; lines is also permissible.  &lsquo;<samp>@item</samp>&rsquo;
and &lsquo;<samp>@end&nbsp;enumerate</samp>&rsquo; should always be preceded by a blank
line.

<blockquote><pre class="example">@enumerate

@item
A long multi-line item like this one must begin
on a line of its own and all the other items in
the list must do so too.

@item
Even short ones

@end enumerate
</pre></blockquote>

<blockquote><pre class="example">@enumerate

@item Short item

@item Short item

@end enumerate
</pre></blockquote>

</li><li>
<code>@itemize</code> &mdash; Create an unordered list (with bullets).  Use
the same format as <code>@enumerate</code>.  Do not use
&lsquo;<samp>@itemize&nbsp;@bullet</samp>&rsquo;.
</li></ul>


<hr size="6">
<a name="Special-characters"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#documentation-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Documentation work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#website-work" title="Next chapter">&nbsp;Website work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#lists" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Lists&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#syntax-survey" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Syntax survey&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#miscellany" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Miscellany &gt; </a>]</td></tr></table>
<a name="special-characters"></a>
<h4 class="unnumberedsubsubsec">Special characters</h4>

<ul>
<li>
<code>--</code>, <code>---</code> &mdash; Create an en dash (&ndash;) or an em dash
(&mdash;) in the text.  To print two or three literal hyphens in a
row, wrap one of them in a <code>@w{&hellip;}</code> (eg.
&lsquo;<samp>-@w{-}-</samp>&rsquo;).

</li><li>
<code>@@</code>, <code>@{</code>, <code>@}</code> &mdash; Create an at-sign (@),
a left curly bracket ({), or a right curly bracket (}).

</li><li>
<code>@bs{}</code> &mdash; Create a backslash within a
<code>@q{&hellip;}</code>, <code>@qq{&hellip;}</code>, or
<code>@warning{&hellip;}</code> block.  This is a custom LilyPond
macro, not a builtin @-command in Texinfo.  Texinfo would also
allow &lsquo;<samp>\\</samp>&rsquo;, but this breaks the PDF output.

</li><li>
<code>@tie{}</code> &mdash; Create a <em>variable-width</em> non-breaking
space in the text (use &lsquo;<samp>@w{ }</samp>&rsquo; for a single
<em>fixed-width</em> non-breaking space).  Variables or numbers
which consist of a single character (probably followed by a
punctuation mark) should be tied properly, either to the previous
or the next word.  Example: &lsquo;<samp>The letter@tie{}@q{I} is
skipped</samp>&rsquo;
</li></ul>


<hr size="6">
<a name="Miscellany"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#documentation-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Documentation work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#website-work" title="Next chapter">&nbsp;Website work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#special-characters" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Special characters&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#syntax-survey" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Syntax survey&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#other-text-concerns" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Other text concerns &gt; </a>]</td></tr></table>
<a name="miscellany"></a>
<h4 class="unnumberedsubsubsec">Miscellany</h4>

<ul>
<li>
<code>@notation{&hellip;}</code> &mdash; refers to pieces of notation, e.g.
&lsquo;<samp>@notation{clef}</samp>&rsquo;.  Also use for specific lyrics
(&lsquo;<samp>the @notation{A&nbsp;-&nbsp;men} is centered</samp>&rsquo;).
Only use once per subsection per term.

</li><li>
<code>@q{&hellip;}</code> &mdash; Single quotes.  Used for
&lsquo;vague&rsquo; terms.  To get a backslash
(\), you must use &lsquo;<samp>@bs{}</samp>&rsquo;.

</li><li>
<code>@qq{&hellip;}</code> &mdash; Double quotes.  Used for actual quotes
(&ldquo;he said&rdquo;) or for introducing special input modes.  To get a
backslash (\), you must use &lsquo;<samp>@bs{}</samp>&rsquo;.

</li><li>
<code>@var{&hellip;}</code> &mdash; Use for metasyntactic variables (such
as <code><var>foo</var></code>, <code><var>bar</var></code>, <code><var>arg1</var></code>, etc.).
In most cases, when the <code>@var{&hellip;}</code> command appears in
the text (and not in an <code>@example</code> block) it should be
wrapped with an appropriate texinfo code-highlighting command
(such as <code>@code</code>, <code>@samp</code>, <code>@file</code>,
<code>@command</code>, etc.).  For example:
&lsquo;<samp>@code{@var{foo}}</samp>&rsquo;,
&lsquo;<samp>@file{@var{myfile.ly}}</samp>&rsquo;,
&lsquo;<samp>@samp{git checkout @var{branch}}</samp>&rsquo;, etc.  This
improves readability in the PDF and HTML output.

</li><li>
<code>@version{}</code> &mdash; Return the current LilyPond version
string.  Use &lsquo;<samp>@w{@version{}}</samp>&rsquo; if it&rsquo;s at the end of a
line (to prevent an ugly line break in PDF); use
&lsquo;<samp>@w{&quot;@version{}&quot;}</samp>&rsquo; if you need it in quotes.

</li><li>
<code>@w{&hellip;}</code> &mdash; Do not allow any line breaks.

</li><li>
<code>@warning{&hellip;}</code> &mdash; produces a &ldquo;Note:&nbsp;&rdquo; box.
Use for important messages.  To get a backslash (\), you must use
&lsquo;<samp>@bs{}</samp>&rsquo;.
</li></ul>


<hr size="6">
<a name="Other-text-concerns"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#documentation-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Documentation work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#website-work" title="Next chapter">&nbsp;Website work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#miscellany" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Miscellany&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#texinfo-introduction-and-usage-policy" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Texinfo introduction and usage policy&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#documentation-policy" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Documentation policy &gt; </a>]</td></tr></table>
<a name="other-text-concerns"></a>
<h3 class="subsection">5.3.7 Other text concerns</h3>

<ul>
<li>
References must occur at the end of a sentence, for more
information see the
<a href="http://www.gnu.org/software/texinfo/manual/texinfo">texinfo manual</a>.  Ideally this should also be the final sentence of a
paragraph, but this is not required.  Any link in a doc section
must be duplicated in the <code>@seealso</code> section at the bottom.

</li><li>
Introducing examples must be done with

<blockquote><pre class="example">. (i.e. finish the previous sentence/paragraph)
: (i.e. `in this example:')
, (i.e. `may add foo with the blah construct,')
</pre></blockquote>

<p>The old &ldquo;sentence runs directly into the example&rdquo; method is not
allowed any more.
</p>
</li><li>
Abbrevs in caps, e.g., HTML, DVI, MIDI, etc.

</li><li>
Colon usage

<ol>
<li>
To introduce lists

</li><li>
When beginning a quote: &ldquo;So, he said,...&rdquo;.

<p>This usage is rarer.  Americans often just use a comma.
</p>
</li><li>
When adding a defining example at the end of a sentence.
</li></ol>

</li><li>
Non-ASCII characters which are in utf-8 should be directly used;
this is, don&rsquo;t say &lsquo;<samp>Ba@ss{}tuba</samp>&rsquo; but &lsquo;<samp>Batuba</samp>&rsquo;.  This
ensures that all such characters appear in all output formats.
</li></ul>


<hr size="6">
<a name="Documentation-policy"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#documentation-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Documentation work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#website-work" title="Next chapter">&nbsp;Website work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#other-text-concerns" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Other text concerns&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#documentation-work" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Documentation work&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#books" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Books &gt; </a>]</td></tr></table>
<a name="documentation-policy"></a>
<h2 class="section">5.4 Documentation policy</h2>

<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#books" accesskey="1">5.4.1 Books</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#section-organization" accesskey="2">5.4.2 Section organization</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#checking-cross_002dreferences" accesskey="3">5.4.3 Checking cross-references</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#general-writing" accesskey="4">5.4.4 General writing</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#technical-writing-style" accesskey="5">5.4.5 Technical writing style</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr size="6">
<a name="Books"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#documentation-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Documentation work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#website-work" title="Next chapter">&nbsp;Website work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#documentation-policy" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Documentation policy&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#documentation-policy" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Documentation policy&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#section-organization" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Section organization &gt; </a>]</td></tr></table>
<a name="books"></a>
<h3 class="subsection">5.4.1 Books</h3>

<p>There are four parts to the documentation: the Learning Manual,
the Notation Reference, the Program Reference, and the Music
Glossary.
</p>
<ul>
<li>
Learning Manual:

<p>The LM is written in a tutorial style which introduces the most
important concepts, structure and syntax of the elements of a
LilyPond score in a carefully graded sequence of steps.
Explanations of all musical concepts used in the Manual can be
found in the Music Glossary, and readers are assumed to have no
prior knowledge of LilyPond.  The objective is to take readers to
a level where the Notation Reference can be understood and
employed to both adapt the templates in the Appendix to their
needs and to begin to construct their own scores.  Commonly used
tweaks are introduced and explained.  Examples are provided
throughout which, while being focussed on the topic being
introduced, are long enough to seem real in order to retain the
readers&rsquo; interest.  Each example builds on the previous material,
and comments are used liberally.  Every new aspect is thoroughly
explained before it is used.
</p>
<p>Users are encouraged to read the complete Learning Manual from
start-to-finish.
</p>

</li><li>
Notation Reference: a (hopefully complete) description of LilyPond
input notation.  Some material from here may be duplicated in the
Learning Manual (for teaching), but consider the NR to be the
&quot;definitive&quot; description of each notation element, with the LM
being an &quot;extra&quot;.  The goal is _not_ to provide a step-by-step
learning environment &ndash; do not avoid using notation that has not
be introduced previously in the NR  (for example, use \break if
appropriate).  This section is written in formal technical writing
style.

<p>Avoid duplication.  Although users are not expected to read this
manual from start to finish, they should be familiar with the
material in the Learning Manual (particularly &ldquo;Fundamental
Concepts&rdquo;), so do not repeat that material in each section of
this book.  Also watch out for common constructs, like ^ - _ for
directions &ndash; those are explained in NR 3.  In NR 1, you can
write: DYNAMICS may be manually placed above or below the staff,
see @ref{Controlling direction and placement}.
</p>
<p>Most tweaks should be added to LSR and not placed directly in the
&lsquo;<tt>.itely</tt>&rsquo; file.  In some cases, tweaks may be placed in the main
text, but ask about this first.
</p>
<p>Finally, you should assume that users know what the notation
means; explaining musical concepts happens in the Music Glossary.
</p>

</li><li>
Application Usage: information about using the program lilypond
with other programs (lilypond-book, operating systems, GUIs,
convert-ly, etc).  This section is written in formal technical
writing style.

<p>Users are not expected to read this manual from start to finish.
</p>

</li><li>
Music Glossary: information about the music notation itself.
Explanations and translations about notation terms go here.

<p>Users are not expected to read this manual from start to finish.
</p>
</li><li>
Internals Reference: not really a documentation book, since it is
automagically generated from the source, but this is its name.

</li></ul>


<hr size="6">
<a name="Section-organization"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#documentation-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Documentation work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#website-work" title="Next chapter">&nbsp;Website work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#books" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Books&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#documentation-policy" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Documentation policy&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#checking-cross_002dreferences" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Checking cross-references &gt; </a>]</td></tr></table>
<a name="section-organization"></a>
<h3 class="subsection">5.4.2 Section organization</h3>

<ul>
<li>
The order of headings inside documentation sections should
be:

<blockquote><pre class="example">main docs
@predefined
@endpredefined
@snippets
@seealso
@knownissues
</pre></blockquote>

</li><li>
You <em>must</em> include a @seealso.

<ul>
<li>
The order of items inside the @seealso section is

<blockquote><pre class="example">Music Glossary:
@rglos{foo},
@rglos{bar}.

Learning Manual:
@rlearning{baz},
@rlearning{foozle}.

Notation Reference:
@ruser{faazle},
@ruser{boo}.

Application Usage:
@rprogram{blah}.

Essay on automated music engraving:
@ressay{yadda}.

Extending LilyPond:
@rextend{frob}.

Installed Files:
@file{path/to/dir/blahz}.

Snippets: @rlsr{section}.

Internals Reference:
@rinternals{fazzle},
@rinternals{booar}.
</pre></blockquote>

</li><li>
If there are multiple entries, separate them by commas but do not
include an &lsquo;and&rsquo;.

</li><li>
Always end with a period.

</li><li>
Place each link on a new line as above; this makes it much easier
to add or remove links.  In the output, they appear on a single
line.

<p>(&quot;Snippets&quot; is REQUIRED; the others are optional)
</p>
</li><li>
Any new concepts or links which require an explanation should go
as a full sentence(s) in the main text.

</li><li>
Don&rsquo;t insert an empty line between @seealso and the first entry!
Otherwise there is excessive vertical space in the PDF output.

</li></ul>

</li><li>
To create links, use @ref{} if the link is within the same
manual.

</li><li>
@predefined ... @endpredefined is for commands in
&lsquo;<tt>ly/*-init.ly</tt>&rsquo;

</li><li>
Do not include any real info in second-level sections (i.e. 1.1
Pitches).  A first-level section may have introductory material,
but other than that all material goes into third-level sections
(i.e. 1.1.1 Writing Pitches).

</li><li>
The @knownissues should not discuss any issues that are in the
tracker, unless the issue is Priority-Postponed.  The goal is to
discuss any overall architecture or syntax decisions which may be
interpreted as bugs.  Normal bugs should not be discussed here,
because we have so many bugs that it would be a huge task to keep
the @knownissues current and accurate all the time.

</li></ul>


<hr size="6">
<a name="Checking-cross_002dreferences"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#documentation-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Documentation work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#website-work" title="Next chapter">&nbsp;Website work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#section-organization" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Section organization&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#documentation-policy" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Documentation policy&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#general-writing" title="Next section in reading order" accesskey="n" rel="next">&nbsp;General writing &gt; </a>]</td></tr></table>
<a name="checking-cross_002dreferences"></a>
<h3 class="subsection">5.4.3 Checking cross-references</h3>

<p>Cross-references between different manuals are heavily used in the
documentation, but they are not checked during compilation.
However, if you compile the documentation, a script called
check_texi_refs can help you with checking and fixing these
cross-references; for information on usage, cd into a source tree
where documentation has been built, cd into Documentation and run:
</p>
<blockquote><pre class="example">make check-xrefs
make fix-xrefs
</pre></blockquote>

<p>Note that you have to find yourself the source files to fix
cross-references in the generated documentation such as the
Internals Reference; e.g. you can grep scm/ and lily/.
</p>
<p>Also of interest may be the linkdoc checks on kainhofer.com.  Be
warned that these docs are not completely rebuilt every day, so it
might not accurately reflect the current state of the docs.
</p>
<blockquote><pre class="example"><a href="http://kainhofer.com/~lilypond/linkdoc">http://kainhofer.com/~lilypond/linkdoc/</a>
</pre></blockquote>


<hr size="6">
<a name="General-writing"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#documentation-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Documentation work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#website-work" title="Next chapter">&nbsp;Website work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#checking-cross_002dreferences" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Checking cross-references&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#documentation-policy" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Documentation policy&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#technical-writing-style" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Technical writing style &gt; </a>]</td></tr></table>
<a name="general-writing"></a>
<h3 class="subsection">5.4.4 General writing</h3>

<ul>
<li>
Do not forget to create @cindex entries for new sections of text.
Enter commands with @funindex, i.e.

<blockquote><pre class="example">@cindex pitches, writing in different octaves
@funindex \relative
</pre></blockquote>

<p>Do not bother with the @code{} (they are added automatically).
These items are added to both the command index and the unified
index.  Both index commands should go in front of the actual material.
</p>
</li><li>
@cindex entries should not be capitalized, i.e.

<blockquote><pre class="example">@cindex time signature
</pre></blockquote>

<p>is preferred instead of &ldquo;Time signature&rdquo;.  Only use capital
letters for musical terms which demand them, e.g.
&ldquo;D.S. al Fine&rdquo;.
</p>
</li><li>
For scheme function index entries, only include the final part, i.e.

<blockquote><pre class="example">@funindex modern-voice-cautionary
     and NOT
@funindex #(set-accidental-style modern-voice-cautionary)
</pre></blockquote>

</li><li>
Use American spelling.  LilyPond&rsquo;s internal property
names use this convention.

</li><li>
Here is a list of preferred terms to be used:

<ul>
<li>
<em>Simultaneous</em> NOT concurrent.

</li><li>
<em>Measure</em>: the unit of music.

</li><li>
<em>Bar line</em>: the symbol delimiting a measure NOT barline.

</li><li>
<em>Note head</em> NOT notehead.

</li><li>
<em>Chord construct</em> NOT just chord (when referring to &lt; ... &gt;)

</li><li>
<em>Staff</em> NOT stave.

</li><li>
<em>Staves</em> NOT Staffs:
Phrases such as
&lsquo;multiple @internalsref{Staff}s&rsquo;
should be rephrased to
&lsquo;multiple @internalsref{Staff} contexts&rsquo;.

</li></ul>


</li></ul>


<hr size="6">
<a name="Technical-writing-style"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#documentation-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Documentation work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#website-work" title="Next chapter">&nbsp;Website work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#general-writing" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; General writing&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#documentation-policy" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Documentation policy&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#tips-for-writing-docs" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Tips for writing docs &gt; </a>]</td></tr></table>
<a name="technical-writing-style"></a>
<h3 class="subsection">5.4.5 Technical writing style</h3>

<p>These refer to the NR.  The LM uses a more gentle, colloquial
style.
</p>
<ul>
<li>
Do not refer to LilyPond in the text.  The reader knows what the
manual is about.  If you do, capitalization is LilyPond.

</li><li>
If you explicitly refer to &lsquo;lilypond&rsquo; the program (or any other
command to be executed), write <code>@command{lilypond}</code>.

</li><li>
Do not explicitly refer to the reader/user.  There is no one else
besides the reader and the writer.

</li><li>
Avoid contractions (don&rsquo;t, won&rsquo;t, etc.).  Spell the words out completely.

</li><li>
Avoid abbreviations, except for commonly used abbreviations of foreign
language terms such as etc. and i.e.

</li><li>
Avoid fluff (&ldquo;Notice that,&rdquo; &ldquo;as you can see,&rdquo;
&ldquo;Currently,&rdquo;).

</li><li>
The use of the word &lsquo;illegal&rsquo; is inappropriate in most cases.
Say &lsquo;invalid&rsquo; instead.

</li></ul>


<hr size="6">
<a name="Tips-for-writing-docs"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#documentation-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Documentation work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#website-work" title="Next chapter">&nbsp;Website work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#technical-writing-style" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Technical writing style&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#documentation-work" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Documentation work&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#scripts-to-ease-doc-work" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Scripts to ease doc work &gt; </a>]</td></tr></table>
<a name="tips-for-writing-docs"></a>
<h2 class="section">5.5 Tips for writing docs</h2>

<p>In the NR, I highly recommend focusing on one subsection at a
time.  For each subsection,
</p>
<ul>
<li>
check the mundane formatting.  Are the headings (@predefined,
@seealso, etc.) in the right order?

</li><li>
add any appropriate index entries.

</li><li>
check the links in the @seealso section &ndash; links to music
glossary, internal references, and other NR sections are the main
concern.  Check for potential additions.

</li><li>
move LSR-worthy material into LSR.  Add the snippet, delete the
material from the &lsquo;<tt>.itely</tt>&rsquo; file, and add a @lilypondfile command.

</li><li>
check the examples and descriptions.  Do they still work?
<strong>Do not</strong> assume that the existing text is
accurate/complete; some of the manual is highly out of date.

</li><li>
is the material in the @knownissues  still accurate?

</li><li>
can the examples be improved (made more explanatory), or is there
any missing info?  (feel free to ask specific questions on -user;
a couple of people claimed to be interesting in being
&ldquo;consultants&rdquo; who would help with such questions)

</li></ul>

<p>In general, I favor short text explanations with good examples &ndash;
&ldquo;an example is worth a thousand words&rdquo;.  When I worked on the
docs, I spent about half my time just working on those tiny
lilypond examples.  Making easily-understandable examples is much
harder than it looks.
</p>

<a name="Tweaks"></a>
<h4 class="subsubheading">Tweaks</h4>

<p>In general, any \set or \override commands should go in the
&ldquo;select snippets&rdquo; section, which means that they should go in
LSR and not the &lsquo;<tt>.itely</tt>&rsquo; file.  For some cases, the command
obviously belongs in the &ldquo;main text&rdquo; (i.e. not inside
@predefined or @seealso or whatever) &ndash; instrument names are a
good example of this.
</p>
<blockquote><pre class="example">\set Staff.instrumentName = #&quot;foo&quot;
</pre></blockquote>

<p>On the other side of this,
</p>
<blockquote><pre class="example">\override Score.Hairpin #'after-line-breaking = ##t
</pre></blockquote>

<p>clearly belongs in LSR.
</p>
<p>I&rsquo;m quite willing to discuss specific cases if you think that a
tweaks needs to be in the main text.  But items that can go into
LSR are easier to maintain, so I&rsquo;d like to move as much as
possible into there.
</p>

<p>It would be &ldquo;nice&rdquo; if you spent a lot of time crafting nice
tweaks for users&hellip; but my recommendation is <strong>not</strong> to do
this.  There&rsquo;s a lot of doc work to do without adding examples of
tweaks.  Tweak examples can easily be added by normal users by adding
them to the LSR.
</p>
<p>One place where a documentation writer can profitably spend time writing
or upgrading tweaks is creating tweaks to deal with known issues.  It
would be ideal if every significant known issue had a workaround to avoid
the difficulty.
</p>
<a name="See-also-1"></a>
<h4 class="subsubheading">See also</h4>
<p><a href="#adding-and-editing-snippets">Adding and editing snippets</a>.
</p>

<hr size="6">
<a name="Scripts-to-ease-doc-work"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#documentation-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Documentation work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#website-work" title="Next chapter">&nbsp;Website work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#tips-for-writing-docs" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Tips for writing docs&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#documentation-work" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Documentation work&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#docstrings-in-scheme" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Docstrings in scheme &gt; </a>]</td></tr></table>
<a name="scripts-to-ease-doc-work"></a>
<h2 class="section">5.6 Scripts to ease doc work</h2>

<a name="Building-only-one-section-of-the-documentation"></a>
<h3 class="subheading">Building only one section of the documentation</h3>

<p>In order to save build time, a script is available to build only
one section of the documentation in English with a default html
appearance.
</p>
<p>You can build a section of the documentation with:
</p>
<blockquote><pre class="example">scripts/auxiliar/doc-section.sh MANUAL SECTION
</pre></blockquote>

<p>where <code>SECTION</code> is the name of the file containing the section
to be built, and <code>MANUAL</code> is replaced by the name of the directory
containing the section.  So, for example, to build section 1.1 of the
Notation Reference, use the command:
</p>
<blockquote><pre class="example">scripts/auxiliar/doc-section.sh notation pitches
</pre></blockquote>

<p>You can then see the generated document for the section at
</p>
<blockquote><pre class="example">tempdocs/pitches/out/pitches.html
</pre></blockquote>

<p>According to
<a href="http://code.google.com/p/lilypond/issues/detail?id=1236">Lilypond issue 1236</a>,
the location of the lilypond git tree is taken from <code>$LILYPOND_GIT</code>
if specified, otherwise it is auto-detected.
</p>
<p>It is assumed that compilation takes place in the &lsquo;<tt>build/</tt>&rsquo;
subdirectory, but this can be overridden by setting the environment
variable <code>LILYPOND_BUILD_DIR</code>.
</p>
<p>Similarly, output defaults to &lsquo;<tt>build/tempdocs/</tt>&rsquo; but this can be
overridden by setting the environment variable
<code>LILYPOND_TEMPDOCS</code>.
</p>
<p>This script will not work for building sections of the
Contributors&rsquo; guide.  For building sections of the Contributors&rsquo;
Guide, use:
</p>
<blockquote><pre class="example">scripts/auxiliar/cg-section.sh SECTION
</pre></blockquote>

<p>where <code>SECTION</code> is the name of the file containing the sections
to be built.  For example, to build section 4 of the Contributors&rsquo; guide,
use:
</p>
<blockquote><pre class="example">scripts/auxiliar/cg-section.sh doc-work
</pre></blockquote>

<p><code>cg-section.sh</code> uses the same environment variables and
corresponding default values as <code>doc-section.sh</code>.
</p>
<a name="Stripping-whitespace-and-generating-menus"></a>
<h3 class="subheading">Stripping whitespace and generating menus</h3>

<div class="warning"><p><strong>Note:</strong> This script assumes that the file conforms to our doc
policy; a few files still need work in this regard.
</p>
</div>
<p>To automatically regenerate <code>@menu</code> portions and strip
whitespace, use:
</p>
<blockquote><pre class="example">scripts/auxiliar/node-menuify.py <var>FILENAME</var>
</pre></blockquote>


<a name="Stripping-whitespace-only"></a>
<h3 class="subheading">Stripping whitespace only</h3>

<p>To remove extra whitespace from the ends of lines, run
</p>
<blockquote><pre class="example">scripts/auxiliar/strip-whitespace.py Documentation/FILENAME
</pre></blockquote>


<a name="Updating-doc-with-convert_002dly"></a>
<h3 class="subheading">Updating doc with <code>convert-ly</code></h3>

<p>Don&rsquo;t.  This should be done by programmers when they add new
features.  If you notice that it hasn&rsquo;t been done, complain to
<code>lilypond-devel</code>.
</p>

<hr size="6">
<a name="Docstrings-in-scheme"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#documentation-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Documentation work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#website-work" title="Next chapter">&nbsp;Website work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#scripts-to-ease-doc-work" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Scripts to ease doc work&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#documentation-work" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Documentation work&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#translating-the-documentation" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Translating the documentation &gt; </a>]</td></tr></table>
<a name="docstrings-in-scheme"></a>
<h2 class="section">5.7 Docstrings in scheme</h2>

<p>Material in the Internals reference is generated automatically
from our source code.  Any doc work on Internals therefore
requires modifying files in &lsquo;<tt>scm/*.scm</tt>&rsquo;.  Texinfo is allowed
in these docstrings.
</p>
<p>Most documentation writers never touch these, though.  If you want
to work on them, please ask for help.
</p>

<hr size="6">
<a name="Translating-the-documentation"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#documentation-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Documentation work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#website-work" title="Next chapter">&nbsp;Website work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#docstrings-in-scheme" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Docstrings in scheme&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#documentation-work" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Documentation work&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#getting-started-with-documentation-translation" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Getting started with documentation translation &gt; </a>]</td></tr></table>
<a name="translating-the-documentation"></a>
<h2 class="section">5.8 Translating the documentation</h2>

<p>The mailing list <code>translations@lilynet.net</code> is dedicated to
LilyPond web site and documentation translation; on this list, you will
get support from the Translations Meister and experienced translators,
and we regularly discuss translation issues common to all languages.
All people interested in LilyPond translations are invited to subscribe
to this list regardless of the amount of their contribution, by sending
an email to <code>translations-request@lilynet.net</code> with subject
<code>subscribe</code> and an empty message body.  Unless mentioned explicitly,
or except if a translations coordinator contacts you privately, you
should send questions, remarks and patches to the list
<code>translations@lilynet.net</code>.  Please note that traffic is high
on the English-speaking list <code>lilypond-user@gnu.org</code>, so it may
take some time before your request or contribution is handled.
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#getting-started-with-documentation-translation" accesskey="1">5.8.1 Getting started with documentation translation</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#documentation-translation-details" accesskey="2">5.8.2 Documentation translation details</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#documentation-translation-maintenance" accesskey="3">5.8.3 Documentation translation maintenance</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#translations-management-policies" accesskey="4">5.8.4 Translations management policies</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#technical-background" accesskey="5">5.8.5 Technical background</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr size="6">
<a name="Getting-started-with-documentation-translation"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#documentation-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Documentation work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#website-work" title="Next chapter">&nbsp;Website work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#translating-the-documentation" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Translating the documentation&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#translating-the-documentation" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Translating the documentation&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#translation-requirements" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Translation requirements &gt; </a>]</td></tr></table>
<a name="getting-started-with-documentation-translation"></a>
<h3 class="subsection">5.8.1 Getting started with documentation translation</h3>

<p>First, get the sources of branch <code>translation</code> from the
Git repository, see <a href="#starting-with-git">Starting with Git</a>.
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#translation-requirements" accesskey="1">Translation requirements</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#which-documentation-can-be-translated" accesskey="2">Which documentation can be translated</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#starting-translation-in-a-new-language" accesskey="3">Starting translation in a new language</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr size="6">
<a name="Translation-requirements"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#documentation-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Documentation work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#website-work" title="Next chapter">&nbsp;Website work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#getting-started-with-documentation-translation" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Getting started with documentation translation&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#getting-started-with-documentation-translation" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Getting started with documentation translation&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#which-documentation-can-be-translated" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Which documentation can be translated &gt; </a>]</td></tr></table>
<a name="translation-requirements"></a>
<h4 class="unnumberedsubsubsec">Translation requirements</h4>

<p>Working on LilyPond documentation translations requires the following
pieces of software, in order to make use of dedicated helper tools:
</p>
<ul>
<li> Python 2.4 or higher,
</li><li> GNU Make,
</li><li> Gettext,
</li><li> Git.
</li></ul>

<p>It is not required to build LilyPond and the documentation to
translate the documentation.  However, if you have enough time and
motivation and a suitable system, it can be very useful to build at
least the documentation so that you can check the output yourself and
more quickly; if you are interested, see <a href="#compiling">Compiling</a>.
</p>
<p>Before undertaking any large translation work, contributors are
encouraged to contact the <a href="#meisters">Translation Meister</a>.
</p>

<hr size="6">
<a name="Which-documentation-can-be-translated"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#documentation-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Documentation work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#website-work" title="Next chapter">&nbsp;Website work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#translation-requirements" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Translation requirements&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#getting-started-with-documentation-translation" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Getting started with documentation translation&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#starting-translation-in-a-new-language" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Starting translation in a new language &gt; </a>]</td></tr></table>
<a name="which-documentation-can-be-translated"></a>
<h4 class="unnumberedsubsubsec">Which documentation can be translated</h4>

<p>The makefiles and scripts infrastructure currently supports translation
of the following documentation:
</p>
<ul>
<li> the web site, the Learning Manual, the Notation Reference and
Application Usage &ndash; Texinfo source, PDF and HTML output; Info output
might be added if there is enough demand for it;
</li><li> the Changes document.
</li></ul>

<p>Support for translating the following pieces of documentation should be
added soon, by decreasing order of priority:
</p>
<ul>
<li> automatically generated documentation: markup commands,
predefined music functions;
</li><li> the Snippets List;
</li><li> the Internals Reference.
</li></ul>


<hr size="6">
<a name="Starting-translation-in-a-new-language"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#documentation-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Documentation work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#website-work" title="Next chapter">&nbsp;Website work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#which-documentation-can-be-translated" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Which documentation can be translated&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#getting-started-with-documentation-translation" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Getting started with documentation translation&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#documentation-translation-details" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Documentation translation details &gt; </a>]</td></tr></table>
<a name="starting-translation-in-a-new-language"></a>
<h4 class="unnumberedsubsubsec">Starting translation in a new language</h4>

<p>At top of the source directory, do
</p>
<blockquote><pre class="example">./autogen.sh
</pre></blockquote>

<p>or (if you want to install your self-compiled LilyPond locally)
</p>
<blockquote><pre class="example">./autogen.sh --prefix=$HOME
</pre></blockquote>

<p>If you want to compile LilyPond &ndash; which is almost required to build
the documentation, but is not required to do translation only &ndash; fix
all dependencies and rerun <code>./configure</code> (with the same
options as for <code>autogen.sh</code>).
</p>
<p>Then <code>cd</code> into &lsquo;<tt>Documentation/</tt>&rsquo; and run
</p>
<blockquote><pre class="example">make ISOLANG=<var>MY-LANGUAGE</var> new-lang
</pre></blockquote>

<p>where <var>MY-LANGUAGE</var> is the ISO 639 language code.
</p>
<p>Finally, add a language definition for your language in
&lsquo;<tt>python/langdefs.py</tt>&rsquo;.
</p>

<hr size="6">
<a name="Documentation-translation-details"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#documentation-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Documentation work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#website-work" title="Next chapter">&nbsp;Website work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#starting-translation-in-a-new-language" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Starting translation in a new language&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#translating-the-documentation" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Translating the documentation&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#files-to-be-translated" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Files to be translated &gt; </a>]</td></tr></table>
<a name="documentation-translation-details"></a>
<h3 class="subsection">5.8.2 Documentation translation details</h3>

<p>Please follow all the instructions with care to ensure quality work.
</p>
<p>All files should be encoded in UTF-8.
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#files-to-be-translated" accesskey="1">Files to be translated</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#translating-the-web-site-and-other-texinfo-documentation" accesskey="2">Translating the Web site and other Texinfo documentation</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#adding-a-texinfo-manual" accesskey="3">Adding a Texinfo manual</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr size="6">
<a name="Files-to-be-translated"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#documentation-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Documentation work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#website-work" title="Next chapter">&nbsp;Website work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#documentation-translation-details" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Documentation translation details&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#documentation-translation-details" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Documentation translation details&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#translating-the-web-site-and-other-texinfo-documentation" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Translating the Web site and other Texinfo documentation &gt; </a>]</td></tr></table>
<a name="files-to-be-translated"></a>
<h4 class="unnumberedsubsubsec">Files to be translated</h4>



<p>Translation of &lsquo;<tt>Documentation/foo/bar</tt>&rsquo; should be
&lsquo;<tt>Documentation/<var>LANG</var>/foo/bar</tt>&rsquo;.  Unmentioned files should not
be translated.
</p>
<p>Priorities:
</p><ul>
<li> 1. delivery,
</li><li> 2. 3. 4. 5. 6. later,
</li><li> 7. optional.
</li></ul>

<p>Files of priority 1 should be submitted along all files generated by
starting a new language in the same commit and thus a unique patch, and
the translation of files marked with priority 2 should be committed to
Git at the same time and thus sent in a single patch.  Files
marked with priority 3 or more may be submitted individually.  Word
counts (excluding LilyPond snippets) are given for each file.  For
knowing how to commit your work to Git, then make patches of your new
translations as well as corrections and updates, see <a href="#basic-git-procedures">Basic Git procedures</a>.
</p>
<blockquote><pre class="example">-1- Web site
616   web.texi
4753  web/introduction.itexi
1211  web/download.itexi
1139  macros.itexi
7977  po/lilypond-doc.pot (translate to po/<var>MY_LANGUAGE</var>.po)
0     search-box.ihtml
---   lilypond-texi2html.init (section TRANSLATIONS)
15696 total

-2- Tutorial
1214  web/manuals.itexi
124   learning.tely
2535  learning/tutorial.itely
4187  learning/common-notation.itely
8060  total

-3- Fundamental Concepts, starting of Usage and Community
11130 learning/fundamental.itely -- Fundamental concepts
135   usage.tely
4615  usage/running.itely
1209  usage/updating.itely
3006  web/community.itexi
20095 total

-4- Rest of Learning manual and Suggestions on writing LilyPond files
15468 learning/tweaks.itely -- Tweaking output
219   learning/templates.itely -- Templates
2694  usage/suggestions.itely -- Suggestions on writing LilyPond files
18381 total

-5- Notation reference
355   notation.tely
91    notation/notation.itely -- Musical notation
4530  notation/pitches.itely
6352  notation/rhythms.itely
1712  notation/expressive.itely
1011  notation/repeats.itely
2640  notation/simultaneous.itely
2392  notation/staff.itely
949   notation/editorial.itely
2729  notation/text.itely
81    notation/specialist.itely -- Specialist notation
4758  notation/vocal.itely
2022  notation/chords.itely
702   notation/piano.itely
812   notation/percussion.itely
826   notation/guitar.itely
66    notation/strings.itely
242   notation/bagpipes.itely
4752  notation/ancient.itely
8701  notation/input.itely -- Input syntax
2164  notation/non-music.itely -- Non-musical notation
11234 notation/spacing.itely -- Spacing issues
12679 notation/changing-defaults.itely -- Changing defaults
5187  notation/programming-interface.itely -- Interfaces for programmers
2177  notation/notation-appendices.itely -- Notation manual tables
252   notation/cheatsheet.itely -- Cheat sheet
79416 total

-6- Rest of Application Usage
4137  usage/lilypond-book.itely -- LilyPond-book
1122  usage/converters.itely -- Converting from other formats
5259  total

-7- Appendices whose translation is optional
326   essay/literature.itely
1222  learning/scheme-tutorial.itely (should be revised first)
1548  total
</pre></blockquote>

<p>In addition, not listed above, Snippets&rsquo; titles and descriptions
should be translated; they are a part of the Notation Reference and
therefore their priority is 5.
</p>
<hr size="6">
<a name="Translating-the-Web-site-and-other-Texinfo-documentation"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#documentation-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Documentation work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#website-work" title="Next chapter">&nbsp;Website work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#files-to-be-translated" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Files to be translated&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#documentation-translation-details" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Documentation translation details&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#adding-a-texinfo-manual" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Adding a Texinfo manual &gt; </a>]</td></tr></table>
<a name="translating-the-web-site-and-other-texinfo-documentation"></a>
<h4 class="unnumberedsubsubsec">Translating the Web site and other Texinfo documentation</h4>

<p>Every piece of text should be translated in the source file, except
Texinfo comments, text in <code>@lilypond</code> blocks and a few cases
mentioned below.
</p>
<p>Node names are translated, but the original node name in English should
be kept as the argument of <code>@translationof</code> put after the section
title; that is, every piece in the original file like
</p>
<blockquote><pre class="example">@node Foo bar
@<var>section_command</var> Bar baz
</pre></blockquote>

<p>should be translated as
</p>
<blockquote><pre class="example">@node <var>translation of Foo bar</var>
@<var>section_command</var> <var>translation of Bar baz</var>
@translationof Foo bar
</pre></blockquote>

<p>The argument of <code>@rglos</code> commands and the first argument of
<code>@rglosnamed</code> commands must not be translated, as it is the node
name of an entry in Music Glossary.
</p>
<p>Every time you translate a node name in a cross-reference, i.e. the
argument of commands <code>@ref, @rprogram, @rlearning, @rlsr,
@ruser</code> or the first argument of their <code><var>*</var>named</code> variants,
you should make sure the target node is defined in the correct source
file; if you do not intend to translate the target node right now, you
should at least write the node definition (that is, the <code>@node
@<var>section_commmand</var> @translationof</code> trio mentioned above) in the
expected source file and define all its parent nodes; for each node you
have defined this way but have not translated, insert a line that
contains <code>@untranslated</code>.  That is, you should end up
for each untranslated node with something like
</p>
<blockquote><pre class="example">@node <var>translation of Foo bar</var>
@<var>section_command</var> <var>translation of Bar baz</var>
@translationof Foo bar

@untranslated
</pre></blockquote>

<div class="warning"><p><strong>Note:</strong> you do not have to translate the node name of a cross-reference
to a node that you do not have translated.  If you do, you must define
an &ldquo;empty&rdquo; node like explained just above; this will produce a
cross-reference with the translated node name in output, although the
target node will still be in English.  On the opposite, if all
cross-references that refer to an untranslated node use the node name in
English, then you do not have to define such an &ldquo;empty&rdquo; node, and the
cross-reference text will appear in English in the output.  The choice
between these two strategies implies its particular maintenance
requirements and is left to the translators, although the opinion of the
Translation meister leans towards not translating these
cross-references.
</p>
</div>
<p>Please think of the fact that it may not make sense translating
everything in some Texinfo files, and you may take distance from the
original text; for instance, in the translation of the web site section
Community, you may take this into account depending on what you know the
community in your language is willing to support, which is possible only
if you personally assume this support, or there exists a public forum
or mailing list listed in Community for LilyPond in your language:
</p>
<ul>
<li> <a name="index-Bug-reports-1"></a>
<a href="web-big-page.html#bug-reports">Bug reports</a>: this page should be translated only if you
know that every bug report sent on your language&rsquo;s mailing list or forum
will be handled by someone who will translate it to English and send it
on bug-lilypond or add an issue in the tracker, then translate back the
reply from developers.

</li><li> <a name="index-Help-us-1"></a>
<a href="web-big-page.html#help-us">Help us</a>: this page should be translated very freely,
and possibly not at all: ask help for contributing to LilyPond for tasks
that LilyPond community in your language is able and going to handle.
</li></ul>

<p>In any case, please mark in your work the sections which do not result
from the direct translation of a piece of English translation, using
comments i.e. lines starting with &lsquo;<code>@c</code>&rsquo;.
</p>
<p>Finally, press in Emacs &lt;C-c C-u C-a&gt; to update or generate
menus.  This process should be made easier in the future, when the helper
script <code>texi-langutils.py</code> and the makefile target are updated.
</p>
<p>Some pieces of text manipulated by build scripts that appear in the
output are translated in a &lsquo;<tt>.po</tt>&rsquo; file &ndash; just like LilyPond output
messages &ndash; in &lsquo;<tt>Documentation/po</tt>&rsquo;.  The Gettext domain is named
<code>lilypond-doc</code>, and unlike <code>lilypond</code> domain it is not managed
through the Free Translation Project.
</p>

<p>Take care of using typographic rules for your language, especially in
&lsquo;<tt>macros.itexi</tt>&rsquo;.
</p>
<p>If you wonder whether a word, phrase or larger piece of text should be
translated, whether it is an argument of a Texinfo command or a small
piece sandwiched between two Texinfo commands, try to track whether and
where it appears in PDF and/or HTML output as visible text.  This piece
of advice is especially useful for translating &lsquo;<tt>macros.itexi</tt>&rsquo;.
</p>
<p>Please keep verbatim copies of music snippets (in <code>@lilypond</code>
blocs).  However, some music snippets containing text that shows in
the rendered music, and sometimes translating this text really helps
the user to understand the documentation; in this case, and only in
this case, you may as an exception translate text in the music
snippet, and then you must add a line immediately before the
<code>@lilypond</code> block, starting with
</p>
<blockquote><pre class="example">@c KEEP LY
</pre></blockquote>

<p>Otherwise the music snippet would be reset to the same content as the
English version at next <code>make snippet-update</code> run &ndash; see
<a href="#updating-documentation-translation">Updating documentation translation</a>.
</p>
<p>When you encounter
</p>
<blockquote><pre class="example">@lilypondfile[&lt;number of fragment options&gt;,texidoc]{<var>filename.ly</var>}
</pre></blockquote>

<p>in the source, open &lsquo;<tt>Documentation/snippets/<var>filename</var>.ly</tt>&rsquo;,
translate the <code>texidoc</code> header field it contains, enclose it with
<code>texidoc<var>MY-LANGUAGE</var> = &quot;</code> and <code>&quot;</code>, and write it into
&lsquo;<tt>Documentation/<var>MY-LANGUAGE</var>/texidocs/<var>filename</var>.texidoc</tt>&rsquo;.
Additionally, you may translate the snippet&rsquo;s title in <code>doctitle</code>
header field, in case <code>doctitle</code> is a fragment option used in
<code>@lilypondfile</code>; you can do this exactly the same way as
<code>texidoc</code>.  For instance,
&lsquo;<tt>Documentation/<var>MY-LANGUAGE</var>/texidocs/<var>filename</var>.texidoc</tt>&rsquo;
may contain
</p>
<blockquote><pre class="example">doctitlees = &quot;Spanish title baz&quot;
texidoces = &quot;
Spanish translation blah
&quot;
</pre></blockquote>

<p><code>@example</code> blocks need not be verbatim copies, e.g. variable
names, file names and comments should be translated.
</p>
<p>Finally, please carefully apply every rule exposed in <a href="#texinfo-introduction-and-usage-policy">Texinfo introduction and usage policy</a>, and <a href="#documentation-policy">Documentation policy</a>.  If one
of these rules conflicts with a rule specific to your language, please
ask the Translation meister on <a href="mailto:translations@lilynet.net">translations@lilynet.net</a> list
and/or the Documentation Editors on <a href="mailto:lilypond-devel@gnu.org">lilypond-devel@gnu.org</a>
list.
</p>

<hr size="6">
<a name="Adding-a-Texinfo-manual"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#documentation-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Documentation work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#website-work" title="Next chapter">&nbsp;Website work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#translating-the-web-site-and-other-texinfo-documentation" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Translating the Web site and other Texinfo documentation&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#documentation-translation-details" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Documentation translation details&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#documentation-translation-maintenance" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Documentation translation maintenance &gt; </a>]</td></tr></table>
<a name="adding-a-texinfo-manual"></a>
<h4 class="unnumberedsubsubsec">Adding a Texinfo manual</h4>

<p>In order to start translating a new manual whose basename is <var>FOO</var>,
do
</p>
<blockquote><pre class="example">cd Documentation/<var>MY-LANGUAGE</var>
cp ../<var>FOO</var>.tely .
mkdir <var>FOO</var>
cp web/GNUmakefile <var>FOO</var>
</pre></blockquote>

<p>then append <var>FOO</var> to variable <code>SUBDIRS</code> in
Documentation/<var>MY-LANGUAGE</var>/GNUmakefile, then translate file
<var>MY-LANGUAGE</var>/<var>FOO</var>.tely and run <code>skeleton-update</code>:
</p>
<blockquote><pre class="example">cd Documentation/
make ISOLANG=<var>MY-LANGUAGE</var> TEXI_LANGUTIL_FLAGS=--head-only skeleton-update
</pre></blockquote>

<p>Your are now ready to translate the new manual exactly like the web site
or the Learning Manual.
</p>

<hr size="6">
<a name="Documentation-translation-maintenance"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#documentation-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Documentation work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#website-work" title="Next chapter">&nbsp;Website work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#adding-a-texinfo-manual" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Adding a Texinfo manual&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#translating-the-documentation" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Translating the documentation&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#check-state-of-translation" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Check state of translation &gt; </a>]</td></tr></table>
<a name="documentation-translation-maintenance"></a>
<h3 class="subsection">5.8.3 Documentation translation maintenance</h3>

<p>Several tools have been developed to make translations maintenance
easier.  These helper scripts make use of the power of Git, the
version control system used for LilyPond development.
</p>
<p>You should use them whenever you would like to update the translation in
your language, which you may do at the frequency that fits your and your
cotranslators&rsquo; respective available times.  In the case your translation
is up-do-date (which you can discover in the first subsection below), it
is enough to check its state every one or two weeks.  If you feel
overwhelmed by the quantity of documentation to be updated, see
<a href="#maintaining-without-updating-translations">Maintaining without updating translations</a>.
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#check-state-of-translation" accesskey="1">Check state of translation</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#updating-documentation-translation" accesskey="2">Updating documentation translation</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#updating-translation-committishes" accesskey="3">Updating translation committishes</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>


<hr size="6">
<a name="Check-state-of-translation"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#documentation-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Documentation work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#website-work" title="Next chapter">&nbsp;Website work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#documentation-translation-maintenance" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Documentation translation maintenance&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#documentation-translation-maintenance" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Documentation translation maintenance&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#updating-documentation-translation" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Updating documentation translation &gt; </a>]</td></tr></table>
<a name="check-state-of-translation"></a>
<h4 class="unnumberedsubsubsec">Check state of translation</h4>

<p>First pull from Git &ndash; see <a href="#pulling-and-rebasing">Pulling and rebasing</a>, but DO NOT rebase
unless you are sure to master the translation state checking and
updating system &ndash; then cd into &lsquo;<tt>Documentation/</tt>&rsquo; (or at top of the
source tree, replace <code>make</code> with <code>make -C
Documentation</code>) and run
</p>
<blockquote><pre class="example">make ISOLANG=<var>MY_LANGUAGE</var> check-translation
</pre></blockquote>

<p>This presents a diff of the original files since the most recent
revision of the translation.  To check a single file, cd into
&lsquo;<tt>Documentation/</tt>&rsquo; and run
</p>
<blockquote><pre class="example">make CHECKED_FILES=<var>MY_LANGUAGE</var>/<var>manual</var>/<var>foo</var>.itely check-translation
</pre></blockquote>

<p>In case this file has been renamed since you last updated the
translation, you should specify both old and new file names, e.g.
<code>CHECKED_FILES=<var>MY_LANGUAGE</var>/{<var>manual</var>,user}/<var>foo</var>.itely</code>.
</p>
<p>To see only which files need to be updated, do
</p>
<blockquote><pre class="example">make ISOLANG=<var>MY_LANGUAGE</var> check-translation | grep 'diff --git'
</pre></blockquote>

<p>To avoid printing terminal colors control characters, which is often
desirable when you redirect output to a file, run
</p>
<blockquote><pre class="example">make ISOLANG=<var>MY_LANGUAGE</var> NO_COLOR=1 check-translation
</pre></blockquote>

<p>You can see the diffs generated by the commands above as changes that
you should make in your language to the existing translation, in order
to make your translation up to date.
</p>
<div class="warning"><p><strong>Note:</strong> do not forget to update the committish in each file you have
completely updated, see <a href="#updating-translation-committishes">Updating translation committishes</a>.
</p>
</div>
<p>Global state of the translation is recorded in
&lsquo;<tt>Documentation/translations.itexi</tt>&rsquo;, which is used to generate
Translations status page.  To update that page, do from
&lsquo;<tt>Documentation/</tt>&rsquo;
</p>
<blockquote><pre class="example">make translation-status
</pre></blockquote>

<p>This will also leave &lsquo;<tt>out/translations-status.txt</tt>&rsquo;, which contains
up-to-dateness percentages for each translated file, and update word
counts of documentation files in this Guide.
</p>
<a name="See-also-3"></a>
<h4 class="subsubheading">See also</h4>
<p><a href="#maintaining-without-updating-translations">Maintaining without updating translations</a>.
</p>
<hr size="6">
<a name="Updating-documentation-translation"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#documentation-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Documentation work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#website-work" title="Next chapter">&nbsp;Website work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#check-state-of-translation" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Check state of translation&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#documentation-translation-maintenance" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Documentation translation maintenance&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#updating-translation-committishes" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Updating translation committishes &gt; </a>]</td></tr></table>
<a name="updating-documentation-translation"></a>
<h4 class="unnumberedsubsubsec">Updating documentation translation</h4>

<p>Instead of running <code>check-translation</code>, you may want to run
<code>update-translation</code>, which will run your favorite text editor to
update files.  First, make sure environment variable <code>EDITOR</code> is
set to a text editor command, then run from &lsquo;<tt>Documentation/</tt>&rsquo;
</p>
<blockquote><pre class="example">make ISOLANG=<var>MY_LANGUAGE</var> update-translation
</pre></blockquote>

<p>or to update a single file
</p>
<blockquote><pre class="example">make CHECKED_FILES=<var>MY_LANGUAGE/<var>manual</var>/foo.itely</var> update-translation
</pre></blockquote>

<p>For each file to be updated, <code>update-translation</code> will open your
text editor with this file and a diff of the file in English; if the
diff cannot be generated or is bigger than the file in English itself,
the full file in English will be opened instead.
</p>
<div class="warning"><p><strong>Note:</strong> do not forget to update the committish in each file you have
completely updated, see <a href="#updating-translation-committishes">Updating translation committishes</a>.
</p>
</div>
<p>Texinfo skeleton files, i.e. &lsquo;<tt>.itely</tt>&rsquo; files not yet translated,
containing only the first node of the original file in English can be
updated automatically: whenever <code>make check-translation</code> shows
that such files should be updated, run from &lsquo;<tt>Documentation/</tt>&rsquo;
</p>
<blockquote><pre class="example">make ISOLANG=<var>MY_LANGUAGE</var> skeleton-update
</pre></blockquote>

<p>&lsquo;<tt>.po</tt>&rsquo; message catalogs in &lsquo;<tt>Documentation/po/</tt>&rsquo; may be updated
by issuing from &lsquo;<tt>Documentation/</tt>&rsquo; or &lsquo;<tt>Documentation/po/</tt>&rsquo;
</p>
<blockquote><pre class="example">make po-update
</pre></blockquote>

<div class="warning"><p><strong>Note:</strong> if you run po-update and somebody else does the same and
pushes before you push or send a patch to be applied, there will be a
conflict when you pull.  Therefore, it is better that only the
Translation meister runs this command.
</p>
</div>
<p>Updating music snippets can quickly become cumbersome, as most
snippets should be identical in all languages.  Fortunately, there is
a script that can do this odd job for you (run from
&lsquo;<tt>Documentation/</tt>&rsquo;):
</p>
<blockquote><pre class="example">make ISOLANG=<var>MY_LANGUAGE</var> snippet-update
</pre></blockquote>

<p>This script overwrites music snippets in
&lsquo;<tt><var>MY_LANGUAGE/foo/every.itely</var></tt>&rsquo; with music snippets from
&lsquo;<tt><var>foo/every.itely</var></tt>&rsquo;.  It ignores skeleton files, and keeps
intact music snippets preceded with a line starting with <code>@c
KEEP LY</code>; it reports an error for each &lsquo;<tt>.itely</tt>&rsquo; that has not the
same music snippet count in both languages.  Always use this script
with a lot of care, i.e. run it on a clean Git working tree, and check
the changes it made with <code>git diff</code> before committing; if you
don&rsquo;t do so, some <code>@lilypond</code> snippets might be broken or make
no sense in their context.
</p>
<p>Finally, a command runs the three update processes above for all
enabled languages (from &lsquo;<tt>Documentation/</tt>&rsquo;):
</p>
<blockquote><pre class="example">make all-translations-update
</pre></blockquote>

<p>Use this command with caution, and keep in mind it will not be really
useful until translations are stabilized after the end of GDP and GOP.
</p>
<a name="See-also-5"></a>
<h4 class="subsubheading">See also</h4>
<p><a href="#maintaining-without-updating-translations">Maintaining without updating translations</a>,
<a href="#adding-and-editing-snippets">Adding and editing snippets</a>.
</p>

<hr size="6">
<a name="Updating-translation-committishes"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#documentation-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Documentation work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#website-work" title="Next chapter">&nbsp;Website work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#updating-documentation-translation" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Updating documentation translation&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#documentation-translation-maintenance" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Documentation translation maintenance&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#translations-management-policies" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Translations management policies &gt; </a>]</td></tr></table>
<a name="updating-translation-committishes"></a>
<h4 class="unnumberedsubsubsec">Updating translation committishes</h4>

<p>At the beginning of each translated file except PO files, there is a
committish which represents the revision of the sources which you have
used to translate this file from the file in English.
</p>
<p>When you have pulled and updated a translation, it is very important to
update this committish in the files you have completely updated (and
only these); to do this, first commit possible changes to any
documentation in English which you are sure to have done in your
translation as well, then replace in the up-to-date translated files the
old committish by the committish of latest commit, which can be obtained
by doing
</p>
<blockquote><pre class="example">git rev-list HEAD |head -1
</pre></blockquote>



<a name="See-also-4"></a>
<h4 class="subsubheading">See also</h4>
<p><a href="#lsr-work">LSR work</a>.
</p>
<hr size="6">
<a name="Translations-management-policies"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#documentation-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Documentation work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#website-work" title="Next chapter">&nbsp;Website work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#updating-translation-committishes" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Updating translation committishes&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#translating-the-documentation" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Translating the documentation&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#maintaining-without-updating-translations" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Maintaining without updating translations &gt; </a>]</td></tr></table>
<a name="translations-management-policies"></a>
<h3 class="subsection">5.8.4 Translations management policies</h3>

<p>These policies show the general intent of how the translations should
be managed, they aim at helping translators, developers and
coordinators work efficiently.
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#maintaining-without-updating-translations" accesskey="1">Maintaining without updating translations</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#managing-documentation-translation-with-git" accesskey="2">Managing documentation translation with Git</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr size="6">
<a name="Maintaining-without-updating-translations"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#documentation-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Documentation work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#website-work" title="Next chapter">&nbsp;Website work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#translations-management-policies" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Translations management policies&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#translations-management-policies" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Translations management policies&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#managing-documentation-translation-with-git" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Managing documentation translation with Git &gt; </a>]</td></tr></table>
<a name="maintaining-without-updating-translations"></a>
<h4 class="unnumberedsubsubsec">Maintaining without updating translations</h4>

<p>Keeping translations up to date under heavy changes in the documentation
in English may be almost impossible, especially as during the former
Grand Documentation Project (GDP) or the Grand Organization Project
(GOP) when a lot of contributors brings changes.  In addition,
translators may be &mdash; and that is a very good thing &mdash; involved in
these projects too.
</p>
<p>it is possible &mdash; and even recommended &mdash; to perform some maintenance
that keeps translated documentation usable and eases future translation
updating.  The rationale below the tasks list motivates this plan.
</p>
<p>The following tasks are listed in decreasing priority order.
</p>
<ol>
<li> Update macros.itexi.
For each obsolete macro definition, if it is possible to update macro
usage in documentation with an automatic text or regexp substitution,
do it and delete the macro definition from &lsquo;<tt>macros.itexi</tt>&rsquo;; otherwise,
mark this macro definition as obsolete with a comment, and keep it in
&lsquo;<tt>macros.itexi</tt>&rsquo; until the documentation translation has been updated and
no longer uses this macro.

</li><li> Update &lsquo;<tt>*.tely</tt>&rsquo; files completely with
<code>make check-translation</code> &ndash; you may want to redirect output
to a file because of overwhelming output, or call check-translation.py
on individual files, see <a href="#check-state-of-translation">Check state of translation</a>.

</li><li> In &lsquo;<tt>.itelys</tt>&rsquo;, match sections and .itely file names with those from
English docs, which possibly involves moving nodes contents in block
between files, without updating contents itself.  In other words, the
game is catching where has gone each section.  In Learning manual, and
in Notation Reference sections which have been revised in GDP, there may
be completely new sections: in this case, copy <code>@node</code> and
<code>@section</code>-command from English docs, and add the marker for
untranslated status <code>@untranslated</code> on a single line.  Note that
it is not possible to exactly match subsections or subsubsections of
documentation in English, when contents has been deeply revised; in this
case, keep obsolete (sub)subsections in the translation, marking them
with a line <code>@c obsolete</code> just before the node.

<p>Emacs with Texinfo mode makes this step easier:
</p>
<ul>
<li> without Emacs AucTeX installed, &lt;C-c C-s&gt; shows structure of current
Texinfo file in a new buffer <code>*Occur*</code>; to show structure of two files
simultaneously, first split Emacs window in 4 tiles (with &lt;C-x 1&gt;
and &lt;C-x 2&gt;), press &lt;C-c C-s&gt; to show structure of one file
(e.g. the translated file), copy <code>*Occur*</code> contents into
<code>*Scratch*</code>, then press &lt;C-c C-s&gt; for the other file.

<p>If you happen to have installed AucTeX, you can either call the macro
by doing &lt;M-x texinfo-show-structure&gt; or create a key binding in your
&lsquo;<tt>~/.emacs</tt>&rsquo;, by adding the four following lines:
</p>
<blockquote><pre class="example">(add-hook 'Texinfo-mode-hook
          '(lambda ()
             (define-key Texinfo-mode-map &quot;\C-cs&quot;
              'texinfo-show-structure)))
</pre></blockquote>

<p>and then obtain the structure in the <code>*Occur*</code> buffer with &lt;C-c
s&gt;.
</p>
</li><li> Do not bother updating <code>@menu</code>s when all menu entries are in the same
file, just do &lt;C-c C-u C-a&gt; (&ldquo;update all menus&rdquo;) when you have
updated all the rest of the file.

</li><li> Moving to next or previous node using incremental search: press
&lt;C-s&gt; and type <code>node</code> (or &lt;C-s @node&gt; if the text
contains the word &lsquo;node&rsquo;) then press &lt;C-s&gt; to move to next node
or &lt;C-r&gt; to move to previous node.  Similar operation can be used
to move to the next/previous section.  Note that every cursor move
exits incremental search, and hitting &lt;C-s&gt; twice starts
incremental search with the text entered in previous incremental
search.

</li><li> Moving a whole node (or even a sequence of nodes): jump to beginning
of the node (quit incremental search by pressing an arrow), press
&lt;C-SPACE&gt;, press &lt;C-s node&gt; and repeat &lt;C-s&gt; until you
have selected enough text, cut it with &lt;C-w&gt; or &lt;C-x&gt;, jump to
the right place (moving between nodes with the previous hint is often
useful) and paste with &lt;C-y&gt; or &lt;C-v&gt;.
</li></ul>

</li><li> Update sections finished in the English documentation; check
sections status at
<table><tr><td>&nbsp;</td><td><pre class="smallexample"><a href="http://lilypondwiki.tuxfamily.org/index.php?title=Documentation_coordination">http://lilypondwiki.tuxfamily.org/index.php?title=Documentation_coordination</a>.
</pre></td></tr></table>

</li><li> Update documentation PO.  It is recommended not to update
strings which come from documentation that is currently deeply revised
in English, to avoid doing the work more than once.

</li><li> Fix broken cross-references by running (from &lsquo;<tt>Documentation/</tt>&rsquo;)

<blockquote><pre class="example">make ISOLANG=<var>YOUR-LANGUAGE</var> fix-xrefs
</pre></blockquote>

<p>This step requires a successful documentation build (with <code>make
doc</code>).  Some cross-references are broken because they point to a node
that exists in the documentation in English, which has not been added
to the translation; in this case, do not fix the cross-reference but
keep it &quot;broken&quot;, so that the resulting HTML link will point to an
existing page of documentation in English.
</p></li></ol>

<a name="Rationale"></a>
<h4 class="subsubheading">Rationale</h4>

<p>You may wonder if it would not be better to leave translations as-is
until you can really start updating translations.  There are several
reasons to do these maintenance tasks right now.
</p>
<ul>
<li> This will have to be done sooner or later anyway, before updating
translation of documentation contents, and this can already be done
without needing to be redone later, as sections of documentation in
English are mostly revised once.  However, note that not all
documentation sectioning has been revised in one go, so all this
maintenance plan has to be repeated whenever a big reorganization is
made.

</li><li> This just makes translated documentation take advantage of the new
organization, which is better than the old one.

</li><li> Moving and renaming sections to match sectioning of documentation in
English simplify future updating work: it allows updating the
translation by side-by-side comparison, without bothering whether
cross-reference names already exist in the translation.

</li><li> Each maintenance task except &lsquo;Updating PO files&rsquo; can be done by
the same person for all languages, which saves overall time spent by
translators to achieve this task: the node names and section titles
are in English, so you can do.  It is important to take advantage of
this now, as it will be more complicated (but still possible) to do
step 3 in all languages when documentation is compiled with
<code>texi2html</code> and node names are directly translated in source
files.
</li></ul>


<hr size="6">
<a name="Managing-documentation-translation-with-Git"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#documentation-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Documentation work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#website-work" title="Next chapter">&nbsp;Website work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#maintaining-without-updating-translations" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Maintaining without updating translations&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#translations-management-policies" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Translations management policies&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#technical-background" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Technical background &gt; </a>]</td></tr></table>
<a name="managing-documentation-translation-with-git"></a>
<h4 class="unnumberedsubsubsec">Managing documentation translation with Git</h4>

<p>This policy explains how to manage Git branches and commit
translations to Git.
</p>
<ul>
<li> Translation work is made on
<code>translation</code> branch.  This branch is merged on
<code>staging</code> once a week, approximately.  Then,
<code>master</code> branch is merged on
<code>translation</code>, where the check-translation script (see
<a href="#check-state-of-translation">Check state of translation</a>) shows changes in English docs which
should be translated, and the cycle starts again.

</li><li> Translations may be pushed directly to
<code>staging</code> only if they do not break compilation of LilyPond and
its documentation.  Those changes could be pushed to
<code>translation</code> too, or alternatively translators could wait until
they come from
<code>master</code> the next time it is merged on
<code>translation</code>.  Similarly, changes matching
<code>stable/X.Y</code> are preferably made on
<code>X.Ytranslation</code>.

</li><li> <code>translation</code> Git branch may be merged into
<code>staging</code> branch only if LilyPond (<code>make all</code>) and
documentation (<code>make doc</code>) compile successfully.

</li><li> <code>make</code> and <code>make doc</code> are usually successful in
<code>master</code> Git branch because those tests should have already
succeeded in
<code>staging</code> branch before merging.
<code>master</code> branch may be merged into
<code>translation</code> when significant changes had been made in
documentation in English in
<code>master</code> branch.

</li><li> General maintenance may be done by anybody who knows what he does
in documentation in all languages, without informing translators
first.  General maintenance include simple text substitutions
(e.g. automated by sed), compilation fixes, updating Texinfo or
lilypond-book commands, updating macros, updating ly code, fixing
cross-references, and operations described in
<a href="#maintaining-without-updating-translations">Maintaining without updating translations</a>.
</li></ul>


<hr size="6">
<a name="Technical-background"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#documentation-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Documentation work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#website-work" title="Next chapter">&nbsp;Website work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#managing-documentation-translation-with-git" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Managing documentation translation with Git&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#translating-the-documentation" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Translating the documentation&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#website-work" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Website work &gt; </a>]</td></tr></table>
<a name="technical-background"></a>
<h3 class="subsection">5.8.5 Technical background</h3>

<p>A number of Python scripts handle a part of the documentation
translation process.  All scripts used to maintain the translations
are located in &lsquo;<tt>scripts/auxiliar/</tt>&rsquo;.
</p>
<ul>
<li> &lsquo;<tt>check_translation.py</tt>&rsquo;  &ndash; show diff to update a translation,
</li><li> &lsquo;<tt>texi-langutils.py</tt>&rsquo;  &ndash; quickly and dirtily parse Texinfo files to
make message catalogs and Texinfo skeleton files,
</li><li> &lsquo;<tt>texi-skeleton-update.py</tt>&rsquo; &ndash; update Texinfo skeleton files,
</li><li> &lsquo;<tt>update-snippets.py</tt>&rsquo; &ndash; synchronize ly snippets with those
from English docs,
</li><li> &lsquo;<tt>translations-status.py</tt>&rsquo; &ndash; update translations status pages and word
counts in the file you are reading,
</li><li> &lsquo;<tt>tely-gettext.py</tt>&rsquo; &ndash; gettext node names, section titles and references
in the sources; WARNING only use this script once for each file, when support for
&quot;makeinfo &ndash;html&quot; has been dropped.
</li></ul>

<p>Other scripts are used in the build process, in &lsquo;<tt>scripts/build/</tt>&rsquo;:
</p>
<ul>
<li> &lsquo;<tt>mass-link.py</tt>&rsquo; &ndash; link or symlink files between English documentation
and documentation in other languages.
</li></ul>

<p>Python modules used by scripts in &lsquo;<tt>scripts/auxiliar/</tt>&rsquo; or &lsquo;<tt>scripts/build/</tt>&rsquo; (but
not by installed Python scripts) are located in &lsquo;<tt>python/auxiliar/</tt>&rsquo;:
</p><ul>
<li> &lsquo;<tt>manuals_definitions.py</tt>&rsquo; &ndash; define manual names and name of
cross-reference Texinfo macros,
</li><li> &lsquo;<tt>buildlib.py</tt>&rsquo; &ndash; common functions (read piped output
of a shell command, use Git),
</li><li> &lsquo;<tt>postprocess_html.py</tt>&rsquo; (module imported by &lsquo;<tt>www_post.py</tt>&rsquo;) &ndash; add footer and
tweak links in HTML pages.
</li></ul>

<p>And finally
</p><ul>
<li> &lsquo;<tt>python/langdefs.py</tt>&rsquo;  &ndash; language definitions module
</li></ul>
<hr size="6">
<a name="Website-work"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#documentation-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Documentation work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#lsr-work" title="Next chapter">&nbsp;LSR work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#technical-background" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Technical background&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#index" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Top&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#introduction-to-website-work" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Introduction to website work &gt; </a>]</td></tr></table>
<a name="website-work"></a>
<h1 class="chapter">6. Website work</h1>

<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#introduction-to-website-work" accesskey="1">6.1 Introduction to website work</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#uploading-and-security" accesskey="2">6.2 Uploading and security</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#debugging-website-and-docs-locally" accesskey="3">6.3 Debugging website and docs locally</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#translating-the-website" accesskey="4">6.4 Translating the website</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>


<hr size="6">
<a name="Introduction-to-website-work"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#website-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Website work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#lsr-work" title="Next chapter">&nbsp;LSR work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#website-work" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Website work&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#website-work" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Website work&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#uploading-and-security" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Uploading and security &gt; </a>]</td></tr></table>
<a name="introduction-to-website-work"></a>
<h2 class="section">6.1 Introduction to website work</h2>

<p>The website is <em>not</em> written directly in HTML;
instead, the source is Texinfo, which is then generated into HTML,
PDF, and Info formats.  The sources are
</p>
<blockquote><pre class="example">Documentation/web.texi
Documentation/web/*.texi
</pre></blockquote>

<p>Unless otherwise specified, follow the instructions and policies
given in <a href="#documentation-work">Documentation work</a>.  That chapter also contains a
quick introduction to Texinfo; consulting an external Texinfo
manual should be not necessary.
</p>
<a name="Exceptions-to-the-documentation-policies"></a>
<h3 class="subheading">Exceptions to the documentation policies</h3>

<ul>
<li>
Sectioning: the website only uses chapters and sections; no
subsections or subsubsections.

</li><li>
@ref{}s to other manuals (@ruser, @rlearning, etc): you can&rsquo;t
link to any pieces of automatically generated documentation, like
the IR or certain NR appendices.

</li><li>
The bibliography in Community-&gt;Publications is generated automatically
from &lsquo;<tt>.bib</tt>&rsquo; files; formatting is done automatically by
&lsquo;<tt>texi-web.bst</tt>&rsquo;.

</li><li>
&hellip;

</li><li>
For anything not listed here, just follow the same style as the
existing website texinfo files.

</li></ul>


<hr size="6">
<a name="Uploading-and-security"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#website-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Website work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#lsr-work" title="Next chapter">&nbsp;LSR work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#introduction-to-website-work" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Introduction to website work&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#website-work" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Website work&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#debugging-website-and-docs-locally" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Debugging website and docs locally &gt; </a>]</td></tr></table>
<a name="uploading-and-security"></a>
<h2 class="section">6.2 Uploading and security</h2>

<a name="Overall-idea"></a>
<h3 class="subheading">Overall idea</h3>

<p>To reduce the CPU burden on the shared host (as well as some
security concerns), we do not compile all of LilyPond.  The
website build process runs <code>texi2html</code>, but all media files
(be they graphical <code>lilypond</code> output, photos of people, or
pdfs) are copied from the <code>$LILYPOND_WEB_MEDIA_GIT</code>
repository.
</p>
<p>All scripts and makefiles used for the website build are run from
a &ldquo;trusted&rdquo; copy.  Any modification to those files in git needs
a human to review the changes (after they have been made in git)
before they are used on the server.
</p>

<a name="Building-the-website-_0028quick-local_0029"></a>
<h3 class="subheading">Building the website (quick local)</h3>

<p>Initial setup: make sure that you have the environment variables
<code>$LILYPOND_GIT</code>, <code>$LILYPOND_BUILD_DIR</code> and
<code>$LILYPOND_WEB_MEDIA_GIT</code> set up correctly.  For more
information, see <a href="#environment-variables">Environment variables</a>.
</p>
<p>Once that is done,
</p>
<blockquote><pre class="example">cd $LILYPOND_BUILD_DIR
make website
</pre></blockquote>

<p>The website is in &lsquo;<tt>out-website/website/index.html</tt>&rsquo;.
</p>

<a name="Building-the-website-_0028exactly-as-on-the-server_0029"></a>
<h3 class="subheading">Building the website (exactly as on the server)</h3>

<a name="Setting-up-_0028exactly-as-on-the-server_0029"></a>
<h4 class="subsubheading">Setting up (exactly as on the server)</h4>

<p>Initial setup: you still need <code>$LILYPOND_GIT</code> and
<code>$LILYPOND_WEB_MEDIA_GIT</code>.
</p>
<p>Once that&rsquo;s done, create:
</p>
<blockquote><pre class="example">mkdir -p $HOME/lilypond/
mkdir -p $HOME/lilypond/bin/
mkdir -p $HOME/lilypond/cron/
mkdir -p $HOME/lilypond/trusted-scripts/
</pre></blockquote>

<p>The add these files to &lsquo;<tt>$HOME/lilypond/bin/</tt>&rsquo;:
</p>
<p>Update git repositories:
</p>
<table><tr><td>&nbsp;</td><td><pre class="verbatim">### update-git.sh
#!/bin/sh
cd $LILYPOND_GIT
git fetch origin
git merge origin/master
cd $LILYPOND_WEB_MEDIA_GIT
git fetch origin
git merge origin/master
</pre></td></tr></table>

<p>Check for any updates to trusted scripts / files:
</p>
<table><tr><td>&nbsp;</td><td><pre class="verbatim">### check-git.sh
#!/bin/sh
DEST=$HOME/lilypond/trusted-scripts
diff -u $DEST/website.make \
  $LILYPOND_GIT/make/website.make
diff -u $DEST/lilypond-texi2html.init \
  $LILYPOND_GIT/Documentation/lilypond-texi2html.init
diff -u $DEST/extract_texi_filenames.py \
  $LILYPOND_GIT/scripts/build/extract_texi_filenames.py
diff -u $DEST/create-version-itexi.py \
  $LILYPOND_GIT/scripts/build/create-version-itexi.py
diff -u $DEST/create-weblinks-itexi.py \
  $LILYPOND_GIT/scripts/build/create-weblinks-itexi.py
diff -u $DEST/mass-link.py \
  $LILYPOND_GIT/scripts/build/mass-link.py
diff -u $DEST/website_post.py \
  $LILYPOND_GIT/scripts/build/website_post.py
diff -u $DEST/bib2texi.py \
  $LILYPOND_GIT/scripts/build/bib2texi.py
diff -u $DEST/langdefs.py \
  $LILYPOND_GIT/python/langdefs.py
diff -u $DEST/lilypond.org.htaccess \
  $LILYPOND_GIT/Documentation/web/server/lilypond.org.htaccess
diff -u $DEST/website-dir.htaccess \
  $LILYPOND_GIT/Documentation/web/server/website-dir.htaccess
</pre></td></tr></table>

<p>If the changes look ok, make them trusted:
</p>
<table><tr><td>&nbsp;</td><td><pre class="verbatim">### copy-from-git.sh
#!/bin/sh
DEST=$HOME/lilypond/trusted-scripts
cp $LILYPOND_GIT/make/website.make \
  $DEST/website.make
cp $LILYPOND_GIT/Documentation/lilypond-texi2html.init \
  $DEST/lilypond-texi2html.init
cp $LILYPOND_GIT/scripts/build/extract_texi_filenames.py \
  $DEST/extract_texi_filenames.py
cp $LILYPOND_GIT/scripts/build/create-version-itexi.py \
  $DEST/create-version-itexi.py
cp $LILYPOND_GIT/scripts/build/create-weblinks-itexi.py \
  $DEST/create-weblinks-itexi.py
cp $LILYPOND_GIT/scripts/build/mass-link.py \
  $DEST/mass-link.py
cp $LILYPOND_GIT/scripts/build/website_post.py \
  $DEST/website_post.py
cp $LILYPOND_GIT/scripts/build/bib2texi.py \
  $DEST/bib2texi.py
cp $LILYPOND_GIT/python/langdefs.py \
  $DEST/langdefs.py
cp $LILYPOND_GIT/Documentation/web/server/lilypond.org.htaccess \
  $DEST/lilypond.org.htaccess
cp $LILYPOND_GIT/Documentation/web/server/website-dir.htaccess \
  $DEST/website-dir.htaccess
</pre></td></tr></table>

<p>Build the website:
</p>
<table><tr><td>&nbsp;</td><td><pre class="verbatim">### make-website.sh
#!/bin/sh
DEST=$HOME/web/
BUILD=$HOME/lilypond/build-website
mkdir -p $BUILD
cd $BUILD
cp $HOME/lilypond/trusted-scripts/website.make .

make -f website.make WEBSITE_ONLY_BUILD=1 website
rsync -raO $BUILD/out-website/website/ $DEST/website/
cp $BUILD/out-website/pictures $DEST
cp $BUILD/out-website/.htaccess $DEST
</pre></td></tr></table>

<p>Then in the &lsquo;<tt>cronjob/</tt>&rsquo; directory, put the cronjob to automate
the trusted portions:
</p>
<div class="warning"><p><strong>Note:</strong> <code>cron</code> will not inherit environment variables from
your main setup, so you must re-define any variables inside your
<code>crontab</code>.
</p>
</div>
<table><tr><td>&nbsp;</td><td><pre class="verbatim"># website-rebuild.cron
LILYPOND_GIT=   ... fill this in
LILYPOND_WEB_MEDIA_GIT=   ... fill this in

11 * * * * $HOME/lilypond/trusted-scripts/update-git.sh &gt;/dev/null 2&gt;&amp;1
22 * * * * $HOME/lilypond/trusted-scripts/make-website.sh &gt;/dev/null 2&gt;&amp;1
</pre></td></tr></table>

<p>As the final stage of the setup, run your <code>copy-from-git.sh</code>
script, assuming that you trust the current state of scripts in
lilypond git.
</p>
<a name="Normal-maintenance"></a>
<h4 class="subsubheading">Normal maintenance</h4>

<p>When there is a change to the build scripts and/or website
makefile, log in to the server (or your own home machine if you&rsquo;re
testing this there), and do
</p>
<blockquote><pre class="example">update-git.sh
check-git.sh
</pre></blockquote>

<p>After reviewing the changes carefully, you can update the trusted
scripts with <code>copy-from-git.sh</code>.
</p>

<a name="Building-the-website-_0028exactly-as-on-the-server_0029-1"></a>
<h4 class="subsubheading">Building the website (exactly as on the server)</h4>

<p>Run <code>make-website.sh</code>; the final version ends up in
&lsquo;<tt>$HOME/web/</tt>&rsquo;.
</p>
<p>On the actual server, the website is generated hourly by user
<code>graham</code> the host <code>lilypond.org</code>.  You can set up the
cronjob by doing:
</p>
<blockquote><pre class="example">crontab $HOME/lilypond/website-rebuild.cron
</pre></blockquote>


<a name="Initial-setup-for-new-users-on-actual-serve"></a>
<h3 class="subheading">Initial setup for new users on actual serve</h3>

<p>You should symlink your own &lsquo;<tt>~/lilypond/</tt>&rsquo; to
&lsquo;<tt>~graham/lilypond/</tt>&rsquo;
</p>
<p>If this directory does not exist, make it.  Git master should go
in &lsquo;<tt>~/lilypond/lilypond-git/</tt>&rsquo; but make sure you enable:
</p>
<blockquote><pre class="example">git config core.filemode false
</pre></blockquote>

<p>If you have created any files in &lsquo;<tt>~graham/lilypond/</tt>&rsquo; then
please run:
</p>
<blockquote><pre class="example">chgrp lilypond ~graham/lilypond/ -R
chmod 775 ~graham/lilypond/ -R
</pre></blockquote>



<a name="Additional-information"></a>
<h4 class="subsubheading">Additional information</h4>

<p>Some information about the website is stored in
&lsquo;<tt>~graham/lilypond/*.txt</tt>&rsquo;; this information should not be
shared with people without trusted access to the server.
</p>

<hr size="6">
<a name="Debugging-website-and-docs-locally"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#website-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Website work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#lsr-work" title="Next chapter">&nbsp;LSR work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#uploading-and-security" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Uploading and security&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#website-work" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Website work&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#translating-the-website" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Translating the website &gt; </a>]</td></tr></table>
<a name="debugging-website-and-docs-locally"></a>
<h2 class="section">6.3 Debugging website and docs locally</h2>

<ul>
<li>
Install apache2, or any other http server.  These instructions
assume that you also enable <code>mod_userdir</code>, and use
<code>$HOME/public_html</code> as the location.

</li><li>
Build the online docs and website:

<blockquote><pre class="example">make WEB_TARGETS=&quot;offline online&quot; doc
make website
</pre></blockquote>

<p>This will make all the language variants of the website.  To save
a little time, just the English version can be made with the
command <code>make WEB_LANGS='' website</code> or the English and (for
example) the French with <code>make WEB_LANGS='fr' website</code>.
</p>
</li><li>
Move the built stuff into those directories.  It&rsquo;s highly
recommended to have your build dir and www dir on the same
partition.  (make <code>$HOME/public_html/</code> a symlink if
necessary)

<blockquote><pre class="example">mv out-website/website/ $HOME/public_html
mv $HOME/public_html/website/pictures $HOME/public_html/
mkdir -p $HOME/public_html/doc/v2.13/
mv out-www/online-root/* $HOME/public_html/doc/v2.13/
</pre></blockquote>

</li></ul>


<hr size="6">
<a name="Translating-the-website"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#website-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Website work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#lsr-work" title="Next chapter">&nbsp;LSR work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#debugging-website-and-docs-locally" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Debugging website and docs locally&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#website-work" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Website work&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#lsr-work" title="Next section in reading order" accesskey="n" rel="next">&nbsp;LSR work &gt; </a>]</td></tr></table>
<a name="translating-the-website"></a>
<h2 class="section">6.4 Translating the website</h2>

<p>As it has much more audience, the website should be translated before
the documentation; see <a href="#translating-the-documentation">Translating the documentation</a>.
</p>
<p>In addition to the normal documentation translation practices,
there are a few additional things to note:
</p>
<ul>
<li>
Build the website with:

<blockquote><pre class="example">make website
</pre></blockquote>

<p>however, please note that this command is not designed for being
run multiple times.  If you see unexpected output (mainly the page
footers getting all messed up), then delete your
&lsquo;<tt>out-website</tt>&rsquo; directory and run <code>make website</code> again.
</p>
</li><li>
Some of the translation infrastructure is defined in python files;
you must look at the <code>### translation data</code> sections in:

<blockquote><pre class="example">scripts/build/create-weblinks-itexi.py
scripts/build/website_post.py
</pre></blockquote>

</li><li>
Translations are not included by default in <code>make website</code>.
To test your translation, edit the <code>WEB_LANGUAGES =</code> line in
&lsquo;<tt>python/langdefs.py</tt>&rsquo;.  You will need to copy this updated
script to <code>$LILYPOND_BUILD_DIR/python/out</code>.

<p>Do not submit a patch to add your language to this file unless
<code>make website</code> completes with fewer than 5 warnings.
</p>
</li><li>
Links to manuals are done with macros like
<code>@manualDevelLearningSplit</code>.  To get translated links, you
must change that to <code>@manualDevelLearningSplit-es</code> (for
es/Spanish translations, for example).

</li></ul>



<hr size="6">
<a name="LSR-work"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#website-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Website work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#issues" title="Next chapter">&nbsp;Issues &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#translating-the-website" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Translating the website&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#index" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Top&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#introduction-to-lsr" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Introduction to LSR &gt; </a>]</td></tr></table>
<a name="lsr-work"></a>
<h1 class="chapter">7. LSR work</h1>

<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#introduction-to-lsr" accesskey="1">7.1 Introduction to LSR</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#adding-and-editing-snippets" accesskey="2">7.2 Adding and editing snippets</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#approving-snippets" accesskey="3">7.3 Approving snippets</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#lsr-to-git" accesskey="4">7.4 LSR to Git</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#fixing-snippets-in-lilypond-sources" accesskey="5">7.5 Fixing snippets in LilyPond sources</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#renaming-a-snippet" accesskey="6">7.6 Renaming a snippet</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#updating-the-lsr-to-a-new-version" accesskey="7">7.7 Updating the LSR to a new version</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>


<hr size="6">
<a name="Introduction-to-LSR"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#lsr-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; LSR work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#issues" title="Next chapter">&nbsp;Issues &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#lsr-work" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; LSR work&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#lsr-work" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;LSR work&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#adding-and-editing-snippets" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Adding and editing snippets &gt; </a>]</td></tr></table>
<a name="introduction-to-lsr"></a>
<h2 class="section">7.1 Introduction to LSR</h2>

<p>The
<a href="http://lsr.dsi.unimi.it">LilyPond Snippet Repository (LSR)</a>
is a collection of lilypond examples.  A subset of these examples
are automatically imported into the documentation, making it easy
for users to contribute to the docs without learning Git and
Texinfo.
</p>

<hr size="6">
<a name="Adding-and-editing-snippets"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#lsr-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; LSR work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#issues" title="Next chapter">&nbsp;Issues &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#introduction-to-lsr" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Introduction to LSR&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#lsr-work" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;LSR work&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#approving-snippets" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Approving snippets &gt; </a>]</td></tr></table>
<a name="adding-and-editing-snippets"></a>
<h2 class="section">7.2 Adding and editing snippets</h2>

<a name="General-guidelines"></a>
<h3 class="subheading">General guidelines</h3>

<p>When you create (or find!) a nice snippet, if it is supported by
the LilyPond version running on the LSR, please add it to the LSR.
Go to <a href="http://lsr.dsi.unimi.it">LSR</a> and log in &ndash; if you haven&rsquo;t
already, create an account.  Follow the instructions on the website.
These instructions also explain how to modify existing snippets.
</p>
<p>If you think the snippet is particularly informative and you think it
should be included in the documentation, tag it with &ldquo;docs&rdquo; and one
or more other categories, or ask on the development list for
somebody who has editing permissions to do it .
</p>
<p>Please make sure that the lilypond code follows the guidelines in
<a href="#lilypond-formatting">LilyPond formatting</a>.
</p>
<p>If a new snippet created for documentation purposes compiles with
LilyPond version currently on LSR, it should be added to LSR, and a
reference to the snippet should be added to the documentation.
Please ask a documentation editor to add a reference to it in an
appropriate place in the docs.  (Note &ndash; it should appear in the
snippets document automatically, once it has been imported into
git and built.  See <a href="#lsr-to-git">LSR to Git</a>.
</p>
<p>If the new snippet uses new features that are not available in the
current LSR version, the snippet should be added to
&lsquo;<tt>Documentation/snippets/new</tt>&rsquo; and a reference should be added to the
manual.
</p>
<p>Snippets created or updated in &lsquo;<tt>Documentation/snippets/new</tt>&rsquo; should
be copied to &lsquo;<tt>Documentation/snippets</tt>&rsquo; by invoking at top of the
source tree
</p>
<blockquote><pre class="example">scripts/auxiliar/makelsr.py
</pre></blockquote>

<p>Be sure that <code>make doc</code> runs successfully before submitting a
patch, to prevent breaking compilation.
</p>
<a name="Formatting-snippets-in-Documentation_002fsnippets_002fnew"></a>
<h3 class="subheading">Formatting snippets in &lsquo;<tt>Documentation/snippets/new</tt>&rsquo;</h3>

<p>When adding a file to this directory, please start the file with
</p>
<blockquote><pre class="example">\version &quot;2.x.y&quot;
\header {
% Use existing LSR tags other than 'docs'; see makelsr.py for
% the list of tags used to sort snippets.  E.g.:
  lsrtags = &quot;rhythms,expressive-marks&quot;
% This texidoc string will be formatted by Texinfo
  texidoc = &quot;
This code demonstrates ...
&quot;
% Please put doctitle last so that the '% begin verbatim'
% mark will be added correctly by makelsr.py.
  doctitle = &quot;Snippet title&quot;
}
</pre></blockquote>

<p>and name the file &lsquo;<tt>snippet-title.ly</tt>&rsquo;.
</p>
<p>Please ensure that the version number you use at the top of the
example is the minimum version that the file will compile with:
for example, if the LSR is currently at 2.14.2 and your example
requires 2.15.30, but the current development version of
<code>lilypond</code> is 2.17.5, put <code>\version &quot;2.15.30&quot;</code> in the
example.
</p>
<p>Please also pay particular attention to the lines beginning
<code>lsrtags = </code> and <code>doctitle =</code>.  The tags must match tags used
in the documentation, and the <code>doctitle</code> must match the
filename.
</p>
<hr size="6">
<a name="Approving-snippets"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#lsr-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; LSR work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#issues" title="Next chapter">&nbsp;Issues &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#adding-and-editing-snippets" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Adding and editing snippets&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#lsr-work" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;LSR work&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#lsr-to-git" title="Next section in reading order" accesskey="n" rel="next">&nbsp;LSR to Git &gt; </a>]</td></tr></table>
<a name="approving-snippets"></a>
<h2 class="section">7.3 Approving snippets</h2>

<p>The main task of LSR editors is approving snippets.  To find a list of
unapproved snippets, log into <a href="http://lsr.dsi.unimi.it">LSR</a> and
select &ldquo;No&rdquo; from the dropdown menu to the right of the word
&ldquo;Approved&rdquo; at the bottom of the interface, then click
&ldquo;Enable filter&rdquo;.
</p>
<p>Check each snippet:
</p>
<ol>
<li>
Does the snippet make sense and does what the author claims that
it does?  If you think the snippet is particularly helpful, add
the &ldquo;docs&rdquo; tag and at least one other tag.

</li><li>
If the snippet is tagged with &ldquo;docs&rdquo;, check to see if it
matches our guidelines for <a href="#lilypond-formatting">LilyPond formatting</a>.

<p>Also, snippets tagged with &ldquo;docs&rdquo; should not be explaining
(replicating) existing material in the docs.  They should not
refer to the docs; the docs should refer to them.
</p>
</li><li>
If the snippet uses scheme, check that everything looks good and
there are no security risks.

<div class="warning"><p><strong>Note:</strong> Somebody could sneak a <code>#'(system &quot;rm -rf /&quot;)</code>
command into our source tree if you do not do this!  Take this
step <strong>VERY SERIOUSLY</strong>.
</p>
</div>
</li><li>
If all is well, check the box labelled &ldquo;approved&rdquo; and save the
snippet.

</li></ol>


<hr size="6">
<a name="LSR-to-Git"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#lsr-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; LSR work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#issues" title="Next chapter">&nbsp;Issues &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#approving-snippets" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Approving snippets&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#lsr-work" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;LSR work&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#fixing-snippets-in-lilypond-sources" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Fixing snippets in LilyPond sources &gt; </a>]</td></tr></table>
<a name="lsr-to-git"></a>
<h2 class="section">7.4 LSR to Git</h2>

<a name="Introduction"></a>
<h3 class="subheading">Introduction</h3>
<p>Snippets used in the documentation are in
&lsquo;<tt>$LILYPOND_GIT/Documentation/snippets</tt>&rsquo;.  This directory
contains a complete set of the snippets in the LSR which are
tagged with &rsquo;docs&rsquo;.  The exact method for getting them there is
described below, but in essence they come from downloading a
tarball from the LSR and importing into the directory using the
<code>makelsr</code> script.
</p>
<p>Any snippets which are too bleeding edge to run on the LSR (which
uses a stable development version) are put into
&lsquo;<tt>$LILYPOND_GIT/Documentation/snippets/new</tt>&rsquo;.  Once the LSR has
been upgraded so that these will run, then they are transferred to
the LSR and deleted from &lsquo;<tt>/snippets/new</tt>&rsquo;.
</p>
<p>&rsquo;Git&rsquo; is the shorthand name for the Git repository that contains
all the development code.  For further information on setting this
up see, <a href="#working-with-source-code">Working with source code</a>.  An alternative to setting
up a Git repository for people wanting to do LSR work is to get
the source code from
<a href="http://lilypond.org/website/development.html">http://lilypond.org/website/development.html</a>.
</p>
<a name="Importing-the-LSR-to-Git"></a>
<h3 class="subheading">Importing the LSR to Git</h3>

<ol>
<li>
Make sure that <code>convert-ly</code> script and the <code>lilypond</code>
binary are a bleeding edge version &ndash; the latest release or even
better, a fresh snapshot from Git master, with the environment
variable <code>LILYPOND_BUILD_DIR</code> correctly set up, see
<a href="#environment-variables">Environment variables</a>.

</li><li>
Start by creating a list of updated snippets from your local
repository.  From the top source directory, run:

<blockquote><pre class="example">scripts/auxiliar/makelsr.py
</pre></blockquote>

<p>Commit the changes and make a patch.  Check the patch has nothing
other than minor changes.  If all is good and you&rsquo;re confident in what
you&rsquo;ve done, this can be pushed directly to staging.
</p>
</li><li>
Next, download the updated snippets and run <code>makelsr.py</code>
against them.  From the top source directory, run:

<table><tr><td>&nbsp;</td><td><pre class="smallexample">wget http://lsr.dsi.unimi.it/download/lsr-snippets-docs-`date +%F`.tar.gz
tar -xzf lsr-snippets-docs-`date +%F`.tar.gz
make -C $LILYPOND_BUILD_DIR
scripts/auxiliar/makelsr.py lsr-snippets-docs-`date +%F`
</pre></td></tr></table>

<p>where <code>date +%F</code> gives the current date in format
<var>YYYY-MM-DD</var> (the snippets archive is usually generated around
03:50 CET, you may want to use <code>date -d yesterday +%F</code>
instead, depending on your time zone and the time you run this
commands sequence).  <code>make</code> is included in this sequence so
that <code>makelsr</code> can run <code>lilypond</code> and
<code>convert-ly</code> versions that match current source tree; you can
select different binaries if desired or needed, to see options for
this do
</p>
<table><tr><td>&nbsp;</td><td><pre class="smallexample">scripts/auxiliar/makelsr.py --help
</pre></td></tr></table>

</li><li>
Follow the instructions printed on the console to manually check for
unsafe files.  These are:

<blockquote><pre class="example">Unsafe files printed in lsr-unsafe.txt: CHECK MANUALLY!
  git add Documentation/snippets/*.ly
  xargs git diff HEAD &lt; lsr-unsafe.txt
</pre></blockquote>

<p>First, it&rsquo;s important to check for any added files and add them to
the files git is tracking.  Run <code>git status</code> and look
carefully to see if files have been added.  If so, add them with
<code>git add</code>.
</p>
<p>As the console says, <code>makelsr</code> creates a list of possibly
unsafe files in &lsquo;<tt>lsr-unsafe.txt</tt>&rsquo; by running <code>lilypond</code>
against each snippet using the <code>-dsafe</code> switch.  This list can be
quite long.  However, by using the command <code>xargs git diff HEAD &lt;
lsr-unsafe.txt</code> git will take that list and check whether any of the
snippets are different from the snippet already in master.  If any is
different it must be checked manually VERY CAREFULLY.
</p>
<div class="warning"><p><strong>Note:</strong> Somebody could sneak a <code>#'(system &quot;rm -rf /&quot;)</code>
command into our source tree if you do not do this!  Take this
step <strong>VERY SERIOUSLY</strong>.
</p>
</div>
<p>If there is any doubt about any of the files, you are strongly
advised to run a review on Rietveld.
</p>
</li><li>
If a Review is not needed, commit the changes and push to
<code>staging</code>.

</li></ol>

<p>Note that whenever there is a snippet in
&lsquo;<tt>Documentation/snippets/new</tt>&rsquo; and another from the LSR with
the same file name, <code>makelsr.py</code> will overwrite the LSR
version with the one from &lsquo;<tt>Documentation/snippets/new</tt>&rsquo;.
</p>

<hr size="6">
<a name="Fixing-snippets-in-LilyPond-sources"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#lsr-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; LSR work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#issues" title="Next chapter">&nbsp;Issues &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#lsr-to-git" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; LSR to Git&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#lsr-work" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;LSR work&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#renaming-a-snippet" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Renaming a snippet &gt; </a>]</td></tr></table>
<a name="fixing-snippets-in-lilypond-sources"></a>
<h2 class="section">7.5 Fixing snippets in LilyPond sources</h2>

<p>If some snippet from &lsquo;<tt>Documentation/snippets</tt>&rsquo; causes the
documentation compilation to fail, the following steps should be
followed to fix it reliably.
</p>
<ol>
<li>
Look up the snippet filename &lsquo;<tt><var>foo</var>.ly</tt>&rsquo; in the error output
or log, then fix the file &lsquo;<tt>Documentation/snippets/<var>foo</var>.ly</tt>&rsquo; to make the
documentation build successfully.

</li><li>
Determine where it comes from by looking at its first two lines,
e.g. run

<blockquote><pre class="example">head -2 Documentation/snippets/<var>foo</var>.ly
</pre></blockquote>

</li><li>
<strong>If the snippet comes from the LSR</strong>, also apply the fix to the
snippet in the LSR and send a notification email to an LSR editor with CC to
the development list &ndash; see <a href="#adding-and-editing-snippets">Adding and editing snippets</a>.  The
failure may sometimes not be caused by the snippet in LSR but by the
syntax conversion made by <code>convert-ly</code>; in this case, try to fix
<code>convert-ly</code> or report the problem on the development list, then
run <code>makelsr.py</code> again, see <a href="#lsr-to-git">LSR to Git</a>.  In some cases,
when some features has been introduced or vastly changed so it requires
(or takes significant advantage of) important changes in the snippet, it
is simpler and recommended to write a new version of the snippet in
&lsquo;<tt>Documentation/snippets/new</tt>&rsquo;, then run <code>makelsr.py</code>.

</li><li>
<strong>If the snippet comes from</strong> &lsquo;<tt>Documentation/snippets/new</tt>&rsquo;,
apply the fix in &lsquo;<tt>Documentation/snippets/new/<var>foo</var>.ly</tt>&rsquo;, then
run <code>makelsr.py</code> without argument from top of the source tree:

<blockquote><pre class="example">scripts/auxiliar/makelsr.py
</pre></blockquote>

<p>Then, inspect &lsquo;<tt>Documentation/snippets/<var>foo</var>.ly</tt>&rsquo; to check that
the fix has been well propagated.
</p>
<p>If the build failure was caused by a translation string, you may have
to fix some &lsquo;<tt>Documentation/<var>lang</var>/texidocs/<var>foo</var>.texidoc</tt>&rsquo;
instead; in case the build failure comes only from translation
strings, it is not needed to run <code>makelsr.py</code>.
</p>
</li><li>
When you&rsquo;ve done, commit your changes to Git and ensure they&rsquo;re
pushed to the correct branch.

</li></ol>


<hr size="6">
<a name="Renaming-a-snippet"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#lsr-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; LSR work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#issues" title="Next chapter">&nbsp;Issues &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#fixing-snippets-in-lilypond-sources" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Fixing snippets in LilyPond sources&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#lsr-work" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;LSR work&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#updating-the-lsr-to-a-new-version" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Updating the LSR to a new version &gt; </a>]</td></tr></table>
<a name="renaming-a-snippet"></a>
<h2 class="section">7.6 Renaming a snippet</h2>

<p>Due to the potential duality of snippets (i.e. they may exist both
in the LSR database, and in <code>Documentation/snippets/new/</code>),
this process is a bit more involved than we might like.
</p>
<ol>
<li>
Send an email LSR editor, requesting the renaming.

</li><li>
The LSR editor does the renaming (or debates the topic with you),
then warns the LSR-to-git person (wanted: better title) about the
renaming.

</li><li>
LSR-to-git person does his normal job, but then also renames any
copies of the snippets in <code>Documentation/snippets/new/</code>, and
any instances of the snippet name in the documentation.

<p><code>git grep</code> is highly recommended for this task.
</p>
</li></ol>


<hr size="6">
<a name="Updating-the-LSR-to-a-new-version"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#lsr-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; LSR work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#issues" title="Next chapter">&nbsp;Issues &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#renaming-a-snippet" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Renaming a snippet&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#lsr-work" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;LSR work&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#issues" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Issues &gt; </a>]</td></tr></table>
<a name="updating-the-lsr-to-a-new-version"></a>
<h2 class="section">7.7 Updating the LSR to a new version</h2>

<p>To update the LSR, perform the following steps:
</p>
<ol>
<li>
Start by emailing the LSR maintainer, Sebastiano, and liaising
with him to ensure that updating the snippets is synchronised with
updating the binary running the LSR.

</li><li>
Download the latest snippet tarball from
<a href="http://lsr.dsi.unimi.it/download">http://lsr.dsi.unimi.it/download/</a> and extract it.
The relevant files can be found in the &lsquo;<tt>all</tt>&rsquo; subdirectory.
Make sure your shell is using an English language version, for
example <code>LANG=en_US</code>, then run <code>convert-ly</code> on all
the files.  Use the command-line option <code>--to=version</code> to
ensure the snippets are updated to the correct stable version.

</li><li>
Make sure that you are using <code>convert-ly</code> from the latest
available release to gain best advantage from the latest
<code>converting-rules-updates</code>.

<p>For example:
</p>
<ul>
<li>
LSR-version: 2.12.2
</li><li>
intended LSR-update to 2.14.2
</li><li>
latest release 2.15.30

</li></ul>

<p>Use convert-ly from 2.15.30 and the following terminal command
for all files:
</p>
<blockquote><pre class="example">convert-ly -e -t2.14.2 *.ly
</pre></blockquote>

</li><li>
There might be no conversion rule for some old commands. To make
an initial check for possible problems you can run the following
script on a copy of the &lsquo;<tt>all</tt>&rsquo; subdirectory:

<blockquote><pre class="example">#!/bin/bash

for LILYFILE in *.ly
do
  STEM=$(basename &quot;$LILYFILE&quot; .ly)
  echo &quot;running $LILYFILE...&quot;
  convert-ly -e -t&lt;version&gt; &quot;$LILYFILE&quot; &gt;&amp; &quot;$STEM&quot;.txt
done

grep refer *.txt
grep smart *.txt
TODO: better script
</pre></blockquote>

</li><li>
Copy relevant snippets (i.e. snippets whose version is equal to
or less than the new version of LilyPond running on the LSR) from
&lsquo;<tt>Documentation/snippets/new/</tt>&rsquo; into the set of files to be
used to make the tarball.  Make sure
you only choose snippets which are already present in the LSR,
since the LSR software isn&rsquo;t able to create new snippets this way.
If you don&rsquo;t have a Git repository for LilyPond, you&rsquo;ll find these
snippets in the source-tarball on
<a href="http://lilypond.org/website/development.html">http://lilypond.org/website/development.html</a>.
Don&rsquo;t rename any files at this stage.

</li><li>
Verify that all files compile with the new version of LilyPond,
ideally without any warnings or errors.  To ease the process,
you may use the shell script that appears after this list.

<p>Due to the workload involved, we <em>do not</em> require that you
verify that all snippets produce the expected output.  If you
happen to notice any such snippets and can fix them, great; but as
long as all snippets compile, don&rsquo;t delay this step due to some
weird output.  If a snippet is not compiling, update it manually.
If it&rsquo;s not possible, delete it for now.
</p>
</li><li>
Remove all headers and version-statements from the files.  Phil
Holmes has a <code>python</code> script that will do this and which
needs testing.  Please ask him for a copy if you wish to do this.

</li><li>
Create a tarball and send it back to Sebastiano. Don&rsquo;t forget to
tell him about any deletions.

</li><li>
Use the LSR web interface to change any descriptions you want to.
Changing the titles of snippets is a bit fraught, since this also
changes the filenames.  Only do this as a last resort.

</li><li>
Use the LSR web interface to add the other snippets from
&lsquo;<tt>Documentation/snippets/new/</tt>&rsquo; which compile with the new
LilyPond version of the LSR.  Ensure that they are correctly
tagged, including the tag <code>docs</code> and that they are approved.

</li><li>
When LSR has been updated, wait a day for the tarball to update,
then download another snippet tarball. Verify that
the relevant snippets from &lsquo;<tt>Documentation/snippets/new/</tt>&rsquo; are
now included, then delete those snippets from
&lsquo;<tt>Documentation/snippets/new/</tt>&rsquo;.

</li><li>
Commit all the changes.  <em>Don&rsquo;t forget to add new files to
the git repository with <code>git add</code></em>.  Run <code>make</code>,
<code>make doc</code> and
<code>make test</code> to ensure the changes don&rsquo;t break the build. Any
snippets that have had their file name changed or have been
deleted could break the build, and these will need correcting
step by step.

</li></ol>


<p>Below is a shell script to run all &lsquo;<tt>.ly</tt>&rsquo; files in a directory
and redirect terminal output to text files, which are then
searched for the word &quot;failed&quot; to see which snippets do not compile.
</p>
<table><tr><td>&nbsp;</td><td><pre class="smallexample">#!/bin/bash

for LILYFILE in *.ly
do
  STEM=$(basename &quot;$LILYFILE&quot; .ly)
  echo &quot;running $LILYFILE...&quot;
  lilypond --format=png -ddelete-intermediate-files &quot;$LILYFILE&quot; &gt;&amp; &quot;$STEM&quot;.txt
done

grep failed *.txt
TODO: better script
</pre></td></tr></table>

<p>Sometimes <code>grep failed *.txt</code> will not discover all
problematic files. In addition you may want to use:
</p>
<blockquote><pre class="example">grep ERROR *.txt
grep error *.txt
grep warning *.txt
</pre></blockquote>
<hr size="6">
<a name="Issues"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#lsr-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; LSR work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#regression-tests" title="Next chapter">&nbsp;Regression tests &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#updating-the-lsr-to-a-new-version" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Updating the LSR to a new version&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#index" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Top&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#introduction-to-issues" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Introduction to issues &gt; </a>]</td></tr></table>
<a name="issues"></a>
<h1 class="chapter">8. Issues</h1>

<p>This chapter deals with defects, feature requests, and
miscellaneous development tasks.
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#introduction-to-issues" accesskey="1">8.1 Introduction to issues</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#bug-squad-overview" accesskey="2">8.2 Bug Squad overview</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#bug-squad-setup" accesskey="3">8.3 Bug Squad setup</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#bug-squad-checklists" accesskey="4">8.4 Bug Squad checklists</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#issue-classification" accesskey="5">8.5 Issue classification</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#adding-issues-to-the-tracker" accesskey="6">8.6 Adding issues to the tracker</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#patch-handling" accesskey="7">8.7 Patch handling</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#summary-of-project-status" accesskey="8">8.8 Summary of project status</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>


<hr size="6">
<a name="Introduction-to-issues"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#issues" title="Beginning of this chapter or previous chapter"> &lt;&lt; Issues&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#regression-tests" title="Next chapter">&nbsp;Regression tests &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#issues" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Issues&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#issues" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Issues&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#bug-squad-overview" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Bug Squad overview &gt; </a>]</td></tr></table>
<a name="introduction-to-issues"></a>
<h2 class="section">8.1 Introduction to issues</h2>

<div class="warning"><p><strong>Note:</strong> Unless otherwise specified, all the tasks in this chapter
are &ldquo;simple&rdquo; tasks: they can be done by a normal user with
nothing more than a web browser, email, and lilypond.
</p>
</div>
<p>&ldquo;Issues&rdquo; isn&rsquo;t just a politically-correct term for &ldquo;bug&rdquo;.
We use the same tracker for feature requests, code TODOs and
patches, so the term &ldquo;bug&rdquo; wouldn&rsquo;t be accurate.  Despite the
difference between &ldquo;issue&rdquo; and &ldquo;bug&rdquo;, we call our team of
contributors who organize issues the <em>Bug Squad</em>.
</p>
<p>The Bug Squad is mainly composed of non-programmers &ndash; their job
is to <em>organize</em> issues, not solve them.  Their duties
include removing false bug reports, ensuring that any real bug
report contains enough information for developers, and checking
that a developer&rsquo;s fix actually resolves the problem.
</p>
<p>New volunteers for the Bug Squad should contact the
<a href="#meisters">Bug Meister</a>.
</p>
<hr size="6">
<a name="Bug-Squad-overview"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#issues" title="Beginning of this chapter or previous chapter"> &lt;&lt; Issues&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#regression-tests" title="Next chapter">&nbsp;Regression tests &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#introduction-to-issues" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Introduction to issues&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#issues" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Issues&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#bug-squad-setup" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Bug Squad setup &gt; </a>]</td></tr></table>
<a name="bug-squad-overview"></a>
<h2 class="section">8.2 Bug Squad overview</h2>

<p>The Bug Squad are volunteers who progress issue tracking using the
Google Issue tracker at
</p>
<blockquote><pre class="example"><a href="http://code.google.com/p/lilypond/issues/list">http://code.google.com/p/lilypond/issues/list</a>
</pre></blockquote>

<p>Bug Squad members have 2 primary responsiblities:
</p>
<ol>
<li>
Monitoring the LilyPond Bugs mailing list and adding to the
tracker any new issues reported there.

</li><li>
Verifying issues that are claimed fixed by a developer, to ensure
that the fix works, and is actually in the code base.

</li></ol>

<p>It&rsquo;s also part of the Bug Squad&rsquo;s responsibility to check that
the Regression Tests don&rsquo;t show up any problems in the latest
release.  The Bug Meister currently does this.
</p>
<p>All of this is explained in more detail in the following sections.
</p>
<hr size="6">
<a name="Bug-Squad-setup"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#issues" title="Beginning of this chapter or previous chapter"> &lt;&lt; Issues&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#regression-tests" title="Next chapter">&nbsp;Regression tests &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#bug-squad-overview" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Bug Squad overview&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#issues" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Issues&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#bug-squad-checklists" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Bug Squad checklists &gt; </a>]</td></tr></table>
<a name="bug-squad-setup"></a>
<h2 class="section">8.3 Bug Squad setup</h2>

<p>We highly recommend that you configure your email to use effective
sorting; this can reduce your workload <em>immensely</em>.  The
email folders names were chosen specifically to make them work if
you sort your folders alphabetically.
</p>
<ol>
<li>
Read every section of this chapter, <a href="#issues">Issues</a>.

</li><li>
If you do not have one already, create a gmail account and send
the email address to the <a href="#meisters">Bug Meister</a>.

</li><li>
Subscribe your gmail account to <code>bug-lilypond</code>.

</li><li>
Configure your google code account:

<ol>
<li>
Wait until your gmail account is listed in:

<blockquote><pre class="example"><a href="http://code.google.com/p/lilypond/people/list">http://code.google.com/p/lilypond/people/list</a>
</pre></blockquote>

</li><li>
Sign in to google code by clicking in the top-right corner of:

<blockquote><pre class="example"><a href="http://code.google.com/p/lilypond/issues/list">http://code.google.com/p/lilypond/issues/list</a>
</pre></blockquote>

<p>You cannot log on if you have Google Sharing enabled
<a href="http://www.googlesharing.net">http://www.googlesharing.net/</a>.
</p>
</li><li>
Go to your &ldquo;Profile&rdquo;, and select &ldquo;Settings&rdquo;.

</li><li>
Scroll down to &ldquo;Issue change notification&rdquo;, and make sure that
you have <em>selected</em> &ldquo;If I starred the issue&rdquo;.

</li></ol>

</li><li>
Configure your email client:

<ol>
<li>
Any email sent with your gmail address in the <code>To:</code> or
<code>CC:</code> fields should go to a <code>bug-answers</code> folder.

<p>When setting up your filtering rules, be aware that Google Code
might use different versions of your email address, such as ones
ending in <code>@googlemail.com</code> or <code>@gmail.com</code>.
</p>
</li><li>
Any other email either from, or CC&rsquo;d to,

<blockquote><pre class="example">lilypond@googlecode.com
</pre></blockquote>

<p>should go into a separate <code>bug-ignore</code> folder.  Alternately,
you may automatically delete these emails.
</p>
<p>You will <strong>not read</strong> these emails as part of your Bug Squad
duties.  If you are curious, go ahead and read them later, but it
does <strong>not</strong> count as Bug Squad work.
</p>
</li><li>
Any other email sent to (or CC&rsquo;d to):

<blockquote><pre class="example">bug-lilypond
</pre></blockquote>

<p>should go into a separate <code>bug-current</code> folder.
</p>
</li></ol>

</li></ol>


<hr size="6">
<a name="Bug-Squad-checklists"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#issues" title="Beginning of this chapter or previous chapter"> &lt;&lt; Issues&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#regression-tests" title="Next chapter">&nbsp;Regression tests &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#bug-squad-setup" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Bug Squad setup&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#issues" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Issues&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#issue-classification" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Issue classification &gt; </a>]</td></tr></table>
<a name="bug-squad-checklists"></a>
<h2 class="section">8.4 Bug Squad checklists</h2>

<p>When you do Bug Squad work, start at the top of this page and work
your way down.  Stop when you&rsquo;ve done 20 minutes.
</p>
<p>Please use the email sorting described in <a href="#bug-squad-setup">Bug Squad setup</a>.
This means that (as Bug Squad members) you will only ever respond
to emails sent or CC&rsquo;d to the <code>bug-lilypond</code> mailing list.
</p>

<a name="Emails-to-you-personally"></a>
<h4 class="subsubheading">Emails to you personally</h4>

<p>You are not expected to work on Bug Squad matters outside of your
20 minutes, but sometimes a confused user will send a bug report
(or an update to a report) to you personally.  If that happens,
please forward such emails to the <code>bug-lilypond</code> list so that
the currently-active Bug Squad member(s) can handle the message.
</p>

<a name="Daily-schedule"></a>
<h4 class="subsubheading">Daily schedule</h4>

<blockquote><pre class="example">Monday:    Colin H
Tuesday:   Eluze
Wednesday: Marek
Thursday:  Ralph
Friday:    Marek
Saturday:  Mark
Sunday:    Colin H
</pre></blockquote>


<a name="Emails-to-bug_002danswers"></a>
<h4 class="subsubheading">Emails to <code>bug-answers</code></h4>

<p>Some of these emails will be comments on issues that you added to
the tracker.
</p>
<ul>
<li>If they are asking for more information, give the additional
information.

</li><li>
If the email says that the issue was classified in some other
manner, read the rationale given and take that into account for
the next issue you add.

</li><li>
Otherwise, move them to your <code>bug-ignore</code> folder.

</li></ul>

<p>Some of these emails will be discussions about Bug Squad work;
read those.
</p>

<a name="Emails-to-bug_002dcurrent"></a>
<h4 class="subsubheading">Emails to <code>bug-current</code></h4>

<p>Dealing with these emails is your main task.  Your job is to get
rid of these emails in the first method which is applicable:
</p>
<ol>
<li>
If the email has already been handled by a Bug Squad member (i.e.
check to see who else has replied to it), delete it.

</li><li>
If the email is a question about how to use LilyPond, reply with
this response:

<blockquote><pre class="example">For questions about how to use LilyPond, please read our
documentation available from:
  <a href="http://lilypond.org/website/manuals.html">http://lilypond.org/website/manuals.html</a>
or ask the lilypond-user mailing list.
</pre></blockquote>

</li><li>
If the email mentions &ldquo;the latest git&rdquo;, or any version number
that has not yet been officially released, forward it to
<code>lilypond-devel</code>.

</li><li>
If a bug report is not in the form of a Tiny example, direct the
user to resubmit the report with this response:

<blockquote><pre class="example">I'm sorry, but due to our limited resources for handling bugs, we
can only accept reports in the form of Tiny examples.  Please see
step 2 in our bug reporting guidelines:
  <a href="http://lilypond.org/website/bug-reports.html">http://lilypond.org/website/bug-reports.html</a>
</pre></blockquote>

</li><li>
If anything is unclear, ask the user for more information.

<p>How does the graphical output differ from what the user expected?
What version of lilypond was used (if not given) and operating
system (if this is a suspected cause of the problem)?  In short,
if you cannot understand what the problem is, ask the user to
explain more.  It is the user&rsquo;s responsibility to explain the
problem, not your responsibility to understand it.
</p>
</li><li>
If the behavior is expected, the user should be told to read the
documentation:

<blockquote><pre class="example">I believe that this is the expected behaviour -- please read our
documentation about this topic.  If you think that it really is a
mistake, please explain in more detail.  If you think that the
docs are unclear, please suggest an improvement as described by
&ldquo;Simple tasks -- Documentation&rdquo; on:
  <a href="http://lilypond.org/website/help-us.html">http://lilypond.org/website/help-us.html</a>
</pre></blockquote>

</li><li>
If the issue already exists in the tracker, send an email to that
effect:

<blockquote><pre class="example">This issue has already been reported; you can follow the
discussion and be notified about fixes here:
</pre></blockquote>

<p>(copy+paste the google code issue URL)
</p>
</li><li>
Accept the report as described in
<a href="#adding-issues-to-the-tracker">Adding issues to the tracker</a>.

</li></ol>

<p>All emails should be CC&rsquo;d to the <code>bug-lilypond</code> list so that
other Bug Squad members know that you have processed the email.
</p>
<div class="warning"><p><strong>Note:</strong> There is no option for &ldquo;ignore the bug report&rdquo; &ndash; if
you cannot find a reason to reject the report, you must accept
it.
</p>
</div>



<a name="Regular-maintenance"></a>
<h3 class="subheading">Regular maintenance</h3>

<p>After <strong>every release</strong> (both stable and unstable):
</p>
<ul>
<li>
Issues to verify: go to

<blockquote><pre class="example"><a href="http://code.google.com/p/lilypond/issues/list?can=7">http://code.google.com/p/lilypond/issues/list?can=7</a>
</pre></blockquote>

<p>(You can also generate this list by selecting
&ldquo;Issues to verify&rdquo; from the drop-down list next to the search
box.)
</p>
<p>You should see a list of Issues that have been claimed fixed by a
developer.  If the developer has done their job properly, the
Issue should have a tag &ldquo;Fixed_mm_MM_ss&rdquo;, where mm is
the major version, MM the minor version and ss the current
release.  This will help you work out which you can verify - do
not verify any Issues where the claimed fixed build is not yet
released.  Work your way through these as follows:
</p>
<p>If the Issue refers to a bug, try to reproduce the bug with the latest
officially released version (not one you&rsquo;ve built yourself from
source); if the bug is no longer there, mark the
issue &ldquo;Verified&rdquo; (i.e. &ldquo;the fix has been verified to work&rdquo;).
</p>
<p>Quite a few of these will be issues tracking patches.  <strong>You
do not have to prove these patches work - simply that they have
been pushed into the code base.</strong>  The developer should have put
information similar to &ldquo;Pushed as as
d8fce1e1ea2aca1a82e25e47805aef0f70f511b9&rdquo; in the tracker.  The
long list of letters and numbers is called the &ldquo;committish&rdquo;.
Providing you can find this at the git tracker:
</p>
<blockquote><pre class="example"><a href="http://git.savannah.gnu.org/gitweb/?p=lilypond.git">http://git.savannah.gnu.org/gitweb/?p=lilypond.git</a>
</pre></blockquote>

<p>then you should mark the issue as verified.  A quick way of
finding these is to enter the committish at the following address:
</p>
<blockquote><pre class="example"><a href="http://philholmes.net/lilypond/git">http://philholmes.net/lilypond/git/</a>
</pre></blockquote>

<p>The Issue tracker also requires that any issues labelled as
&ldquo;Duplicate&rdquo; are also verified.  Check that the linked issue is
a duplicate and verify the issue.
</p>
<p>A few (approximately 10%) of the fixed issues relate to the
build system or fundamental architecture changes; there is no way
for you to verify these.  Leave those issues alone; somebody else
will handle them.
</p>
</li><li>
The official regression test comparison is online at:

<blockquote><pre class="example"><a href="http://lilypond.org/test">http://lilypond.org/test/</a>
</pre></blockquote>

<p>If anything has changed suspiciously,
ask if it was deliberate.  If the text output from LilyPond (the
logfile) changes, the differences will be displayed with a +
before text added to the logfile and - before any text removed
from the logfile.  This may or may not be suspicious.
</p>
<p>There is one test designed to produce output every time the
regtests are created. <code>test-output-distance.ly</code> creates
randomly spaced notes and will always have different output if the
regtest checker is working.
</p>
<p>More information is available from in
<a href="#precompiled-regression-tests">Precompiled regression tests</a>.
</p>
</li><li>
Check for any incorrectly-classified items in the tracker.  This
generally just means looking at the grid to see any items without
a Type.

</li></ul>




<hr size="6">
<a name="Issue-classification"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#issues" title="Beginning of this chapter or previous chapter"> &lt;&lt; Issues&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#regression-tests" title="Next chapter">&nbsp;Regression tests &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#bug-squad-checklists" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Bug Squad checklists&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#issues" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Issues&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#adding-issues-to-the-tracker" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Adding issues to the tracker &gt; </a>]</td></tr></table>
<a name="issue-classification"></a>
<h2 class="section">8.5 Issue classification</h2>

<p>The Bug Squad should classify issues according to the guidelines
given by developers.  Every issue should have a Status and Type;
the other fields are optional.
</p>
<a name="Status-_0028mandatory_0029"></a>
<h3 class="subheading">Status (mandatory)</h3>

<p>Open issues:
</p>
<ul>
<li>
New: the item was added by a non-member, despite numerous warnings
not to do this.  Should be reviewed by a member of the Bug Squad.

</li><li>
Accepted: the Bug Squad added it, or reviewed the item.

</li><li>
Started: a contributor is working on a fix.  Owner should change
to be this contributor.

</li></ul>


<p>Closed issues:
</p>
<ul>
<li>
Invalid: issue should not have been added in the current state.

</li><li>
Duplicate: issue already exists in the tracker.

</li><li>
Fixed: a contributor claims to have fixed the bug.  The Bug
Squad should check the fix with the next official binary release
(not by compiling the source from git).  Owner should be set to
that contributor.

</li><li>
Verified: Bug Squad has confirmed that the issue is closed.  This
means that nobody should ever need look at the report again &ndash; if
there is any information in the issue that should be kept, open a
new issue for that info.

</li></ul>


<a name="Owner-_0028optional_0029"></a>
<h3 class="subheading">Owner (optional)</h3>

<p>Newly-added issues should have <em>no owner</em>.  When a
contributor indicates that he has Started or Fixed an item, he
should become the owner.
</p>

<a name="Type-_0028mandatory_0029"></a>
<h3 class="subheading">Type (mandatory)</h3>

<p>The issue&rsquo;s Type should be the first relevant item in this list.
</p>
<ul>
<li>
Type-Critical: normally a regression
against the current stable version or the previous stable version.
Alternatively, a regression against a fix developed for the
current version. This does not apply where the
&ldquo;regression&rdquo; occurred because a feature was removed
deliberately - this is not a bug.

<p>Currently, only Critical items will block a stable release.
</p>
</li><li>
Type-Maintainability: hinders future development.

</li><li>
Type-Crash: any input which produces a crash.

</li><li>
Type-Ugly: overlapping or other ugly notation in graphical output.

</li><li>
Type-Defect: a problem in the core program.  (the <code>lilypond</code>
binary, scm files, fonts, etc).

</li><li>
Type-Documentation: inaccurate, missing, confusing, or desired
additional info.  Must be fixable by editing a texinfo, ly, or scm
file.

</li><li>
Type-Build: problem or desired features in the build system.  This
includes the makefiles, stepmake, python scripts, and GUB.

</li><li>
Type-Scripts: problem or desired feature in the non-build-system
scripts.  Mostly used for convert-ly, lilypond-book, etc.

</li><li>
Type-Enhancement: a feature request for the core program.  The
distinction between enhancement and defect isn&rsquo;t extremely clear;
when in doubt, mark it as enhancement.

</li><li>
Type-Patch: tracking a patch on Rietveld.  Bug squad should not
need to use this label.

</li><li>
Type-Other: anything else.

</li></ul>


<a name="Opsys-_0028optional_0029"></a>
<h3 class="subheading">Opsys (optional)</h3>

<p>Issues that only affect specific operating systems.
</p>
<a name="Patch-label-_0028optional_0029"></a>
<h3 class="subheading">Patch label (optional)</h3>

<p>Normal Bug Squad members should not add or modify Patch issues
except to verify them; for all other Patch work, leave them to the
Patch Meister.
</p>
<ul>
<li>
Patch-new: the patch has not been checked for &ldquo;obvious&rdquo;
mistakes.  When in doubt, use this tag.

</li><li>
Patch-review: the patch has no &ldquo;obvious&rdquo; mistakes (as checked
by the Patch Meister), and is ready for review from main
developers.

<p>Developers with git push ability can use this category, skipping
over <code>patch-new</code>.
</p>
</li><li>
Patch-needs_work: a developer has some concerns about the patch.
This does not necessarily mean that the patch must be changed; in
some cases, the developer&rsquo;s concerns can be resolved simply by
discussion the situation or providing notation examples.

<p>If the patch is updated, the category should be changed to
<code>patch-new</code> (for normal contributors) or <code>patch-review</code>
(for developers who are very confident about their patch).
</p>
</li><li>
Patch-countdown: final call for any patch problems

</li><li>
Patch-push: patch has passed the countdown and should be pushed.

</li><li>
Patch-abandoned: the author has not responded to review comments
for a few months.

</li></ul>

<a name="Other-items-_0028optional_0029"></a>
<h3 class="subheading">Other items (optional)</h3>

<p>Other labels:
</p>
<ul>
<li>
Regression: it used to work intentionally in the current
stable release or the previous stable release.  If the earlier
output was accidental (i.e. we didn&rsquo;t try to stop a collision,
but it just so happened that two grobs didn&rsquo;t collide), then
breaking it does not count as a regression.

<p>To help decide whether the change is a regression, please adopt
the following process:
</p>
<ol>
<li>
Are you certain the change is OK?  If so, do nothing.

</li><li>
Are you certain that the change is bad?  Add it to the tracker
as a regression.

</li><li>
If you&rsquo;re not certain either way, add it to the tracker as a
regression but be aware that it may be recategorised or marked
invalid.

</li></ol>

<p>In particular, anything that breaks a regression test is a
regression.
</p>
</li><li>
Frog: the fix is believed to be suitable for a new contributor
(does not require a great deal of knowledge about LilyPond).  The
issue should also have an estimated time in a comment.

</li><li>
Bounty: somebody is willing to pay for the fix.  Only add this tag
if somebody has offered an exact figure in US dollars or euros.

</li><li>
Warning: graphical output is fine, but lilypond prints a
false/misleading warning message.  Alternately, a warning should
be printed (such as a bar line error), but was not.  Also applies
to warnings when compiling the source code or generating
documentation.

</li><li>
Security: security risk.

</li><li>
Performance: performance issue.

</li></ul>

<p>If you particularly want to add a label not in the list, go
ahead, but this is not recommended, except when an issue is marked
as fixed.  In this case it should be labeled Fixed_mm_MM_ss,
where mm is major version, MM minor version and ss current
release.
</p>

<hr size="6">
<a name="Adding-issues-to-the-tracker"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#issues" title="Beginning of this chapter or previous chapter"> &lt;&lt; Issues&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#regression-tests" title="Next chapter">&nbsp;Regression tests &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#issue-classification" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Issue classification&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#issues" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Issues&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#patch-handling" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Patch handling &gt; </a>]</td></tr></table>
<a name="adding-issues-to-the-tracker"></a>
<h2 class="section">8.6 Adding issues to the tracker</h2>

<div class="warning"><p><strong>Note:</strong> This should only be done by the Bug Squad or experienced
developers.  Normal users should not do this; instead, they should
follow the guidelines for <a name="index-Bug-reports-2"></a>
<a href="web-big-page.html#bug-reports">Bug reports</a>.
</p>
</div>
<p>In order to assign labels to issues, Bug Squad members should log
in to their google account before adding an item.
</p>
<ol>
<li>
Check if the issue falls into any previous category given on the
relevant checklists in <a href="#bug-squad-checklists">Bug Squad checklists</a>.  If in doubt,
add a new issue for a report.  We would prefer to have some
incorrectly-added issues rather than lose information that should
have been added.

</li><li>
Add the issue and classify it according to the guidelines in
<a href="#issue-classification">Issue classification</a>.  In particular, the item should have
<code>Status</code> and <code>Type-</code> labels.

<p>Include output with the first applicable method:
</p>
<ul>
<li>
If the issue has a notation example which fits in one system,
generate a small &lsquo;<tt>bug.preview.png</tt>&rsquo; file with:

<blockquote><pre class="example">lilypond -dpreview bug.ly
</pre></blockquote>

</li><li>
If the issue has an example which requires more than one system
(i.e. a spacing bug), generate a &lsquo;<tt>bug.png</tt>&rsquo; file with:

<blockquote><pre class="example">lilypond --png bug.ly
</pre></blockquote>

</li><li>
If the issue requires one or two pages of output, then generate a
&lsquo;<tt>bug.png</tt>&rsquo; file with the normal:

<blockquote><pre class="example">lilypond --png bug.ly
</pre></blockquote>

</li><li>
Images created as &lsquo;<tt>bug.png</tt>&rsquo; may be trimmed to a minimum size
by using the <code>trimtagline.sh</code> script, which can be found at

<table><tr><td>&nbsp;</td><td><pre class="smallexample"><a href="https://raw.github.com/gperciva/lilypond-extra/master/bug-squad/trimtagline.sh">https://raw.github.com/gperciva/lilypond-extra/master/bug-squad/trimtagline.sh</a>
</pre></td></tr></table>

<blockquote><pre class="example">trimtagline.sh bug.ly
</pre></blockquote>

</li><li>
If the issue cannot be shown with less than three pages, then
generate a &lsquo;<tt>bug.pdf</tt>&rsquo; file with:

<blockquote><pre class="example">lilypond --pdf bug.ly
</pre></blockquote>

<p>Note that this is likely to be extremely rare; most bugs should
fit into the first two categories above.
</p>

</li></ul>

</li><li>
After adding the issue, please send a response email to the same
group(s) that the initial patch was sent to.  If the initial email
was sent to multiple mailing lists (such as both <code>user</code> and
<code>bugs</code>), then reply to all those mailing lists as well.  The
email should contain a link to the issue you just added.

</li></ol>



<hr size="6">
<a name="Patch-handling"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#issues" title="Beginning of this chapter or previous chapter"> &lt;&lt; Issues&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#regression-tests" title="Next chapter">&nbsp;Regression tests &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#adding-issues-to-the-tracker" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Adding issues to the tracker&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#issues" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Issues&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#summary-of-project-status" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Summary of project status &gt; </a>]</td></tr></table>
<a name="patch-handling"></a>
<h2 class="section">8.7 Patch handling</h2>

<div class="warning"><p><strong>Note:</strong> This is not a Bug Squad responsibility; we have a
separate person handling this task.
</p>
</div>
<p>For contributors/developers: follow the steps in
<a href="#commits-and-patches">Commits and patches</a>, and <a href="#pushing-to-staging">Pushing to staging</a>.
</p>
<p>For people doing maintenance tasks: git-cl is adding issues, James
is testing them, Colin is selecting them for countdowns, and
Patchy is merging from staging to master.  In the coming weeks,
these tasks will be more and more automated.
</p>


<hr size="6">
<a name="Summary-of-project-status"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#issues" title="Beginning of this chapter or previous chapter"> &lt;&lt; Issues&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#regression-tests" title="Next chapter">&nbsp;Regression tests &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#patch-handling" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Patch handling&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#issues" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Issues&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#regression-tests" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Regression tests &gt; </a>]</td></tr></table>
<a name="summary-of-project-status"></a>
<h2 class="section">8.8 Summary of project status</h2>

<a name="Project-overview"></a>
<h4 class="subsubheading">Project overview</h4>

<p>Grid view provides the best overview:
</p>
<table><tr><td>&nbsp;</td><td><pre class="smallexample"><a href="http://code.google.com/p/lilypond/issues/list?mode=grid&amp;y=Priority&amp;x=Type&amp;cells=ids">http://code.google.com/p/lilypond/issues/list?mode=grid&amp;y=Priority&amp;x=Type&amp;cells=ids</a>
</pre></td></tr></table>

<a name="Hindering-development"></a>
<h4 class="subsubheading">Hindering development</h4>

<p>These issues stop or slow development work:
</p>
<table><tr><td>&nbsp;</td><td><pre class="smallexample"><a href="http://code.google.com/p/lilypond/issues/list?can=2&amp;q=label:Maintainability">http://code.google.com/p/lilypond/issues/list?can=2&amp;q=label:Maintainability</a>
</pre></td></tr></table>

<a name="Easy-tasks"></a>
<h4 class="subsubheading">Easy tasks</h4>

<p>Issues tagged with <code>Frog</code> indicates a task suitable for a
relatively new contributor.  The time given is a quick
(inaccurate) estimate of the time required for somebody who is
familiar with material in this manual, but does not know anything
else about LilyPond development.
</p>
<table><tr><td>&nbsp;</td><td><pre class="smallexample"><a href="http://code.google.com/p/lilypond/issues/list?can=2&amp;q=label:Frog">http://code.google.com/p/lilypond/issues/list?can=2&amp;q=label:Frog</a>
</pre></td></tr></table>

<a name="Patches-to-review"></a>
<h4 class="subsubheading">Patches to review</h4>

<p>Patches which have no &ldquo;obvious&rdquo; problems:
</p>
<blockquote><pre class="example"><a href="http://code.google.com/p/lilypond/issues/list?can=2&amp;q=label:patch-review">http://code.google.com/p/lilypond/issues/list?can=2&amp;q=label:patch-review</a>
</pre></blockquote>



<hr size="6">
<a name="Regression-tests"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#issues" title="Beginning of this chapter or previous chapter"> &lt;&lt; Issues&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#programming-work" title="Next chapter">&nbsp;Programming work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#summary-of-project-status" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Summary of project status&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#index" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Top&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#introduction-to-regression-tests" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Introduction to regression tests &gt; </a>]</td></tr></table>
<a name="regression-tests"></a>
<h1 class="chapter">9. Regression tests</h1>

<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#introduction-to-regression-tests" accesskey="1">9.1 Introduction to regression tests</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#precompiled-regression-tests" accesskey="2">9.2 Precompiled regression tests</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#compiling-regression-tests" accesskey="3">9.3 Compiling regression tests</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#regtest-comparison" accesskey="4">9.4 Regtest comparison</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#finding-the-cause-of-a-regression" accesskey="5">9.5 Finding the cause of a regression</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#memory-and-coverage-tests" accesskey="6">9.6 Memory and coverage tests</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#musicxml-tests" accesskey="7">9.7 MusicXML tests</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#grand-regression-test-checking" accesskey="8">9.8 Grand Regression Test Checking</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>


<hr size="6">
<a name="Introduction-to-regression-tests"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#regression-tests" title="Beginning of this chapter or previous chapter"> &lt;&lt; Regression tests&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#programming-work" title="Next chapter">&nbsp;Programming work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#regression-tests" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Regression tests&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#regression-tests" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Regression tests&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#precompiled-regression-tests" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Precompiled regression tests &gt; </a>]</td></tr></table>
<a name="introduction-to-regression-tests"></a>
<h2 class="section">9.1 Introduction to regression tests</h2>

<p>LilyPond has a complete suite of regression tests that are used
to ensure that changes to the code do not break existing behavior.
These regression tests comprise small LilyPond snippets that test
the functionality of each part of LilyPond.
</p>
<p>Regression tests are added when new functionality is added to
LilyPond.
We do not yet have a policy on when it is appropriate to add or
modify a regtest when bugs are fixed.  Individual developers
should use their best judgement until this is clarified during the
<a href="#grand-organization-project-_0028gop_0029">Grand Organization Project (GOP)</a>.
</p>
<p>The regression tests are compiled using special <code>make</code>
targets.  There are three primary uses for the regression
tests.  First, successful completion of the regression tests means
that LilyPond has been properly built.  Second, the output of the
regression tests can be manually checked to ensure that
the graphical output matches the description of the intended
output.  Third, the regression test output from two different
versions of LilyPond can be automatically compared to identify
any differences.  These differences should then be manually
checked to ensure that the differences are intended.
</p>
<p>Regression tests (&ldquo;regtests&rdquo;) are available in precompiled form
as part of the documentation.  Regtests can also be compiled
on any machine that has a properly configured LilyPond build
system.
</p>

<hr size="6">
<a name="Precompiled-regression-tests"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#regression-tests" title="Beginning of this chapter or previous chapter"> &lt;&lt; Regression tests&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#programming-work" title="Next chapter">&nbsp;Programming work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#introduction-to-regression-tests" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Introduction to regression tests&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#regression-tests" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Regression tests&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#compiling-regression-tests" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Compiling regression tests &gt; </a>]</td></tr></table>
<a name="precompiled-regression-tests"></a>
<h2 class="section">9.2 Precompiled regression tests</h2>

<a name="Regression-test-output"></a>
<h3 class="subheading">Regression test output</h3>

<p>As part of the release process, the regression tests are run
for every LilyPond release.  Full regression test output is
available for every stable version and the most recent development
version.
</p>
<p>Regression test output is available in HTML and PDF format.  Links
to the regression test output are available at the developer&rsquo;s
resources page for the version of interest.
</p>
<p>The latest stable version of the regtests is found at:
</p>
<blockquote><pre class="example"><a href="http://lilypond.org/doc/stable/input/regression/collated-files.html">http://lilypond.org/doc/stable/input/regression/collated-files.html</a>
</pre></blockquote>

<p>The latest development version of the regtests is found at:
</p>
<blockquote><pre class="example"><a href="http://lilypond.org/doc/latest/input/regression/collated-files.html">http://lilypond.org/doc/latest/input/regression/collated-files.html</a>
</pre></blockquote>


<a name="Regression-test-comparison"></a>
<h3 class="subheading">Regression test comparison</h3>

<p>Each time a new version is released, the regtests are
compiled and the output is automatically compared with the
output of the previous release.  The result of these
comparisons is archived online:
</p>
<blockquote><pre class="example"><a href="http://lilypond.org/test">http://lilypond.org/test/</a>
</pre></blockquote>

<p>Checking these pages is a very important task for the LilyPond project.
You are invited to report anything that looks broken, or any case
where the output quality is not on par with the previous release,
as described in <a name="index-Bug-reports-3"></a>
<a href="web-big-page.html#bug-reports">Bug reports</a>.
</p>
<div class="warning"><p><strong>Note:</strong> The special regression test
&lsquo;<tt>test-output-distance.ly</tt>&rsquo; will always show up as a
regression.  This test changes each time it is run, and serves to
verify that the regression tests have, in fact, run.
</p>
</div>

<a name="What-to-look-for"></a>
<h3 class="subheading">What to look for</h3>

<p>The test comparison shows all of the changes that occurred between
the current release and the prior release.  Each test that has a
significant (noticeable) difference in output is displayed, with
the old version on the left and the new version on the right.
</p>
<p>Some of the small changes can be ignored (slightly different slur
shapes, small variations in note spacing), but this is not always
the case: sometimes even the smallest change means that something
is wrong.  To help in distinguishing these cases, we use bigger
staff size when small differences matter.
</p>
<p>Staff size 30 generally means &quot;pay extra attention to details&quot;.
Staff size 40 (two times bigger than default size) or more means
that the regtest <strong>is</strong> about the details.
</p>
<p>Staff size smaller than default doesn&rsquo;t mean anything.
</p>
<p>Regression tests whose output is the same for both versions are
not shown in the test comparison.
</p>
<ul>
<li>
Images: green blurs in the new version show the approximate
location of elements in the old version.

<p>There are often minor adjustments in spacing which do not indicate
any problem.
</p>
</li><li>
Log files: show the difference in command-line output.

<p>The main thing to examine are any changes in page counts &ndash; if a
file used to fit on 1 page but now requires 4 or 5 pages,
something is suspicious!
</p>
</li><li>
Profile files: give information about
TODO?  I don&rsquo;t know what they&rsquo;re for.

</li></ul>

<div class="warning"><p><strong>Note:</strong> The automatic comparison of the regtests checks the LilyPond
bounding boxes.  This means that Ghostscript changes and changes
in lyrics or text are not found.
</p>

</div>
<hr size="6">
<a name="Compiling-regression-tests"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#regression-tests" title="Beginning of this chapter or previous chapter"> &lt;&lt; Regression tests&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#programming-work" title="Next chapter">&nbsp;Programming work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#precompiled-regression-tests" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Precompiled regression tests&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#regression-tests" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Regression tests&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#regtest-comparison" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Regtest comparison &gt; </a>]</td></tr></table>
<a name="compiling-regression-tests"></a>
<h2 class="section">9.3 Compiling regression tests</h2>

<p>Developers may wish to see the output of the complete regression
test suite for the current version of the source repository
between releases.  Current source code is available; see
<a href="#working-with-source-code">Working with source code</a>.
</p>
<p>For regression testing <code>../configure</code> should be run with the
<code>--disable-optimising</code> option.  Then you will need
to build the LilyPond binary; see <a href="#compiling-lilypond">Compiling LilyPond</a>.
</p>
<p>Uninstalling the previous LilyPond version is not necessary, nor is
running <code>make install</code>, since the tests will automatically be
compiled with the LilyPond binary you have just built in your source
directory.
</p>
<p>From this point, the regtests are compiled with:
</p>
<blockquote><pre class="example">make test
</pre></blockquote>

<p>If you have a multi-core machine you may want to use the &lsquo;<samp>-j</samp>&rsquo;
option and <var>CPU_COUNT</var> variable, as
described in <a href="#saving-time-with-cpu_005fcount">Saving time with <code>CPU_COUNT</code></a>.
For a quad-core processor the complete command would be:
</p>
<blockquote><pre class="example">make -j5 CPU_COUNT=5 test
</pre></blockquote>

<p>The regtest output will then be available in
&lsquo;<tt>input/regression/out-test</tt>&rsquo;.
&lsquo;<tt>input/regression/out-test/collated-examples.html</tt>&rsquo;
contains a listing of all the regression tests that were run,
but none of the images are included.  Individual images are
also available in this directory.
</p>
<p>The primary use of &lsquo;<samp>make&nbsp;test</samp>&rsquo; is to verify that the
regression tests all run without error.  The regression test
page that is part of the documentation is created only when the
documentation is built, as described in <a href="#generating-documentation">Generating documentation</a>.
Note that building the documentation requires more installed components
than building the source code, as described in
<a href="#requirements-for-building-documentation">Requirements for building documentation</a>.
</p>

<hr size="6">
<a name="Regtest-comparison"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#regression-tests" title="Beginning of this chapter or previous chapter"> &lt;&lt; Regression tests&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#programming-work" title="Next chapter">&nbsp;Programming work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#compiling-regression-tests" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Compiling regression tests&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#regression-tests" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Regression tests&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#finding-the-cause-of-a-regression" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Finding the cause of a regression &gt; </a>]</td></tr></table>
<a name="regtest-comparison"></a>
<h2 class="section">9.4 Regtest comparison</h2>

<p>Before modified code is committed to <code>master</code> (via <code>staging</code>),
a regression test
comparison must be completed to ensure that the changes have
not caused problems with previously working code.  The comparison
is made automatically upon compiling the regression test suite
twice.
</p>
<ol>
<li>
Run <code>make</code> with current git master without any of your changes.

</li><li>
Before making changes to the code, establish a baseline for the comparison by
going to the &lsquo;<tt>lilypond-git/build/</tt>&rsquo; directory and running:

<blockquote><pre class="example">make test-baseline
</pre></blockquote>

</li><li>
Make your changes, or apply the patch(es) to consider.

</li><li>
Compile the source with &lsquo;<samp>make</samp>&rsquo; as usual.

</li><li>
Check for unintentional changes to the regtests:

<blockquote><pre class="example">make check
</pre></blockquote>

<p>After this has finished, a regression test comparison will be
available (relative to the current &lsquo;<tt>build/</tt>&rsquo; directory) at:
</p>
<blockquote><pre class="example">out/test-results/index.html
</pre></blockquote>

<p>For each regression test that differs between the baseline and the
changed code, a regression test entry will be displayed.  Ideally,
the only changes would be the changes that you were working on.
If regressions are introduced, they must be fixed before
committing the code.
</p>
<div class="warning"><p><strong>Note:</strong> The special regression test &lsquo;<tt>test-output-distance.ly</tt>&rsquo; will always
show up as a regression.  This test changes each time it is run, and
serves to verify that the regression tests have, in fact, run.
</p>
</div>
</li><li>
If you are happy with the results, then stop now.

<p>If you want to continue programming, then make any additional code
changes, and continue.
</p>
</li><li>
Compile the source with &lsquo;<samp>make</samp>&rsquo; as usual.

</li><li>
To re-check files that differed between the initial
&lsquo;<samp>make&nbsp;test-baseline</samp>&rsquo; and your post-changes
&lsquo;<samp>make&nbsp;check</samp>&rsquo;, run:

<blockquote><pre class="example">make test-redo
</pre></blockquote>

<p>This updates the regression list at &lsquo;<tt>out/test-results/index.html</tt>&rsquo;.
It does <em>not</em> redo &lsquo;<tt>test-output-distance.ly</tt>&rsquo;.
</p>
</li><li>
When all regressions have been resolved, the output list will be empty.

</li><li>
Once all regressions have been resolved, a final check should be completed
by running:

<blockquote><pre class="example">make test-clean
make check
</pre></blockquote>

<p>This cleans the results of the previous &lsquo;<samp>make&nbsp;check</samp>&rsquo;, then does the
automatic regression comparison again.  
</p>
</li></ol>

<div class="advanced"><p><strong>Advanced note:</strong> Once a test baseline has been established, there is no need to run it again
unless git master changed. In other words, if you work with several branches
and want to do regtests comparison for all of them, you can
<code>make test-baseline</code> with git master, checkout some branch,
<code>make</code> and <code>make check</code> it, then switch to another branch,
<code>make test-clean</code>, <code>make</code> and <code>make check</code> it without doing
<code>make test-baseline</code> again.
</p>
</div>

<hr size="6">
<a name="Finding-the-cause-of-a-regression"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#regression-tests" title="Beginning of this chapter or previous chapter"> &lt;&lt; Regression tests&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#programming-work" title="Next chapter">&nbsp;Programming work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#regtest-comparison" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Regtest comparison&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#regression-tests" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Regression tests&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#memory-and-coverage-tests" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Memory and coverage tests &gt; </a>]</td></tr></table>
<a name="finding-the-cause-of-a-regression"></a>
<h2 class="section">9.5 Finding the cause of a regression</h2>

<p>Git has special functionality to help tracking down the exact
commit which causes a problem.  See the git manual page for
<code>git bisect</code>.  This is a job that non-programmers can do,
although it requires familiarity with git, ability to compile
LilyPond, and generally a fair amount of technical knowledge.  A
brief summary is given below, but you may need to consult other
documentation for in-depth explanations.
</p>
<p>Even if you are not familiar with git or are not able to compile
LilyPond you can still help to narrow down the cause of a
regression simply by downloading the binary releases of different
LilyPond versions and testing them for the regression.  Knowing
which version of LilyPond first exhibited the regression is
helpful to a developer as it shortens the <code>git bisect</code>
procedure.
</p>
<p>Once a problematic commit is identified, the programmers&rsquo; job is
much easier.  In fact, for most regression bugs, the majority of
the time is spent simply finding the problematic commit.
</p>
<p>More information is in <a href="#regression-tests">Regression tests</a>.
</p>
<a name="git-bisect-setup"></a>
<h3 class="subheading">git bisect setup</h3>

<p>We need to set up the bisect for each problem we want to
investigate.
</p>
<p>Suppose we have an input file which compiled in version 2.13.32,
but fails in version 2.13.38 and above.
</p>
<ol>
<li>
Begin the process:

<blockquote><pre class="example">git bisect start
</pre></blockquote>

</li><li>
Give it the earliest known bad tag:

<blockquote><pre class="example">git bisect bad release/2.13.38-1
</pre></blockquote>

<p>(you can see tags with: <code>git tag</code> )
</p>
</li><li>
Give it the latest known good tag:

<blockquote><pre class="example">git bisect good release/2.13.32-1
</pre></blockquote>

<p>You should now see something like:
</p><blockquote><pre class="example">Bisecting: 195 revisions left to test after this (roughly 8 steps)
[b17e2f3d7a5853a30f7d5a3cdc6b5079e77a3d2a] Web: Announcement
update for the new &ldquo;LilyPond Report&rdquo;.
</pre></blockquote>

</li></ol>

<a name="git-bisect-actual"></a>
<h3 class="subheading">git bisect actual</h3>

<ol>
<li>
Compile the source:

<blockquote><pre class="example">make
</pre></blockquote>

</li><li>
Test your input file:

<blockquote><pre class="example">out/bin/lilypond test.ly
</pre></blockquote>

</li><li>
Test results?

<ul>
<li>
Does it crash, or is the output bad?  If so:

<blockquote><pre class="example">git bisect bad
</pre></blockquote>

</li><li>
Does your input file produce good output?  If so:

<blockquote><pre class="example">git bisect good
</pre></blockquote>

</li></ul>

</li><li>
Once the exact problem commit has been identified, git will inform
you with a message like:

<blockquote><pre class="example">6d28aebbaaab1be9961a00bf15a1ef93acb91e30 is the first bad commit
%%% ... blah blah blah ...
</pre></blockquote>

<p>If there is still a range of commits, then git will automatically
select a new version for you to test.  Go to step #1.
</p>
</li></ol>

<a name="Recommendation_003a-use-two-terminal-windows"></a>
<h3 class="subheading">Recommendation: use two terminal windows</h3>

<ul>
<li>
One window is open to the <code>build/</code> directory, and alternates
between these commands:

<blockquote><pre class="example">make
out/bin/lilypond test.ly
</pre></blockquote>

</li><li>
One window is open to the top source directory, and alternates
between these commands:

<blockquote><pre class="example">git bisect good
git bisect bad
</pre></blockquote>

</li></ul>


<hr size="6">
<a name="Memory-and-coverage-tests"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#regression-tests" title="Beginning of this chapter or previous chapter"> &lt;&lt; Regression tests&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#programming-work" title="Next chapter">&nbsp;Programming work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#finding-the-cause-of-a-regression" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Finding the cause of a regression&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#regression-tests" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Regression tests&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#musicxml-tests" title="Next section in reading order" accesskey="n" rel="next">&nbsp;MusicXML tests &gt; </a>]</td></tr></table>
<a name="memory-and-coverage-tests"></a>
<h2 class="section">9.6 Memory and coverage tests</h2>

<p>In addition to the graphical output of the regression tests, it is
possible to test memory usage and to determine how much of the source
code has been exercised by the tests.
</p>
<a name="Memory-usage"></a>
<h3 class="subheading">Memory usage</h3>

<p>For tracking memory usage as part of this test, you will need
GUILE CVS; especially the following patch:
</p><table><tr><td>&nbsp;</td><td><pre class="smallexample"><a href="http://www.lilypond.org/vc/old/gub.darcs/patches/guile-1.9-gcstats.patch">http://www.lilypond.org/vc/old/gub.darcs/patches/guile-1.9-gcstats.patch</a>.
</pre></td></tr></table>

<a name="Code-coverage"></a>
<h3 class="subheading">Code coverage</h3>

<p>For checking the coverage of the test suite, do the following
</p>
<blockquote><pre class="example">./scripts/auxiliar/build-coverage.sh
<em># uncovered files, least covered first</em>
./scripts/auxiliar/coverage.py  --summary out-cov/*.cc
<em># consecutive uncovered lines, longest first</em>
./scripts/auxiliar/coverage.py  --uncovered out-cov/*.cc
</pre></blockquote>


<hr size="6">
<a name="MusicXML-tests"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#regression-tests" title="Beginning of this chapter or previous chapter"> &lt;&lt; Regression tests&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#programming-work" title="Next chapter">&nbsp;Programming work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#memory-and-coverage-tests" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Memory and coverage tests&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#regression-tests" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Regression tests&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#grand-regression-test-checking" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Grand Regression Test Checking &gt; </a>]</td></tr></table>
<a name="musicxml-tests"></a>
<h2 class="section">9.7 MusicXML tests</h2>


<p>LilyPond comes with a complete set of regtests for the
<a href="http://www.musicxml.org">MusicXML</a> language.  Originally
developed to test &lsquo;<samp>musicxml2ly</samp>&rsquo;, these regression tests
can be used to test any MusicXML implementation.
</p>
<p>The MusicXML regression tests are found at
&lsquo;<tt>input/regression/musicxml/</tt>&rsquo;.
</p>
<p>The output resulting from running these tests
through &lsquo;<samp>musicxml2ly</samp>&rsquo; followed by &lsquo;<samp>lilypond</samp>&rsquo; is
available in the LilyPond documentation:
</p>
<blockquote><pre class="example"><a href="http://lilypond.org/doc/latest/input/regression/musicxml/collated-files">http://lilypond.org/doc/latest/input/regression/musicxml/collated-files</a>
</pre></blockquote>


<hr size="6">
<a name="Grand-Regression-Test-Checking"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#regression-tests" title="Beginning of this chapter or previous chapter"> &lt;&lt; Regression tests&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#programming-work" title="Next chapter">&nbsp;Programming work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#musicxml-tests" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; MusicXML tests&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#regression-tests" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Regression tests&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#programming-work" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Programming work &gt; </a>]</td></tr></table>
<a name="grand-regression-test-checking"></a>
<h2 class="section">9.8 Grand Regression Test Checking</h2>

<a name="What-is-this-all-about_003f"></a>
<h3 class="subheading">What is this all about?</h3>

<p>Regression tests (usually abbreviated &quot;regtests&quot;) is a collection
of &lsquo;<tt>.ly</tt>&rsquo; files used to check whether LilyPond is working correctly.
Example: before version 2.15.12 breve noteheads had incorrect width,
which resulted in collisions with other objects.  After the issue was fixed,
a small &lsquo;<tt>.ly</tt>&rsquo; file demonstrating the problem was added to the regression
tests as a proof that the fix works.  If someone will accidentally break
breve width again, we will notice this in the output of that regression test.
</p>
<a name="How-can-I-help_003f"></a>
<h3 class="subheading">How can I help?</h3>

<p>We ask you to help us by checking one or two regtests from time to time.
You don&rsquo;t need programming skills to do this, not even LilyPond skills -
just basic music notation knowledge; checking one regtest takes less than
a minute.  Simply go here:
</p>
<blockquote><pre class="example"><a href="http://www.philholmes.net/lilypond/regtests">http://www.philholmes.net/lilypond/regtests/</a>
</pre></blockquote>

<a name="Some-tips-on-checking-regtests"></a>
<h3 class="subheading">Some tips on checking regtests</h3>

<a name="Description-text"></a>
<h4 class="subsubheading">Description text</h4>

<p>The description should be clear even for a music beginner.
If there are any special terms used in the description,
they all should be explained in our <a name="index-Top"></a>
<a href="music-glossary-big-page.html#top">Music Glossary</a>
or <a name="index-Top-1"></a>
<a href="internals-big-page.html#top">Internals Reference</a>.
Vague descriptions (like &quot;behaves well&quot;, &quot;looks reasonable&quot;) shouldn&rsquo;t be used.
</p>
<hr size="6">
<a name="Programming-work"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#regression-tests" title="Beginning of this chapter or previous chapter"> &lt;&lt; Regression tests&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#grand-regression-test-checking" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Grand Regression Test Checking&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#index" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Top&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#overview-of-lilypond-architecture" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Overview of LilyPond architecture &gt; </a>]</td></tr></table>
<a name="programming-work"></a>
<h1 class="chapter">10. Programming work</h1>

<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#overview-of-lilypond-architecture" accesskey="1">10.1 Overview of LilyPond architecture</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#lilypond-programming-languages" accesskey="2">10.2 LilyPond programming languages</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#programming-without-compiling" accesskey="3">10.3 Programming without compiling</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#finding-functions" accesskey="4">10.4 Finding functions</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#code-style" accesskey="5">10.5 Code style</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#warnings-errors-progress-and-debug-output" accesskey="6">10.6 Warnings, Errors, Progress and Debug Output</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#debugging-lilypond" accesskey="7">10.7 Debugging LilyPond</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#tracing-object-relationships" accesskey="8">10.8 Tracing object relationships</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#adding-or-modifying-features" accesskey="9">10.9 Adding or modifying features</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#iterator-tutorial">10.10 Iterator tutorial</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#engraver-tutorial">10.11 Engraver tutorial</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#callback-tutorial">10.12 Callback tutorial</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#understanding-pure-properties">10.13 Understanding pure properties</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#lilypond-scoping">10.14 LilyPond scoping</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#scheme_002d_003ec-interface">10.15 Scheme-&gt;C interface</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#lilypond-miscellany">10.16 LilyPond miscellany</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr size="6">
<a name="Overview-of-LilyPond-architecture"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#programming-work" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#programming-work" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Programming work&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#lilypond-programming-languages" title="Next section in reading order" accesskey="n" rel="next">&nbsp;LilyPond programming languages &gt; </a>]</td></tr></table>
<a name="overview-of-lilypond-architecture"></a>
<h2 class="section">10.1 Overview of LilyPond architecture</h2>

<p>LilyPond processes the input file into graphical and musical output in a
number of stages.  This process, along with the types of routines that
accomplish the various stages of the process, is described in this section.  A
more complete description of the LilyPond architecture and internal program
execution is found in Erik Sandberg&rsquo;s
<a href="http://lilypond.org/website/pdf/thesis-erik-sandberg.pdf">master&rsquo;s thesis</a>.
</p>
<p>The first stage of LilyPond processing is <em>parsing</em>.  In the parsing
process, music expressions in LilyPond input format are converted to music
expressions in Scheme format.  In Scheme format, a music expression is a list
in tree form, with nodes that indicate the relationships between various music
events.  The LilyPond parser is written in Bison.
</p>
<p>The second stage of LilyPond processing is <em>iterating</em>.  Iterating
assigns each music event to a context, which is the environment in which the
music will be finally engraved.  The context is responsible for all further
processing of the music.  It is during the iteration stage that contexts are
created as necessary to ensure that every note has a Voice type context (e.g.
Voice, TabVoice, DrumVoice, CueVoice, MensuralVoice, VaticanaVoice,
GregorianTranscriptionVoice), that the Voice type contexts exist in
appropriate Staff type contexts, and that parallel Staff type contexts exist
in StaffGroup type contexts.  In addition, during the iteration stage each
music event is assigned a moment, or a time in the music when the event
begins.
</p>
<p>Each type of music event has an associated iterator.  Iterators are defined in
&lsquo;<tt>*-iterator.cc</tt>&rsquo;.  During iteration, an
event&rsquo;s iterator is called to deliver that music event to the appropriate
context(s).
</p>
<p>The final stage of LilyPond processing is <em>translation</em>.  During
translation, music events are prepared for graphical or midi output.  The
translation step is accomplished by the polymorphic base class Translator
through its two derived classes: Engraver (for graphical output) and
Performer (for midi output).
</p>
<p>Translators are defined in C++ files named &lsquo;<tt>*-engraver.cc</tt>&rsquo;
and &lsquo;<tt>*-performer.cc</tt>&rsquo;.
Much of the work of translating is handled by Scheme functions,
which is one of the keys to LilyPond&rsquo;s exceptional flexibility.
</p>
<img src="pictures/architecture-diagram.png" alt="png">


<hr size="6">
<a name="LilyPond-programming-languages"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#overview-of-lilypond-architecture" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Overview of LilyPond architecture&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#programming-work" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Programming work&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#lilypond-programming-languages" title="Next section in reading order" accesskey="n" rel="next">&nbsp; &gt; </a>]</td></tr></table>
<a name="lilypond-programming-languages"></a>
<h2 class="section">10.2 LilyPond programming languages</h2>

<p>Programming in LilyPond is done in a variety of programming languages.  Each
language is used for a specific purpose or purposes.  This section describes
the languages used and provides links to reference manuals and tutorials for
the relevant language.
</p>
<hr size="6">
<a name="lilypond-programming-languages"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#lilypond-programming-languages" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; LilyPond programming languages&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#lilypond-programming-languages" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;LilyPond programming languages&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#lilypond-programming-languages" title="Next section in reading order" accesskey="n" rel="next">&nbsp; &gt; </a>]</td></tr></table>
<h3 class="subsection">10.2.1 C++</h3>

<p>The core functionality of LilyPond is implemented in C++.
</p>
<p>C++ is so ubiquitous that it is difficult to identify either a reference
manual or a tutorial.  Programmers unfamiliar with C++ will need to spend some
time to learn the language before attempting to modify the C++ code.
</p>
<p>The C++ code calls Scheme/GUILE through the GUILE interface, which is
documented in the
<a href="http://www.gnu.org/software/guile/manual/html_node/index.html">GUILE Reference Manual</a>.
</p>
<hr size="6">
<a name="lilypond-programming-languages"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#lilypond-programming-languages" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; &nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#lilypond-programming-languages" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;LilyPond programming languages&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#lilypond-programming-languages" title="Next section in reading order" accesskey="n" rel="next">&nbsp; &gt; </a>]</td></tr></table>
<h3 class="subsection">10.2.2 Flex</h3>

<p>The LilyPond lexer is implemented in Flex, an implementation of the Unix lex
lexical analyser generator.  Resources for Flex can be found
<a href="http://flex.sourceforge.net">here</a>.
</p>
<hr size="6">
<a name="lilypond-programming-languages"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#lilypond-programming-languages" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; &nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#lilypond-programming-languages" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;LilyPond programming languages&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#lilypond-programming-languages" title="Next section in reading order" accesskey="n" rel="next">&nbsp; &gt; </a>]</td></tr></table>
<h3 class="subsection">10.2.3 GNU Bison</h3>

<p>The LilyPond parser is implemented in Bison, a GNU parser generator.  The
Bison homepage is found at <a href="http://www.gnu.org/software/bison">gnu.org</a>.  The manual (which includes both a reference and tutorial) is
<a href="http://www.gnu.org/software/bison/manual/index.html">available</a> in a
variety of formats.
</p>
<hr size="6">
<a name="lilypond-programming-languages"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#lilypond-programming-languages" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; &nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#lilypond-programming-languages" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;LilyPond programming languages&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#lilypond-programming-languages" title="Next section in reading order" accesskey="n" rel="next">&nbsp; &gt; </a>]</td></tr></table>
<h3 class="subsection">10.2.4 GNU Make</h3>

<p>GNU Make is used to control the compiling process and to build the
documentation and the website.  GNU Make documentation is available at
<a href="http://www.gnu.org/software/make/manual">the GNU website</a>.
</p>
<hr size="6">
<a name="lilypond-programming-languages"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#lilypond-programming-languages" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; &nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#lilypond-programming-languages" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;LilyPond programming languages&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#lilypond-programming-languages" title="Next section in reading order" accesskey="n" rel="next">&nbsp; &gt; </a>]</td></tr></table>
<h3 class="subsection">10.2.5 GUILE or Scheme</h3>

<p>GUILE is the dialect of Scheme that is used as LilyPond&rsquo;s extension language.
Many extensions to LilyPond are written entirely in GUILE.  The
<a href="http://www.gnu.org/software/guile/manual/html_node/index.html">GUILE Reference Manual</a> is available online.
</p>
<p><a href="http://mitpress.mit.edu/sicp/full-text/book/book.html">Structure and Interpretation of Computer Programs</a>, a popular textbook used to teach
programming in Scheme is available in its entirety online.
</p>
<p>An introduction to Guile/Scheme as used in LilyPond can be found in the
<a name="index-Scheme-tutorial"></a>
<a href="extending-big-page.html#scheme-tutorial">Scheme tutorial</a>.
</p>
<hr size="6">
<a name="lilypond-programming-languages"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#lilypond-programming-languages" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; &nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#lilypond-programming-languages" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;LilyPond programming languages&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#lilypond-programming-languages" title="Next section in reading order" accesskey="n" rel="next">&nbsp; &gt; </a>]</td></tr></table>
<h3 class="subsection">10.2.6 MetaFont</h3>

<p>MetaFont is used to create the music fonts used by LilyPond.  A MetaFont
tutorial is available at <a href="http://metafont.tutorial.free.fr">the METAFONT tutorial page</a>.
</p>
<hr size="6">
<a name="lilypond-programming-languages"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#lilypond-programming-languages" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; &nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#lilypond-programming-languages" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;LilyPond programming languages&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#lilypond-programming-languages" title="Next section in reading order" accesskey="n" rel="next">&nbsp; &gt; </a>]</td></tr></table>
<h3 class="subsection">10.2.7 PostScript</h3>

<p>PostScript is used to generate graphical output.  A brief PostScript tutorial
is <a href="http://local.wasp.uwa.edu.au/~pbourke/dataformats/postscript">available online</a>.  The
<a href="http://www.adobe.com/products/postscript/pdfs/PLRM.pdf">PostScript Language Reference</a> is available online in PDF format.
</p>
<hr size="6">
<a name="lilypond-programming-languages"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#lilypond-programming-languages" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; &nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#lilypond-programming-languages" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;LilyPond programming languages&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#programming-without-compiling" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Programming without compiling &gt; </a>]</td></tr></table>
<h3 class="subsection">10.2.8 Python</h3>

<p>Python is used for XML2ly and is used for building the documentation and the
website.
</p>
<p>Python documentation is available at <a href="http://www.python.org/doc">python.org</a>.
</p>
<hr size="6">
<a name="Programming-without-compiling"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#lilypond-programming-languages" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; &nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#programming-work" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Programming work&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#programming-without-compiling" title="Next section in reading order" accesskey="n" rel="next">&nbsp; &gt; </a>]</td></tr></table>
<a name="programming-without-compiling"></a>
<h2 class="section">10.3 Programming without compiling</h2>

<p>Much of the development work in LilyPond takes place by changing &lsquo;<tt>*.ly</tt>&rsquo; or
&lsquo;<tt>*.scm</tt>&rsquo; files.  These changes can be made without compiling LilyPond.  Such
changes are described in this section.
</p>

<hr size="6">
<a name="programming-without-compiling"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#programming-without-compiling" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Programming without compiling&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#programming-without-compiling" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Programming without compiling&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#programming-without-compiling" title="Next section in reading order" accesskey="n" rel="next">&nbsp; &gt; </a>]</td></tr></table>
<h3 class="subsection">10.3.1 Modifying distribution files</h3>

<p>Much of LilyPond is written in Scheme or LilyPond input files.  These
files are interpreted when the program is run, rather than being compiled
when the program is built, and are present in all LilyPond distributions.
You will find &lsquo;<tt>.ly</tt>&rsquo; files in the &lsquo;<tt>ly/</tt>&rsquo; directory and the Scheme files in the
&lsquo;<tt>scm/</tt>&rsquo; directory.  Both Scheme files and &lsquo;<tt>.ly</tt>&rsquo; files can be modified and
saved with any text editor.  It&rsquo;s probably wise to make a backup copy of
your files before you modify them, although you can reinstall if the
files become corrupted.
</p>
<p>Once you&rsquo;ve modified the files, you can test the changes just by running
LilyPond on some input file.  It&rsquo;s a good idea to create a file that
demonstrates the feature you&rsquo;re trying to add.  This file will eventually
become a regression test and will be part of the LilyPond distribution.
</p>
<hr size="6">
<a name="programming-without-compiling"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#programming-without-compiling" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; &nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#programming-without-compiling" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Programming without compiling&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#finding-functions" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Finding functions &gt; </a>]</td></tr></table>
<h3 class="subsection">10.3.2 Desired file formatting</h3>

<p>Files that are part of the LilyPond distribution have Unix-style line
endings (LF), rather than DOS (CR+LF) or MacOS 9 and earlier (CR).  Make
sure you use the necessary tools to ensure that Unix-style line endings are
preserved in the patches you create.
</p>
<p>Tab characters should not be included in files for distribution.  All
indentation should be done with spaces.  Most editors have settings to
allow the setting of tab stops and ensuring that no tab characters are
included in the file.
</p>
<p>Scheme files and LilyPond files should be written according to standard
style guidelines.  Scheme file guidelines can be found at
<a href="http://community.schemewiki.org/?scheme-style">http://community.schemewiki.org/?scheme-style</a>.  Following these
guidelines will make your code easier to read.  Both you and others that
work on your code will be glad you followed these guidelines.
</p>
<p>For LilyPond files, you should follow the guidelines for LilyPond snippets
in the documentation.  You can find these guidelines at
<a href="#texinfo-introduction-and-usage-policy">Texinfo introduction and usage policy</a>.
</p>
<hr size="6">
<a name="Finding-functions"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#programming-without-compiling" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; &nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#programming-work" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Programming work&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#finding-functions" title="Next section in reading order" accesskey="n" rel="next">&nbsp; &gt; </a>]</td></tr></table>
<a name="finding-functions"></a>
<h2 class="section">10.4 Finding functions</h2>

<p>When making changes or fixing bugs in LilyPond, one of the initial
challenges is finding out where in the code tree the functions to
be modified live.  With nearly 3000 files in the source tree,
trial-and-error searching is generally ineffective.  This section
describes a process for finding interesting code.
</p>
<hr size="6">
<a name="finding-functions"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#finding-functions" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Finding functions&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#finding-functions" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Finding functions&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#finding-functions" title="Next section in reading order" accesskey="n" rel="next">&nbsp; &gt; </a>]</td></tr></table>
<h3 class="subsection">10.4.1 Using the ROADMAP</h3>

<p>The file ROADMAP is located in the main directory of the lilypond source.
ROADMAP lists all of the directories in the LilyPond source tree, along
with a brief description of the kind of files found in each directory.
This can be a very helpful tool for deciding which directories to search
when looking for a function.
</p>

<hr size="6">
<a name="finding-functions"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#finding-functions" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; &nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#finding-functions" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Finding functions&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#finding-functions" title="Next section in reading order" accesskey="n" rel="next">&nbsp; &gt; </a>]</td></tr></table>
<h3 class="subsection">10.4.2 Using grep to search</h3>

<p>Having identified a likely subdirectory to search, the grep utility can
be used to search for a function name.  The format of the grep command is
</p>
<blockquote><pre class="example">grep -i functionName subdirectory/*
</pre></blockquote>

<p>This command will search all the contents of the directory subdirectory/
and display every line in any of the files that contains
functionName.  The &lsquo;<samp>-i</samp>&rsquo; option makes <code>grep</code> ignore
case &ndash; this can be very useful if you are not yet familiar with
our capitalization conventions.
</p>
<p>The most likely directories to grep for function names are &lsquo;<tt>scm/</tt>&rsquo; for
scheme files, ly/ for lilypond input (&lsquo;<tt>*.ly</tt>&rsquo;) files, and &lsquo;<tt>lily/</tt>&rsquo; for C++
files.
</p>

<hr size="6">
<a name="finding-functions"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#finding-functions" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; &nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#finding-functions" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Finding functions&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#finding-functions" title="Next section in reading order" accesskey="n" rel="next">&nbsp; &gt; </a>]</td></tr></table>
<h3 class="subsection">10.4.3 Using git grep to search</h3>

<p>If you have used git to obtain the source, you have access to a
powerful tool to search for functions.  The command:
</p>
<blockquote><pre class="example">git grep functionName
</pre></blockquote>

<p>will search through all of the files that are present in the git
repository looking for functionName.  It also presents the results
of the search using <code>less</code>, so the results are displayed one page
at a time.
</p>
<hr size="6">
<a name="finding-functions"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#finding-functions" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; &nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#finding-functions" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Finding functions&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#code-style" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Code style &gt; </a>]</td></tr></table>
<h3 class="subsection">10.4.4 Searching on the git repository at Savannah</h3>

<p>You can also use the equivalent of git grep on the Savannah server.
</p>
<ul>
<li>
Go to http://git.sv.gnu.org/gitweb/?p=lilypond.git

</li><li>
In the pulldown box that says commit, select grep.

</li><li>
Type functionName in the search box, and hit enter/return

</li></ul>

<p>This will initiate a search of the remote git repository.
</p>

<hr size="6">
<a name="Code-style"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#finding-functions" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; &nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#programming-work" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Programming work&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#languages" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Languages &gt; </a>]</td></tr></table>
<a name="code-style"></a>
<h2 class="section">10.5 Code style</h2>

<p>This section describes style guidelines for LilyPond
source code.
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#languages" accesskey="1">10.5.1 Languages</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#filenames" accesskey="2">10.5.2 Filenames</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#indentation" accesskey="3">10.5.3 Indentation</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#naming-conventions" accesskey="4">10.5.4 Naming Conventions</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#broken-code" accesskey="5">10.5.5 Broken code</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#code-comments" accesskey="6">10.5.6 Code comments</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#handling-errors" accesskey="7">10.5.7 Handling errors</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#localization" accesskey="8">10.5.8 Localization</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>


<hr size="6">
<a name="Languages"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#code-style" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Code style&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#code-style" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Code style&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#filenames" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Filenames &gt; </a>]</td></tr></table>
<a name="languages"></a>
<h3 class="subsection">10.5.1 Languages</h3>

<p>C++ and Python are preferred.  Python code should use PEP 8.
</p>

<hr size="6">
<a name="Filenames"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#languages" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Languages&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#code-style" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Code style&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#indentation" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Indentation &gt; </a>]</td></tr></table>
<a name="filenames"></a>
<h3 class="subsection">10.5.2 Filenames</h3>

<p>Definitions of classes that are only accessed via pointers (*) or
references (&amp;) shall not be included as include files.
</p>
<pre class="verbatim">   filenames

        &quot;.hh&quot;   Include files
             &quot;.cc&quot;      Implementation files
             &quot;.icc&quot;     Inline definition files
             &quot;.tcc&quot;     non inline Template defs

   in emacs:

             (setq auto-mode-alist
                   (append '((&quot;\\.make$&quot; . makefile-mode)
                        (&quot;\\.cc$&quot; . c++-mode)
                        (&quot;\\.icc$&quot; . c++-mode)
                        (&quot;\\.tcc$&quot; . c++-mode)
                        (&quot;\\.hh$&quot; . c++-mode)
                        (&quot;\\.pod$&quot; . text-mode)
                        )
                      auto-mode-alist))
</pre>
<p>The class Class_name is coded in &lsquo;class-name.*&rsquo;
</p>

<hr size="6">
<a name="Indentation"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#filenames" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Filenames&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#code-style" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Code style&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#naming-conventions" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Naming conventions &gt; </a>]</td></tr></table>
<a name="indentation"></a>
<h3 class="subsection">10.5.3 Indentation</h3>

<p>Standard GNU coding style is used.
</p>
<a name="Indenting-files-with-fixcc_002epy-_0028recommended_0029"></a>
<h4 class="subsubheading">Indenting files with <code>fixcc.py</code> (recommended)</h4>

<p>LilyPond provides a python script that will adjust the indentation
and spacing on a <code>.cc</code> or <code>.hh</code> file to very near the
GNU standard:
</p>
<blockquote><pre class="example">scripts/auxiliar/fixcc.py FILENAME
</pre></blockquote>

<p>This can be run on all files at once, but this is not recommended
for normal contributors or developers.
</p>
<table><tr><td>&nbsp;</td><td><pre class="smallexample">scripts/auxiliar/fixcc.py \
  $(find flower lily -name '*cc' -o -name '*hh' | grep -v /out)
</pre></td></tr></table>


<a name="Indenting-with-emacs"></a>
<h4 class="subsubheading">Indenting with emacs</h4>

<p>The following hooks will produce indentation which is similar to
our official indentation as produced with <code>fixcc.py</code>.
</p>
<blockquote><pre class="example">(add-hook 'c++-mode-hook
     '(lambda ()
        (c-set-style &quot;gnu&quot;)
        (setq indent-tabs-mode nil))
</pre></blockquote>

<p>If you like using font-lock, you can also add this to your
&lsquo;<tt>.emacs</tt>&rsquo;:
</p>
<blockquote><pre class="example">(setq font-lock-maximum-decoration t)
(setq c++-font-lock-keywords-3
      (append
       c++-font-lock-keywords-3
       '((&quot;\\b\\(a-zA-Z_?+_\\)\\b&quot; 1 font-lock-variable-name-face) (&quot;\\b\\(A-Z?+a-z_?+\\)\\b&quot; 1 font-lock-type-face))
       ))
</pre></blockquote>



<a name="Indenting-with-vim"></a>
<h3 class="subheading">Indenting with vim</h3>

<p>Although emacs indentation is the GNU standard, acceptable
indentation can usually be accomplished with vim.  Some hints for
vim are as follows:
</p>
<p>A workable .vimrc:
</p>
<blockquote><pre class="example">set cindent
set smartindent
set autoindent
set expandtab
set softtabstop=2
set shiftwidth=2
filetype plugin indent on
set incsearch
set ignorecase smartcase
set hlsearch
set confirm
set statusline=%F%m%r%h%w\ %{&amp;ff}\ %Y\ [ASCII=\%03.3b]\ [HEX=\%02.2B]\ %04l,%04v\ %p%%\ [LEN=%L]
set laststatus=2
set number
&quot; Remove trailing whitespace on write
autocmd BufWritePre * :%s/\s\+$//e
</pre></blockquote>

<p>With this &lsquo;<tt>.vimrc</tt>&rsquo;, files can be reindented automatically by
highlighting the lines to be indented in visual mode (use V to
enter visual mode) and pressing <code>=</code>.
</p>
<p>A &lsquo;<tt>scheme.vim</tt>&rsquo; file will help improve the indentation.  This
one was suggested by Patrick McCarty.  It should be saved in
&lsquo;<tt>~/.vim/after/syntax/scheme.vim</tt>&rsquo;.
</p>
<blockquote><pre class="example">&quot; Additional Guile-specific 'forms'
syn keyword schemeSyntax define-public define*-public
syn keyword schemeSyntax define* lambda* let-keywords*
syn keyword schemeSyntax defmacro defmacro* define-macro
syn keyword schemeSyntax defmacro-public defmacro*-public
syn keyword schemeSyntax use-modules define-module
syn keyword schemeSyntax define-method define-class

&quot; Additional LilyPond-specific 'forms'
syn keyword schemeSyntax define-markup-command define-markup-list-command
syn keyword schemeSyntax define-safe-public define-music-function
syn keyword schemeSyntax def-grace-function

&quot; All of the above should influence indenting too
set lw+=define-public,define*-public
set lw+=define*,lambda*,let-keywords*
set lw+=defmacro,defmacro*,define-macro
set lw+=defmacro-public,defmacro*-public
set lw+=use-modules,define-module
set lw+=define-method,define-class
set lw+=define-markup-command,define-markup-list-command
set lw+=define-safe-public,define-music-function
set lw+=def-grace-function

&quot; These forms should not influence indenting
set lw-=if
set lw-=set!

&quot; Try to highlight all ly: procedures
syn match schemeFunc &quot;ly:[^) ]\+&quot;
</pre></blockquote>


<hr size="6">
<a name="Naming-conventions"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#indentation" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Indentation&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#code-style" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Code style&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#broken-code" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Broken code &gt; </a>]</td></tr></table>
<a name="naming-conventions"></a>
<h3 class="subsection">10.5.4 Naming Conventions</h3>

<p>Naming conventions have been established for LilyPond
source code.
</p>
<a name="Classes-and-Types"></a>
<h3 class="subheading">Classes and Types</h3>

<p>Classes begin with an uppercase letter, and words
in class names are separated with <code>_</code>:
</p>
<pre class="verbatim">This_is_a_class
</pre>
<a name="Members"></a>
<h3 class="subheading">Members</h3>

<p>Member variable names end with an underscore:
</p>
<pre class="verbatim">Type Class::member_
</pre>
<a name="Macros"></a>
<h3 class="subheading">Macros</h3>

<p>Macro names should be written in uppercase completely,
with words separated by <code>_</code>:
</p>
<pre class="verbatim">THIS_IS_A_MACRO
</pre>
<a name="Variables"></a>
<h3 class="subheading">Variables</h3>

<p>Variable names should be complete words, rather than abbreviations.
For example, it is preferred to use <code>thickness</code> rather than
<code>th</code> or <code>t</code>.
</p>
<p>Multi-word variable names in C++ should have the words separated
by the underscore character (&lsquo;_&rsquo;):
</p>
<pre class="verbatim">cxx_multiword_variable
</pre>
<p>Multi-word variable names in Scheme should have the words separated
by a hyphen (&lsquo;-&rsquo;):
</p>
<pre class="verbatim">scheme-multiword-variable
</pre>
<hr size="6">
<a name="Broken-code"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#naming-conventions" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Naming conventions&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#code-style" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Code style&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#code-comments" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Code comments &gt; </a>]</td></tr></table>
<a name="broken-code"></a>
<h3 class="subsection">10.5.5 Broken code</h3>

<p>Do not write broken code.  This includes hardwired dependencies,
hardwired constants, slow algorithms and obvious limitations.  If
you can not avoid it, mark the place clearly, and add a comment
explaining shortcomings of the code.
</p>
<p>Ideally, the comment marking the shortcoming would include
TODO, so that it is marked for future fixing.
</p>
<p>We reject broken-in-advance on principle.
</p>

<hr size="6">
<a name="Code-comments"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#broken-code" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Broken code&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#code-style" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Code style&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#handling-errors" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Handling errors &gt; </a>]</td></tr></table>
<a name="code-comments"></a>
<h3 class="subsection">10.5.6 Code comments</h3>

<p>Comments may not be needed if descriptive variable names are used
in the code and the logic is straightforward.  However, if the
logic is difficult to follow, and particularly if non-obvious
code has been included to resolve a bug, a comment describing
the logic and/or the need for the non-obvious code should be included.
</p>
<p>There are instances where the current code could be commented better.
If significant time is required to understand the code as part of
preparing a patch, it would be wise to add comments reflecting your
understanding to make future work easier.
</p>

<hr size="6">
<a name="Handling-errors"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#code-comments" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Code comments&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#code-style" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Code style&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#localization" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Localization &gt; </a>]</td></tr></table>
<a name="handling-errors"></a>
<h3 class="subsection">10.5.7 Handling errors</h3>

<p>As a general rule, you should always try to continue computations,
even if there is some kind of error.  When the program stops, it
is often very hard for a user to pinpoint what part of the input
causes an error.  Finding the culprit is much easier if there is
some viewable output.
</p>
<p>So functions and methods do not return errorcodes, they never
crash, but report a programming_error and try to carry on.
</p>
<p>Error and warning messages need to be localized.
</p>

<hr size="6">
<a name="Localization"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#handling-errors" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Handling errors&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#code-style" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Code style&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#warnings-errors-progress-and-debug-output" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Warnings Errors Progress and Debug Output &gt; </a>]</td></tr></table>
<a name="localization"></a>
<h3 class="subsection">10.5.8 Localization</h3>

<p>This document provides some guidelines to help programmers write
proper user
messages.  To help translations, user messages must follow
uniform conventions.  Follow these rules when coding for LilyPond.
Hopefully, this can be replaced by general GNU guidelines in the
future.  Even better would be to have an English (en_BR, en_AM)
guide helping programmers writing consistent messages for all GNU
programs.
</p>
<p>Non-preferred messages are marked with &lsquo;+&rsquo;.  By convention,
ungrammatical examples are marked with &lsquo;*&rsquo;.  However, such ungrammatical
examples may still be preferred.
</p>
<ul>
<li>
Every message to the user should be localized (and thus be marked
for localization).  This includes warning and error messages.

</li><li>
Do not localize/gettextify:

<ul>
<li>
&lsquo;programming_error ()&rsquo;s

</li><li>
&lsquo;programming_warning ()&rsquo;s

</li><li>
debug strings

</li><li>
output strings (PostScript, TeX, etc.)

</li></ul>

</li><li>
Messages to be localized must be encapsulated in &lsquo;_ (STRING)&rsquo; or
&lsquo;_f (FORMAT, ...)&rsquo;. E.g.:

<blockquote><pre class="example">warning (_ (&quot;need music in a score&quot;));
error (_f (&quot;cannot open file: `%s'&quot;, file_name));
</pre></blockquote>

<p>In some rare cases you may need to call &lsquo;gettext ()&rsquo; by hand.  This
happens when you pre-define (a list of) string constants for later
use.  In that case, you&rsquo;ll probably also need to mark these string
constants for translation, using &lsquo;_i (STRING)&rsquo;.  The &lsquo;_i&rsquo; macro is
a no-op, it only serves as a marker for &lsquo;xgettext&rsquo;.
</p>
<blockquote><pre class="example">char const* messages[] = {
  _i (&quot;enable debugging output&quot;),
  _i (&quot;ignore lilypond version&quot;),
  0
};

void
foo (int i)
{
  puts (gettext (messages i));
}
</pre></blockquote>

<p>See also &lsquo;<tt>flower/getopt-long.cc</tt>&rsquo; and &lsquo;<tt>lily/main.cc</tt>&rsquo;.
</p>
</li><li>
Do not use leading or trailing whitespace in messages.  If you need
whitespace to be printed, prepend or append it to the translated
message

<blockquote><pre class="example">message (&quot;Calculating line breaks...&quot; + &quot; &quot;);
</pre></blockquote>

</li><li>
Error or warning messages displayed with a file name and line
number never start with a capital, eg,

<blockquote><pre class="example">foo.ly: 12: not a duration: 3
</pre></blockquote>

<p>Messages containing a final verb, or a gerund (&lsquo;-ing&rsquo;-form) always
start with a capital.  Other (simpler) messages start with a
lowercase letter
</p>
<blockquote><pre class="example">Processing foo.ly...
`foo': not declared.
Not declaring: `foo'.
</pre></blockquote>

</li><li>
Avoid abbreviations or short forms, use &lsquo;cannot&rsquo; and &lsquo;do not&rsquo;
rather than &lsquo;can&rsquo;t&rsquo; or &lsquo;don&rsquo;t&rsquo;
To avoid having a number of different messages for the same
situation, well will use quoting like this &lsquo;&quot;message: &lsquo;%s&rsquo;&quot;&rsquo; for all
strings.  Numbers are not quoted:

<blockquote><pre class="example">_f (&quot;cannot open file: `%s'&quot;, name_str)
_f (&quot;cannot find character number: %d&quot;, i)
</pre></blockquote>

</li><li>
Think about translation issues.  In a lot of cases, it is better to
translate a whole message.  English grammar must not be imposed on the
translator.  So, instead of

<blockquote><pre class="example">stem at  + moment.str () +  does not fit in beam
</pre></blockquote>

<p>have
</p>
<blockquote><pre class="example">_f (&quot;stem at %s does not fit in beam&quot;, moment.str ())
</pre></blockquote>

</li><li>
Split up multi-sentence messages, whenever possible.  Instead of

<blockquote><pre class="example">warning (_f (&quot;out of tune!  Can't find: `%s'&quot;, &quot;Key_engraver&quot;));
warning (_f (&quot;cannot find font `%s', loading default&quot;, font_name));
</pre></blockquote>

<p>rather say:
</p>
<blockquote><pre class="example">warning (_ (&quot;out of tune:&quot;));
warning (_f (&quot;cannot find: `%s', &quot;Key_engraver&quot;));
warning (_f (&quot;cannot find font: `%s', font_name));
warning (_f (&quot;Loading default font&quot;));
</pre></blockquote>

</li><li>
If you must have multiple-sentence messages, use full punctuation.
Use two spaces after end of sentence punctuation.  No punctuation
(esp. period) is used at the end of simple messages.

<blockquote><pre class="example">_f (&quot;Non-matching braces in text `%s', adding braces&quot;, text)
_ (&quot;Debug output disabled.  Compiled with NPRINT.&quot;)
_f (&quot;Huh?  Not a Request: `%s'.  Ignoring.&quot;, request)
</pre></blockquote>

</li><li>
Do not modularize too much; words frequently cannot be translated
without context.  It is probably safe to treat most occurrences of
words like stem, beam, crescendo as separately translatable words.

</li><li>
When translating, it is preferable to put interesting information
at the end of the message, rather than embedded in the middle.
This especially applies to frequently used messages, even if this
would mean sacrificing a bit of eloquence.  This holds for original
messages too, of course.

<blockquote><pre class="example">en: cannot open: `foo.ly'
+   nl: kan `foo.ly' niet openen (1)
kan niet openen: `foo.ly'*   (2)
niet te openen: `foo.ly'*    (3)
</pre></blockquote>


<p>The first nl message, although grammatically and stylistically
correct, is not friendly for parsing by humans (even if they speak
dutch).  I guess we would prefer something like (2) or (3).
</p>
</li><li>
Do not run make po/po-update with GNU gettext &lt; 0.10.35

</li></ul>


<hr size="6">
<a name="Warnings-Errors-Progress-and-Debug-Output"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#localization" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Localization&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#programming-work" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Programming work&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#warnings-errors-progress-and-debug-output" title="Next section in reading order" accesskey="n" rel="next">&nbsp; &gt; </a>]</td></tr></table>
<a name="warnings-errors-progress-and-debug-output"></a>
<h2 class="section">10.6 Warnings, Errors, Progress and Debug Output</h2>

<hr size="6">
<a name="warnings-errors-progress-and-debug-output"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#warnings-errors-progress-and-debug-output" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Warnings Errors Progress and Debug Output&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#warnings-errors-progress-and-debug-output" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Warnings Errors Progress and Debug Output&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#warnings-errors-progress-and-debug-output" title="Next section in reading order" accesskey="n" rel="next">&nbsp; &gt; </a>]</td></tr></table>
<h3 class="unnumberedsubsec">Available log levels</h3>

<p>LilyPond has several loglevels, which specify how verbose the output on
the console should be:
</p><ul>
<li> NONE: No output at all, even on failure
</li><li> ERROR: Only error messages
</li><li> WARN: Only error messages and warnings
</li><li> BASIC_PROGRESS: Warnings, errors and basic progress (success, etc.)
</li><li> PROGRESS: Warnings, errors and full progress messages
</li><li> INFO: Warnings, errors, progress and more detailed information (default)
</li><li> DEBUG: All messages, including full debug messages (very verbose!)
</li></ul>

<p>The loglevel can either be set with the environment variable
<code>LILYPOND_LOGLEVEL</code> or on the command line with the &lsquo;<samp>--loglevel=...</samp>&rsquo;
option.
</p>
<hr size="6">
<a name="warnings-errors-progress-and-debug-output"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#warnings-errors-progress-and-debug-output" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; &nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#warnings-errors-progress-and-debug-output" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Warnings Errors Progress and Debug Output&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#warnings-errors-progress-and-debug-output" title="Next section in reading order" accesskey="n" rel="next">&nbsp; &gt; </a>]</td></tr></table>
<h3 class="unnumberedsubsec">Functions for debug and log output</h3>

<p>LilyPond has two different types of error and log functions:
</p><ul>
<li>
If a warning or error is caused by an identified position in the input file,
e.g. by a grob or by a music expression, the functions of the <code>Input</code>
class provide logging functionality that prints the position of the message
in addition to the message.

</li><li>
If a message can not be associated with a particular position in an input file,
e.g. the output file cannot be written, then the functions in the 
<code>flower/include/warn.hh</code> file will provide logging functionality that 
only prints out the message, but no location.

</li></ul>

<p>There are also Scheme functions to access all of these logging functions from
scheme.  In addition, the Grob class contains some convenience wrappers for
even easier access to these functions.
</p>
<p>The message and debug functions in <code>warn.hh</code> also have an optional 
argument <code>newline</code>, which specifies whether the message should always
start on a new line or continue a previous message.
By default, <code>progress_indication</code> does NOT start on a new line, but rather
continue the previous output.  They also do not have a particular input
position associated, so there are no progress functions in the Input class.
All other functions by default start their output on a new line.
</p>
<p>The error functions come in three different flavors: fatal error messages,
programming error messages and normal error messages.  Errors written
by the <code>error ()</code> function will cause LilyPond to exit immediately,
errors by <code>Input::error ()</code> will continue the compilation, but
return a non-zero return value of the lilypond call (i.e. indicate an 
unsuccessful program execution).  All other errors will be printed on the 
console, but not exit LilyPond or indicate an unsuccessful return code.
Their only differences to a warnings are the displayed text and that
they will be shown with loglevel <code>ERROR</code>.
</p>
<p>If the Scheme option <code>warning-as-error</code> is set, any warning will be
treated as if <code>Input::error</code> was called.
</p>

<hr size="6">
<a name="warnings-errors-progress-and-debug-output"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#warnings-errors-progress-and-debug-output" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; &nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#warnings-errors-progress-and-debug-output" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Warnings Errors Progress and Debug Output&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#debugging-lilypond" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Debugging LilyPond &gt; </a>]</td></tr></table>
<h3 class="unnumberedsubsec">All logging functions at a glance</h3>

<table>
<thead><tr><th width="16%"></th><th width="42%">C++, no location</th><th width="42%">C++ from input location</th></tr></thead>
<tr><td width="16%">ERROR</td><td width="42%"><code>error ()</code>, <code>programming_error (msg)</code>, <code>non_fatal_error (msg)</code></td><td width="42%"><code>Input::error (msg)</code>, <code>Input::programming_error (msg)</code></td></tr>
<tr><td width="16%">WARN</td><td width="42%"><code>warning (msg)</code></td><td width="42%"><code>Input::warning (msg)</code></td></tr>
<tr><td width="16%">BASIC</td><td width="42%"><code>basic_progress (msg)</code></td><td width="42%">-</td></tr>
<tr><td width="16%">PROGRESS</td><td width="42%"><code>progress_indication (msg)</code></td><td width="42%">-</td></tr>
<tr><td width="16%">INFO</td><td width="42%"><code>message (msg)</code></td><td width="42%"><code>Input::message (msg)</code></td></tr>
<tr><td width="16%">DEBUG</td><td width="42%"><code>debug_output (msg)</code></td><td width="42%"><code>Input::debug_output (msg)</code></td></tr>
<tr><td width="16%"></td><td width="42%"></td><td width="42%"></td></tr>
<thead><tr><th width="16%"></th><th width="42%">C++ from a Grob</th><th width="42%">Scheme, music expression</th></tr></thead>
<tr><td width="16%">ERROR</td><td width="42%"><code>Grob::programming_error (msg)</code></td><td width="42%">-</td></tr>
<tr><td width="16%">WARN</td><td width="42%"><code>Grob::warning (msg)</code></td><td width="42%"><code>(ly:music-warning music msg)</code></td></tr>
<tr><td width="16%">BASIC</td><td width="42%">-</td><td width="42%">-</td></tr>
<tr><td width="16%">PROGRESS</td><td width="42%">-</td><td width="42%">-</td></tr>
<tr><td width="16%">INFO</td><td width="42%">-</td><td width="42%"><code>(ly:music-message music msg)</code></td></tr>
<tr><td width="16%">DEBUG</td><td width="42%">-</td><td width="42%">-</td></tr>
<tr><td width="16%"></td><td width="42%"></td><td width="42%"></td></tr>
<thead><tr><th width="16%"></th><th width="42%">Scheme, no location</th><th width="42%">Scheme, input location</th></tr></thead>
<tr><td width="16%">ERROR</td><td width="42%">-</td><td width="42%"><code>(ly:error msg args)</code>, <code>(ly:programming-error msg args)</code></td></tr>
<tr><td width="16%">WARN</td><td width="42%"><code>(ly:warning msg args)</code></td><td width="42%"><code>(ly:input-warning input msg args)</code></td></tr>
<tr><td width="16%">BASIC</td><td width="42%"><code>(ly:basic-progress msg args)</code></td><td width="42%">-</td></tr>
<tr><td width="16%">PROGRESS</td><td width="42%"><code>(ly:progress msg args)</code></td><td width="42%">-</td></tr>
<tr><td width="16%">INFO</td><td width="42%"><code>(ly:message msg args)</code></td><td width="42%"><code>(ly:input-message input msg args)</code></td></tr>
<tr><td width="16%">DEBUG</td><td width="42%"><code>(ly:debug msg args)</code></td><td width="42%">-</td></tr>
</table>




<hr size="6">
<a name="Debugging-LilyPond"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#warnings-errors-progress-and-debug-output" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; &nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#programming-work" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Programming work&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#debugging-overview" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Debugging overview &gt; </a>]</td></tr></table>
<a name="debugging-lilypond"></a>
<h2 class="section">10.7 Debugging LilyPond</h2>

<p>The most commonly used tool for debugging LilyPond is the GNU
debugger gdb.  The gdb tool is used for investigating and debugging
core Lilypond code written in C++.  Another tool is available for
debugging Scheme code using the Guile debugger.  This section
describes how to use both gdb and the Guile Debugger.
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#debugging-overview" accesskey="1">10.7.1 Debugging overview</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#debugging-c_002b_002b-code" accesskey="2">10.7.2 Debugging C++ code</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#debugging-scheme-code" accesskey="3">10.7.3 Debugging Scheme code</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr size="6">
<a name="Debugging-overview"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#debugging-lilypond" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Debugging LilyPond&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#debugging-lilypond" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Debugging LilyPond&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#debugging-c_002b_002b-code" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Debugging C++ code &gt; </a>]</td></tr></table>
<a name="debugging-overview"></a>
<h3 class="subsection">10.7.1 Debugging overview</h3>

<p>Using a debugger simplifies troubleshooting in at least two ways.
</p>
<p>First, breakpoints can be set to pause execution at any desired point.
Then, when execution has paused, debugger commands can be issued to
explore the values of various variables or to execute functions.
</p>
<p>Second, the debugger can display a stack trace, which shows the
sequence in which functions have been called and the arguments
passed to the called functions.
</p>
<hr size="6">
<a name="Debugging-C_002b_002b-code"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#debugging-overview" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Debugging overview&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#debugging-lilypond" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Debugging LilyPond&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#debugging-scheme-code" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Debugging Scheme code &gt; </a>]</td></tr></table>
<a name="debugging-c_002b_002b-code"></a>
<h3 class="subsection">10.7.2 Debugging C++ code</h3>

<p>The GNU debugger, gdb, is the principal tool for debugging C++ code.
</p>
<a name="Compiling-LilyPond-for-use-with-gdb"></a>
<h3 class="subheading">Compiling LilyPond for use with gdb</h3>

<p>In order to use gdb with LilyPond, it is necessary to compile
LilyPond with debugging information.  This is accomplished by running
the following commands in the main LilyPond source directory.
</p>
<blockquote><pre class="example">./configure  --disable-optimising
make
</pre></blockquote>

<p>This will create a version of LilyPond containing debugging
information that will allow the debugger to tie the source code
to the compiled code.
</p>
<p>You should not do <var>make install</var> if you want to use a debugger
with LilyPond.  The <var>make install</var> command will strip debugging
information from the LilyPond binary.
</p>
<a name="Typical-gdb-usage"></a>
<h3 class="subheading">Typical gdb usage</h3>

<p>Once you have compiled the Lilypond image with the necessary
debugging information it will have been written to a location in a
subfolder of your current working directory:
</p>
<blockquote><pre class="example">out/bin/lilypond
</pre></blockquote>

<p>This is important as you will need to let gdb know where to find the
image containing the symbol tables.  You can invoke gdb from the
command line using the following:
</p>
<blockquote><pre class="example">gdb out/bin/lilypond
</pre></blockquote>
<p>This loads the LilyPond symbol tables into gdb.  Then, to run
LilyPond on &lsquo;<tt>test.ly</tt>&rsquo; under the debugger, enter the following:
</p>
<blockquote><pre class="example">run test.ly
</pre></blockquote>

<p>at the gdb prompt.
</p>
<p>As an alternative to running gdb at the command line you may try
a graphical interface to gdb such as ddd:
</p>
<blockquote><pre class="example">ddd out/bin/lilypond
</pre></blockquote>

<p>You can also use sets of standard gdb commands stored in a .gdbinit
file (see next section).
</p>
<a name="Typical-_002egdbinit-files"></a>
<h3 class="subheading">Typical .gdbinit files</h3>

<p>The behavior of gdb can be readily customized through the use of a
<var>.gdbinit</var> file.  A <var>.gdbinit</var> file is a file named
<var>.gdbinit</var> (notice the &ldquo;.&rdquo; at the beginning of the file name)
that is placed in a user&rsquo;s home directory.
</p>
<p>The <var>.gdbinit</var> file below is from Han-Wen.  It sets breakpoints
for all errors and defines functions for displaying scheme objects
(ps), grobs (pgrob), and parsed music expressions (pmusic).
</p>
<blockquote><pre class="example">file ~/lilypond-git/build/out/bin/lilypond
b programming_error
b Grob::programming_error

define ps
   print ly_display_scm($arg0)
end
define pgrob
  print ly_display_scm($arg0-&gt;self_scm_)
  print ly_display_scm($arg0-&gt;mutable_property_alist_)
  print ly_display_scm($arg0-&gt;immutable_property_alist_)
  print ly_display_scm($arg0-&gt;object_alist_)
end
define pmusic
  print ly_display_scm($arg0-&gt;self_scm_)
  print ly_display_scm($arg0-&gt;mutable_property_alist_)
  print ly_display_scm($arg0-&gt;immutable_property_alist_)
end
</pre></blockquote>

<hr size="6">
<a name="Debugging-Scheme-code"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#debugging-c_002b_002b-code" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Debugging C++ code&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#debugging-lilypond" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Debugging LilyPond&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#tracing-object-relationships" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Tracing object relationships &gt; </a>]</td></tr></table>
<a name="debugging-scheme-code"></a>
<h3 class="subsection">10.7.3 Debugging Scheme code</h3>

<p>Scheme code can be developed using the Guile command line
interpreter <code>top-repl</code>.  You can either investigate
interactively using just Guile or you can use the debugging
tools available within Guile.
</p>
<a name="Using-Guile-interactively-with-LilyPond"></a>
<h3 class="subheading">Using Guile interactively with LilyPond</h3>

<p>In order to experiment with Scheme programming in the LilyPond
environment, it is necessary to have a Guile interpreter that
has all the LilyPond modules loaded.  This requires the following
steps.
</p>
<p>First, define a Scheme symbol for the active module in the &lsquo;<tt>.ly</tt>&rsquo; file:
</p>
<blockquote><pre class="example">#(module-define! (resolve-module '(guile-user))
                 'lilypond-module (current-module))
</pre></blockquote>

<p>Now place a Scheme function in the &lsquo;<tt>.ly</tt>&rsquo; file that gives an
interactive Guile prompt:
</p>
<blockquote><pre class="example">#(top-repl)
</pre></blockquote>

<p>When the &lsquo;<tt>.ly</tt>&rsquo; file is compiled, this causes the compilation to be
interrupted and an interactive guile prompt to appear.  Once the
guile prompt appears, the LilyPond active module must be set as the
current guile module:
</p>
<blockquote><pre class="example">guile&gt; (set-current-module lilypond-module)
</pre></blockquote>

<p>You can demonstrate these commands are operating properly by typing the name
of a LilyPond public scheme function to check it has been defined:
</p>
<blockquote><pre class="example">guile&gt; fret-diagram-verbose-markup
#&lt;procedure fret-diagram-verbose-markup (layout props marking-list)&gt;
</pre></blockquote>

<p>If the LilyPond module has not been correctly loaded, an error
message will be generated:
</p>
<blockquote><pre class="example">guile&gt; fret-diagram-verbose-markup
ERROR: Unbound variable: fret-diagram-verbose-markup
ABORT: (unbound-variable)
</pre></blockquote>

<p>Once the module is properly loaded, any valid LilyPond Scheme
expression can be entered at the interactive prompt.
</p>
<p>After the investigation is complete, the interactive guile
interpreter can be exited:
</p>
<blockquote><pre class="example">guile&gt; (quit)
</pre></blockquote>

<p>The compilation of the &lsquo;<tt>.ly</tt>&rsquo; file will then continue.
</p>
<a name="Using-the-Guile-debugger"></a>
<h3 class="subheading">Using the Guile debugger</h3>

<p>To set breakpoints and/or enable tracing in Scheme functions, put
</p>
<blockquote><pre class="example">\include &quot;guile-debugger.ly&quot;
</pre></blockquote>

<p>in your input file after any scheme procedures you have defined in
that file.  This will invoke the Guile command-line after having set
up the environment for the debug command-line.  When your input file
is processed, a guile prompt will be displayed.  You may now enter
commands to set up breakpoints and enable tracing by the Guile debugger.
</p>
<a name="Using-breakpoints"></a>
<h3 class="subheading">Using breakpoints</h3>

<p>At the guile prompt, you can set breakpoints with
the <code>set-break!</code> procedure:
</p>
<blockquote><pre class="example">guile&gt; (set-break! my-scheme-procedure)
</pre></blockquote>

<p>Once you have set the desired breakpoints, you exit the guile repl frame
by typing:
</p>
<blockquote><pre class="example">guile&gt; (quit)
</pre></blockquote>

<p>Then, when one of the scheme routines for which you have set
breakpoints is entered, guile will interrupt execution in a debug
frame.  At this point you will have access to Guile debugging
commands.  For a listing of these commands, type:
</p>
<blockquote><pre class="example">debug&gt; help
</pre></blockquote>

<p>Alternatively you may code the breakpoints in your Lilypond source
file using a command such as:
</p>
<blockquote><pre class="example">#(set-break! my-scheme-procedure)
</pre></blockquote>

<p>immediately after the <code>\include</code> statement.  In this case the
breakpoint will be set straight after you enter the <code>(quit)</code>
command at the guile prompt.
</p>
<p>Embedding breakpoint commands like this is particularly useful if
you want to look at how the Scheme procedures in the &lsquo;<tt>.scm</tt>&rsquo;
files supplied with LilyPond work.  To do this, edit the file in
the relevant directory to add this line near the top:
</p>
<blockquote><pre class="example">(use-modules (scm guile-debugger))
</pre></blockquote>

<p>Now you can set a breakpoint after the procedure you are interested
in has been declared.  For example, if you are working on routines
called by <var>print-book-with</var> in &lsquo;<tt>lily-library.scm</tt>&rsquo;:
</p>
<blockquote><pre class="example">(define (print-book-with parser book process-procedure)
  (let* ((paper (ly:parser-lookup parser '$defaultpaper))
	 (layout (ly:parser-lookup parser '$defaultlayout))
	 (outfile-name (get-outfile-name parser)))
    (process-procedure book paper layout outfile-name)))

(define-public (print-book-with-defaults parser book)
  (print-book-with parser book ly:book-process))

(define-public (print-book-with-defaults-as-systems parser book)
  (print-book-with parser book ly:book-process-to-systems))

</pre></blockquote>

<p>At this point in the code you could add this to set a breakpoint at
print-book-with:
</p>
<blockquote><pre class="example">(set-break! print-book-with)
</pre></blockquote>

<a name="Tracing-procedure-calls-and-evaluator-steps"></a>
<h3 class="subheading">Tracing procedure calls and evaluator steps</h3>

<p>Two forms of trace are available:
</p>
<blockquote><pre class="example">(set-trace-call! my-scheme-procedure)
</pre></blockquote>

<p>and
</p>
<blockquote><pre class="example">(set-trace-subtree! my-scheme-procedure)
</pre></blockquote>

<p><code>set-trace-call!</code> causes Scheme to log a line to the standard
output to show when the procedure is called and when it exits.
</p>
<p><code>set-trace-subtree!</code> traces every step the Scheme evaluator
performs in evaluating the procedure.
</p>
<hr size="6">
<a name="Tracing-object-relationships"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#debugging-scheme-code" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Debugging Scheme code&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#programming-work" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Programming work&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#adding-or-modifying-features" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Adding or modifying features &gt; </a>]</td></tr></table>
<a name="tracing-object-relationships"></a>
<h2 class="section">10.8 Tracing object relationships</h2>

<p>Understanding the LilyPond source often boils down to figuring out what
is happening to the Grobs.  Where (and why) are they being created,
modified and destroyed? Tracing Lily through a debugger in order to
identify these relationships can be time-consuming and tedious.
</p>
<p>In order to simplify this process, a facility has been added to
display the grobs that are created and the properties that are set
and modified.  Although it can be complex to get set up, once set up
it easily provides detailed information about the life of grobs
in the form of a network graph.
</p>
<p>Each of the steps necessary to use the graphviz utility
is described below.
</p>
<ol>
<li> Installing graphviz

<p>In order to create the graph of the object relationships, it is
first necessary to install Graphviz.  Graphviz is available for a
number of different platforms:
</p>
<blockquote><pre class="example"><a href="http://www.graphviz.org/Download..php">http://www.graphviz.org/Download..php</a>
</pre></blockquote>

</li><li> Modifying config.make

<p>In order for the Graphviz tool to work, config.make must be modified.
It is probably a good idea to first save a copy of config.make under
a different name.  Then, edit config.make by removing every occurrence
of &lsquo;<samp>-DNDEBUG</samp>&rsquo;.
</p>
</li><li> Rebuilding LilyPond

<p>The executable code of LilyPond must be rebuilt from scratch:
</p>
<blockquote><pre class="example">make -C lily clean &amp;&amp; make -C lily
</pre></blockquote>

</li><li> Create a graphviz-compatible &lsquo;<tt>.ly</tt>&rsquo; file

<p>In order to use the graphviz utility, the &lsquo;<tt>.ly</tt>&rsquo; file must include
&lsquo;<tt>ly/graphviz-init.ly</tt>&rsquo;, and should then specify the
grobs and symbols that should be tracked.  An example of this
is found in &lsquo;<tt>input/regression/graphviz.ly</tt>&rsquo;.
</p>
</li><li> Run lilypond with output sent to a log file

<p>The Graphviz data is sent to stderr by lilypond, so it is
necessary to redirect stderr to a logfile:
</p>
<blockquote><pre class="example">lilypond graphviz.ly 2&gt; graphviz.log
</pre></blockquote>

</li><li> Edit the logfile

<p>The logfile has standard lilypond output, as well as the Graphviz
output data.  Delete everything from the beginning of the file
up to but not including the first occurrence of <code>digraph</code>.
</p>
<p>Also, delete the final lilypond message about success from the end
of the file.
</p>
</li><li> Process the logfile with <code>dot</code>

<p>The directed graph is created from the log file with the program
<code>dot</code>:
</p>
<blockquote><pre class="example">dot -Tpdf graphviz.log &gt; graphviz.pdf
</pre></blockquote>

</li></ol>

<p>The pdf file can then be viewed with any pdf viewer.
</p>
<p>When compiled without &lsquo;<samp>-DNDEBUG</samp>&rsquo;, lilypond may run slower
than normal.  The original configuration can be restored by either
renaming the saved copy of <code>config.make</code> or rerunning
<code>configure</code>.  Then rebuild lilypond with
</p>
<blockquote><pre class="example">make -C lily clean &amp;&amp; make -C lily
</pre></blockquote>


<hr size="6">
<a name="Adding-or-modifying-features"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#tracing-object-relationships" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Tracing object relationships&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#programming-work" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Programming work&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#write-the-code" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Write the code &gt; </a>]</td></tr></table>
<a name="adding-or-modifying-features"></a>
<h2 class="section">10.9 Adding or modifying features</h2>

<p>When a new feature is to be added to LilyPond, it is necessary to
ensure that the feature is properly integrated to maintain
its long-term support.  This section describes the steps necessary
for feature addition and modification.
</p>

<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#write-the-code" accesskey="1">10.9.1 Write the code</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#write-regression-tests" accesskey="2">10.9.2 Write regression tests</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#write-convert_002dly-rule" accesskey="3">10.9.3 Write convert-ly rule</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#automatically-update-documentation" accesskey="4">10.9.4 Automatically update documentation</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#manually-update-documentation" accesskey="5">10.9.5 Manually update documentation</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#edit-changes_002etely" accesskey="6">10.9.6 Edit changes.tely</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#verify-successful-build" accesskey="7">10.9.7 Verify successful build</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#verify-regression-tests" accesskey="8">10.9.8 Verify regression tests</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#post-patch-for-comments" accesskey="9">10.9.9 Post patch for comments</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#push-patch">10.9.10 Push patch</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#closing-the-issues">10.9.11 Closing the issues</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr size="6">
<a name="Write-the-code"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#adding-or-modifying-features" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Adding or modifying features&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#adding-or-modifying-features" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Adding or modifying features&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#write-regression-tests" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Write regression tests &gt; </a>]</td></tr></table>
<a name="write-the-code"></a>
<h3 class="subsection">10.9.1 Write the code</h3>

<p>You should probably create a new git branch for writing the code, as that
will separate it from the master branch and allow you to continue
to work on small projects related to master.
</p>
<p>Please be sure to follow the rules for programming style discussed
earlier in this chapter.
</p>

<hr size="6">
<a name="Write-regression-tests"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#write-the-code" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Write the code&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#adding-or-modifying-features" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Adding or modifying features&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#write-convert_002dly-rule" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Write convert-ly rule &gt; </a>]</td></tr></table>
<a name="write-regression-tests"></a>
<h3 class="subsection">10.9.2 Write regression tests</h3>

<p>In order to demonstrate that the code works properly, you will
need to write one or more regression tests.  These tests are
typically &lsquo;<tt>.ly</tt>&rsquo; files that are found in &lsquo;<tt>input/regression</tt>&rsquo;.
</p>
<p>Regression tests should be as brief as possible to demonstrate the
functionality of the code.
</p>
<p>Regression tests should generally cover one issue per test.  Several
short, single-issue regression tests are preferred to a single, long,
multiple-issue regression test.
</p>
<p>If the change in the output is small or easy to overlook, use bigger
staff size &ndash; 40 or more (up to 100 in extreme cases).  Size 30 means
&quot;pay extra attention to details in general&quot;.
</p>
<p>Use existing regression tests as templates to demonstrate the type of
header information that should be included in a regression test.
</p>

<hr size="6">
<a name="Write-convert_002dly-rule"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#write-regression-tests" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Write regression tests&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#adding-or-modifying-features" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Adding or modifying features&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#automatically-update-documentation" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Automatically update documentation &gt; </a>]</td></tr></table>
<a name="write-convert_002dly-rule"></a>
<h3 class="subsection">10.9.3 Write convert-ly rule</h3>

<p>If the modification changes the input syntax, a convert-ly rule
should be written to automatically update input files from older
versions.
</p>
<p>convert-ly rules are found in python/convertrules.py
</p>
<p>If possible, the convert-ly rule should allow automatic updating
of the file.  In some cases, this will not be possible, so the
rule will simply point out to the user that the feature needs
manual correction.
</p>
<a name="Updating-version-numbers"></a>
<h4 class="subsubheading">Updating version numbers</h4>

<p>If a development release occurs between you writing your patch and
having it approved+pushed, you will need to update the version
numbers in your tree.  This can be done with:
</p>
<blockquote><pre class="example">scripts/auxiliar/update-patch-version old.version.number new.version.number
</pre></blockquote>

<p>It will change all files in git, so use with caution and examine
the resulting diff.
</p>

<hr size="6">
<a name="Automatically-update-documentation"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#write-convert_002dly-rule" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Write convert-ly rule&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#adding-or-modifying-features" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Adding or modifying features&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#manually-update-documentation" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Manually update documentation &gt; </a>]</td></tr></table>
<a name="automatically-update-documentation"></a>
<h3 class="subsection">10.9.4 Automatically update documentation</h3>

<p><code>convert-ly</code> should be used to update the documentation,
the snippets, and the regression tests.  This not only makes the
necessary syntax changes, it also tests the <code>convert-ly</code>
rules.
</p>
<p>The automatic updating is performed by moving to the top-level
source directory, then running:
</p>
<blockquote><pre class="example">scripts/auxiliar/update-with-convert-ly.sh
</pre></blockquote>

<p>If you did an out-of-tree build, pass in the relative path:
</p>
<blockquote><pre class="example">BUILD_DIR=../build-lilypond/ scripts/auxiliar/update-with-convert-ly.sh
</pre></blockquote>


<hr size="6">
<a name="Manually-update-documentation"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#automatically-update-documentation" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Automatically update documentation&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#adding-or-modifying-features" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Adding or modifying features&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#edit-changes_002etely" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Edit changes.tely &gt; </a>]</td></tr></table>
<a name="manually-update-documentation"></a>
<h3 class="subsection">10.9.5 Manually update documentation</h3>

<p>Where the convert-ly rule is not able to automatically update the inline
lilypond code in the documentation (i.e. if a NOT_SMART rule is used), the
documentation must be manually updated.  The inline snippets that require
changing must be changed in the English version of the docs and all
translated versions.  If the inline code is not changed in the
translated documentation, the old snippets will show up in the
English version of the documentation.
</p>
<p>Where the convert-ly rule is not able to automatically update snippets
in Documentation/snippets/, those snippets must be manually updated.
Those snippets should be copied to Documentation/snippets/new.  The
comments at the top of the snippet describing its automatic generation
should be removed.  All translated texidoc strings should be removed.
The comment &ldquo;% begin verbatim&rdquo; should be removed.  The syntax of
the snippet should then be manually edited.
</p>
<p>Where snippets in Documentation/snippets are made obsolete, the snippet
should be copied to Documentation/snippets/new.  The comments and
texidoc strings should be removed as described above.  Then the body
of the snippet should be changed to:
</p>
<blockquote><pre class="example">\markup {
  This snippet is deprecated as of version X.Y.Z and
  will be removed from the documentation.
}
</pre></blockquote>

<p>where X.Y.Z is the version number for which the convert-ly rule was
written.
</p>
<p>Update the snippet files by running:
</p>
<blockquote><pre class="example">scripts/auxiliar/makelsr.py
</pre></blockquote>

<p>Where the convert-ly rule is not able to automatically update regression
tests, the regression tests in input/regression should be manually
edited.
</p>
<p>Although it is not required, it is helpful if the developer
can write relevant material for inclusion in the Notation
Reference.  If the developer does not feel qualified to write
the documentation, a documentation editor will be able to
write it from the regression tests.  The text that is added to
or removed from the documentation should be changed only in
the English version.
</p>

<hr size="6">
<a name="Edit-changes_002etely"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#manually-update-documentation" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Manually update documentation&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#adding-or-modifying-features" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Adding or modifying features&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#verify-successful-build" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Verify successful build &gt; </a>]</td></tr></table>
<a name="edit-changes_002etely"></a>
<h3 class="subsection">10.9.6 Edit changes.tely</h3>

<p>An entry should be added to Documentation/changes.tely to describe
the feature changes to be implemented.  This is especially important
for changes that change input file syntax.
</p>
<p>Hints for changes.tely entries are given at the top of the file.
</p>
<p>New entries in changes.tely go at the top of the file.
</p>
<p>The changes.tely entry should be written to show how the new change
improves LilyPond, if possible.
</p>

<hr size="6">
<a name="Verify-successful-build"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#edit-changes_002etely" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Edit changes.tely&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#adding-or-modifying-features" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Adding or modifying features&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#verify-regression-tests" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Verify regression tests &gt; </a>]</td></tr></table>
<a name="verify-successful-build"></a>
<h3 class="subsection">10.9.7 Verify successful build</h3>

<p>When the changes have been made, successful completion must be
verified by doing
</p>
<blockquote><pre class="example">make all
make doc
</pre></blockquote>

<p>When these commands complete without error, the patch is
considered to function successfully.
</p>
<p>Developers on Windows who are unable to build LilyPond should
get help from a GNU/Linux or OSX developer to do the make tests.
</p>

<hr size="6">
<a name="Verify-regression-tests"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#verify-successful-build" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Verify successful build&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#adding-or-modifying-features" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Adding or modifying features&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#post-patch-for-comments" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Post patch for comments &gt; </a>]</td></tr></table>
<a name="verify-regression-tests"></a>
<h3 class="subsection">10.9.8 Verify regression tests</h3>

<p>In order to avoid breaking LilyPond, it is important to verify that
the regression tests succeed, and that no unwanted changes are
introduced into the output.  This process is described in
<a href="#regtest-comparison">Regtest comparison</a>.
</p>
<a name="Typical-developer_0027s-edit_002fcompile_002ftest-cycle"></a>
<h3 class="subheading">Typical developer&rsquo;s edit/compile/test cycle</h3>

<ul>
<li>
Initial test:

<blockquote><pre class="example">make [-j<var>X</var>]
make [-j<var>X</var> CPU_COUNT=<var>X</var>] test-baseline
make [-j<var>X</var> CPU_COUNT=<var>X</var>] check
</pre></blockquote>

</li><li>
Edit/compile/test cycle:

<blockquote><pre class="example"><em>## edit source files, then...</em>

make clean                       <em>## only if needed (see below)</em>
make [-j<var>X</var>]                       <em>## only if needed (see below)</em>
make [-j<var>X</var> CPU_COUNT=<var>X</var>] test-redo <em>## redo files differing from baseline</em>
make [-j<var>X</var> CPU_COUNT=<var>X</var>] check
</pre></blockquote>

</li><li>
Reset:

<blockquote><pre class="example">make test-clean
</pre></blockquote>
</li></ul>

<p>If you modify any source files that have to be compiled (such as
&lsquo;<tt>.cc</tt>&rsquo; or &lsquo;<tt>.hh</tt>&rsquo; files in &lsquo;<tt>flower/</tt>&rsquo; or &lsquo;<tt>lily/</tt>&rsquo;),
then you must run <code>make</code> before <code>make test-redo</code>,
so <code>make</code> can compile the modified files and relink all
the object files.  If you only modify files which are interpreted,
like those in the &lsquo;<tt>scm/</tt>&rsquo; and &lsquo;<tt>ly/</tt>&rsquo; directories, then
<code>make</code> is not needed before <code>make test-redo</code>.
</p>
<p>Also, if you modify any font definitions in the &lsquo;<tt>mf/</tt>&rsquo;
directory then you must run <code>make clean</code> and
<code>make</code> before running <code>make test-redo</code>.  This will
recompile everything, whether modified or not, and takes a lot
longer.
</p>
<p>Running <code>make&nbsp;check</code> will leave an HTML page
&lsquo;<tt>out/test-results/index.html</tt>&rsquo;.  This page shows all the
important differences that your change introduced, whether in the
layout, MIDI, performance or error reporting.
</p>
<p>You only need to use <code>make test-clean</code> to start from
scratch, prior to running <code>make&nbsp;test-baseline</code>. To
check new modifications, all that is needed is to repeat
<code>make&nbsp;test-redo</code> and <code>make&nbsp;test-check</code>
(not forgetting <code>make</code> if needed).
</p>



<hr size="6">
<a name="Post-patch-for-comments"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#verify-regression-tests" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Verify regression tests&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#adding-or-modifying-features" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Adding or modifying features&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#push-patch" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Push patch &gt; </a>]</td></tr></table>
<a name="post-patch-for-comments"></a>
<h3 class="subsection">10.9.9 Post patch for comments</h3>

<p>See <a href="#uploading-a-patch-for-review">Uploading a patch for review</a>.
</p>

<hr size="6">
<a name="Push-patch"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#post-patch-for-comments" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Post patch for comments&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#adding-or-modifying-features" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Adding or modifying features&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#closing-the-issues" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Closing the issues &gt; </a>]</td></tr></table>
<a name="push-patch"></a>
<h3 class="subsection">10.9.10 Push patch</h3>

<p>Once all the comments have been addressed, the patch can be pushed.
</p>
<p>If the author has push privileges, the author will push the patch.
Otherwise, a developer with push privileges will push the patch.
</p>

<hr size="6">
<a name="Closing-the-issues"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#push-patch" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Push patch&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#adding-or-modifying-features" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Adding or modifying features&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#iterator-tutorial" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Iterator tutorial &gt; </a>]</td></tr></table>
<a name="closing-the-issues"></a>
<h3 class="subsection">10.9.11 Closing the issues</h3>

<p>Once the patch has been pushed, all the relevant issues should be
closed.
</p>
<p>On Rietveld, the author should log in and close the issue either by
using the &lsquo;Edit Issue&rsquo; link, or by clicking the circled x icon
to the left of the issue name.
</p>
<p>If the changes were in response to a feature request on the Google
issue tracker for LilyPond, the author should change the status to
Fixed and a tag &lsquo;fixed_x_y_z&rsquo; should be added, where the patch was
fixed in version x.y.z.  If
the author does not have privileges to change the status, an email
should be sent to bug-lilypond requesting the BugMeister to change
the status.
</p>

<hr size="6">
<a name="Iterator-tutorial"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#closing-the-issues" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Closing the issues&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#programming-work" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Programming work&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#engraver-tutorial" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Engraver tutorial &gt; </a>]</td></tr></table>
<a name="iterator-tutorial"></a>
<h2 class="section">10.10 Iterator tutorial</h2>

<p>TODO &ndash; this is a placeholder for a tutorial on iterators
</p>
<p>Iterators are routines written in C++ that process music expressions
and sent the music events to the appropriate engravers and/or
performers.
</p>
<p>See a short example discussing iterators and their duties in
<a href="#articulations-on-eventchord">Articulations on EventChord</a>.
</p>

<hr size="6">
<a name="Engraver-tutorial"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#iterator-tutorial" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Iterator tutorial&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#programming-work" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Programming work&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#useful-methods-for-information-processing" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Useful methods for information processing &gt; </a>]</td></tr></table>
<a name="engraver-tutorial"></a>
<h2 class="section">10.11 Engraver tutorial</h2>

<p>Engravers are C++ classes that catch music events and
create the appropriate grobs for display on the page.  Though the
majority of engravers are responsible for the creation of a single grob,
in some cases (e.g. <code>New_fingering_engraver</code>), several different grobs
may be created.
</p>
<p>Engravers listen for events and acknowledge grobs.  Events are passed to
the engraver in time-step order during the iteration phase.  Grobs are
made available to the engraver when they are created by other engravers
during the iteration phase.
</p>

<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#useful-methods-for-information-processing" accesskey="1">10.11.1 Useful methods for information processing</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#translation-process" accesskey="2">10.11.2 Translation process</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#preventing-garbage-collection-for-scm-member-variables" accesskey="3">10.11.3 Preventing garbage collection for SCM member variables</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#listening-to-music-events" accesskey="4">10.11.4 Listening to music events</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#acknowledging-grobs" accesskey="5">10.11.5 Acknowledging grobs</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#engraver-declaration_002fdocumentation" accesskey="6">10.11.6 Engraver declaration/documentation</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr size="6">
<a name="Useful-methods-for-information-processing"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#engraver-tutorial" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Engraver tutorial&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#engraver-tutorial" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Engraver tutorial&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#translation-process" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Translation process &gt; </a>]</td></tr></table>
<a name="useful-methods-for-information-processing"></a>
<h3 class="subsection">10.11.1 Useful methods for information processing</h3>

<p>An engraver inherits the following public methods from the Translator
base class, which can be used to process listened events and acknowledged
grobs:
</p>
<ul>
<li> <code>virtual void initialize ()</code>
</li><li> <code>void start_translation_timestep ()</code>
</li><li> <code>void process_music ()</code>
</li><li> <code>void process_acknowledged ()</code>
</li><li> <code>void stop_translation_timestep ()</code>
</li><li> <code>virtual void finalize ()</code>
</li></ul>

<p>These methods are listed in order of translation time, with
<code>initialize ()</code> and <code>finalize ()</code> bookending the whole
process.  <code>initialize ()</code> can be used for one-time initialization
of context properties before translation starts, whereas
<code>finalize ()</code> is often used to tie up loose ends at the end of
translation: for example, an unterminated spanner might be completed
automatically or reported with a warning message.
</p>

<hr size="6">
<a name="Translation-process"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#useful-methods-for-information-processing" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Useful methods for information processing&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#engraver-tutorial" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Engraver tutorial&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#preventing-garbage-collection-for-scm-member-variables" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Preventing garbage collection for SCM member variables &gt; </a>]</td></tr></table>
<a name="translation-process"></a>
<h3 class="subsection">10.11.2 Translation process</h3>

<p>At each timestep in the music, translation proceeds by calling the
following methods in turn:
</p>
<p><code>start_translation_timestep ()</code> is called before any user
information enters the translators, i.e., no property operations
(\set, \override, etc.) or events have been processed yet.
</p>
<p><code>process_music ()</code> and <code>process_acknowledged ()</code> are called
after all events in the current time step have been heard, or all
grobs in the current time step have been acknowledged.  The latter
tends to be used exclusively with engravers which only acknowledge
grobs, whereas the former is the default method for main processing
within engravers.
</p>
<p><code>stop_translation_timestep ()</code> is called after all user
information has been processed prior to beginning the translation for
the next timestep.
</p>

<hr size="6">
<a name="Preventing-garbage-collection-for-SCM-member-variables"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#translation-process" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Translation process&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#engraver-tutorial" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Engraver tutorial&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#listening-to-music-events" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Listening to music events &gt; </a>]</td></tr></table>
<a name="preventing-garbage-collection-for-scm-member-variables"></a>
<h3 class="subsection">10.11.3 Preventing garbage collection for SCM member variables</h3>

<p>In certain cases, an engraver might need to ensure private Scheme
variables (with type SCM) do not get swept away by Guile&rsquo;s garbage
collector: for example, a cache of the previous key signature which
must persist between timesteps.  The method
<code>virtual derived_mark () const</code> can be used in such cases:
</p>
<blockquote><pre class="example">Engraver_name::derived_mark ()
{
  scm_gc_mark (private_scm_member_)
}
</pre></blockquote>


<hr size="6">
<a name="Listening-to-music-events"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#preventing-garbage-collection-for-scm-member-variables" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Preventing garbage collection for SCM member variables&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#engraver-tutorial" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Engraver tutorial&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#acknowledging-grobs" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Acknowledging grobs &gt; </a>]</td></tr></table>
<a name="listening-to-music-events"></a>
<h3 class="subsection">10.11.4 Listening to music events</h3>

<p>External interfaces to the engraver are implemented by protected
macros including one or more of the following:
</p>
<ul>
<li> <code>DECLARE_TRANSLATOR_LISTENER (event_name)</code>
</li><li> <code>IMPLEMENT_TRANSLATOR_LISTENER (Engraver_name, event_name)</code>
</li></ul>

<p>where <var>event_name</var> is the type of event required to provide the
input the engraver needs and <var>Engraver_name</var> is the name of the
engraver.
</p>
<p>Following declaration of a listener, the method is implemented as follows:
</p>
<blockquote><pre class="example">IMPLEMENT_TRANSLATOR_LISTENER (Engraver_name, event_name)
void
Engraver_name::listen_event_name (Stream event *event)
{
  ...body of listener method...
}
</pre></blockquote>


<hr size="6">
<a name="Acknowledging-grobs"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#listening-to-music-events" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Listening to music events&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#engraver-tutorial" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Engraver tutorial&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#engraver-declaration_002fdocumentation" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Engraver declaration/documentation &gt; </a>]</td></tr></table>
<a name="acknowledging-grobs"></a>
<h3 class="subsection">10.11.5 Acknowledging grobs</h3>

<p>Some engravers also need information from grobs as they are created
and as they terminate.  The mechanism and methods to obtain this
information are set up by the macros:
</p>
<ul>
<li> <code>DECLARE_ACKNOWLEDGER (grob_interface)</code>
</li><li> <code>DECLARE_END_ACKNOWLEDGER (grob_interface)</code>
</li></ul>

<p>where <var>grob_interface</var> is an interface supported by the
grob(s) which should be acknowledged.  For example, the following
code would declare acknowledgers for a <code>NoteHead</code> grob (via the
<code>note-head-interface</code>) and any grobs which support the
<code>side-position-interface</code>:
</p>
<blockquote><pre class="example"><code>DECLARE_ACKNOWLEDGER (note_head)</code>
<code>DECLARE_ACKNOWLEDGER (side_position)</code>
</pre></blockquote>

<p>The <code>DECLARE_END_ACKNOWLEDGER ()</code> macro sets up a spanner-specific
acknowledger which will be called whenever a spanner ends.
</p>
<p>Following declaration of an acknowledger, the method is coded as follows:
</p>
<blockquote><pre class="example">void
Engraver_name::acknowledge_interface_name (Grob_info info)
{
  ...body of acknowledger method...
}
</pre></blockquote>

<p>Acknowledge functions are called in the order engravers are
<code>\consist</code>-ed (the only exception is if you set
<code>must-be-last</code> to <code>#t</code>).
</p>
<p>If useful things are to be done to the acknowledged grobs, this
should be deferred until all the acknowledging has finished, i.e.,
store the acknowledged grobs and process the information in a
<code>process-acknowledged ()</code> or <code>stop-translation-timestep ()</code> 
function.
</p>

<hr size="6">
<a name="Engraver-declaration_002fdocumentation"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#acknowledging-grobs" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Acknowledging grobs&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#engraver-tutorial" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Engraver tutorial&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#callback-tutorial" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Callback tutorial &gt; </a>]</td></tr></table>
<a name="engraver-declaration_002fdocumentation"></a>
<h3 class="subsection">10.11.6 Engraver declaration/documentation</h3>

<p>An engraver must have a public macro
</p>
<ul>
<li> <code>TRANSLATOR_DECLARATIONS (Engraver_name)</code>
</li></ul>

<p>where <code>Engraver_name</code> is the name of the engraver.  This
defines the common variables and methods used by every engraver.
</p>
<p>At the end of the engraver file, one or both of the following
macros are generally called to document the engraver in the
Internals Reference:
</p>
<ul>
<li> <code>ADD_ACKNOWLEDGER (Engraver_name, grob_interface)</code>
</li><li> <code>ADD_TRANSLATOR (Engraver_name, Engraver_doc,
    Engraver_creates, Engraver_reads, Engraver_writes)</code>
</li></ul>

<p>where <code>Engraver_name</code> is the name of the engraver, <code>grob_interface</code>
is the name of the interface that will be acknowledged,
<code>Engraver_doc</code> is a docstring for the engraver,
<code>Engraver_creates</code> is the set of grobs created by the engraver,
<code>Engraver_reads</code> is the set of properties read by the engraver,
and <code>Engraver_writes</code> is the set of properties written by
the engraver.
</p>
<p>The <code>ADD_ACKNOWLEDGER</code> and <code>ADD_TRANSLATOR</code> macros use a
non-standard indentation system.  Each interface, grob, read property,
and write property is on its own line, and the closing parenthesis
and semicolon for the macro all occupy a separate line beneath the final
interface or write property.  See existing engraver files for more
information.
</p>

<hr size="6">
<a name="Callback-tutorial"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#engraver-declaration_002fdocumentation" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Engraver declaration/documentation&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#programming-work" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Programming work&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#understanding-pure-properties" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Understanding pure properties &gt; </a>]</td></tr></table>
<a name="callback-tutorial"></a>
<h2 class="section">10.12 Callback tutorial</h2>

<p>TODO &ndash; This is a placeholder for a tutorial on callback functions.
</p>

<hr size="6">
<a name="Understanding-pure-properties"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#callback-tutorial" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Callback tutorial&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#programming-work" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Programming work&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#purity-in-lilypond" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Purity in LilyPond &gt; </a>]</td></tr></table>
<a name="understanding-pure-properties"></a>
<h2 class="section">10.13 Understanding pure properties</h2>

<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#purity-in-lilypond" accesskey="1">10.13.1 Purity in LilyPond</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#writing-a-pure-function" accesskey="2">10.13.2 Writing a pure function</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#how-purity-is-defined-and-stored" accesskey="3">10.13.3 How purity is defined and stored</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#where-purity-is-used" accesskey="4">10.13.4 Where purity is used</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#case-studies" accesskey="5">10.13.5 Case studies</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#debugging-tips" accesskey="6">10.13.6 Debugging tips</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<p>Pure properties are some of the most difficult properties to understand
in LilyPond but, once understood, it is much easier to work with
horizontal spacing.  This document provides an overview of what it means
for something to be &lsquo;pure&rsquo; in LilyPond, what this purity guarantees,
and where pure properties are stored and used.  It finishes by
discussing a few case studies for the pure programmer to save you some
time and to prevent you some major headaches.
</p>

<hr size="6">
<a name="Purity-in-LilyPond"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#understanding-pure-properties" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Understanding pure properties&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#understanding-pure-properties" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Understanding pure properties&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#writing-a-pure-function" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Writing a pure function &gt; </a>]</td></tr></table>
<a name="purity-in-lilypond"></a>
<h3 class="subsection">10.13.1 Purity in LilyPond</h3>
<p>Pure properties in LilyPond that do not have any &lsquo;side effects&rsquo;.
That is, looking up a pure property should never result in calls to the
following functions:
</p><ul>
<li> <code>set_property</code>
</li><li> <code>set_object</code>
</li><li> <code>suicide</code>
</li></ul>
<p>This means that, if the property is calculated via a callback, this callback
must not only avoid the functions above but make sure that any functions
it calls also avoid the functions above.  Also, to date in LilyPond, a pure
function will always return the same value before line breaking (or, more
precisely, before any version of <code>break_into_pieces</code> is called).  This
convention makes it possible to cache pure functions and be more flexible
about the order in which functions are called. For example; Stem #&rsquo;length has
a pure property that will <em>never</em> trigger one of the functions listed
above and will <em>always</em> return the same value before line breaking,
independent of where it is called.  Sometimes, this will be the actual length
of the Stem.  But sometimes it will not.  For example; stem that links up
with a beam will need its end set to the Y position of the beam at the stem&rsquo;s
X position.  However, the beam&rsquo;s Y positions can only be known after the score
is broken up in to several systems (a beam that has a shallow slope on a
compressed line of music, for example, may have a steeper one on an
uncompressed line).  Thus, we only call the impure version of the properties
once we are <em>absolutely certain</em> that all of the parameters needed to
calculate their final value have been calculated.  The pure version provides a
useful estimate of what this Stem length (or any property) will be, and
the art of creating good pure properties is trying to get the estimation
as close to the actual value as possible.
</p>
<p>Of course, like Gregory Peck and Tintin, some Grobs will have properties
that will always be pure.  For example, the height of a note-head in
not-crazy music will never depend on line breaking or other parameters
decided late in the typesetting process.  Inversely, in rare cases,
certain properties are difficult to estimate with pure values.  For
example, the height of a Hairpin at a certain cross-section of its
horizontal span is difficult to know without knowing the horizontal
distance that the hairpin spans, and LilyPond provides an
over-estimation by reporting the pure height as the entire height of the
Hairpin.
</p>
<p>Purity, like for those living in a convent, is more like a contract than
an <em>a priori</em>.  If you write a pure-function, you are promising
the user (and the developer who may have to clean up after you) that
your function will not be dependent on factors that change at different
stages of the compilation process (compilation of a score, not of
LilyPond).
</p>
<p>One last oddity is that purity, in LilyPond, is currently limited
exclusively to things that have to do with Y-extent and positioning.
There is no concept of &lsquo;pure X&rsquo; as, by design, X is always the
independent variable (i.e. from column X1 to column X2, what will be the
Y height of a given grob).  Furthermore, there is no purity for
properties like color, text, and other things for which a meaningful notion
of estimation is either not necessary or has not yet been found.  For example,
even if a color were susceptible to change at different points of the
compilation process, it is not clear what a pure estimate of this color
would be or how this pure color could be used.  Thus, in this document and
in the source, you will see purity discussed almost interchangeably with
Y-axis positioning issues.
</p>

<hr size="6">
<a name="Writing-a-pure-function"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#purity-in-lilypond" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Purity in LilyPond&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#understanding-pure-properties" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Understanding pure properties&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#how-purity-is-defined-and-stored" title="Next section in reading order" accesskey="n" rel="next">&nbsp;How purity is defined and stored &gt; </a>]</td></tr></table>
<a name="writing-a-pure-function"></a>
<h3 class="subsection">10.13.2 Writing a pure function</h3>
<p>Pure functions take, at a minimum, three arguments: the <var>grob</var>, the
starting column at which the function is being evaluated (hereafter
referred to as <var>start</var>), and the end column at which the grob is
being evaluated (hereafter referred to as <var>end</var>).  For items,
<var>start</var> and <var>end</var> must be provided (meaning they are not optional)
but will not have a meaningful impact on the result, as items only occupy
one column and will thus yield a value or not (if they are not in the range
from <var>start</var> to <var>end</var>).  For spanners however, <var>start</var> and
<var>end</var> are important, as we may can get a better pure estimation of a
slice of the spanner than considering it on the whole.  This is useful
during line breaking, for example, when we want to estimate the Y-extent
of a spanner broken at given starting and ending columns.
</p>

<hr size="6">
<a name="How-purity-is-defined-and-stored"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#writing-a-pure-function" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Writing a pure function&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#understanding-pure-properties" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Understanding pure properties&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#where-purity-is-used" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Where purity is used &gt; </a>]</td></tr></table>
<a name="how-purity-is-defined-and-stored"></a>
<h3 class="subsection">10.13.3 How purity is defined and stored</h3>
<p>Purity can currently be defined two different ways in LilyPond that
correspond to two types of scenarios.  In one scenario, we know that a
callback is pure, but we are not necessarily certain what properties
will use this callback.  In another, we want a property to be pure, but
we don&rsquo;t want to guarantee that its callback function will be pure in
all circumstances.
</p>
<p>In the first scenario, we register the callback in define-grobs.scm in
one of four places depending on what the function does.
</p>
<ul>
<li> <code>pure-print-functions</code>: If finding a print function&rsquo;s vertical
extent does not have any &lsquo;side effects&rsquo; we register it here. We then
don&rsquo;t have to set the pure Y-extent property, which will be taken from the
stencil.

</li><li> <code>pure-print-to-height-conversions</code>: If a stencil can
eventually be used to glean a grob&rsquo;s Y-extent but is not pure (meaning
it will have a different height at different stages of the compilation
process), we add it to this list along with a function for the pure
Y-extent.

</li><li> <code>pure-conversions-alist</code>: This list contains pairs of
functions and their pure equivalents.  It is onto but not one-to-one.

</li><li> <code>pure-functions</code>: Like pure-print-functions in that they work
for both pure and impure values, but they do not return a stencil.
</li></ul>

<p>At all stages of the compilation process, when LilyPond wants the pure
version of a property, it will consult these lists and see if it can get
this property for a given Grob.  Note that you do <em>not</em> need to
register the pure property in the grob itself.  For example, there is no
property &lsquo;pure-Y-extent&rsquo;.  Rather, by registering these functions as
defined above, every time LilyPond needs a pure property, it will check
to see if a Grob contains one of these functions and, if so, will use
its value.  If LilyPond cannot get a pure function, it will return a
value of <code>##f</code> for the property.
</p>
<p>LilyPond is smart enough to know if a series of chained functions are
pure.  For example, if a Y-offset property has four chained functions
and all of them have pure equivalents, LilyPond will read the four pure
equivalents when calculating the pure property.  However, if even one is
impure, LilyPond will not return a pure property for the offset (instead
returning something like <code>#f</code> or <code>'()</code>) and will likely wreak
havoc on your score.
</p>
<p>In the second scenario, we create an unpure-pure-container (unpure is
not a word, but hey, neither was Lilypond until the 90s).  For example:
</p>
<blockquote><pre class="example">#(define (foo grob)
  '(-1 . 1))

#(define (bar grob start end)
  '(-2 . 2))

\override Stem #'length = #(ly:make-unpure-pure-container foo bar)
</pre></blockquote>

<p>This is useful if we want to:
</p>
<ul>
<li> create overrides that have pure alternatives (should not be used
in development, but useful for users)

</li><li> use return values that are not functions (i.e. pairs or booleans)
for either pure or unpure values.

</li><li> allow a function to be considered pure in a limited amount of
circumstances.  This is useful if we are sure that, when associated with
one grob a function will be pure but not necessarily with another grob
that has different callbacks.
</li></ul>

<p>Items can only ever have two pure heights: their actual pure height if
they are between &lsquo;start&rsquo; and &lsquo;end&rsquo;, or an empty interval if they are
not.  Thus, their pure property is cached to speed LilyPond up.  Pure
heights for spanners are generally not cached as they change depending
on the start and end values.  They are only cached in certain particular
cases.  Before writing a lot of caching code, make sure that it is a
value that will be reused a lot.
</p>

<hr size="6">
<a name="Where-purity-is-used"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#how-purity-is-defined-and-stored" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; How purity is defined and stored&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#understanding-pure-properties" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Understanding pure properties&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#case-studies" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Case studies &gt; </a>]</td></tr></table>
<a name="where-purity-is-used"></a>
<h3 class="subsection">10.13.4 Where purity is used</h3>
<p>Pure Y values must be used in any functions that are called before
line breaking.  Examples of this can be seen in
<code>Separation_items::boxes</code> to construct horizontal skylines and in
<code>Note_spacing::stem_dir_correction</code> to correct for optical
illusions in spacing.  Pure properties are also used in the calculation
of other pure properties.  For example, the <code>Axis_group_interface</code>
has pure functions that look up other pure functions.
</p>
<p>Purity is also implicitly used in any functions that should only ever
return pure values.  For example, extra-spacing-height is only ever used
before line-breaking and thus should never use values that would only be
available after line breaking.  In this case, there is no need to create
callbacks with pure equivalents because these functions, by design, need
to be pure.
</p>
<p>To know if a property will be called before and/or after line-breaking
is sometimes tricky and can, like all things in coding, be found by
using a debugger and/or adding <var>printf</var> statements to see where they
are called in various circumstances.
</p>

<hr size="6">
<a name="Case-studies"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#where-purity-is-used" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Where purity is used&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#understanding-pure-properties" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Understanding pure properties&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#debugging-tips" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Debugging tips &gt; </a>]</td></tr></table>
<a name="case-studies"></a>
<h3 class="subsection">10.13.5 Case studies</h3>
<p>In each of these case studies, we expose a problem in pure properties, a
solution, and the pros and cons of this solution.
</p>
<a name="Time-signatures"></a>
<h3 class="subheading">Time signatures</h3>
<p>A time signature needs to prevent accidentals from passing over or under
it, but its extent does not necessarily extend to the Y-position of
accidentals.  LilyPond&rsquo;s horizontal spacing sometimes makes a line of
music compact and, when doing so, allows certain columns to pass over
each other if they will not collide.  This type of passing over is not
desirable with time signatures in traditional engraving.  But how do we
know if this passing over will happen before line breaking, as we are
not sure what the X positions will be?  We need a pure estimation of how
much extra spacing height the time signatures would need to prevent this
form of passing over without making this height so large as to
overly-distort the Y-extent of an system, which could result in a very
&lsquo;loose&rsquo; looking score with lots of horizontal space between columns.
So, to approximate this extra spacing height, we use the Y-extent of a
time signature&rsquo;s next-door-neighbor grobs via the pure-from-neighbor
interface.
</p>
<ul>
<li> pros: By extending the extra spacing height of a time signature to
that of its next-door-neighbors, we make sure that grobs to the right of
it that could pass above or below it do not.

</li><li> cons: This over-estimation of the vertical height could prevent
snug vertical spacing of systems, as the system will be registered as
being taller at the point of the time signature than it actually is.
This approach can be used for clefs and bar lines as well.
</li></ul>

<a name="Stems"></a>
<h3 class="subheading">Stems</h3>
<p>As described above, Stems need pure height approximations when they are
beamed, as we do not know the beam positions before line breaking.  To
estimate this pure height, we take all the stems in a beam and find
their pure heights as if they were not beamed.  Then, we find the union
of all these pure heights and take the intersection between this
interval (which is large) and an interval going from the note-head of a
stem to infinity in the direction of the stem so that the interval stops
at the note head.
</p>
<ul>
<li> pros: This is guaranteed to be at least as long as the beamed
stem, as a beamed stem will never go over the ideal length of the
extremal beam of a stem.

</li><li> cons: Certain stems will be estimated as being too long, which
leads to the same problem of too-much-vertical-height as described
above.

</li></ul>


<hr size="6">
<a name="Debugging-tips"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#case-studies" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Case studies&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#understanding-pure-properties" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Understanding pure properties&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#lilypond-scoping" title="Next section in reading order" accesskey="n" rel="next">&nbsp;LilyPond scoping &gt; </a>]</td></tr></table>
<a name="debugging-tips"></a>
<h3 class="subsection">10.13.6 Debugging tips</h3>
<p>A few questions to ask yourself when working with pure properties:
</p>
<ul>
<li> Is the property really pure?  Are you sure that its value could
not be changed later in the compiling process due to other changes?

</li><li> Can the property be made to correspond even more exactly with the
eventual impure property?

</li><li> For a spanner, is the pure property changing correctly depending
on the starting and ending points of the spanner?

</li><li> For an Item, will the item&rsquo;s pure height need to act in horizontal
spacing but not in vertical spacing?  If so, use extra-spacing-height
instead of pure height.

</li></ul>


<hr size="6">
<a name="LilyPond-scoping"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#debugging-tips" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Debugging tips&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#programming-work" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Programming work&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#scheme_002d_003ec-interface" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Scheme-&gt;C interface &gt; </a>]</td></tr></table>
<a name="lilypond-scoping"></a>
<h2 class="section">10.14 LilyPond scoping</h2>

<p>The Lilypond language has a concept of scoping, i.e. you can do:
</p>
<blockquote><pre class="example">foo = 1

#(begin
   (display (+ foo 2)))
</pre></blockquote>

<p>with <code>\paper</code>, <code>\midi</code> and <code>\header</code> being
nested scope inside the &lsquo;<tt>.ly</tt>&rsquo; file-level scope.  <code>foo = 1</code>
is translated in to a scheme variable definition.
</p>
<p>This implemented using modules, with each scope being an anonymous
module that imports its enclosing scope&rsquo;s module.
</p>
<p>Lilypond&rsquo;s core, loaded from &lsquo;<tt>.scm</tt>&rsquo; files, is usually placed in the
<code>lily</code> module, outside the &lsquo;<tt>.ly</tt>&rsquo; level.  In the case of
</p>
<blockquote><pre class="example">lilypond a.ly b.ly
</pre></blockquote>

<p>we want to reuse the built-in definitions, without changes effected in
user-level &lsquo;<tt>a.ly</tt>&rsquo; leaking into the processing of &lsquo;<tt>b.ly</tt>&rsquo;.
</p>
<p>The user-accessible definition commands have to take care to avoid
memory leaks that could occur when running multiple files.  All
information belonging to user-defined commands and markups is stored in
a manner that allows it to be garbage-collected when the module is
dispersed, either by being stored module-locally, or in weak hash
tables.
</p>

<hr size="6">
<a name="Scheme_002d_003eC-interface"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#lilypond-scoping" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; LilyPond scoping&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#programming-work" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Programming work&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#comparison" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Comparison &gt; </a>]</td></tr></table>
<a name="scheme_002d_003ec-interface"></a>
<h2 class="section">10.15 Scheme-&gt;C interface</h2>

<p>Most of the C functions interfacing with Guile/Scheme used in LilyPond
are described in the API Reference of the
<a href="http://www.gnu.org/software/guile/manual/html_node/index.html">GUILE Reference Manual</a>.
</p>
<p>The remaining functions are defined in &lsquo;<tt>lily/lily-guile.cc</tt>&rsquo;,
&lsquo;<tt>lily/include/lily-guile.hh</tt>&rsquo; and
&lsquo;<tt>lily/include/lily-guile-macros.hh</tt>&rsquo;.
Although their names are meaningful there&rsquo;s a few things you should know
about them.
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#comparison" accesskey="1">10.15.1 Comparison</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#conversion" accesskey="2">10.15.2 Conversion</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr size="6">
<a name="Comparison"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#scheme_002d_003ec-interface" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Scheme-&gt;C interface&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#scheme_002d_003ec-interface" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Scheme-&gt;C interface&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#conversion" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Conversion &gt; </a>]</td></tr></table>
<a name="comparison"></a>
<h3 class="subsection">10.15.1 Comparison</h3>

<p>This is the trickiest part of the interface.
</p>
<p>Mixing Scheme values with C comparison operators won&rsquo;t produce any crash
or warning when compiling but must be avoided:
</p>
<blockquote><pre class="example">scm_string_p (scm_value) == SCM_BOOL_T
</pre></blockquote>

<p>As we can read in the reference, <code>scm_string_p</code> returns a Scheme
value: either <code>#t</code> or <code>#f</code> which are written <code>SCM_BOOL_T</code>
and <code>SCM_BOOL_F</code> in C.  This will work, but it is not following
to the API guidelines.  For further information, read this discussion:
</p>
<table><tr><td>&nbsp;</td><td><pre class="smallexample"><a href="http://lists.gnu.org/archive/html/lilypond-devel/2011-08/msg00646.html">http://lists.gnu.org/archive/html/lilypond-devel/2011-08/msg00646.html</a>
</pre></td></tr></table>

<p>There are functions in the Guile reference that returns C values
instead of Scheme values.  In our example, a function called
<code>scm_is_string</code> (described after <code>string?</code> and <code>scm_string_p</code>)
returns the C value 0 or 1.
</p>
<p>So the best solution was simply:
</p>
<blockquote><pre class="example">scm_is_string (scm_value)
</pre></blockquote>

<p>There a simple solution for almost every common comparison.  Another example:
we want to know if a Scheme value is a non-empty list.  Instead of:
</p>
<blockquote><pre class="example">(scm_is_true (scm_list_p (scm_value)) &amp;&amp; scm_value != SCM_EOL)
</pre></blockquote>

<p>one can usually use:
</p>
<blockquote><pre class="example">scm_is_pair (scm_value)
</pre></blockquote>

<p>since a list of at least one member is a pair.  This test is
cheap; <code>scm_list_p</code> is actually quite more complex since it makes
sure that its argument is neither a &lsquo;dotted list&rsquo; where the last pair
has a non-null <code>cdr</code>, nor a circular list.  There are few
situations where the complexity of those tests make sense.
</p>
<p>Unfortunately, there is not a <code>scm_is_[something]</code> function for
everything.  That&rsquo;s one of the reasons why LilyPond has its own Scheme
interface.  As a rule of thumb, tests that are cheap enough to be
worth inlining tend to have such a C interface.  So there is
<code>scm_is_pair</code> but not <code>scm_is_list</code>, and <code>scm_is_eq</code>
but not <code>scm_is_equal</code>.
</p>
<a name="General-definitions-1"></a>
<h3 class="subheading">General definitions</h3>

<a name="bool-to_005fboolean-_0028SCM-b_0029"></a>
<h4 class="subsubheading">bool to_boolean (SCM b)</h4>

<p>Return <code>true</code> if <var>b</var> is <code>SCM_BOOL_T</code>, else return <code>false</code>.
</p>
<p>This should be used instead of <code>scm_is_true</code> and
<code>scm_is_false</code> for properties since in Lilypond, unset properties
are read as an empty list, and by convention unset Boolean properties
default to false.  Since both <code>scm_is_true</code> and
<code>scm_is_false</code> only compare with <code>##f</code> in line with what
Scheme&rsquo;s conditionals do, they are not really useful for checking the
state of a Boolean property.
</p>
<a name="bool-ly_005fis_005f_005bsomething_005d-_0028args_0029"></a>
<h4 class="subsubheading">bool ly_is_[something] (args)</h4>

<p>Behave the same as scm_is_[something] would do if it existed.
</p>
<a name="bool-is_005f_005btype_005d-_0028SCM-s_0029"></a>
<h4 class="subsubheading">bool is_[type] (SCM s)</h4>

<p>Test whether the type of <var>s</var> is [type].
[type] is a LilyPond-only set of values (direction, axis...).  More
often than not, the code checks Lilypond specific C++-implemented
types using
</p>
<a name="g_t_005btype-_002a_005d-unsmob_005f_005btype_005d-_0028SCM-s_0029"></a>
<h4 class="subsubheading">[type *] unsmob_[type] (SCM s)</h4>

<p>This tries converting a Scheme object to a pointer of the desired
kind.  If the Scheme object is of the wrong type, a pointer value
of <code>0</code> is returned, making this suitable for a Boolean test.
</p>
<hr size="6">
<a name="Conversion"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#comparison" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Comparison&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#scheme_002d_003ec-interface" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Scheme-&gt;C interface&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#lilypond-miscellany" title="Next section in reading order" accesskey="n" rel="next">&nbsp;LilyPond miscellany &gt; </a>]</td></tr></table>
<a name="conversion"></a>
<h3 class="subsection">10.15.2 Conversion</h3>

<a name="General-definitions"></a>
<h3 class="subheading">General definitions</h3>

<a name="bool-to_005fboolean-_0028SCM-b_0029-1"></a>
<h4 class="subsubheading">bool to_boolean (SCM b)</h4>

<p>Return <code>true</code> if <var>b</var> is <code>SCM_BOOL_T</code>, else return <code>false</code>.
</p>
<p>This should be used instead of <code>scm_is_true</code> and <code>scm_is_false</code>
for properties since empty lists are sometimes used to unset them.
</p>
<a name="g_t_005bC-type_005d-ly_005fscm2_005bC-type_005d-_0028SCM-s_0029"></a>
<h4 class="subsubheading">[C type] ly_scm2[C type] (SCM s)</h4>

<p>Behave the same as scm_to_[C type] would do if it existed.
</p>
<a name="g_t_005bC-type_005d-robust_005fscm2_005bC-type_005d-_0028SCM-s_002c-_005bC-type_005d-d_0029"></a>
<h4 class="subsubheading">[C type] robust_scm2[C type] (SCM s, [C type] d)</h4>

<p>Behave the same as scm_to_[C type] would do if it existed.
Return <var>d</var> if type verification fails.
</p>

<hr size="6">
<a name="LilyPond-miscellany"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#conversion" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Conversion&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#programming-work" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Programming work&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#spacing-algorithms" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Spacing algorithms &gt; </a>]</td></tr></table>
<a name="lilypond-miscellany"></a>
<h2 class="section">10.16 LilyPond miscellany</h2>

<p>This is a place to dump information that may be of use to developers
but doesn&rsquo;t yet have a proper home.  Ideally, the length of this section
would become zero as items are moved to other homes.
</p>

<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#spacing-algorithms" accesskey="1">10.16.1 Spacing algorithms</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#info-from-han_002dwen-email" accesskey="2">10.16.2 Info from Han-Wen email</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#music-functions-and-guile-debugging" accesskey="3">10.16.3 Music functions and GUILE debugging</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#articulations-on-eventchord" accesskey="4">10.16.4 Articulations on EventChord</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr size="6">
<a name="Spacing-algorithms"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#lilypond-miscellany" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; LilyPond miscellany&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#lilypond-miscellany" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;LilyPond miscellany&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#info-from-han_002dwen-email" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Info from Han-Wen email &gt; </a>]</td></tr></table>
<a name="spacing-algorithms"></a>
<h3 class="subsection">10.16.1 Spacing algorithms</h3>

<p>Here is information from an email exchange about spacing algorithms.
</p>
<p>On Thu, 2010-02-04 at 15:33 -0500, Boris Shingarov wrote:
I am experimenting with some modifications to the line breaking code,
and I am stuck trying to understand how some of it works.  So far my
understanding is that Simple_spacer operates on a vector of Grobs, and
it is a well-known Constrained-QP problem (rods = constraints, springs
= quadratic function to minimize).  What I don&rsquo;t understand is, if the
spacer operates at the level of Grobs, which are built at an earlier
stage in the pipeline, how are the changes necessitated by differences
in line breaking, taken into account?  in other words, if I take the
last measure of a line and place it on the next line, it is not just a
matter of literally moving that graphic to where the start of the next
line is, but I also need to draw a clef, key signature, and possibly
other fundamental things &ndash; but at that stage in the rendering
pipeline, is it not too late??
</p>
<p>Joe Neeman answered:
</p>
<p>We create lots of extra grobs (eg. a BarNumber at every bar line) but
most of them are not drawn.  See the break-visibility property in
item-interface.
</p>
<p>Here is another e-mail exchange.  Janek Warcho asked for a starting point
to fixing 1301 (change clef colliding with notes).  Neil Puttock replied:
</p>
<p>The clef is on a loose column (it floats before the head), so the
first place I&rsquo;d look would be lily/spacing-loose-columns.cc (and
possibly lily/spacing-determine-loose-columns.cc).
I&rsquo;d guess the problem is the way loose columns are spaced between
other columns: in this snippet, the columns for the quaver and tuplet
minim are so close together that the clef&rsquo;s column gets dumped on top
of the quaver (since it&rsquo;s loose, it doesn&rsquo;t influence the spacing).
</p>
<hr size="6">
<a name="Info-from-Han_002dWen-email"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#spacing-algorithms" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Spacing algorithms&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#lilypond-miscellany" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;LilyPond miscellany&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#music-functions-and-guile-debugging" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Music functions and GUILE debugging &gt; </a>]</td></tr></table>
<a name="info-from-han_002dwen-email"></a>
<h3 class="subsection">10.16.2 Info from Han-Wen email</h3>

<p>In 2004, Douglas Linhardt decided to try starting a document that would
explain LilyPond architecture and design principles.  The material below
is extracted from that email, which can be found at
<a href="http://thread.gmane.org/gmane.comp.gnu.lilypond.devel/2992">http://thread.gmane.org/gmane.comp.gnu.lilypond.devel/2992</a>.
The headings reflect questions from Doug or comments from Han-Wen;
the body text are Han-Wen&rsquo;s answers.
</p>
<a name="Figuring-out-how-things-work_002e"></a>
<h3 class="subheading">Figuring out how things work.</h3>

<p>I must admit that when I want to know how a program works, I use grep
and emacs and dive into the source code.  The comments and the code
itself are usually more revealing than technical documents.
</p>
<a name="What_0027s-a-grob_002c-and-how-is-one-used_003f"></a>
<h3 class="subheading">What&rsquo;s a grob, and how is one used?</h3>

<p>Graphical object - they are created from within engravers, either as
Spanners (derived class) -slurs, beams- or Items (also a derived
class) -notes, clefs, etc.
</p>
<p>There are two other derived classes System (derived from Spanner,
containing a &quot;line of music&quot;) and Paper_column (derived from Item, it
contains all items that happen at the same moment).  They are separate
classes because they play a special role in the linebreaking process.
</p>
<a name="What_0027s-a-smob_002c-and-how-is-one-used_003f"></a>
<h3 class="subheading">What&rsquo;s a smob, and how is one used?</h3>

<p>A C(++) object that is encapsulated so it can be used as a Scheme
object.  See GUILE info, &quot;19.3 Defining New Types (Smobs)&quot;
</p>
<a name="When-is-each-C_002b_002b-class-constructed-and-used_003f"></a>
<h3 class="subheading">When is each C++ class constructed and used?</h3>

<ul>
<li>
Music classes

<p>In the parser.yy see the macro calls MAKE_MUSIC_BY_NAME().
</p>
</li><li>
Contexts

<p>Constructed during &quot;interpreting&quot; phase.
</p>
</li><li>
Engravers

<p>Executive branch of Contexts, plugins that create grobs, usually one
engraver per grob type.  Created  together with context.
</p>
</li><li>
Layout Objects

<p>= grobs
</p>
</li><li>
Grob Interfaces

<p>These are not C++ classes per se.  The idea of a Grob interface hasn&rsquo;t
crystallized well.  ATM, an interface is a symbol, with a bunch of grob
properties.  They are not objects that are created or destroyed.
</p>
</li><li>
Iterators

<p>Objects that walk through different music classes, and deliver events
in a synchronized way, so that notes that play together are processed
at the same moment and (as a result) end up on the same horizontal position.
</p>
<p>Created during interpreting phase.
</p>
<p>BTW, the entry point for interpreting is ly:run-translator
(ly_run_translator on the C++ side)
</p>
</li></ul>

<a name="Can-you-get-to-Context-properties-from-a-Music-object_003f"></a>
<h3 class="subheading">Can you get to Context properties from a Music object?</h3>

<p>You can create music object with a Scheme function that reads context
properties (the \applycontext syntax).  However, that function is
executed during Interpreting, so you can not really get Context
properties from Music objects, since music objects are not directly
connected to Contexts.  That connection is made by the  Music_iterators
</p>
<a name="Can-you-get-to-Music-properties-from-a-Context-object_003f"></a>
<h3 class="subheading">Can you get to Music properties from a Context object?</h3>

<p>Yes, if you are given the music object within a Context
object.  Normally, the music objects enter Contexts in synchronized
fashion, and the synchronization is done by Music_iterators.
</p>
<a name="What-is-the-relationship-between-C_002b_002b-classes-and-Scheme-objects_003f"></a>
<h3 class="subheading">What is the relationship between C++ classes and Scheme objects?</h3>

<p>Smobs are C++ objects in Scheme.  Scheme objects (lists, functions) are
manipulated from C++ as well using the GUILE C function interface
(prefix: scm_)
</p>
<a name="How-do-Scheme-procedures-get-called-from-C_002b_002b-functions_003f"></a>
<h3 class="subheading">How do Scheme procedures get called from C++ functions?</h3>

<p>scm_call_*, where * is an integer from 0 to 4.
Also scm_c_eval_string (), scm_eval ()
</p>
<a name="How-do-C_002b_002b-functions-get-called-from-Scheme-procedures_003f"></a>
<h3 class="subheading">How do C++ functions get called from Scheme procedures?</h3>

<p>Export a C++ function to Scheme with LY_DEFINE.
</p>
<a name="What-is-the-flow-of-control-in-the-program_003f"></a>
<h3 class="subheading">What is the flow of control in the program?</h3>

<p>Good question.  Things used to be clear-cut, but we have Scheme
and SMOBs now, which means that interactions do not follow a very
rigid format anymore.  See below for an overview, though.
</p>
<a name="Does-the-parser-make-Scheme-procedure-calls-or-C_002b_002b-function-calls_003f"></a>
<h3 class="subheading">Does the parser make Scheme procedure calls or C++ function calls?</h3>

<p>Both.  And the Scheme calls can call C++ and vice versa.  It&rsquo;s nested,
with the SCM datatype as lubrication between the interactions
</p>
<p>(I think the word &quot;lubrication&quot; describes the process better than the
traditional word &quot;glue&quot;)
</p>
<a name="How-do-the-front_002dend-and-back_002dend-get-started_003f"></a>
<h3 class="subheading">How do the front-end and back-end get started?</h3>

<p>Front-end: a file is parsed, the rest follows from that.  Specifically,
</p>
<p>Parsing leads to a Music + Music_output_def object (see parser.yy,
definition of toplevel_expression )
</p>
<p>A Music + Music_output_def object leads to a Global_context object (see
ly_run_translator ())
</p>
<p>During interpreting, Global_context + Music leads to a bunch of
Contexts (see Global_translator::run_iterator_on_me ()).
</p>
<p>After interpreting, Global_context contains a Score_context (which
contains staves, lyrics etc.) as a child.  Score_context::get_output ()
spews a Music_output object (either a Paper_score object for notation
or Performance object for MIDI).
</p>
<p>The Music_output object is the entry point for the backend (see
ly_render_output ()).
</p>
<p>The main steps of the backend itself are in
</p>
<ul>
<li>
&lsquo;<tt>paper-score.cc</tt>&rsquo; , Paper_score::process_

</li><li>
&lsquo;<tt>system.cc</tt>&rsquo; , System::get_lines()

</li><li>
The step, where things go from grobs to output, is in
System::get_line(): each grob delivers a Stencil (a Device
independent output description), which is interpreted by our
outputting backends (&lsquo;<tt>scm/output-tex.scm</tt>&rsquo; and
&lsquo;<tt>scm/output-ps.scm</tt>&rsquo;) to produce TeX and PS.

</li></ul>

<p>Interactions between grobs and putting things into .tex and .ps files
have gotten a little more complex lately.  Jan has implemented
page-breaking, so now the backend also involves Paper_book,
Paper_lines and other things.  This area is still heavily in flux, and
perhaps not something you should want to look at.
</p>
<a name="How-do-the-front_002dend-and-back_002dend-communicate_003f"></a>
<h3 class="subheading">How do the front-end and back-end communicate?</h3>

<p>There is no communication from backend to front-end.  From front-end to
backend is simply the program flow: music + definitions gives
contexts, contexts yield output, after processing, output is written
to disk.
</p>
<a name="Where-is-the-functionality-associated-with-KEYWORDs_003f"></a>
<h3 class="subheading">Where is the functionality associated with KEYWORDs?</h3>

<p>See &lsquo;<tt>my-lily-lexer.cc</tt>&rsquo; (keywords, there aren&rsquo;t that many)
and &lsquo;<tt>ly/*.ly</tt>&rsquo; (most of the other backslashed <code>/\words</code> are identifiers)
</p>
<a name="What-Contexts_002fProperties_002fMusic_002fetc_002e-are-available-when-they-are-processed_003f"></a>
<h3 class="subheading">What Contexts/Properties/Music/etc. are available when they are processed?</h3>

<p>What do you mean exactly with this question?
</p>
<p>See &lsquo;<tt>ly/engraver-init.ly</tt>&rsquo; for contexts,
see &lsquo;<tt>scm/define-*.scm</tt>&rsquo; for other objects.
</p>
<a name="How-do-you-decide-if-something-is-a-Music_002c-Context_002c-or-Grob-property_003f"></a>
<h3 class="subheading">How do you decide if something is a Music, Context, or Grob property?</h3>
<p>Why is part-combine-status a Music property when it seems (IMO)
to be related to the Staff context?
</p>
<p>The Music_iterators and Context communicate through two channels
</p>
<p>Music_iterators can set and read context properties, idem for
Engravers and Contexts
</p>
<p>Music_iterators can send &quot;synthetic&quot; music events (which aren&rsquo;t in
the input) to a context.  These are caught by Engravers.  This is
mostly a one way communication channel.
</p>
<p>part-combine-status is part of such a synthetic event, used by
Part_combine_iterator to communicate with Part_combine_engraver.
</p>

<a name="Deciding-between-context-and-music-properties"></a>
<h3 class="subheading">Deciding between context and music properties</h3>

<p>I&rsquo;m adding a property to affect how \autochange works.  It seems to
me that it should be a context property, but the Scheme autochange
procedure has a Music argument.  Does this mean I should use
a Music property?
</p>
<p>\autochange is one of these extra strange beasts: it requires
look-ahead to decide when to change staves.  This is achieved by
running the interpreting step twice (see
&lsquo;<tt>scm/part-combiner.scm</tt>&rsquo; , at the bottom), and
storing the result of the first step (where to switch
staves) in a Music property.  Since you want to influence that
where-to-switch list, your must affect the code in
make-autochange-music (&lsquo;<tt>scm/part-combiner.scm</tt>&rsquo;).
That code is called directly from the parser and there are no
official &quot;parsing properties&quot; yet, so there is no generic way
to tune \autochange.  We would have to invent something new
for this, or add a separate argument,
</p>
<blockquote><pre class="example">    \autochange #around-central-C ..music..
</pre></blockquote>

<p>where around-central-C is some function that is called from
make-autochange-music.
</p>
<a name="More-on-context-and-music-properties"></a>
<h3 class="subheading">More on context and music properties</h3>

<p>From Neil Puttock, in response to a question about transposition:
</p>
<p>Context properties (using \set &amp; \unset) are tied to engravers: they
provide information relevant to the generation of graphical objects.
</p>
<p>Since transposition occurs at the music interpretation stage, it has
no direct connection with engravers: the pitch of a note is fixed
before a notehead is created.  Consider the following minimal snippet:
</p>
<blockquote><pre class="example">{ c' }
</pre></blockquote>

<p>This generates (simplified) a NoteEvent, with its pitch and duration
as event properties,
</p>
<blockquote><pre class="example">(make-music
  'NoteEvent
  'duration
  (ly:make-duration 2 0 1 1)
  'pitch
  (ly:make-pitch 0 0 0)
</pre></blockquote>

<p>which the Note_heads_engraver hears.  It passes this information on to
the NoteHead grob it creates from the event, so the head&rsquo;s correct
position and duration-log can be determined once it&rsquo;s ready for
printing.
</p>
<p>If we transpose the snippet,
</p>
<blockquote><pre class="example">\transpose c d { c' }
</pre></blockquote>

<p>the pitch is changed before it reaches the engraver (in fact, it
happens just after the parsing stage with the creation of a
TransposedMusic music object):
</p>
<blockquote><pre class="example">(make-music
 'NoteEvent
 'duration
 (ly:make-duration 2 0 1 1)
 'pitch
 (ly:make-pitch 0 1 0)
</pre></blockquote>

<p>You can see an example of a music property relevant to transposition:
untransposable.
</p>
<blockquote><pre class="example">\transpose c d { c'2 \withMusicProperty #'untransposable ##t c' }
</pre></blockquote>

<p>-&gt; the second c&rsquo; remains untransposed.
</p>
<p>Take a look at &lsquo;<tt>lily/music.cc</tt>&rsquo; to see where the transposition takes place.
</p>

<a name="How-do-I-tell-about-the-execution-environment_003f"></a>
<h3 class="subheading">How do I tell about the execution environment?</h3>

<p>I get lost figuring out what environment the code I&rsquo;m looking at is in when it
executes.  I found both the C++ and Scheme autochange code.  Then I was trying
to figure out where the code got called from.  I finally figured out that the
Scheme procedure was called before the C++ iterator code, but it took me a
while to figure that out, and I still didn&rsquo;t know who did the calling in the
first place.  I only know a little bit about Flex and Bison, so reading those
files helped only a little bit.
</p>
<p><em>Han-Wen:</em> GDB can be of help here.  Set a breakpoint in C++, and run.  When you
hit the breakpoint, do a backtrace.  You can inspect Scheme objects
along the way by doing
</p>
<blockquote><pre class="example">p ly_display_scm(obj)
</pre></blockquote>

<p>this will display OBJ through GUILE.
</p>
<hr size="6">
<a name="Music-functions-and-GUILE-debugging"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#info-from-han_002dwen-email" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Info from Han-Wen email&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#lilypond-miscellany" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;LilyPond miscellany&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#articulations-on-eventchord" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Articulations on EventChord &gt; </a>]</td></tr></table>
<a name="music-functions-and-guile-debugging"></a>
<h3 class="subsection">10.16.3 Music functions and GUILE debugging</h3>

<p>Ian Hulin was trying to do some debugging in music functions, and
came up with the following question
</p>
<p>HI all,
I&rsquo;m working on the Guile Debugger Stuff, and would like to try
debugging a music function definition such as:
</p>
<blockquote><pre class="example">conditionalMark = #(define-music-function (parser location) ()
 #{ \tag #'instrumental-part {\mark \default} #} )
</pre></blockquote>

<p>It appears conditionalMark does not get set up as an
equivalent of a Scheme
</p>
<blockquote><pre class="example">(define conditionalMark = define-music-function(parser location () ...
</pre></blockquote>

<p>although something gets defined because Scheme apparently recognizes
</p>
<blockquote><pre class="example">#(set-break! conditionalMark)
</pre></blockquote>

<p>later on in the file without signalling any Guile errors.
</p>
<p>However the breakpoint trap is never encountered as
define-music-function passed things on to ly:make-music-function,
which is really C++ code ly_make_music_function, so Guile never
finds out about the breakpoint.
</p>
<p>Han-Wen answered as follows:
</p>
<p>You can see the definition by doing
</p>
<blockquote><pre class="example">#(display conditionalMark)
</pre></blockquote>

<p>noindent
inside the &lsquo;<tt>.ly</tt>&rsquo; file.
</p>
<p>The breakpoint failing may have to do with the call sequence.  See
&lsquo;<tt>parser.yy</tt>&rsquo;, run_music_function().  The function is called directly from
C++, without going through the GUILE evaluator, so I think that is why
there is no debugger trap.
</p>
<hr size="6">
<a name="Articulations-on-EventChord"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#release-work" title="Next chapter">&nbsp;Release work &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#music-functions-and-guile-debugging" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Music functions and GUILE debugging&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#lilypond-miscellany" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;LilyPond miscellany&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#release-work" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Release work &gt; </a>]</td></tr></table>
<a name="articulations-on-eventchord"></a>
<h3 class="subsection">10.16.4 Articulations on EventChord</h3>

<p>From David Kastrup&rsquo;s email
<a href="http://lists.gnu.org/archive/html/lilypond-devel/2012-02/msg00189.html">http://lists.gnu.org/archive/html/lilypond-devel/2012-02/msg00189.html</a>:
</p>
<p>LilyPond&rsquo;s typesetting does not act on music expressions and music
events.  It acts exclusively on stream events.  It is the act of
iterators to convert a music expression into a sequence of stream events
played in time order.
</p>
<p>The EventChord iterator is pretty simple: it just takes its &quot;elements&quot;
field when its time comes up, turns every member into a StreamEvent and
plays that through the typesetting process.  The parser currently
appends all postevents belonging to a chord at the end of &quot;elements&quot;,
and thus they get played at the same point of time as the elements of
the chord.  Due to this design, you can add per-chord articulations or
postevents or even assemble chords with a common stem by using parallel
music providing additional notes/events: the typesetter does not see a
chord structure or postevents belonging to a chord, it just sees a
number of events occuring at the same point of time in a Voice context.
</p>
<p>So all one needs to do is let the EventChord iterator play articulations
after elements, and then adding to articulations in EventChord is
equivalent to adding them to elements (except in cases where the order
of events matters).
</p><hr size="6">
<a name="Release-work"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#programming-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Programming work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#build-system-notes" title="Next chapter">&nbsp;Build system notes &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#articulations-on-eventchord" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Articulations on EventChord&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#index" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Top&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#development-phases" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Development phases &gt; </a>]</td></tr></table>
<a name="release-work"></a>
<h1 class="chapter">11. Release work</h1>

<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#development-phases" accesskey="1">11.1 Development phases</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#minor-release-checklist" accesskey="2">11.2 Minor release checklist</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#major-release-checklist" accesskey="3">11.3 Major release checklist</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#release-extra-notes" accesskey="4">11.4 Release extra notes</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>


<hr size="6">
<a name="Development-phases"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#release-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Release work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#build-system-notes" title="Next chapter">&nbsp;Build system notes &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#release-work" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Release work&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#release-work" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Release work&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#minor-release-checklist" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Minor release checklist &gt; </a>]</td></tr></table>
<a name="development-phases"></a>
<h2 class="section">11.1 Development phases</h2>

<p>There are 2 states of development on <code>master</code>:
</p>
<ol>
<li> <strong>Normal development</strong>:
Any commits are fine.

</li><li> <strong>Build-frozen</strong>:
Do not require any additional or updated libraries or make
non-trivial changes to the build process.  Any such patch (or
branch) may not be merged with master during this period.

<p>This should occur approximately 1 month before any alpha version
of the next stable release, and ends when the next unstable branch
begins.
</p>
</li></ol>


<p>After announcing a beta release, branch <code>stable/2.x</code>.  There
are 2 states of development for this branch:
</p>
<ol>
<li> <strong>Normal maintenance</strong>:
The following patches <strong>MAY NOT</strong> be merged with this branch:

<ul>
<li> Any change to the input syntax.  If a file compiled with a
previous <code>2.x</code> (beta) version, then it must compile in the
new version.

<p>Exception: any bugfix to a Critical issue.
</p>
</li><li> New features with new syntax <em>may be committed</em>,
although once committed that syntax cannot change during the
remainder of the stable phase.

</li><li> Any change to the build dependencies (including programming
libraries, documentation process programs, or python modules used
in the buildscripts).  If a contributor could compile a previous
lilypond <code>2.x</code>, then he must be able to compile the new
version.

</li></ul>

</li><li> <strong>Release prep</strong>:
Only translation updates and important bugfixes are allowed.

</li></ol>


<hr size="6">
<a name="Minor-release-checklist"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#release-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Release work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#build-system-notes" title="Next chapter">&nbsp;Build system notes &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#development-phases" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Development phases&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#release-work" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Release work&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#major-release-checklist" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Major release checklist &gt; </a>]</td></tr></table>
<a name="minor-release-checklist"></a>
<h2 class="section">11.2 Minor release checklist</h2>

<p>A &ldquo;minor release&rdquo; means an update of <code>y</code> in <code>2.x.y</code>.
</p>
<a name="Pre_002drelease"></a>
<h3 class="subheading">Pre-release</h3>

<ol>
<li>
Switch to the release branch, get changes, prep release
announcement.  This requires a clean index and work tree.  If the
checkout displays modified files, you might want to run <code>git reset
--hard</code> before continuing.

<blockquote><pre class="example">git fetch
git checkout origin/release/unstable
git merge origin
make -C $LILYPOND_BUILD_DIR po-replace
mv $LILYPOND_BUILD_DIR/po/lilypond.pot po/
vi Documentation/web/news-front.itexi Documentation/web/news.itexi
</pre></blockquote>

</li><li>
Commit, push, switch back to master (or wherever else):

<blockquote><pre class="example">git commit -m &quot;PO: update template.&quot; po/lilypond.pot
git commit -m &quot;Release: update news.&quot; Documentation/web/
git push origin HEAD:release/unstable
git checkout master
</pre></blockquote>

</li><li>
If you do not have the previous release test-output tarball, download
it and put it in <code>regtests/</code>

</li><li> Prepare GUB environment by running:

<blockquote><pre class="example">### my-gub.sh
# special terminal, and default PATH environment.
# import these special environment vars:
#   HOME, HTTP_PROXY, TERM
env -i \
  HOME=$HOME \
  HTTP_PROXY=$HTTP_PROXY \
  bash --rcfile my-bashrc
</pre></blockquote>

<blockquote><pre class="example">### my-bashrc
export PS1=&quot;\[\e[1;33mGUB-ENV \w\]$ \[\e[0m\]&quot;
export PATH=$PATH
export TERM=xterm
</pre></blockquote>


</li><li> Build release on GUB by running:

<blockquote><pre class="example">make LILYPOND_BRANCH=release/unstable lilypond
</pre></blockquote>

<p>or something like:
</p>
<blockquote><pre class="example">make LILYPOND_BRANCH=stable/2.12 lilypond
</pre></blockquote>

</li><li> Check the regtest comparison in &lsquo;<tt>uploads/webtest/</tt>&rsquo; for
any unintentional breakage.  More info in
<a href="#precompiled-regression-tests">Precompiled regression tests</a>.

</li><li> If any work was done on GUB since the last release, upload
binaries to a temporary location, ask for feedback, and wait a day
or two in case there&rsquo;s any major problems.

<div class="warning"><p><strong>Note:</strong> Always do this for a stable release.
</p>
</div>
</li></ol>


<a name="Actual-release"></a>
<h3 class="subheading">Actual release</h3>

<ol>
<li> If you&rsquo;re not the right user on the webserver, remove the
<code>t</code> from the rsync command in:

<blockquote><pre class="example">test-lily/rsync-lily-doc.py
test-lily/rsync-test.py
</pre></blockquote>

<p><code>graham</code> owns v2.13; <code>han-wen</code> owns v2.12.
</p>
</li><li> Upload GUB by running:

<blockquote><pre class="example">make lilypond-upload \
  LILYPOND_REPO_URL=git://git.sv.gnu.org/lilypond.git \
  LILYPOND_BRANCH=release/unstable
</pre></blockquote>

<p>or something like:
</p>
<blockquote><pre class="example">make lilypond-upload \
  LILYPOND_REPO_URL=git://git.sv.gnu.org/lilypond.git \
  LILYPOND_BRANCH=stable/2.12
</pre></blockquote>

</li></ol>


<a name="Post-release"></a>
<h3 class="subheading">Post release</h3>

<ol>
<li> Update the current staging branch with the current news:

<blockquote><pre class="example">git fetch
git checkout origin/staging
git merge origin/release/unstable
</pre></blockquote>

</li><li> Update &lsquo;<tt>VERSION</tt>&rsquo; in lilypond git and upload changes:

<blockquote><pre class="example">vi VERSION
</pre></blockquote>

<ul>
<li>
VERSION = what you just did +0.0.1

</li><li>
DEVEL_VERSION = what you just did (i.e. is now online)

</li><li>
STABLE_VERSION = what&rsquo;s online (probably no change here)

</li></ul>

<blockquote><pre class="example">git commit -m &quot;Release: bump version.&quot; VERSION
git push origin HEAD:staging
</pre></blockquote>

<p>If the push fails with a message like
</p>
<blockquote><pre class="example"> ! [rejected]        HEAD -&gt; staging (non-fast-forward)
</pre></blockquote>

<p>it means that somebody else updated the staging branch while you were
preparing your change.  In that case, you need to restart the Post
Release process.  Otherwise, proceed:
</p>
</li><li> (for now) do a <code>make doc</code> and manually upload:

<blockquote><pre class="example">### upload-lily-web-media.sh
#!/bin/sh
BUILD_DIR=$HOME/src/build-lilypond

PICS=$BUILD_DIR/Documentation/pictures/out-www/
EXAMPLES=$BUILD_DIR/Documentation/ly-examples/out-www/

cd $BUILD_DIR
rsync -a $PICS graham@lilypond.org:media/pictures
rsync -a $EXAMPLES graham@lilypond.org:media/ly-examples
</pre></blockquote>

</li><li> Wait a few hours for the website to update.

</li><li> Email release notice to <code>info-lilypond</code>

</li></ol>



<hr size="6">
<a name="Major-release-checklist"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#release-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Release work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#build-system-notes" title="Next chapter">&nbsp;Build system notes &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#minor-release-checklist" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Minor release checklist&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#release-work" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Release work&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#release-extra-notes" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Release extra notes &gt; </a>]</td></tr></table>
<a name="major-release-checklist"></a>
<h2 class="section">11.3 Major release checklist</h2>

<p>A &ldquo;major release&rdquo; means an update of <code>x</code> in <code>2.x.0</code>.
</p>
<a name="Main-requirements"></a>
<h3 class="subheading">Main requirements</h3>

<p>This is the current official guidelines.
</p>
<ul>
<li>
0 Critical issues for two weeks (14 days) after the latest release
candidate.

</li></ul>


<a name="Potential-requirements"></a>
<h3 class="subheading">Potential requirements</h3>

<p>These might become official guidelines in the future.
</p>
<ul>
<li>
Check reg test

</li><li>
Check all 2ly scripts

</li><li>
Check for emergencies the docs:

<blockquote><pre class="example">grep FIXME --exclude &quot;misc/*&quot; --exclude &quot;*GNUmakefile&quot; \
  --exclude &quot;snippets/*&quot; ????*/*
</pre></blockquote>

</li><li>
Check for altered regtests, and document as necessary.  (update
numbers in the following command as appropriate)

<blockquote><pre class="example">git diff -u -r release/2.12.0-1 -r release/2.13.13-1 input/regression/
</pre></blockquote>

</li></ul>


<a name="Housekeeping-requirements"></a>
<h3 class="subheading">Housekeeping requirements</h3>

<p>Before the release:
</p>
<ul>
<li>
write release notes.  note: stringent size requirements for
various websites, so be brief.

</li><li>
Run convert-ly on all files, bump parser minimum version.

</li><li>
Update lilypond.pot:

<blockquote><pre class="example">make -C $LILYPOND_BUILD_DIR po-replace
mv $LILYPOND_BUILD_DIR/po/lilypond.pot po/
</pre></blockquote>

</li><li>
Make directories on lilypond.org:

<blockquote><pre class="example">~/web/download/sources/v2.14
~/web/download/sources/v2.15
</pre></blockquote>

</li><li>
Shortly after the release, move all current contributors to
previous contributors in:

<blockquote><pre class="example">Documentation/included/authors.itexi
</pre></blockquote>

<p>Also, delete old material in:
</p>
<blockquote><pre class="example">Documentation/changes.tely
</pre></blockquote>

<p>but don&rsquo;t forget to check it still compiles!  also update the
version numbers.
</p>
</li><li>
Website:

<ul>
<li>
make a link from the old unstable to the next stable in
lilypond.org&rsquo;s /doc/ dir.  Keep all previous unstable-&gt;stable doc
symlinks.

<p>Also, make the old docs self-contained &ndash; if there&rsquo;s a redirect in
/doc/v2.12/Documentation/index.html , replace it with the
index.html.old-2.12 files.
</p>
<p>The post-2.13 docs will need another way of handling the
self-containment.  It won&rsquo;t be hard to whip up a python script
that changes the link to ../../../../manuals.html to
../website/manuals.html , but it&rsquo;s still a 30-minute task that
needs to be done before 2.16.
</p>
</li><li>
doc auto redirects  to v2.LATEST-STABLE

</li><li>
add these two lines to http://www.lilypond.org/robots.txt:

<blockquote><pre class="example">Disallow: /doc/v2.PREVIOUS-STABLE/
Disallow: /doc/v2.CURRENT-DEVELOPMENT/
</pre></blockquote>

</li></ul>

</li></ul>

<a name="Unsorted"></a>
<h3 class="subheading">Unsorted</h3>

<ul>
<li>
submit po template for translation: send url of tarball to
coordinator@translationproject.org, mentioning lilypond-VERSION.pot

</li><li>
update links to distros providing lilypond packages?  link in:
&lsquo;<tt>Documentation/web/download.itexi</tt>&rsquo;

<p>This has nothing to do with the release, but it&rsquo;s a &quot;periodic
maintenance&quot; task that might make sense to include with releases.
</p>
</li><li>
Send announcements to...

<p>News:
</p>
<blockquote><pre class="example">comp.music.research
comp.os.linux.announce

comp.text.tex
rec.music.compose
</pre></blockquote>

<p>Mail:
</p>
<blockquote><pre class="example">info-lilypond@gnu.org

linux-audio-announce@lists.linuxaudio.org
linux-audio-user@lists.linuxaudio.org
linux-audio-dev@lists.linuxaudio.org

tex-music@icking-music-archive.org

--- non-existant?
abcusers@blackmill.net

rosegarden-user@lists.sourceforge.net
info-gnu@gnu.org
noteedit-user@berlios.de

gmane.comp.audio.fomus.devel
gmane.linux.audio.users
gmane.linux.audio.announce
gmane.comp.audio.rosegarden.devel
</pre></blockquote>

<p>Web:
</p>
<blockquote><pre class="example">lilypond.org
freshmeat.net
linuxfr.com
http://www.apple.com/downloads
harmony-central.com (news@harmony-central.com)
versiontracker.com [auto]
hitsquad.com [auto]
http://www.svgx.org
https://savannah.gnu.org/news/submit.php?group_id=1673  </pre></blockquote>

</li></ul>


<hr size="6">
<a name="Release-extra-notes"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#release-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Release work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#build-system-notes" title="Next chapter">&nbsp;Build system notes &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#major-release-checklist" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Major release checklist&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#release-work" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Release work&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#build-system-notes" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Build system notes &gt; </a>]</td></tr></table>
<a name="release-extra-notes"></a>
<h2 class="section">11.4 Release extra notes</h2>

<a name="Regenerating-regression-tests"></a>
<h4 class="subsubheading">Regenerating regression tests</h4>

<p>Regenerating regtests (if the lilypond-book naming has changed):
</p>
<ul>
<li>
git checkout release/lilypond-X.Y.Z-A

</li><li>
take lilypond-book and any related makefile updates from the
latest git.

</li><li>
configure; make; make test

</li><li>
tar -cjf lilypond-X.Y.Z-A.test-output.tar.bz2 input/regression/out-test/

</li><li>
mv lilypond-X.Y.Z-A.test-output.tar.bz2 ../gub/regtests/

</li><li>
cd ../gub/regtests/

</li><li>
make lilypond

</li></ul>


<a name="stable_002f2_002e12"></a>
<h4 class="subsubheading">stable/2.12</h4>

<p>If releasing stable/2.12, then:
</p>
<ul>
<li>
apply doc patch: patches/rsync-lily.patch  (or something like
that)

</li><li>
change infodir in gub/specs/lilypond-doc.py from &quot;lilypond.info&quot;
to &quot;lilypond-web.info&quot;
</li></ul>

<a name="Updating-a-release-_0028changing-a-in-x_002ey_002ez_002da_0029"></a>
<h4 class="subsubheading">Updating a release (changing a in x.y.z-a)</h4>

<p>Really tentative instructions, almost certainly can be done
better.
</p>
<ol>
<li>
change the VERSION back to release you want.  push change.
(hopefully you&rsquo;ll have forgotten to update it when you made your
last release)

</li><li>
make sure that there aren&rsquo;t any lilypond files floating around in
target/  (like usr/bin/lilypond).

</li><li>
build the specific package(s) you want, i.e.

<blockquote><pre class="example">bin/gub mingw::lilypond-installer
make LILYPOND_BRANCH=stable/2.12 -f lilypond.make doc
bin/gub --platform=darwin-x86 \
  'git://git.sv.gnu.org/lilypond-doc.git?branch=stable/2.12'
</pre></blockquote>

<p>or
</p>
<p>build everything with the normal &quot;make lilypond&quot;, then (maybe)
manually delete stuff you don&rsquo;t want to upload.
</p>
</li><li>
manually upload them.  good luck figuring out the rsync
command(s).  Hints are in test-lily/

<p>or
</p>
<p>run the normal lilypond-upload command, and (maybe) manually
delete stuff you didn&rsquo;t want to upload from the server.
</p>
</li></ol>





<hr size="6">
<a name="Build-system-notes"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#release-work" title="Beginning of this chapter or previous chapter"> &lt;&lt; Release work&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#modifying-the-feta-font" title="Next chapter">&nbsp;Modifying the feta font &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#release-extra-notes" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Release extra notes&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#index" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Top&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#build-system-overview" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Build system overview &gt; </a>]</td></tr></table>
<a name="build-system-notes"></a>
<h1 class="chapter">12. Build system notes</h1>

<div class="warning"><p><strong>Note:</strong> This chapter is in high flux, and is being run in a
&ldquo;wiki-like&rdquo; fashion.  Do not trust anything you read in this
chapter.
</p>
</div>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#build-system-overview" accesskey="1">12.1 Build system overview</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#tips-for-working-on-the-build-system" accesskey="2">12.2 Tips for working on the build system</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#general-build-system-notes" accesskey="3">12.3 General build system notes</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#doc-build" accesskey="4">12.4 Doc build</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#website-build" accesskey="5">12.5 Website build</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#building-an-ubuntu-distro" accesskey="6">12.6 Building an Ubuntu distro</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#building-gub" accesskey="7">12.7 Building GUB</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>


<hr size="6">
<a name="Build-system-overview"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#build-system-notes" title="Beginning of this chapter or previous chapter"> &lt;&lt; Build system notes&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#modifying-the-feta-font" title="Next chapter">&nbsp;Modifying the feta font &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#build-system-notes" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Build system notes&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#build-system-notes" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Build system notes&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#tips-for-working-on-the-build-system" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Tips for working on the build system &gt; </a>]</td></tr></table>
<a name="build-system-overview"></a>
<h2 class="section">12.1 Build system overview</h2>

<p>Build system is currently GNU make, with an extra &quot;stepmake&quot; layer
on top.  Look at files in &lsquo;<tt>make/</tt>&rsquo; and &lsquo;<tt>stepmake/</tt>&rsquo; and
all &lsquo;<tt>GNUmakefile</tt>&rsquo;s.
</p>
<p>There is wide-spread dissatisfaction with this system, and we are
considering changing.  This would be a huge undertaking (estimated
200+ hours).  This change will probably involve not using GNU make
any more &ndash; but a discussion about the precise build system will
have to wait.  Before we reach that point, we need to figure out
(at least approximately) what the current build system does.
</p>
<p>Fundamentally, a build system does two things:
</p>
<ol>
<li>
Constructs command-line commands, for example:

<blockquote><pre class="example">lilypond-book \
  --tons --of --options \
  pitches.itely
texi2pdf \
  --more --imperial --and --metric --tons --of --options \
  pitches.texi
</pre></blockquote>

</li><li>
If there was a previous build, it decides which parts of the
system need to be rebuilt.

</li></ol>

<p>When I try to do anything in the build system, it helps to remind
myself of this.  The &quot;end result&quot; is just a series of command-line
commands.  All the black magick is just an attempt to construct
those commands.
</p>
<hr size="6">
<a name="Tips-for-working-on-the-build-system"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#build-system-notes" title="Beginning of this chapter or previous chapter"> &lt;&lt; Build system notes&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#modifying-the-feta-font" title="Next chapter">&nbsp;Modifying the feta font &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#build-system-overview" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Build system overview&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#build-system-notes" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Build system notes&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#general-build-system-notes" title="Next section in reading order" accesskey="n" rel="next">&nbsp;General build system notes &gt; </a>]</td></tr></table>
<a name="tips-for-working-on-the-build-system"></a>
<h2 class="section">12.2 Tips for working on the build system</h2>

<ul>
<li>
Add:

<blockquote><pre class="example">echo &quot;aaa&quot;

echo &quot;bbb&quot;
</pre></blockquote>

<p>to the build system files in various places.  This will let you
track where the program is, in various points of the build.
</p>
<p>PH note.  There are lots of places where Make doesn&rsquo;t let you put
echo commands.  My top tip for tracing how make runs is to put
</p>
<blockquote><pre class="example">$(error Some Text to display)
</pre></blockquote>

<p>This will stop make running and print the text <code>Some Text to
display</code>.
</p>
<p>End PH note.
</p>
</li><li>
First task: understand how <code>make website</code> works,
<em>without</em> the translations.  Looking at the english-only
website is the best introduction to the build system... it only
covers about 5% of the whole thing, but even that will likely take
10 hours or more.

</li></ul>


<hr size="6">
<a name="General-build-system-notes"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#build-system-notes" title="Beginning of this chapter or previous chapter"> &lt;&lt; Build system notes&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#modifying-the-feta-font" title="Next chapter">&nbsp;Modifying the feta font &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#tips-for-working-on-the-build-system" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Tips for working on the build system&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#build-system-notes" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Build system notes&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#how-stepmake-works" title="Next section in reading order" accesskey="n" rel="next">&nbsp;How stepmake works &gt; </a>]</td></tr></table>
<a name="general-build-system-notes"></a>
<h2 class="section">12.3 General build system notes</h2>

<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#how-stepmake-works" accesskey="1">12.3.1 How stepmake works</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr size="6">
<a name="How-stepmake-works"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#build-system-notes" title="Beginning of this chapter or previous chapter"> &lt;&lt; Build system notes&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#modifying-the-feta-font" title="Next chapter">&nbsp;Modifying the feta font &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#general-build-system-notes" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; General build system notes&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#general-build-system-notes" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;General build system notes&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#doc-build" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Doc build &gt; </a>]</td></tr></table>
<a name="how-stepmake-works"></a>
<h3 class="subsection">12.3.1 How stepmake works</h3>

<p>Typing make website runs the file &lsquo;<tt>GNUmakefile</tt>&rsquo; from the
build directory.  This only contains 3 lines:
</p>
<blockquote><pre class="example">depth = .
include config$(if $(conf),-$(conf),).make
include $(configure-srcdir)/GNUmakefile.in
</pre></blockquote>

<p>The variable <code>depth</code> is used throughout the make system to
track how far down the directory structure the make is.  The first
include sets lots of variables but doesn&rsquo;t &quot;do&quot; anything.  Default
values for these variables are automatically detected at the
./configure step, which creates the file &lsquo;<tt>config.make</tt>&rsquo;.
The second include runs the file &lsquo;<tt>GNUmakefile.in</tt>&rsquo; from
the top level source directory.
</p>
<p>This sets another load of variables, and then includes (i.e.
immediately runs) &lsquo;<tt>stepmake.make</tt>&rsquo; from the &lsquo;<tt>make</tt>&rsquo;
subdirectory.  This sets a load of other variables, does some
testing to see if SCONS (another build tool?) is being used, and
then runs &lsquo;<tt>make/config.make</tt>&rsquo; - which doesn&rsquo;t seem to exist...
</p>
<p>GP: scons is indeed a different build tool; I think that Jan
experimented with it 5 years ago or something.  It seems like we
still have bits and pieces of it floating around.
</p>
<p>Next, it runs &lsquo;<tt>make/toplevel-version.make</tt>&rsquo;, which sets the
version variables for major, minor, patch, stable, development and
mypatchlevel (which seems to be used for patch numbers for
non-stable versions only?).
</p>
<p>Next - &lsquo;<tt>make/local.make</tt>&rsquo;, which doesn&rsquo;t exist.
</p>
<p>Then a few more variable and the interesting comment:
</p>
<blockquote><pre class="example"># Don't try to outsmart us, you puny computer!
# Well, UGH.  This only removes builtin rules from
</pre></blockquote>

<p>and then tests to see whether BUILTINS_REMOVED is defined.  It
appears to be when I run make, and so
&lsquo;<tt>stepmake/stepmake/no-builtin-rules.make</tt>&rsquo; is run.  The
comment at the head of this file says:
</p>
<blockquote><pre class="example"># UGH.  GNU make comes with implicit rules.
# We don't want any of them, and can't force users to run
# --no-builtin-rules
</pre></blockquote>

<p>I&rsquo;ve not studied that file at length, but assume it removes all
make&rsquo;s build-in rules (e.g. &lsquo;<tt>*.c</tt>&rsquo; files are run through the
GNU C compiler) - there&rsquo;s a lot of them in here, and a lot of
comments, and I&rsquo;d guess most of it isn&rsquo;t needed.
</p>
<p>We return to &lsquo;<tt>stepmake.make</tt>&rsquo;, where we hit the make rule all:
The first line of this is:
</p>
<table><tr><td>&nbsp;</td><td><pre class="smallexample">-include $(addprefix $(depth)/make/,$(addsuffix -inclusions.make, $(LOCALSTEPMAKE_TEMPLATES)))
</pre></td></tr></table>

<p>which, when the variables are substituted, gives:
</p>
<blockquote><pre class="example">./make/generic-inclusions.make
./make/lilypond-inclusions.make.
</pre></blockquote>

<p>(Note - according to the make documentation, -include is only
different from include in that it doesn&rsquo;t produce any kind of
error message when the included file doesn&rsquo;t exist).
</p>
<p>And the first file doesn&rsquo;t exist.  Nor the second.  Next:
</p>
<table><tr><td>&nbsp;</td><td><pre class="smallexample">-include $(addprefix $(stepdir)/,$(addsuffix -inclusions.make, $(STEPMAKE_TEMPLATES)))
</pre></td></tr></table>

<p>which expands to the following files:
</p>
<blockquote><pre class="example">/home/phil/lilypond-git/stepmake/stepmake/generic-inclusions.make
/home/phil/lilypond-git/stepmake/stepmake/toplevel-inclusions.make
/home/phil/lilypond-git/stepmake/stepmake/po-inclusions.make
/home/phil/lilypond-git/stepmake/stepmake/install-inclusions.make.
</pre></blockquote>

<p>One little feature to notice here - these are all absolute file
locations - the line prior to this used relative locations.  And
none of these files exist, either.
</p>
<p>(Further note - I&rsquo;m assuming all these lines of make I&rsquo;m following are
autogenerated, but that&rsquo;ll be something else to discover.)
</p>
<p>JM: <em>&ldquo;No, these lines are not useful in LilyPond (this is why
you think they are autogenerated), but they are part of StepMake,
which was meant to be a package to be installed as a build system over
autoconf/make in software project source trees.&rdquo;</em>
</p>
<p>Next in &lsquo;<tt>stepmake.make</tt>&rsquo;:
</p>
<table><tr><td>&nbsp;</td><td><pre class="smallexample">include $(addprefix $(stepdir)/,$(addsuffix -vars.make, $(STEPMAKE_TEMPLATES)))
</pre></td></tr></table>

<p>which expands to:
</p>
<blockquote><pre class="example">/home/phil/lilypond-git/stepmake/stepmake/generic-vars.make
/home/phil/lilypond-git/stepmake/stepmake/toplevel-vars.make
/home/phil/lilypond-git/stepmake/stepmake/po-vars.make
/home/phil/lilypond-git/stepmake/stepmake/install-vars.make.
</pre></blockquote>

<p>Woo.  They all exist (they should as there&rsquo;s no - in front of the
include).  &lsquo;<tt>generic-vars.make</tt>&rsquo; sets loads of variables
(funnily enough).  &lsquo;<tt>toplevel-vars.make</tt>&rsquo; is very short - one
line commented as <code># override Generic_vars.make:</code> and 2 as
follows:
</p>
<blockquote><pre class="example"># urg?
include $(stepdir)/documentation-vars.make
</pre></blockquote>

<p>I assume the urg comment refers to the fact that this should
really just create more variables, but it actually sends us off to
&lsquo;<tt>/home/phil/lilypond-git/stepmake/stepmake/documentation-vars.make</tt>&rsquo;.
</p>
<p>That file is a 3 line variable setting one.
</p>
<p>&lsquo;<tt>po-vars.make</tt>&rsquo; has the one-line comment <code># empty</code>, as
does &lsquo;<tt>install-vars.make</tt>&rsquo;.
</p>
<p>So now we&rsquo;re back to &lsquo;<tt>stepmake.make</tt>&rsquo;.
</p>
<p>The next lines are
:
</p><table><tr><td>&nbsp;</td><td><pre class="smallexample"># ugh. need to do this because of PATH :=$(top-src-dir)/..:$(PATH)
include $(addprefix $(depth)/make/,$(addsuffix -vars.make, $(LOCALSTEPMAKE_TEMPLATES)))
</pre></td></tr></table>

<p>and the include expands to:
</p>
<blockquote><pre class="example">include ./make/generic-vars.make ./make/lilypond-vars.make.
</pre></blockquote>

<p>These again set variables, and in some cases export them to allow
child <code>make</code> processes to use them.
</p>
<p>The final 4 lines of &lsquo;<tt>stepmake.make</tt>&rsquo; are:
</p>
<table><tr><td>&nbsp;</td><td><pre class="smallexample">include $(addprefix $(depth)/make/,$(addsuffix -rules.make, $(LOCALSTEPMAKE_TEMPLATES)))
include $(addprefix $(stepdir)/,$(addsuffix -rules.make, $(STEPMAKE_TEMPLATES)))
include $(addprefix $(depth)/make/,$(addsuffix -targets.make, $(LOCALSTEPMAKE_TEMPLATES)))
include $(addprefix $(stepdir)/,$(addsuffix -targets.make, $(STEPMAKE_TEMPLATES)))
</pre></td></tr></table>

<p>which expand as follows:
</p>
<blockquote><pre class="example">include ./make/generic-rules.make ./make/lilypond-rules.make
include
  /home/phil/lilypond-git/stepmake/stepmake/generic-rules.make
  /home/phil/lilypond-git/stepmake/stepmake/toplevel-rules.make
  /home/phil/lilypond-git/stepmake/stepmake/po-rules.make
  /home/phil/lilypond-git/stepmake/stepmake/install-rules.make
include ./make/generic-targets.make ./make/lilypond-targets.make
include
  /home/phil/lilypond-git/stepmake/stepmake/generic-targets.make
  /home/phil/lilypond-git/stepmake/stepmake/toplevel-targets.make
  /home/phil/lilypond-git/stepmake/stepmake/po-targets.make
  /home/phil/lilypond-git/stepmake/stepmake/install-targets.make
</pre></blockquote>

<p>&lsquo;<tt>lilypond-rules.make</tt>&rsquo; is <code>#empty</code>
</p>
<p>&lsquo;<tt>generic-rules.make</tt>&rsquo; does seem to have 2 rules in it.  They
are:
</p>
<blockquote><pre class="example">$(outdir)/%.ly: %.lym4
        $(M4) $&lt; | sed &quot;s/\`/,/g&quot; &gt; $@

$(outdir)/%: %.in
        rm -f $@
        cat $&lt; | sed $(sed-atfiles) | sed $(sed-atvariables) &gt; $@
</pre></blockquote>

<p>I believe the first rule is for *.ly files, and has a prerequisite
that *.lym4 files must be built first.  The recipe is <code>m4  |
sed &quot;s/\`/,/g&quot; &gt;</code>.  Perhaps someone with more Unix/make knowledge
can comment on exactly what the rules mean/do.
</p>
<p>&lsquo;<tt>toplevel-rules.make</tt>&rsquo; is <code>#empty</code>
</p>
<p>&lsquo;<tt>po-rules.make</tt>&rsquo; is <code>#empty</code>
</p>
<p>&lsquo;<tt>install-rules.make</tt>&rsquo; is <code>#empty</code>
</p>
<p>&lsquo;<tt>generic-targets.make</tt>&rsquo; contains 2 lines of comments.
</p>
<p>&lsquo;<tt>lilypond-targets.make</tt>&rsquo; contains only:
</p>
<blockquote><pre class="example">## TODO: fail dist or web if no \version present.
check-version:
        grep -L version $(LY_FILES)
</pre></blockquote>

<p>&lsquo;<tt>stepmake/generic-targets.make</tt>&rsquo; contains lots of rules - too
many to list here - it seems to be the main file for rules. (FWIW
I haven&rsquo;t actually found a rule for website: anywhere, although
it clearly exists.  I have also found that you can display a rule
in the terminal by typing, say <code>make -n website</code>.  This is
probably common knowledge.
</p>
<p>&lsquo;<tt>stepmake/toplevel-targets.make</tt>&rsquo; adds a load of other (and
occasionally the same) rules to the gernric-targets.
</p>
<p>&lsquo;<tt>stepmake/po-targets.make</tt>&rsquo; is rules for po* makes.
</p>
<p>&lsquo;<tt>stepmake/install-targets.make</tt>&rsquo; has rules for local-install*.
</p>
<p>And that&rsquo;s the end of stepmake.make.  Back to
&lsquo;<tt>GNUmakefile.in</tt>&rsquo;.
</p>
<p>A bit more info from 27 March.  I&rsquo;ve put some error traces into
<code>GNUmakefile</code> in the build directory, and it looks like the
following lines actually cause the make to run (putting an error
call above them - no make; below them - make):
</p>
<table><tr><td>&nbsp;</td><td><pre class="smallexample">ifeq ($(out),www)
# All web targets, except info image symlinks and info docs are
# installed in non-recursing target from TOP-SRC-DIR
install-WWW:
        -$(INSTALL) -m 755 -d $(DESTDIR)$(webdir)
        rsync -rl --exclude='*.signature' $(outdir)/offline-root $(DESTDIR)$(webdir)
        $(MAKE) -C Documentation omf-local-install
</pre></td></tr></table>

<p>I don&rsquo;t currently understand the <code>ifeq</code>, since <code>$(out)</code>
is empty at this point, but the line starting <code>-$(INSTALL)</code>
translates to:
</p>
<blockquote><pre class="example">-/usr/bin/python /home/phil/lilypond-git/stepmake/bin/install.py \
  -c -m 755 -d /usr/local/share/doc/lilypond/html
</pre></blockquote>

<p>End of work for Sunday 27th.
</p>
<p>Another alterative approach to understanding the website build
would be to redirect <code>make -n website</code> and <code>make website</code>
to a text file and work through a) what it does and b) where the
errors are occurring.
</p>
<p>GP: wow, all the above is much more complicated than I&rsquo;ve ever
looked at stuff &ndash; I tend to do a &quot;back first&quot; approach (where I
begin from the command-line that I want to modify, figure out
where it&rsquo;s generated, and then figure out how to change the
generated command-line), rather than a &quot;front first&quot; (where you
begin from the &quot;make&quot; command).
</p>

<hr size="6">
<a name="Doc-build"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#build-system-notes" title="Beginning of this chapter or previous chapter"> &lt;&lt; Build system notes&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#modifying-the-feta-font" title="Next chapter">&nbsp;Modifying the feta font &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#how-stepmake-works" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; How stepmake works&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#build-system-notes" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Build system notes&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#the-function-of-make-doc" title="Next section in reading order" accesskey="n" rel="next">&nbsp;The function of make doc &gt; </a>]</td></tr></table>
<a name="doc-build"></a>
<h2 class="section">12.4 Doc build</h2>

<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#the-function-of-make-doc" accesskey="1">12.4.1 The function of make doc</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#building-a-bibliography" accesskey="2">12.4.2 Building a bibliography</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr size="6">
<a name="The-function-of-make-doc"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#build-system-notes" title="Beginning of this chapter or previous chapter"> &lt;&lt; Build system notes&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#modifying-the-feta-font" title="Next chapter">&nbsp;Modifying the feta font &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#doc-build" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Doc build&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#doc-build" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Doc build&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#building-a-bibliography" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Building a bibliography &gt; </a>]</td></tr></table>
<a name="the-function-of-make-doc"></a>
<h3 class="subsection">12.4.1 The function of make doc</h3>

<p>The following is a set of notes on how make doc functions.
</p>
<p>Preliminary question to be answered some time: where do all the
GNUmakefiles come from.  They&rsquo;re in the build directory, but this
is not part of source.  Must be the configure script.  And it
looks like this comes from autogen.sh.  Must at some point kill
the whole git directory, repull and see what is created when.
</p>
<p>Anyway, here&rsquo;s how make doc progresses:
</p>
<p>This is the build dependency tree from
&lsquo;<tt>stepmake/stepmake/generic-targets.make</tt>&rsquo;:
</p>
<blockquote><pre class="example">doc: doc-stage-1
  doc-stage-1:
        $(MAKE) -C $(depth)/scripts/build out=
        $(MAKE) out=www WWW-1
          WWW-1: local-WWW-1
        $(LOOP)
          $(MAKE) out=www WWW-2
          WWW-2: local-WWW-2
            $(LOOP)
          $(MAKE) out=www WWW-post
</pre></blockquote>

<blockquote><pre class="example">MAKE = make --no-builtin-rules
-C = Change to directory before make
</pre></blockquote>

<p>doc-stage-1 does lots of opening and looking in files, but no
processing.
</p>
<blockquote><pre class="example">Variable LOOP =

+ make PACKAGE=LILYPOND package=lilypond -C python
&amp;&amp; make PACKAGE=LILYPOND package=lilypond -C scripts
&amp;&amp;  make PACKAGE=LILYPOND package=lilypond -C flower
&amp;&amp;  make PACKAGE=LILYPOND package=lilypond -C lily
&amp;&amp;  make PACKAGE=LILYPOND package=lilypond -C mf
&amp;&amp;  make PACKAGE=LILYPOND package=lilypond -C ly
&amp;&amp;  make PACKAGE=LILYPOND package=lilypond -C tex
&amp;&amp;  make PACKAGE=LILYPOND package=lilypond -C ps
&amp;&amp;  make PACKAGE=LILYPOND package=lilypond -C scm
&amp;&amp;  make PACKAGE=LILYPOND package=lilypond -C po
&amp;&amp;  make PACKAGE=LILYPOND package=lilypond -C make
&amp;&amp;  make PACKAGE=LILYPOND package=lilypond -C elisp
&amp;&amp;  make PACKAGE=LILYPOND package=lilypond -C vim
&amp;&amp;  make PACKAGE=LILYPOND package=lilypond -C input
&amp;&amp;  make PACKAGE=LILYPOND package=lilypond -C stepmake
&amp;&amp;  make PACKAGE=LILYPOND package=lilypond -C Documentation
&amp;&amp; true
</pre></blockquote>

<p>From git grep:
</p>
<p>stepmake/stepmake/generic-vars.make has this:
</p>
<table><tr><td>&nbsp;</td><td><pre class="smallexample">LOOP=+$(foreach i, $(SUBDIRS), $(MAKE) PACKAGE=$(PACKAGE) package=$(package) -C $(i) $@ &amp;&amp;) true
</pre></td></tr></table>

<p>$@ is the name of the target - WWW-1 in this case.
</p>
<p>In GNUmakefile.in we find:
</p>
<blockquote><pre class="example">SUBDIRS = python scripts \
        flower lily \
        mf ly \
        tex ps scm \
        po make \
        elisp vim \
        input \
        stepmake $(documentation-dir)
</pre></blockquote>

<p>So that&rsquo;s how we get the main make loop...
</p>
<p>That loop expands like this:
</p>
<blockquote><pre class="example">make PACKAGE=LILYPOND package=lilypond -C python WWW-1 &amp;&amp;
make PACKAGE=LILYPOND package=lilypond -C scripts WWW-1 &amp;&amp;
make PACKAGE=LILYPOND package=lilypond -C flower WWW-1 &amp;&amp;
make PACKAGE=LILYPOND package=lilypond -C lily WWW-1 &amp;&amp;
make PACKAGE=LILYPOND package=lilypond -C mf WWW-1 &amp;&amp;
make PACKAGE=LILYPOND package=lilypond -C ly WWW-1 &amp;&amp;
make PACKAGE=LILYPOND package=lilypond -C tex WWW-1 &amp;&amp;
make PACKAGE=LILYPOND package=lilypond -C ps WWW-1 &amp;&amp;
make PACKAGE=LILYPOND package=lilypond -C scm WWW-1 &amp;&amp;
make PACKAGE=LILYPOND package=lilypond -C po WWW-1 &amp;&amp;
make PACKAGE=LILYPOND package=lilypond -C make WWW-1 &amp;&amp;
make PACKAGE=LILYPOND package=lilypond -C elisp WWW-1 &amp;&amp;
make PACKAGE=LILYPOND package=lilypond -C vim WWW-1 &amp;&amp;
make PACKAGE=LILYPOND package=lilypond -C input WWW-1 &amp;&amp;
make PACKAGE=LILYPOND package=lilypond -C stepmake WWW-1 &amp;&amp;
make PACKAGE=LILYPOND package=lilypond -C Documentation WWW-1 &amp;&amp;
true
</pre></blockquote>

<p>The directories up to and including vim produce no effect with
make in non-debug mode, although debug does show lots of action.
</p>
<p>&lsquo;<tt>git/build/input/GNUmakefile</tt>&rsquo; is:
</p>
<blockquote><pre class="example">depth=../
include $(depth)/config$(if $(conf),-$(conf),).make
include $(configure-srcdir)/./input/GNUmakefile
MODULE_INCLUDES += $(src-dir)/$(outbase)
</pre></blockquote>

<p>The first include is:
</p>
<blockquote><pre class="example">..//config.make
</pre></blockquote>

<p>(note the // which is strictly wrong)
</p>
<p>which has lots of variables to set, but no action occurs.
</p>
<p>The second is:
</p>
<blockquote><pre class="example">lilypond-git/./input/GNUmakefile
</pre></blockquote>

<p>which similarly doesn&rsquo;t create any actual action.
</p>
<p>An error message at the end of build/input/GNUmakefile stops
make processing before it moves on to regression - so where does
that come from?
</p>
<p>And the answer is - make processes all directories in the
directory it&rsquo;s entered (with some exceptions like out and out-www)
and so it changes to /regression.
</p>
<p>It then seems to consider whether it needs to make/remake loads of
makefiles.  Don&rsquo;t understand this yet.  Possibly these are all the
makefiles it&rsquo;s processing, and it always checks they&rsquo;re up to date
before processing other files?
</p>
<p>Could be correct - some of this output is:
</p>
<blockquote><pre class="example">Must remake target `../../make/ly-inclusions.make'.
Failed to remake target file `../../make/ly-inclusions.make'.
</pre></blockquote>

<p>Having decided that, it then leaves the directory and re-executes:
</p>
<blockquote><pre class="example">make PACKAGE=LILYPOND package=lilypond -C regression WWW-1
</pre></blockquote>

<p>The top of this make is:
</p>
<blockquote><pre class="example">This program built for i486-pc-linux-gnu
Reading makefiles...
Reading makefile `GNUmakefile'...
Reading makefile `../..//config.make' (search path) (no ~ expansion)...
</pre></blockquote>

<p>which looks like it&rsquo;s re-reading all its known makefiles to check
they&rsquo;re up to date.
</p>
<p>(From the make manual:
</p>
<p>To this end, after reading in all makefiles, make will consider each
as a goal target and attempt to update it. If a makefile has a rule
which says how to update it (found either in that very makefile or in
another one) or if an implicit rule applies to it (see Chapter 10
[Using Implicit Rules], page 103), it will be updated if
necessary. After all makefiles have been checked, if any have actually
been changed, make starts with a clean slate and reads all the
makefiles over again. (It will also attempt to update each of them
over again, but normally this will not change them again, since they
are already up to date.)
</p>
<p>So my assumption seems correct)
</p>
<p>There appear to be about 74 of them.  After all the makefile
checking, we get this:
</p>
<table><tr><td>&nbsp;</td><td><pre class="smallexample">Updating goal targets....
Considering target file `WWW-1'.
File `WWW-1' does not exist.
Considering target file `local-WWW-1'.
File `local-WWW-1' does not exist.
Considering target file `out-www/collated-files.texi'.
File `out-www/collated-files.texi' does not exist.
Looking for an implicit rule for `out-www/collated-files.texi'.
Trying pattern rule with stem `collated-files.texi'.
Trying implicit prerequisite `collated-files.texi.in'.
Trying pattern rule with stem `collated-files.texi'.
Trying implicit prerequisite `collated-files.texi.in'.
Trying pattern rule with stem `collated-files'.
Trying implicit prerequisite `collated-files.tely'.
Trying pattern rule with stem `collated-files'.
Trying implicit prerequisite `out-www/collated-files.tely'.
Trying rule prerequisite `out-www/version.itexi'.
Found prerequisite `out-www/version.itexi' as VPATH `/home/phil/lilypond-git/input/regression/out-www/version.itexi'
</pre></td></tr></table>

<p>grep finds this if searching for local-WWW-1:
</p>
<blockquote><pre class="example">make/lysdoc-targets.make:
  local-WWW-1: $(outdir)/collated-files.texi $(outdir)/collated-files.pdf
</pre></blockquote>

<p>which means that local-WWW-1 depends on coll*.texi and coll*.pdf
and so these will need to be checked to see if they&rsquo;re up to date.
So make needs to find rules for both of those and (as it says) it
certainly needs to make coll*.texi, since it doesn&rsquo;t exist.
</p>
<p>In ly-rules.make we have:
</p>
<blockquote><pre class="example">.SUFFIXES: .doc .tely .texi .ly
</pre></blockquote>

<p>which I&rsquo;ll work out at some point, and also this rule:
</p>
<table><tr><td>&nbsp;</td><td><pre class="smallexample">$(outdir)/%.texi: $(outdir)/%.tely $(outdir)/version.itexi $(DOCUMENTATION_LOCALE_TARGET) $(INIT_LY_SOURCES) $(SCHEME_SOURCES)
  LILYPOND_VERSION=$(TOPLEVEL_VERSION) $(PYTHON) $(LILYPOND_BOOK) $(LILYPOND_BOOK_INCLUDES) --process='$(LILYPOND_BOOK_PROCESS) $(LILYPOND_BOOK_INCLUDES) $(LILYPOND_BOOK_LILYPOND_FLAGS)' --output=$(outdir) --format=$(LILYPOND_BOOK_FORMAT) $(LILYPOND_BOOK_FLAGS) $&lt;
</pre></td></tr></table>

<p>Note that the recipe is a very long line - it could probably
benefit from splitting.  The same makefile also has:
</p>
<table><tr><td>&nbsp;</td><td><pre class="smallexample">$(outdir)/%.texi: $(outdir)/%.tely $(outdir)/version.itexi $(DOCUMENTATION_LOCALE_TARGET) $(INIT_LY_SOURCES) $(SCHEME_SOURCES)
  LILYPOND_VERSION=$(TOPLEVEL_VERSION) $(PYTHON) $(LILYPOND_BOOK) $(LILYPOND_BOOK_INCLUDES) --process='$(LILYPOND_BOOK_PROCESS) $(LILYPOND_BOOK_INCLUDES) $(LILYPOND_BOOK_LILYPOND_FLAGS)' --output=$(outdir) --format=$(LILYPOND_BOOK_FORMAT) $(LILYPOND_BOOK_FLAGS) $&lt;
</pre></td></tr></table>

<p>which seems to be an almost exact duplicate.  Whatever, the first
one is executed first.  Have not checked if the second executes.
</p>
<p>The first recipe translates as this:
</p>
<blockquote><pre class="example">LILYPOND_VERSION=2.15.0 /usr/bin/python   --process=' ' \
  --output=./out-www --format= --lily-output-dir \
    /home/phil/lilypond-git/build/out/lybook-db
</pre></blockquote>

<p>if we stop the build with an $(error), but I think this is because
we need to allow it to process the dependencies first.  It looks
like foo.texi is shown as being dependent on foo.tely, plus a load
of other files.
</p>
<blockquote><pre class="example">DOCUMENTATION_LOCALE_TARGET is blank
INIT_LY_SOURCES = /home/phil/lilypond-git/scm/auto-beam.scm \
  /home/phil/lilypond-git/scm/autochange.scm
</pre></blockquote>

<p>plus 10s (100s?) of other .scm files.
</p>
<blockquote><pre class="example">SCHEME_SOURCES = /home/phil/lilypond-git/ly/Welcome-to-LilyPond-MacOS.ly \
  /home/phil/lilypond-git/ly/Welcome_to_LilyPond.ly
</pre></blockquote>

<p>ditto .ly files.  This does seem a teency bit wrong - it looks like
the .ly and .scm files have been interchanged.  ly-vars.make has
these 2 lines:
</p>
<blockquote><pre class="example">INIT_LY_SOURCES = $(wildcard $(top-src-dir)/scm/*.scm)
SCHEME_SOURCES = $(wildcard $(top-src-dir)/ly/*.ly)
</pre></blockquote>

<p>Looks like a bug.....
</p>
<p>So it now works its way through all these files, checking if they
need to be remade.  This is 100s of lines of the debug listing,
although none in the normal list.  Clearly none has to be made
since they&rsquo;re source files.  It concludes:
</p>
<blockquote><pre class="example">Must remake target `out-www/collated-files.tely'
</pre></blockquote>

<p>&lsquo;<tt>lysdoc-rules.make</tt>&rsquo; has this:
</p>
<table><tr><td>&nbsp;</td><td><pre class="smallexample">$(outdir)/collated-files.tely: $(COLLATED_FILES)
        $(LYS_TO_TELY) --name=$(outdir)/collated-files.tely --title=&quot;$(TITLE)&quot; --author=&quot;$(AUTHOR)&quot; $^
</pre></td></tr></table>

<p>&lsquo;<tt>lysdoc-vars.make</tt>&rsquo; has:
</p>
<blockquote><pre class="example">COLLATED_FILES = $(sort $(TEXINFO_SOURCES) $(LY_FILES) $(OUT_LY_FILES) )
</pre></blockquote>

<p>We find that:
</p>
<blockquote><pre class="example">TEXINFO_SOURCES = AAA-intro-regression.tely
OUT_LY_FILES is empty
</pre></blockquote>

<p>so LY_FILES has the big long list of all the .ly files in the
regression directory.
</p>
<p>This kicks off
</p>
<blockquote><pre class="example">/home/phil/lilypond-git/build/scripts/build/out/lys-to-tely
</pre></blockquote>

<p>with a list of all the files in the regression test directory. This
should (I believe) create the file collated-files.tely.
</p>
<p>So the next rule in make is for &lsquo;<tt>version.itexi</tt>&rsquo;, and make duly
checks this.  There&rsquo;s a rule in &lsquo;<tt>doc-i18n-root-rules.make</tt>&rsquo; that this
depends on &lsquo;<tt>git/VERSION</tt>&rsquo;:
</p>
<table><tr><td>&nbsp;</td><td><pre class="smallexample">$(outdir)/version.%: $(top-src-dir)/VERSION
        $(PYTHON) $(top-src-dir)/scripts/build/create-version-itexi.py &gt; $&nbsp;</pre></td></tr></table>

<p>This causes create-version-itexi.py to run and create
version.itexi.
</p>
<p>Once that&rsquo;s done, all the other *.scm and *.ly files are checked
and since they have no rules associated, they aren&rsquo;t remade (just
as well for source files, really).  Since version.itexi was remade
make concludes that collated-files.texi must be remade.  To do
this, it runs lilypond-book.py on collated-files.tely, as below:
</p>
<blockquote><pre class="example">LILYPOND_VERSION=2.15.0
  /usr/bin/python
  /home/phil/lilypond-git/scripts/lilypond-book.py
    -I /home/phil/lilypond-git/input/regression/
    -I ./out-www -I /home/phil/lilypond-git/input
    -I /home/phil/lilypond-git/Documentation
    -I /home/phil/lilypond-git/Documentation/snippets
    -I /home/phil/lilypond-git/input/regression/
    -I /home/phil/lilypond-git/Documentation/included/
    -I /home/phil/lilypond-git/build/mf/out/
    -I /home/phil/lilypond-git/build/mf/out/
    -I /home/phil/lilypond-git/Documentation/pictures
    -I /home/phil/lilypond-git/build/Documentation/pictures/./out-www
    --process='/home/phil/lilypond-git/build/out/bin/lilypond
    -I /home/phil/lilypond-git/input/regression/
    -I ./out-www
    -I /home/phil/lilypond-git/input
    -I /home/phil/lilypond-git/Documentation
    -I /home/phil/lilypond-git/Documentation/snippets
    -I /home/phil/lilypond-git/input/regression/
    -I /home/phil/lilypond-git/Documentation/included/
    -I /home/phil/lilypond-git/build/mf/out/
    -I /home/phil/lilypond-git/build/mf/out/
    -I /home/phil/lilypond-git/Documentation/pictures
    -I /home/phil/lilypond-git/build/Documentation/pictures/./out-www
    -dbackend=eps
    --formats=ps,png,pdf
    -dinclude-eps-fonts
    -dgs-load-fonts
    --header=doctitle
    --header=doctitlecs
    --header=doctitlede
    --header=doctitlees
    --header=doctitlefr
    --header=doctitlehu
    --header=doctitleit
    --header=doctitleja
    --header=doctitlenl
    --header=doctitlezh
    --header=texidoc
    --header=texidoccs
    --header=texidocde
    --header=texidoces
    --header=texidocfr
    --header=texidochu
    --header=texidocit
    --header=texidocja
    --header=texidocnl
    --header=texidoczh
    -dcheck-internal-types
    -ddump-signatures
    -danti-alias-factor=2'
    --output=./out-www
    --format=texi-html
    --verbose
    --lily-output-dir /home/phil/lilypond-git/build/out/lybook-db
    out-www/collated-files.tely
</pre></blockquote>

<p>So - lilypond-book runs on:
</p>
<blockquote><pre class="example">input/regression/out-www/collated-files.tely
</pre></blockquote>


<p>Note the &ndash;verbose flag - this is from the make variable
LILYPOND_BOOK_VERBOSE which is added to the make variable
LILYPOND_BOOK_FLAGS.
</p>
<p>Now found the invocation to write some of the image files.  It&rsquo;s
like this:
</p>
<blockquote><pre class="example">/home/phil/lilypond-git/build/out/bin/lilypond
  -I /home/phil/lilypond-git/input/regression/
  -I ./out-www -I /home/phil/lilypond-git/input
  -I /home/phil/lilypond-git/Documentation
  -I /home/phil/lilypond-git/Documentation/snippets
  -I /home/phil/lilypond-git/input/regression/
  -I /home/phil/lilypond-git/Documentation/included/
  -I /home/phil/lilypond-git/build/mf/out/
  -I /home/phil/lilypond-git/build/mf/out/
  -I /home/phil/lilypond-git/Documentation/pictures
  -I /home/phil/lilypond-git/build/Documentation/pictures/./out-www
  -dbackend=eps
  --formats=ps,png,pdf
  -dinclude-eps-fonts
  -dgs-load-fonts
  --header=doctitle
  --header=doctitlecs
  --header=doctitlede
  --header=doctitlees
  --header=doctitlefr
  --header=doctitlehu
  --header=doctitleit
  --header=doctitleja
  --header=doctitlenl
  --header=doctitlezh
  --header=texidoc
  --header=texidoccs
  --header=texidocde
  --header=texidoces
  --header=texidocfr
  --header=texidochu
  --header=texidocit
  --header=texidocja
  --header=texidocnl
  --header=texidoczh
  -dcheck-internal-types
  -ddump-signatures
  -danti-alias-factor=2
  -I  &quot;/home/phil/lilypond-git/build/out/lybook-db&quot;
  -I  &quot;/home/phil/lilypond-git/build/input/regression&quot;
  -I  &quot;/home/phil/lilypond-git/input/regression&quot;
  -I  &quot;/home/phil/lilypond-git/build/input/regression/out-www&quot;
  -I  &quot;/home/phil/lilypond-git/input&quot;
  -I  &quot;/home/phil/lilypond-git/Documentation&quot;
  -I  &quot;/home/phil/lilypond-git/Documentation/snippets&quot;
  -I  &quot;/home/phil/lilypond-git/input/regression&quot;
  -I  &quot;/home/phil/lilypond-git/Documentation/included&quot;
  -I  &quot;/home/phil/lilypond-git/build/mf/out&quot;
  -I  &quot;/home/phil/lilypond-git/build/mf/out&quot;
  -I  &quot;/home/phil/lilypond-git/Documentation/pictures&quot;
  -I  &quot;/home/phil/lilypond-git/build/Documentation/pictures/out-www&quot;
  --formats=eps
  --verbose
  -deps-box-padding=3.000000
  -dread-file-list
  -dno-strip-output-dir
  &quot;/home/phil/lilypond-git/build/out/lybook-db/snippet-names--415419468.ly&quot;'
</pre></blockquote>

<p>Note the &ndash;verbose.  This causes 100s of lines of Lily debug output.
But at present I can&rsquo;t work out where the flag comes from. Later.
</p>

<hr size="6">
<a name="Building-a-bibliography"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#build-system-notes" title="Beginning of this chapter or previous chapter"> &lt;&lt; Build system notes&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#modifying-the-feta-font" title="Next chapter">&nbsp;Modifying the feta font &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#the-function-of-make-doc" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; The function of make doc&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#doc-build" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Doc build&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#website-build" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Website build &gt; </a>]</td></tr></table>
<a name="building-a-bibliography"></a>
<h3 class="subsection">12.4.2 Building a bibliography</h3>

<p>Bibliography files contain a list of citations, like this:
</p>
<blockquote><pre class="example">@Book{vinci,
  author = {Vinci, Albert C.},
  title = {Fundamentals of Traditional Music Notation},
  publisher = {Kent State University Press},
  year = {1989}
}
</pre></blockquote>

<p>There are a variety of types of citation (e.g. Book (as above),
article, publication).  Each cited publication has a list of
entries that can be used to identify the publication.
Bibliograpies are normally stored as files with a .bib
extension.  One part of the doc-build process is transforming the
bibliography information into <code>texinfo</code> files.  The commands
to do this are in the &lsquo;<tt>GNUmakefile</tt>&rsquo; in the
&lsquo;<tt>Documentation</tt>&rsquo; directory.
</p>
<p>A typical line of the makefile to translate a single bibliography
is:
</p>
<blockquote><pre class="example">$(outdir)/colorado.itexi:
        BSTINPUTS=$(src-dir)/essay $(buildscript-dir)/bib2texi \
                -s $(top-src-dir)/Documentation/lily-bib \
                -o $(outdir)/colorado.itexi \
                $(src-dir)/essay/colorado.bib
</pre></blockquote>

<p>Line by line:
</p>
<blockquote><pre class="example">$(outdir)/colorado.itexi:
</pre></blockquote>

<p>We&rsquo;re making the file &lsquo;<tt>colorado.itexi</tt>&rsquo; and so this is the
make instruction.
</p>
<blockquote><pre class="example">        BSTINPUTS=$(src-dir)/essay $(buildscript-dir)/bib2texi \
</pre></blockquote>

<p>It&rsquo;s in the &lsquo;<tt>essay</tt>&rsquo; directory and we want to run the
bib2texi.py script against it.
</p>
<blockquote><pre class="example">                -s $(top-src-dir)/Documentation/lily-bib \
</pre></blockquote>

<p>The style template is &lsquo;<tt>lily-bib.bst</tt>&rsquo; and is found in the
&lsquo;<tt>Documentation</tt>&rsquo; directory.
</p>
<blockquote><pre class="example">                -o $(outdir)/colorado.itexi \
</pre></blockquote>

<p>The output file in &lsquo;<tt>colorado.itexi</tt>&rsquo;.
</p>
<blockquote><pre class="example">                $(src-dir)/essay/colorado.bib
</pre></blockquote>

<p>The input file is &lsquo;<tt>colorado.bib</tt>&rsquo; in the &lsquo;<tt>essay</tt>&rsquo;
directory.
</p>
<p>The <code>bib2texi</code> Python script used to be used with a variety
of options, but now is always called using the same options, as
above.  Its job is to create the file containing the options for
<code>bibtex</code> (the program that actually does the translation),
run bibtex, and then clean up some temporary files.  Its main
&quot;value add&quot; is the creation of the options file, using this code:
</p>
<blockquote><pre class="example">open (tmpfile + '.aux', 'w').write (r'''
\relax
\citation{*}
\bibstyle{%(style)s}
\bibdata{%(files)s}''' % vars ())
</pre></blockquote>

<p>The key items are the style file (now always lily-bib for us) and
the input file.
</p>
<p>The style file is written in its own specialised language,
described to some extent at
</p>
<blockquote><pre class="example"><a href="http://amath.colorado.edu/documentation/LaTeX/reference/faq/bibtex.pdf">http://amath.colorado.edu/documentation/LaTeX/reference/faq/bibtex.pdf</a>
</pre></blockquote>

<p>The file &lsquo;<tt>lily-bib.bst</tt>&rsquo; also has fairly extensive commenting.
</p>

<hr size="6">
<a name="Website-build"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#build-system-notes" title="Beginning of this chapter or previous chapter"> &lt;&lt; Build system notes&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#modifying-the-feta-font" title="Next chapter">&nbsp;Modifying the feta font &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#building-a-bibliography" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Building a bibliography&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#build-system-notes" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Build system notes&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#building-an-ubuntu-distro" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Building an Ubuntu distro &gt; </a>]</td></tr></table>
<a name="website-build"></a>
<h2 class="section">12.5 Website build</h2>

<div class="warning"><p><strong>Note:</strong> This information applies only to the standard <code>make
website</code> from the normal build directory.  The process is
different for <code>dev/website-build</code>.
</p>
</div>
<p>The rule for make website is found in GNUmakefile.in:
</p>
<blockquote><pre class="example">website:
$(MAKE) config_make=$(config_make) \
        top-src-dir=$(top-src-dir) \
        -f $(top-src-dir)/make/website.make \
        website
</pre></blockquote>

<p>This translates as:
</p>
<blockquote><pre class="example">make --no-builtin-rules config_make=./config.make \
                top-src-dir=/home/phil/lilypond-git \
                -f /home/phil/lilypond-git/make/website.make \
                website
</pre></blockquote>

<p>which has the effect of setting the variables <code>config_make</code>
and <code>top-src-dir</code> and then processing the file
<code>git/make/website.make</code> with the target of website.
</p>
<p><code>website.make</code> starts with the following:
</p>
<blockquote><pre class="example">ifeq ($(WEBSITE_ONLY_BUILD),1)
</pre></blockquote>

<p>which checks to see whether the variable <code>WEBSITE_ONLY_BUILD</code>
was set to one on the command line.  This is only done for
standalone website builds, not in the normal case.  The result of
the test determines the value of some variables that are set.  A
number of other variables are set, in order to establish locations
of various files.  An example is:
</p>
<blockquote><pre class="example">CREATE_VERSION=python $(script-dir)/create-version-itexi.py
</pre></blockquote>

<p>The rule for website is:
</p>
<table><tr><td>&nbsp;</td><td><pre class="smallexample">website: website-texinfo website-css website-pictures website-examples web-post
        cp $(SERVER_FILES)/favicon.ico $(OUT)/website
        cp $(SERVER_FILES)/robots.txt $(OUT)/website
        cp $(top-htaccess) $(OUT)/.htaccess
        cp $(dir-htaccess) $(OUT)/website/.htaccess
</pre></td></tr></table>

<p>so we see that this starts by running the rules for 5 other
targets, then finishes by copying some files.  We&rsquo;ll cover that
later - first <code>website-texinfo</code>.  That rule is:
</p>
<blockquote><pre class="example">website-texinfo: website-version website-xrefs website-bibs
        for l in '' $(WEB_LANGS); do \
                if test -n &quot;$$l&quot;; then \
                        langopt=--lang=&quot;$$l&quot;; \
                        langsuf=.$$l; \
                fi; \
                $(TEXI2HTML) --prefix=index \
                        --split=section \
                        --I=$(top-src-dir)/Documentation/&quot;$$l&quot; \
                        --I=$(top-src-dir)/Documentation \
                        --I=$(OUT) \
                        $$langopt \
                        --init-file=$(texi2html-init-file) \
                        -D web_version \
                        --output=$(OUT)/&quot;$$l&quot; \
                        $(top-src-dir)/Documentation/&quot;$$l&quot;/web.texi ; \
                ls $(OUT)/$$l/*.html | xargs grep -L \
                        'UNTRANSLATED NODE: IGNORE ME' | \
                        sed 's!$(OUT)/'$$l'/!!g' | xargs \
                        $(MASS_LINK) --prepend-suffix=&quot;$$langsuf&quot; \
                        hard $(OUT)/$$l/ $(OUT)/website/ ; \
        done
</pre></blockquote>

<p>which therefore depends on <code>website-version</code>,
<code>website-xrefs</code> and <code>website-bibs</code>.
</p>
<blockquote><pre class="example">website-version:
        mkdir -p $(OUT)
        $(CREATE_VERSION) $(top-src-dir) &gt; $(OUT)/version.itexi
        $(CREATE_WEBLINKS) $(top-src-dir) &gt; $(OUT)/weblinks.itexi
</pre></blockquote>

<p>which translates as:
</p>
<blockquote><pre class="example">mkdir -p out-website
python /home/phil/lilypond-git/scripts/build/create-version-itexi.py
        /home/phil/lilypond-git &gt; out-website/version.itexi
python /home/phil/lilypond-git/scripts/build/create-weblinks-itexi.py
        /home/phil/lilypond-git &gt; out-website/weblinks.itexi
</pre></blockquote>

<p>So, we make out-website then send the output of
<code>create-version-itexi.py</code> to <code>out-website/version.itexi</code>
and <code>create-weblinks-itexi.py</code> to
<code>out-website/weblinks.itexi</code>.
</p>
<p><code>create-version-itexi.py</code> parses the file <code>VERSION</code> in
the top source dir.  It contains:
</p>
<blockquote><pre class="example">PACKAGE_NAME=LilyPond
MAJOR_VERSION=2
MINOR_VERSION=15
PATCH_LEVEL=13
MY_PATCH_LEVEL=
VERSION_STABLE=2.14.2
VERSION_DEVEL=2.15.12
</pre></blockquote>

<p>currently.  <code>c-v-i.py</code> parses this to:
</p>
<blockquote><pre class="example">@c ************************ Version numbers ************
@macro version
2.15.13
@end macro

@macro versionStable
2.14.2
@end macro

@macro versionDevel
2.15.12
@end macro
</pre></blockquote>

<p><code>create-weblinks-itexi.py</code> creates a load of texi macros (of
the order of 1000) similar to:
</p>
<blockquote><pre class="example">@macro manualStableGlossaryPdf
@uref{../doc/v2.14/Documentation/music-glossary.pdf,Music glossary.pdf}
@end macro.
</pre></blockquote>

<p>It loads its languages from langdefs.py, and therefore outputs the following unhelpful warning:
</p>
<p><code>langdefs.py: warning: lilypond-doc gettext domain not found.</code>
</p>
<p>Next:
</p>
<blockquote><pre class="example">website-xrefs: website-version
        for l in '' $(WEB_LANGS); do \
</pre></blockquote>

<p>is the start of the rule, truncated for brevity.  This loops
through the languages to be used on the website, processing some
variables which I don&rsquo;t fully understand, to run this command:
</p>
<table><tr><td>&nbsp;</td><td><pre class="smallexample">python /home/phil/lilypond-git/scripts/build/extract_texi_filenames.py \
        -I /home/phil/lilypond-git/Documentation \
        -I /home/phil/lilypond-git/Documentation/&quot;$l&quot; \
        -I out-website -o out-website --split=node \
        --known-missing-files= \
                 /home/phil/lilypond-git/scripts/build/website-known-missing-files.txt \
        -q \
        /home/phil/lilypond-git/Documentation/&quot;$l&quot;/web.texi ;\
</pre></td></tr></table>

<p>There&rsquo;s a good description of what
<code>extract_texi_filenames.py</code> does at the top of the script,
but a shortened version is:
</p>
<p><code>If this script is run on a file texifile.texi, it produces
a file texifile[.LANG].xref-map with tab-separated entries
of the form NODE\tFILENAME\tANCHOR.</code>
</p>
<p>An example from
<code>web.nl.xref-map</code> is:
</p>
<blockquote><pre class="example">Inleiding        Introduction        Introduction
</pre></blockquote>

<p><code>e-t-f.py</code> follows the includes from document to document.
We know some have not been created yet, and
<code>known-missing-files</code> option tells <code>e-t-f.py</code> which
these are.
</p>
<p>It then does this:
</p>
<blockquote><pre class="example">for m in $(MANUALS); do \
</pre></blockquote>

<p>to run <code>e-t-f.py</code> against all of the manuals, in each
language. Next:
</p>
<blockquote><pre class="example">website-bibs: website-version
        BSTINPUTS=$(top-src-dir)/Documentation/web \
                $(WEB_BIBS) -s web \
                -s $(top-src-dir)/Documentation/lily-bib \
                -o $(OUT)/others-did.itexi \
                $(quiet-flag) \
                $(top-src-dir)/Documentation/web/others-did.bib
</pre></blockquote>

<p>This is half the command.  It runs <code>bib2texi.py</code> on 2
<code>.bib</code> files - <code>others-did.bib</code> and <code>we-wrote.bib</code>.
This converts bibliography files into texi files with
<code>bibtex</code>.
</p>
<p>Next the commands in the <code>website-texinfo</code> rule are run:
</p>
<blockquote><pre class="example">for l in '' $(WEB_LANGS); do \
</pre></blockquote>

<p>run <code>texi2html</code>.  This is the program that outputs the
progress message (found in
<code>Documentation/lilypond-texi2html.init</code>):
</p>
<p><code>Processing web site: []</code>
</p>
<p>It also outputs warning messages like:
</p>
<p><code>WARNING: Unable to find node 'een pot' in book usage.</code>
</p>
<blockquote><pre class="example">website-css:
        cp $(top-src-dir)/Documentation/css/*.css $(OUT)/website
</pre></blockquote>

<p>Copies 3 css files to out-website/website.  Then:
</p>
<blockquote><pre class="example">website-pictures:
        mkdir -p $(OUT)/website/pictures
        if [ -d $(PICTURES) ]; \
        then \
                cp $(PICTURES)/* $(OUT)/website/pictures ; \
                ln -sf website/pictures $(OUT)/pictures  ;\
        fi
</pre></blockquote>

<p>which translates as:
</p>
<table><tr><td>&nbsp;</td><td><pre class="smallexample">if [ -d Documentation/pictures/out-www ]; \
    then \
        cp Documentation/pictures/out-www/* out-website/website/pictures ; \
        ln -sf website/pictures out-website/pictures  ;\
    fi
</pre></td></tr></table>

<p>i.e. it copies the contents of
<code>build/Documentation/pictures/out-www/*</code> to
<code>out-website/website/pictures</code>.  Unfortunately, the pictures
are only created once <code>make doc</code> has been run, so an initial
run of <code>make website</code> copies nothing, and the pictures on the
website (e.g. the logo) do not exist.  Next:
</p>
<blockquote><pre class="example">website-examples:
        mkdir -p $(OUT)/website/ly-examples
        if [ -d $(EXAMPLES) ]; \
        then \
                cp $(EXAMPLES)/* $(OUT)/website/ly-examples ; \
        fi
</pre></blockquote>

<p>translates to:
</p>
<table><tr><td>&nbsp;</td><td><pre class="smallexample">mkdir -p out-website/website/ly-examples
if [ -d Documentation/web/ly-examples/out-www ]; \
    then \
        cp Documentation/web/ly-examples/out-www/* out-website/website/ly-examples ; \
    fi
</pre></td></tr></table>

<p>This does the same with the LilyPond examples (found at
<a href="http://lilypond.org/examples.html">http://lilypond.org/examples.html</a>).  Again, these are
actually only created by <code>make doc</code> (and since they are
generated from LilyPond source files, require a working LilyPond
<code>exe</code> made with <code>make</code>).  So this does nothing
initially.  Then:
</p>
<blockquote><pre class="example">web-post:
        $(WEB_POST) $(OUT)/website
</pre></blockquote>

<p>which is:
</p>
<table><tr><td>&nbsp;</td><td><pre class="smallexample">python /home/phil/lilypond-git/scripts/build/website_post.py out-website/website
</pre></td></tr></table>

<p>which describes itself as:
</p>
<p><code>This is web_post.py. This script deals with translations
in the &quot;make website&quot; target.</code>
</p>
<p>It also does a number of other things, including adding the Google
tracker code and the language selection footer.  We&rsquo;re now at
the end of our story.  The final 4 lines of the recipe for website
are:
</p>
<blockquote><pre class="example">cp $(SERVER_FILES)/favicon.ico $(OUT)/website
cp $(SERVER_FILES)/robots.txt $(OUT)/website
cp $(top-htaccess) $(OUT)/.htaccess
cp $(dir-htaccess) $(OUT)/website/.htaccess
</pre></blockquote>

<p>The first translates as:
</p>
<table><tr><td>&nbsp;</td><td><pre class="smallexample">cp /home/phil/lilypond-git/Documentation/web/server/favicon.ico out-website/website
</pre></td></tr></table>

<p>so we see these are just copying the support files for the web
server.
</p>
<a name="website_002emake-summary"></a>
<h4 class="subsubheading">website.make summary</h4>

<p>Recipes in &lsquo;<tt>website.make</tt>&rsquo;:
</p>
<ul>
<li>
<code>website:</code>
this is the &quot;master&quot; rule.  It calls the other rules in order,
then copies some extra files around - see below for further
of the process it produces.

</li><li>
<code>website-version</code>:
this calls the python scripts below:
<ul>
<li>
<blockquote><pre class="example">scripts/build/create-version-itexi.py
</pre></blockquote>

This writes a @version, @versionStable, and @versionDevel based
on the top-level VERSIONS file, to
<code>out-website/version.itexi</code>

</li><li>
<blockquote><pre class="example">scripts/build/create-weblinks-itexi.py
</pre></blockquote>

This creates a ton of macros in <code>out-website/weblinks.itexi</code>.
Stuff like @downloadStableLinuxNormal, @downloadStableWidows,
<code>@stableDocsNotationPdf{}</code>, @downloadDevelSourch-zh.

<p>It&rsquo;s quite monstrous because it deals with combinations of
stable/devel, source/docs, lang/lang/lang*10, etc.
</p>
</li></ul>

</li><li>
<code>website-xrefs:</code>
creates files used for complicated &quot;out-of-build&quot; references to
<code>out-website/*.xref-map</code>

<p>If you just write @ref{}, then all&rsquo;s groovy and we wouldn&rsquo;t
need this.  But if you write @rlearning{}, then our custom
texi2html init file needs to know about our custom xref file
format, which tells our custom texi2html init file how to create
the link.
</p>
<p>GP: we should have a separate @node to discuss xrefs.  Also, take a
quick look at a generated xref file &ndash; it&rsquo;s basically just a list
of @node&rsquo;s [sic teenager pluralization rule] from the file.
</p>
</li><li>
<code>website-bib:</code>
generates the bibliography texinfo files from the .bib files - in
the case of the website build these are &lsquo;<tt>others-did.bib</tt>&rsquo; and
&lsquo;<tt>we-wrote.bib</tt>&rsquo;.

</li><li>
<code>website-texinfo:</code>
this is the main part; it calles texi2html to generate the actual
html.  It also has a ton of options to texi2html to pass info to
our custom init file.

<p>The file actually built is called &lsquo;<tt>web.texi</tt>&rsquo;, and is either
in the &lsquo;<tt>Documentation</tt>&rsquo; directory, or a sub-directory specific
to the language.
</p>
<p>The options file is &lsquo;<tt>/Documentation/lilypond-texi2html.init</tt>&rsquo;.
This contains *lots* of option and configuration stuff, and also
includes the line:
</p>
<table><tr><td>&nbsp;</td><td><pre class="smallexample">print STDERR &quot;Initializing settings for web site: [$Texi2HTML::THISDOC{current_lang}]\n&quot;;
</pre></td></tr></table>

<p>This is where one of the console messages is generated.
</p>
<p>We have somewhere between 2-4 different ways &quot;to pass info to our
custom init file&quot;.  This is highly Not Good (tm), but that&rsquo;s how
things work at the moment.
</p>
<p>After texi2html, it does some black magick to deal with
untranslated nodes in the translations.  Despite writing that
part, I can&rsquo;t remember how it works.  But in theory, you could
figure it out by copy&amp;pasting each part of the command (by &quot;part&quot;,
I mean &quot;stuff before each | pipe&quot;), substituting the variables,
then looking at the text that&rsquo;s output.  For example,
</p>
<blockquote><pre class="example">  ls $(OUT)/$$l/*.html
</pre></blockquote>

<p>is going to print a list of all html files, in all languages, in
the build directory.  Then more stuff happens to each of those
files (that&rsquo;s what xargs does).
</p>
</li><li>
<code>website-css:</code>
just copies files to the build dir.

</li><li>
<code>website-pictures, website-examples:</code>
more file copies, with an if statement to handle if you don&rsquo;t have
any generated pictures/examples.

</li><li>
<code>web-post:</code>
runs:

<blockquote><pre class="example">scripts/build/website_post.py
</pre></blockquote>

<p>which, it adds the &quot;this page is translated in klingon&quot; to the
bottom of html pages, and adds the google analytics javascript.
It also has hard-coded lilypond version numbers, which is Bad
(tm).
</p>
</li></ul>

<p>Here&rsquo;s a summary of what gets called, in what order, when we run
<code>make website</code>
</p>
<blockquote><pre class="example">website:
  website-texinfo:
    website-version:
      creates version.itexi and weblinks.itexi
    website-xrefs:
      runs extract_texi_filenames.py
    website-bibs:
      creates bibliography files, described above
  website-css:
    copies css files
  website-pictures:
    copies pictures
  website-examples:
    copies examples
  web-post:
    runs website_post.py
  Then some file copying
</pre></blockquote>

<hr size="6">
<a name="Building-an-Ubuntu-distro"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#build-system-notes" title="Beginning of this chapter or previous chapter"> &lt;&lt; Build system notes&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#modifying-the-feta-font" title="Next chapter">&nbsp;Modifying the feta font &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#website-build" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Website build&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#build-system-notes" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Build system notes&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#building-gub" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Building GUB &gt; </a>]</td></tr></table>
<a name="building-an-ubuntu-distro"></a>
<h2 class="section">12.6 Building an Ubuntu distro</h2>


<p>Here&rsquo;s the short instruction on how to create lilybuntu iso image
(Jonathan Kulp did this on a spare drive,
but he supposes it can be done in a VM too):
</p>
<ol>
<li>
Install ubuntu, reboot.
</li><li>
Run all updates, reboot if asked.
</li><li>
Enable src repos, refresh package lists.
</li><li>
Install LilyPond build deps:
<blockquote><pre class="example">sudo apt-get build-dep lilypond
</pre></blockquote>
</li><li>
Install git and autoconf:
<blockquote><pre class="example">sudo apt-get install git-core gitk autoconf
</pre></blockquote>

</li><li>
Test to see whether everything works fine now:
<ol>
<li>
use <code>lily-git.tcl</code> to grab source files
</li><li>
go to source dir and do
<blockquote><pre class="example">&quot;./autogen.sh&quot; ; make ; make doc
</pre></blockquote>
</li><li>
if all compiles, move on to iso creation...
</li></ol>

</li><li>
Download &amp; install &quot;remastersys&quot;:
<a href="http://sourceforge.net/projects/remastersys">http://sourceforge.net/projects/remastersys/</a>
</li><li>
Copy <code>lily-git.tcl</code> script file into &lsquo;<tt>/etc/skel/</tt>&rsquo;.
</li><li>
Modify &lsquo;<tt>/etc/remastersys.conf</tt>&rsquo; as desired (change <code>.iso</code> name,
default live session username, etc).
</li><li>
Remove non-essential desktop software as desired.
</li><li>
Create iso:
<blockquote><pre class="example">sudo remastersys dist
</pre></blockquote>
<p>New iso is in &lsquo;<tt>/home/remastersys/remastersys/</tt>&rsquo;.
</p></li><li>
Test iso by installing in VM and repeating steps above for
getting source files and building lp and docs.

</li></ol>

<hr size="6">
<a name="Building-GUB"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#build-system-notes" title="Beginning of this chapter or previous chapter"> &lt;&lt; Build system notes&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#modifying-the-feta-font" title="Next chapter">&nbsp;Modifying the feta font &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#building-an-ubuntu-distro" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Building an Ubuntu distro&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#build-system-notes" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Build system notes&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#modifying-the-feta-font" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Modifying the feta font &gt; </a>]</td></tr></table>
<a name="building-gub"></a>
<h2 class="section">12.7 Building GUB</h2>

<p>GUB - the Grand Unified Builder - is used to build the release
versions of LilyPond.  For background information, see
<a href="#grand-unified-builder-_0028gub_0029">Grand Unified Builder (GUB)</a>.  The simplest way to set up a
GUB build environment is to use a virtual machine with LilyDev
(<a href="#lilydev">LilyDev</a>).  Follow the instructions on that page to set this
up.  Make sure that your virtual machine has enough disk space -
a GUB installation takes over 30 GBytes of disk space, and if you
allocate too little, it will fail during the setting up stage and
you will have to start again.  64 GBytes should be sufficient.
</p>
<p>While GUB is being built, any interruptions are likely to make it
almost impossible to restart.  If at all possible, leave the build
to continue uniterrupted.
</p>
<p>Download GUB and start the set up:
</p>
<blockquote><pre class="example">git clone git://github.com/gperciva/gub/gub.git
cd gub
make bootstrap
</pre></blockquote>

<p>This downloads and installs a number of packages.  You may find
some fail during download and you will need to download them
manually.  For example, the perl archive.  If this happens,
download it from
<a href="http://www.cpan.org/src/5.0/perl-5.10.0.tar.gz">http://www.cpan.org/src/5.0/perl-5.10.0.tar.gz</a>, saving the
archive to &lsquo;<tt>gub/downloads/perl/</tt>&rsquo;.  Continue the set up with:
</p>
<blockquote><pre class="example">make bootstrap
</pre></blockquote>

<p>Once this has completed successfully, you can build the LilyPond
release package.  However, this uses an archived version of the
regression tests, so it is better to download this first.
Download the test output from lilypond.org:
</p>
<table><tr><td>&nbsp;</td><td><pre class="smallexample"><a href="http://lilypond.org/download/binaries/test-output/lilypond-2.15.33-1.test-output.tar.bz2">http://lilypond.org/download/binaries/test-output/lilypond-2.15.33-1.test-output.tar.bz2</a>
</pre></td></tr></table>

<p>Copy the tarball into &lsquo;<tt>gub/regtests/</tt>&rsquo;, and tell the build
system that you have done this:
</p>
<blockquote><pre class="example">touch regtests/ignore
</pre></blockquote>

<p>Now start the GUB build:
</p>
<blockquote><pre class="example">make lilypond
</pre></blockquote>

<p>That&rsquo;s it.  This will build LilyPond from current master.  To build
the current unstable release, run:
</p>
<blockquote><pre class="example">make LILYPOND_BRANCH=release/unstable lilypond
</pre></blockquote>
<hr size="6">
<a name="Modifying-the-feta-font"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#build-system-notes" title="Beginning of this chapter or previous chapter"> &lt;&lt; Build system notes&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#administrative-policies" title="Next chapter">&nbsp;Administrative policies &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#building-gub" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Building GUB&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#index" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Top&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#overview-of-the-feta-font" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Overview of the feta font &gt; </a>]</td></tr></table>
<a name="modifying-the-feta-font"></a>
<h1 class="chapter">13. Modifying the feta font</h1>

<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#overview-of-the-feta-font" accesskey="1">13.1 Overview of the feta font</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#font-creation-tools" accesskey="2">13.2 Font creation tools</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#adding-a-new-font-section" accesskey="3">13.3 Adding a new font section</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#adding-a-new-glyph" accesskey="4">13.4 Adding a new glyph</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#building-the-changed-font" accesskey="5">13.5 Building the changed font</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#metafont-formatting-rules" accesskey="6">13.6 METAFONT formatting rules</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr size="6">
<a name="Overview-of-the-feta-font"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#modifying-the-feta-font" title="Beginning of this chapter or previous chapter"> &lt;&lt; Modifying the feta font&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#administrative-policies" title="Next chapter">&nbsp;Administrative policies &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#modifying-the-feta-font" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Modifying the feta font&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#modifying-the-feta-font" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Modifying the feta font&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#font-creation-tools" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Font creation tools &gt; </a>]</td></tr></table>
<a name="overview-of-the-feta-font"></a>
<h2 class="section">13.1 Overview of the feta font</h2>

<p>The feta font is a font that was created specifically for use in
LilyPond.  The sources for the font are found in mf/*.mf.
</p>
<p>The feta font is merged from a number of subfonts.  Each subfont
can contain at most 224 glyphs.  This is because each subfont is
limited to a one-byte address space (256 glyphs maximum) and we
avoid the first 32 points in that address space, since they are
non-printing control characters in ASCII.
</p>
<p>In LilyPond, glyphs are accessed by glyph name, rather than by code point.
Therefore, the naming of glyphs is significant.
</p>
<p>Information about correctly creating glyphs is found in &lsquo;<tt>mf/README</tt>&rsquo;.
Please make sure you read and understand this file.
</p>
<p>TODO &ndash; we should get mf/README automatically generated from texinfo source
and include it here.
</p>

<hr size="6">
<a name="Font-creation-tools"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#modifying-the-feta-font" title="Beginning of this chapter or previous chapter"> &lt;&lt; Modifying the feta font&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#administrative-policies" title="Next chapter">&nbsp;Administrative policies &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#overview-of-the-feta-font" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Overview of the feta font&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#modifying-the-feta-font" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Modifying the feta font&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#adding-a-new-font-section" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Adding a new font section &gt; </a>]</td></tr></table>
<a name="font-creation-tools"></a>
<h2 class="section">13.2 Font creation tools</h2>

<p>The sources for the feta font are written in metafont.  The definitive
reference for metafont is &quot;The METAFONT book&quot;.  Source for the book is
available at CTAN.
</p>
<p>mf2pt1 is used to create type 1 fonts from the metafont sources.
</p>
<p>FontForge is used to postprocess the output of mf2pt1 and clean up
details of the font.  It can also be used by a developer to
display the resulting glyph shapes.
</p>
<hr size="6">
<a name="Adding-a-new-font-section"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#modifying-the-feta-font" title="Beginning of this chapter or previous chapter"> &lt;&lt; Modifying the feta font&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#administrative-policies" title="Next chapter">&nbsp;Administrative policies &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#font-creation-tools" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Font creation tools&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#modifying-the-feta-font" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Modifying the feta font&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#adding-a-new-glyph" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Adding a new glyph &gt; </a>]</td></tr></table>
<a name="adding-a-new-font-section"></a>
<h2 class="section">13.3 Adding a new font section</h2>

<p>The font is divided into sections, each of which contains less
than 224 glyphs.  If more than 224 glyphs are included in a section,
an error will be generated.
</p>
<p>Each of the sections is contained in a separate <code>.mf</code> file.  The
files are named according to the type of glyphs in that section.
</p>
<p>When adding a new section, it will be necessary to add the following:
</p>
<ul>
<li>
The code for the glyphs, in a file <code>&lt;section-name&gt;.mf</code>
</li><li>
Driver files used to create the font in different sizes
</li><li>
An entry in the generic file used to create the font, or a new
generic file
</li><li>
If necessary, new entries in the GNUmakefile
</li><li>
An entry in &lsquo;<tt>scripts/build/gen-emmentaler-scripts.py</tt>&rsquo;
</li></ul>

<p>See the examples in <code>mf/</code> for more information.
</p>
<hr size="6">
<a name="Adding-a-new-glyph"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#modifying-the-feta-font" title="Beginning of this chapter or previous chapter"> &lt;&lt; Modifying the feta font&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#administrative-policies" title="Next chapter">&nbsp;Administrative policies &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#adding-a-new-font-section" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Adding a new font section&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#modifying-the-feta-font" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Modifying the feta font&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#building-the-changed-font" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Building the changed font &gt; </a>]</td></tr></table>
<a name="adding-a-new-glyph"></a>
<h2 class="section">13.4 Adding a new glyph</h2>

<p>Adding a new glyph is done by modifying the .mf file to which the
glyph will be added.
</p>
<p>Necessary functions to draw the glyph can be added anywhere in the file,
but it is standard to put them immediately before the glyph definition.
</p>
<p>The glyph definition begins with:
</p>
<blockquote><pre class="example">fet_beginchar (&quot;glyph description&quot;, &quot;glyphname&quot;);
</pre></blockquote>

<p>with <code>glyph description</code> replaced with a short description of the
glyph, and <code>glyphname</code> replaced with the glyphname, which is chosen
to comply with the naming rules in &lsquo;<tt>mf/README</tt>&rsquo;.
</p>
<p>The metafont code used to draw the glyph follows the <code>fet_beginchar</code>
entry.  The glyph is finished with:
</p>
<blockquote><pre class="example">fet_endchar;
</pre></blockquote>

<hr size="6">
<a name="Building-the-changed-font"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#modifying-the-feta-font" title="Beginning of this chapter or previous chapter"> &lt;&lt; Modifying the feta font&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#administrative-policies" title="Next chapter">&nbsp;Administrative policies &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#adding-a-new-glyph" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Adding a new glyph&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#modifying-the-feta-font" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Modifying the feta font&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#metafont-formatting-rules" title="Next section in reading order" accesskey="n" rel="next">&nbsp;METAFONT formatting rules &gt; </a>]</td></tr></table>
<a name="building-the-changed-font"></a>
<h2 class="section">13.5 Building the changed font</h2>

<p>In order to rebuild the font after making the changes, the existing
font files must be deleted.  The simplest and quickest way to do this
is to do:
</p>
<blockquote><pre class="example">rm mf/out/*
make
</pre></blockquote>

<hr size="6">
<a name="METAFONT-formatting-rules"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#modifying-the-feta-font" title="Beginning of this chapter or previous chapter"> &lt;&lt; Modifying the feta font&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#administrative-policies" title="Next chapter">&nbsp;Administrative policies &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#building-the-changed-font" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Building the changed font&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#modifying-the-feta-font" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Modifying the feta font&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#administrative-policies" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Administrative policies &gt; </a>]</td></tr></table>
<a name="metafont-formatting-rules"></a>
<h2 class="section">13.6 METAFONT formatting rules</h2>

<p>There are special formatting rules for METAFONT files.
</p>
<p>Tabs are used for indentation.
</p>
<p>When a path contains more than two points, put each point on a
separate line, with the operator at the beginning  of the line:
</p>
<blockquote><pre class="example">fill z1
     -- z2
     -- z3
     .. cycle;
</pre></blockquote>

<hr size="6">
<a name="Administrative-policies"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#modifying-the-feta-font" title="Beginning of this chapter or previous chapter"> &lt;&lt; Modifying the feta font&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#gnu-free-documentation-license" title="Next chapter">&nbsp;GNU Free Documentation License &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#metafont-formatting-rules" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; METAFONT formatting rules&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#index" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Top&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#meta_002dpolicy-for-this-document" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Meta-policy for this document &gt; </a>]</td></tr></table>
<a name="administrative-policies"></a>
<h1 class="chapter">14. Administrative policies</h1>

<p>This chapter discusses miscellaneous administrative issues which
don&rsquo;t fit anywhere else.
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#meta_002dpolicy-for-this-document" accesskey="1">14.1 Meta-policy for this document</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#environment-variables" accesskey="2">14.2 Environment variables</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#meisters" accesskey="3">14.3 Meisters</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#patchy" accesskey="4">14.4 Patchy</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#administrative-mailing-list" accesskey="5">14.5 Administrative mailing list</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#grand-organization-project-_0028gop_0029" accesskey="6">14.6 Grand Organization Project (GOP)</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#grand-lilypond-input-syntax-standardization-_0028gliss_0029" accesskey="7">14.7 Grand LilyPond Input Syntax Standardization (GLISS)</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#unsorted-policies" accesskey="8">14.8 Unsorted policies</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr size="6">
<a name="Meta_002dpolicy-for-this-document"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#administrative-policies" title="Beginning of this chapter or previous chapter"> &lt;&lt; Administrative policies&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#gnu-free-documentation-license" title="Next chapter">&nbsp;GNU Free Documentation License &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#administrative-policies" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Administrative policies&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#administrative-policies" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Administrative policies&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#environment-variables" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Environment variables &gt; </a>]</td></tr></table>
<a name="meta_002dpolicy-for-this-document"></a>
<h2 class="section">14.1 Meta-policy for this document</h2>

<p>The Contributor&rsquo;s Guide as a whole is still a work in progress,
but some chapters are much more complete than others.  Chapters
which are &ldquo;almost finished&rdquo; should not have major changes
without a discussion on <code>-devel</code>; in other chapters, a
disorganized &ldquo;wiki-style dump&rdquo; of information is encouraged.
</p>
<p>Do not change (other than spelling mistakes) without discussion:
</p>
<ul>
<li>
<a href="#introduction-to-contributing">Introduction to contributing</a>

</li><li>
<a href="#working-with-source-code">Working with source code</a>

</li></ul>

<p>Please dump info in an appropriate @section within these manuals,
but discuss any large-scale reorganization:
</p>
<ul>
<li>
<a href="#compiling">Compiling</a>

</li><li>
<a href="#documentation-work">Documentation work</a>

</li><li>
<a href="#issues">Issues</a>

</li><li>
<a href="#regression-tests">Regression tests</a>

</li><li>
<a href="#programming-work">Programming work</a>


</li></ul>

<p>Totally disorganized; do whatever the mao you want:
</p>
<ul>
<li>
<a href="#website-work">Website work</a>

</li><li>
<a href="#lsr-work">LSR work</a>

</li><li>
<a href="#release-work">Release work</a>

</li><li>
<a href="#administrative-policies">Administrative policies</a>

</li></ul>


<hr size="6">
<a name="Environment-variables"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#administrative-policies" title="Beginning of this chapter or previous chapter"> &lt;&lt; Administrative policies&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#gnu-free-documentation-license" title="Next chapter">&nbsp;GNU Free Documentation License &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#meta_002dpolicy-for-this-document" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Meta-policy for this document&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#administrative-policies" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Administrative policies&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#meisters" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Meisters &gt; </a>]</td></tr></table>
<a name="environment-variables"></a>
<h2 class="section">14.2 Environment variables</h2>

<p>Some maintenance scripts and instructions in this guide rely on
the following environment variables.  They should be predefined in
LilyDev distribution (see <a href="#lilydev">LilyDev</a>); if you set up your own
development environment, you can set them by appending these settings to
your &lsquo;<tt>~/.bashrc</tt>&rsquo; (or whatever defines your default environment
variables for the user account for LilyPond development), then logging
out and in (adapt directories to your setup):
</p>
<blockquote><pre class="example">LILYPOND_GIT=~/lilypond-git
export LILYPOND_GIT
LILYPOND_BUILD_DIR=~/lilypond-git/build
export LILYPOND_BUILD_DIR
</pre></blockquote>

<p>The standard build and install procedure (with <code>autogen.sh</code>,
<code>configure</code>, <code>make</code>, <code>make install</code>, <code>make doc</code>
&hellip;) does not rely on them.
</p>
<p>In addition, for working on the website, <code>LILYPOND_WEB_MEDIA_GIT</code>
should be set to the repository lilypond-extra, see
<a href="#lilypond_002dextra">lilypond-extra</a>.
</p>

<hr size="6">
<a name="Meisters"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#administrative-policies" title="Beginning of this chapter or previous chapter"> &lt;&lt; Administrative policies&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#gnu-free-documentation-license" title="Next chapter">&nbsp;GNU Free Documentation License &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#environment-variables" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Environment variables&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#administrative-policies" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Administrative policies&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#patchy" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Patchy &gt; </a>]</td></tr></table>
<a name="meisters"></a>
<h2 class="section">14.3 Meisters</h2>

<p>We have four jobs for organizing a team of contributors:
</p>
<ul>
<li>
Bug Meister: trains new Bug Squad volunteers, organizes who works
on which part of their job, checks to make sure that everything is
running smoothly, and has final say on our policy for Issues.

<p>Currently: Colin H
</p>
</li><li>
Doc Meister: trains new doc editors/writers, organizes who works
on which part of the job, checks to make sure that everything is
running smoothly, and has final say on our policy for
Documentation.  Also includes LSR work.

<p>Currently: Graham
</p>
</li><li>
Translation Meister: trains new translators, updates the
translation priority list, and handles merging branches (in both
directions).

<p>Currently: Francisco
</p>
</li><li>
Frog Meister: is responsible for code patches from (relatively)
inexperienced contributors.  Keeps track of patches, does initial
reviewing of those patches, sends them to <code>-devel</code> when
they&rsquo;ve had some initial review on the Frog list, pesters the
<code>-devel</code> community into actually reviewing said patches, and
finally pushes the patches once they&rsquo;re accepted.  This person is
<em>not</em> responsible for training new programmers, because that
would be far too much work &ndash; his/her job is &ldquo;only&rdquo; to guide
completed patches through our process.

<p>Currently: Mike Solomon
</p>
</li></ul>

<hr size="6">
<a name="Patchy"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#administrative-policies" title="Beginning of this chapter or previous chapter"> &lt;&lt; Administrative policies&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#gnu-free-documentation-license" title="Next chapter">&nbsp;GNU Free Documentation License &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#meisters" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Meisters&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#administrative-policies" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Administrative policies&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#administrative-mailing-list" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Administrative mailing list &gt; </a>]</td></tr></table>
<a name="patchy"></a>
<h2 class="section">14.4 Patchy</h2>

<a name="Introduction-1"></a>
<h3 class="subheading">Introduction</h3>

<p>Patchy is a set of Python scripts to automate two administrative
tasks:
</p>
<ul>
<li>
<code>lilypond-patchy-staging.py</code>: checks that new commits in
<code>staging</code> can compile the regtests and documentation before
merging <code>staging</code> into <code>master</code>.

<p>(completely automatic)
</p>
</li><li>
<code>test-patches.py</code>: checks that patches apply to Git <code>master</code>,
compile, and lets a human check that there are no big unintended
changes to the regtests.

<p>(requires some human input)
</p>
</li></ul>

<a name="Installing-Patchy"></a>
<h3 class="subheading">Installing Patchy</h3>

<p>To install Patchy, you should do the following:
</p>
<ol>
<li>
Create a new user on your box to run Patchy; this is a security
step for your own protection.  It is recommended that this should
not be an administrator.  New users are created from System;
Administration; Users and Groups.

</li><li>
Get the Patchy scripts from
<blockquote><pre class="example"><a href="https://github.com/gperciva/lilypond-extra">https://github.com/gperciva/lilypond-extra/</a>
</pre></blockquote>
<p>Patchy is in the &lsquo;<tt>patches/</tt>&rsquo; directory.
</p>
</li><li>
Put the scripts and Python libraries contained in &lsquo;<tt>patches</tt>&rsquo; in a
sensible place on your system; this can be done by appending
&lsquo;<tt>patches/</tt>&rsquo; full path to the <var>PATH</var> of the user that runs
Patchy.

</li><li>
Create a new git repository with
<blockquote><pre class="example">git clone git://git.sv.gnu.org/lilypond.git
</pre></blockquote>
<p>This will create a directory called lilypond with the repo in it.
Make sure it&rsquo;s where you want it and name it lilypond-git
(assuming you want to follow the standard naming conventions).
</p>
</li><li>
Create environment variables <var>LILYPOND_GIT</var> and
<var>LILYPOND_BUILD_DIR</var>, see <a href="#environment-variables">Environment variables</a>.

</li><li>
Run Patchy once to set up config files, answer &lsquo;<code>n</code>&rsquo; when it
asks for going on, unless the default config file happens to suit your
setup:
<blockquote><pre class="example">lilypond-patchy-staging.py
</pre></blockquote>

</li><li>
Edit &lsquo;<tt>$HOME/.lilypond-patchy-config</tt>&rsquo; to provide the location of
your local lilypond Git repository, working directories for your build
directory, your results directory, compiler options and notification
method.  If you don&rsquo;t want to use email notification, then delete
everything after <code>smtp_command:</code>.

</li><li>
Ensure that your new user has git push access.  Follow the
instructions in the CG at <a href="#commit-access">Commit access</a>.  Do not set
password protection for the key &mdash; if you do you will not be able
to run patchy unattended.

</li></ol>

<a name="lilypond_002dpatchy_002dstaging_002epy"></a>
<h3 class="subheading">lilypond-patchy-staging.py</h3>

<p><code>lilypond-patchy-staging.py</code> is run with
</p><blockquote><pre class="example">python lilypond-patchy-staging.py
</pre></blockquote>
<p>Not much appears to happen except you can see a lot of CPU gets used
if you open System Monitor. There&rsquo;s not much point running
<code>lilypond-patchy-staging.py</code> unless there is something in
<code>staging</code> to be merged to <code>master</code>, however, if there&rsquo;s
nothing new in <code>staging</code> then the script won&rsquo;t waste resources by
compiling anything.
</p>
<p>The script fetches the current patches in staging and runs
<code>make</code>, <code>make test</code> and <code>make doc</code> to ensure that all of
these complete error-free. If you have set Patchy up to use email,
it emails its results to you.  If you haven&rsquo;t, then you can view
them in a logfile.  It also merges <code>staging</code> into <code>master</code>.
</p>
<div class="warning"><p><strong>Note:</strong> in case the build fails, do not try to push fixes on top of
staging branch, for details see <a href="#pushing-to-staging">Pushing to staging</a>.
</p>
</div>
<p>When you have run Patchy a few successful times with email sending,
you are ready for running it as a cron job. First, make sure you have
the following in &lsquo;<tt>$HOME/.lilypond-patchy-config</tt>&rsquo; to avoid
email flood:
</p>
<blockquote><pre class="example">[notification]
notify_non_action = no
</pre></blockquote>

<p>Then, assuming Patchy run with user account <code>patchy</code>, write the
following to &lsquo;<tt>$HOME/lilypond-patchy.cron</tt>&rsquo;, adapting it as
necessary (the <code>/2</code> means &ldquo;run this every 2 hours&rdquo;):
</p><blockquote><pre class="example">02 0-23/2 * * * /home/patchy/git/lilypond-extra/patches/lilypond-patchy-staging.py
</pre></blockquote>

<div class="warning"><p><strong>Note:</strong> <code>cron</code> will not inherit environment variables from
your main setup, so you must re-define any variables inside
&lsquo;<tt>$HOME/lilypond-patchy.cron</tt>&rsquo;. For instance, <var>LILYPOND_GIT</var>
may need to be defined if <var>git_repository_dir</var> is not correctly
set in &lsquo;<tt>$HOME/.lilypond-patchy-config</tt>&rsquo;.
</p>
</div>
<p>Finally, install the cron job (you may need superuser privileges for
this):
</p><blockquote><pre class="example">crontab -u patchy /home/patchy/lilypond-patchy.cron
</pre></blockquote>

<a name="test_002dpatches_002epy"></a>
<h3 class="subheading">test-patches.py</h3>
<p><code>test-patches.py</code> prepares a regtest comparison for a human to
quickly glance at, to determine if the patch is ready for a review.
After looking at the comparison (or the lack of a comparison in the
case of problems), run <code>accept-patch.py</code> or
<code>reject-patch.py</code>.
</p>
<p>Once a patch has gotten a &quot;LGTM&quot; from Patchy, it should be
reviewed by relevant developers, and if it passes this, it can be
considered for countdown (see <a href="#commits-and-patches">Commits and patches</a>) and
pushing to staging (see <a href="#pushing-to-staging">Pushing to staging</a>).
</p>

<hr size="6">
<a name="Administrative-mailing-list"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#administrative-policies" title="Beginning of this chapter or previous chapter"> &lt;&lt; Administrative policies&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#gnu-free-documentation-license" title="Next chapter">&nbsp;GNU Free Documentation License &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#patchy" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Patchy&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#administrative-policies" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Administrative policies&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#grand-organization-project-_0028gop_0029" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Grand Organization Project (GOP) &gt; </a>]</td></tr></table>
<a name="administrative-mailing-list"></a>
<h2 class="section">14.5 Administrative mailing list</h2>

<p>A mailing list for administrative issues is maintained at
<code>lilypond-hackers@gnu.org</code>.
</p>
<p>This list is intended to be used for discussions that should be kept
private. Therefore, the archives are closed to the public.
</p>
<p>Subscription to this list is limited to certain senior developers.
</p>
<p>At the present time, the list is dormant.
</p>
<p>Details about the criteria for membership, the types of discussion
to take place on the list, and other policies for the hackers list
will be finalized during the
<a href="#grand-organization-project-_0028gop_0029">Grand Organization Project (GOP)</a>.
</p>


<hr size="6">
<a name="Grand-Organization-Project-_0028GOP_0029"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#administrative-policies" title="Beginning of this chapter or previous chapter"> &lt;&lt; Administrative policies&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#gnu-free-documentation-license" title="Next chapter">&nbsp;GNU Free Documentation License &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#administrative-mailing-list" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Administrative mailing list&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#administrative-policies" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Administrative policies&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#motivation" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Motivation &gt; </a>]</td></tr></table>
<a name="grand-organization-project-_0028gop_0029"></a>
<h2 class="section">14.6 Grand Organization Project (GOP)</h2>

<p>GOP has two goals:
</p>
<ul>
<li>
Clarify the various development tasks by writing down the policies
and techniques and/or simplifying the tasks directly.

</li><li>
Get more people involved in development: specifically, find people
to do easy tasks to allow advanced developers to concentrate on
difficult tasks.

</li></ul>

<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#motivation" accesskey="1">14.6.1 Motivation</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#ongoing-jobs" accesskey="2">14.6.2 Ongoing jobs</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#policy-decisions" accesskey="3">14.6.3 Policy decisions</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#policy-decisions-_0028finished_0029" accesskey="4">14.6.4 Policy decisions (finished)</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr size="6">
<a name="Motivation"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#administrative-policies" title="Beginning of this chapter or previous chapter"> &lt;&lt; Administrative policies&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#gnu-free-documentation-license" title="Next chapter">&nbsp;GNU Free Documentation License &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#grand-organization-project-_0028gop_0029" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Grand Organization Project (GOP)&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#grand-organization-project-_0028gop_0029" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Grand Organization Project (GOP)&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#ongoing-jobs" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Ongoing jobs &gt; </a>]</td></tr></table>
<a name="motivation"></a>
<h3 class="subsection">14.6.1 Motivation</h3>

<p>Most readers are probably familiar with the LilyPond Grand
Documentation Project, which ran from Aug 2007 to Aug 2008. This
project involved over 20 people and resulted in an almost complete
rewrite of the documentation. Most of those contributors were
normal users who decided to volunteer their time and effort to
improve lilypond for everybody. By any measure, it was a great
success.
</p>
<p>The Grand Organization Project aims to do the same thing with a
larger scope &ndash; instead of focusing purely on documentation, the
project aims to improve all parts of LilyPond and its community.
Just as with GDP, the main goal is to encourage and train users to
become more involved.
</p>
<p>If you have never contributed to an open-source project before &ndash;
especially if you use Windows or OSX and do not know how to
program or compile programs &ndash; you may be wondering if there&rsquo;s
anything you can do. Rest assured that you <em>can</em> help.
</p>
<a name="g_t_0022Trickle_002dup_0022-development"></a>
<h3 class="subheading">&quot;Trickle-up&quot; development</h3>

<p>One of the reasons I&rsquo;m organizing GOP is &quot;trickle-up&quot;
development.  The idea is this: doing easy tasks frees up advanced
developers to do harder tasks.  Don&rsquo;t ask &quot;am I the <em>best</em>
person for this job&quot;; instead, ask &quot;am I <em>capable</em> of doing
this job, so that the current person can do stuff I <em>can&rsquo;t</em>
do?&quot;.
</p>
<p>For example, consider lilypond&rsquo;s poor handling of grace notes in
conjunction with clef and tempo changes. Fixing this will require
a fair amount of code rewriting, and would take an advanced
developer a few weeks to do. It&rsquo;s clearly beyond the scope of a
normal user, so we might as well sit back and do nothing, right?
</p>
<p>No; we <em>can</em> help, indirectly. Suppose that our normal user
starts answering more emails on lilypond-user. This in turn means
that documentation writers don&rsquo;t need to answer those emails, so
they can spend more time improving the docs. I&rsquo;ve noticed that all
doc writers tackle harder and harder subjects, and when they start
writing docs on scheme programming and advanced tweaks, they start
contributing bug fixes to lilypond. Having people performing these
easy-to-moderate bug fixes frees up the advanced developers to
work on the really hard stuff... like rewriting the grace note
code.
</p>
<p>Having 1 more normal user answering emails on lilypond-user won&rsquo;t
have a dramatic &lsquo;trickle-up&rsquo; effect all by itself, of course. But if
we had 8 users volunteering to answer emails, 6 users starting to
write documentation, and 2 users editing LSR... well, that would
free up a lot of current bug-fixing-capable contributors to focus
on that, and we could start to make a real dent in the number of
bugs in lilypond. Quite apart from the eased workload, having that
many new helpers will provide a great moral boost!
</p>
<hr size="6">
<a name="Ongoing-jobs"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#administrative-policies" title="Beginning of this chapter or previous chapter"> &lt;&lt; Administrative policies&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#gnu-free-documentation-license" title="Next chapter">&nbsp;GNU Free Documentation License &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#motivation" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Motivation&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#grand-organization-project-_0028gop_0029" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Grand Organization Project (GOP)&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#policy-decisions" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Policy decisions &gt; </a>]</td></tr></table>
<a name="ongoing-jobs"></a>
<h3 class="subsection">14.6.2 Ongoing jobs</h3>

<p>Although GOP is a short-term project, the main goal is to train
more people to handle ongoing jobs. The more people doing these
jobs, the lighter the work will be, and the more we can get done
with lilypond!
</p>
<p>Also, it would be nice if we had at least one &quot;replacement&quot; /
&quot;understudy&quot; for each role &ndash; too many tasks are only being done
by one person, so if that person goes on vacation or gets very
busy with other matters, work in that area grinds to a halt.
</p>
<a name="Jobs-for-normal-users"></a>
<h3 class="subheading">Jobs for normal users</h3>

<ul>
<li> Consultant:
LilyPond is sometimes critized for not listening to users, but
whenever we ask for opinions about specific issues, we never get
enough feedback. This is somewhat aggravating.
We need a group of users to make a dedicated effort to test and
give feedback. If there&rsquo;s new documentation, read it. If there&rsquo;s
an experimental binary, download it and try compiling a score with
it. If we&rsquo;re trying to name a new command, think about it and give
serious suggestions.

</li><li> lilypond-user support:
I think it would be nice if we had an official team of users
helping other users.

</li><li> LilyPond Report:
Keeping a monthly newsletter running is a non-trivial task.  A lot
of work is needed to organize it; it would be great if we could
split up the work. One person could write the Snippet of the
Month, another person could do Quotes of the Month, another person
could do interviews, etc.

</li><li> Documentation:
Although GDP (the Grand Documentation Project) did great work,
there&rsquo;s still many tasks remaining.

</li><li> Translations:
Keeping the documentation translations is a monumental task; we
need all the help we can get!

</li></ul>

<a name="Jobs-for-advanced-users-for-developers"></a>
<h3 class="subheading">Jobs for advanced users for developers</h3>

<ul>
<li> Git help for writers:
We often receive reports of typos and minor text updates to the
documentation. It would be great if somebody could create
properly-formatted patches for these corrections.

<p>Technical requirements: ability to run <a href="#lilydev">LilyDev</a>.
</p>
</li><li> LSR editor:
LSR contains many useful examples of lilypond, but some snippets
are out of date and need updating. Other snippets need to be
advertized, and new snippets need to be sorted. We could use
another person to handle LSR.

<p>Technical requirements: use of a web browser. LilyPond
requirements: you should be familiar with most of Notation
chapters 1 and 2 (or be willing to read the docs to find out).
</p>
</li><li> Join the Frogs:
&quot;Frogs&quot; are a team of bug-fixers (because frogs eat bugs, and you
often find them in Ponds of Lilies) and new feature implementors.

<p>Technical requirements: development environment (such as
<a href="#lilydev">LilyDev</a>), ability to read+write scheme and/or C++ code.
</p>
</li></ul>


<hr size="6">
<a name="Policy-decisions"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#administrative-policies" title="Beginning of this chapter or previous chapter"> &lt;&lt; Administrative policies&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#gnu-free-documentation-license" title="Next chapter">&nbsp;GNU Free Documentation License &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#ongoing-jobs" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Ongoing jobs&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#grand-organization-project-_0028gop_0029" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Grand Organization Project (GOP)&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#policy-decisions-_0028finished_0029" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Policy decisions (finished) &gt; </a>]</td></tr></table>
<a name="policy-decisions"></a>
<h3 class="subsection">14.6.3 Policy decisions</h3>

<p>There are a number of policy decisions &ndash; some of them fairly
important &ndash; which we have been postponing for a few years.  We
are now discussing them slowly and thoroughly; agenda and exact
proposals are online:
</p>
<blockquote><pre class="example"><a href="http://lilypond.org/~graham/gop/index.html">http://lilypond.org/~graham/gop/index.html</a>
</pre></blockquote>

<p>Below is a list of policies which are not &ldquo;on the agenda&rdquo; yet.
</p>
<p>Note that the presence of an item on this list does <em>not</em>
mean that everybody thinks that something needs to be done.
Inclusion in this simply means that one developer thinks that we
should discuss it.  We are not going to filter this list; if any
developer thinks we should discuss something, just add it to the
bottom of the list.  (the list is unsorted)
</p>
<p>As GOP progresses, items from this list will be put on the agenda
and removed from this list.  I generally try to have one month&rsquo;s
discussion planned in advance, but I may shuffle things around to
respond to any immediate problems in the developer community.
</p>
<p>There are some item(s) not displayed here; these are questions
that were posed to me privately, and I do not feel justified in
discussing them publicly without the consent of the person(s) that
brought them up. They will initially be discussed privately on the
lilypond-hackers mailing list &ndash; but the first question will be
&quot;do we absolutely need to do this privately&quot;, and if not, the
discussion will take place on lilypond-devel like the other items.
</p>
<p>In most policy discussions in lilypond over the past few years,
the first half (or more) is wasted arguing on the basis of
incorrect or incomplete data; once all the relevant facts are
brought to light, the argument is generally resolved fairly
quickly.  In order to keep the GOP discussions focused, each topic
will be introduced with a collection of relevant facts and/or
proposals.  It is, of course, impossible to predict exactly which
facts will be relevant to the discussion &ndash; but spending an hour
or two collecting information could still save hours of
discussion.
</p>
<div class="warning"><p><strong>Note:</strong> The estimated time required for &quot;prep work&quot;, and the
following discussion, has been added to each item.  At the moment,
there is an estimated 30 hours of prep work and 140 hours of
discussion.
</p>
</div>
<ul>
<li> <strong>Patch reviewing</strong>:
At the time of this writing, we have 23 (known) patches waiting
for review.  Some from main developers; some from new developers.
We desperately need more people helping with lilypond, but
ignoring patches is the best way to drive potential contributors
away.  This is not good.

<p>(prep: 2 hours.  discuss: 10 hours)
</p>
</li><li> <strong>Official links to other organizations?</strong>:
There&rsquo;s something called the &quot;software freedom conservancy&quot;, and
in general, there&rsquo;s a bunch of &quot;umbrella organizations&quot;. Joining
some of these might give us more visibility, possibly leading to
more users, more developers, maybe even financial grants or use in
schools, etc.

<p>(prep: 2 hours.  discuss: 5 hours)
</p>
</li><li> <strong>Issue tracking with google code</strong>:
We use the google issue tracker, but this means that we are
relying on a commercial entity for a large part of our
development. Would it be better (safer in the long run) to use the
savannah bug tracker?

<p>(prep: 1 hour.  discuss: 5 hours)
</p>
</li><li> <strong>Patch review tool</strong>:
Reitveld is inconvenient in some respects: it requires a google
account, and there&rsquo;s no way to see all patches relating to
lilypond. Should we switch to something like gerritt?
<a href="http://code.google.com/p/lilypond/issues/detail?id=1184">http://code.google.com/p/lilypond/issues/detail?id=1184</a>

<p>(prep: 5 hours.  discuss: 15 hours)
</p>
</li><li> <strong>Clarity for sponsorships</strong>:
We currently do not advertize bounties and sponsorships on the
webpage.  How much advertising do we want, and what type?
Should we change the &quot;structure&quot; / &quot;framework&quot; for bounties?

<p>(prep: 2 hours.  discuss: 10 hours)
</p>
</li><li> <strong>code readability</strong>:
&quot;Our aim when producing source code for Lilypond in whatever
language is that it should be totally comprehensible to a
relatively inexperienced developer at the second reading.&quot;

<p>Rationale:
- aids maintainability of code base
- &quot;second reading&quot; so newer developers can look up unfamiliar
  stuff
- will help to keep things simple, even if the code is doing
  complex stuff discourages &quot;secret squirrel&quot; coding, e.g.  &quot;how
  much functionality can I squeeze into as few characters as
  possible&quot; &quot;comments are for wimps&quot;
- will aid not *discouraging* new developers to join the project
</p>
<p>(prep: 2 hours.  discuss: 10 hours)
</p>
</li><li> <strong>C++ vs. scheme</strong>:
what should be in scheme, what should be in C++, what can/should
be ported from one to the other, etc.  Questions of
maintainability, speed (especially considering guile 2.0), and the
amount of current material in either form, are important.

<p>(prep: 5 hours.  discuss: 15 hours)
</p>
</li><li> <strong>always make an issue number for patches</strong>:
there is a proposal that we should always have a google code issue
number for every patch.  This proposal is closely tied to our
choice of patch review tool; if we switch to a different tool (as
suggested in a different proposal), this proposal may become moot.

<p>(prep: 1 hour.  discuss: 5 hours)
</p>
</li><li> <strong>initalizer lists</strong>:
shoudl we use initalizer lists for C++?  AFAIK they make no
difference for built-in types, but there&rsquo;s some weird case where
it&rsquo;s more efficient for objects, or something.

<p>Probably not worth making this a weekly thing on its own, but we
can probably wrap it up with some other code-related questions.
</p>
<p>(prep: 15 minutes.  discuss: 3 hours)
</p>
</li></ul>

<hr size="6">
<a name="Policy-decisions-_0028finished_0029"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#administrative-policies" title="Beginning of this chapter or previous chapter"> &lt;&lt; Administrative policies&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#gnu-free-documentation-license" title="Next chapter">&nbsp;GNU Free Documentation License &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#policy-decisions" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Policy decisions&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#grand-organization-project-_0028gop_0029" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Grand Organization Project (GOP)&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#gop_002dprop-1-_002d-python-formatting" title="Next section in reading order" accesskey="n" rel="next">&nbsp;GOP-PROP 1 - python formatting &gt; </a>]</td></tr></table>
<a name="policy-decisions-_0028finished_0029"></a>
<h3 class="subsection">14.6.4 Policy decisions (finished)</h3>

<p>Here is a record the final decisions, along with links to the
discussions.
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#gop_002dprop-1-_002d-python-formatting" accesskey="1">14.6.4.1 GOP-PROP 1 - python formatting</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#gop_002dprop-2-_002d-mentors-and-frogs" accesskey="2">14.6.4.2 GOP-PROP 2 - mentors and frogs</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#gop_002dprop-3-_002d-c_002b_002b-formatting" accesskey="3">14.6.4.3 GOP-PROP 3 - C++ formatting</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#gop_002dprop-4-_002d-lessons-from-2_002e14" accesskey="4">14.6.4.4 GOP-PROP 4 - lessons from 2.14</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#gop_002dprop-5-_002d-build-system-output-_0028not-accepted_0029" accesskey="5">14.6.4.5 GOP-PROP 5 - build system output (not accepted)</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#gop_002dprop-6-_002d-private-mailing-lists" accesskey="6">14.6.4.6 GOP-PROP 6 - private mailing list</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#gop_002dprop-7-_002d-developers-as-resources" accesskey="7">14.6.4.7 GOP-PROP 7 - developers as resources</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#gop_002dprop-8-_002d-issue-priorities" accesskey="8">14.6.4.8 GOP-PROP 8 - issue priorities</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#gop_002dprop-9-_002d-behavior-of-make-doc" accesskey="9">14.6.4.9 GOP-PROP 9 - behavior of make doc</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr size="6">
<a name="GOP_002dPROP-1-_002d-python-formatting"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#administrative-policies" title="Beginning of this chapter or previous chapter"> &lt;&lt; Administrative policies&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#gnu-free-documentation-license" title="Next chapter">&nbsp;GNU Free Documentation License &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#policy-decisions-_0028finished_0029" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Policy decisions (finished)&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#policy-decisions-_0028finished_0029" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Policy decisions (finished)&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#gop_002dprop-2-_002d-mentors-and-frogs" title="Next section in reading order" accesskey="n" rel="next">&nbsp;GOP-PROP 2 - mentors and frogs &gt; </a>]</td></tr></table>
<a name="gop_002dprop-1-_002d-python-formatting"></a>
<h4 class="subsubsection">14.6.4.1 GOP-PROP 1 - python formatting</h4>

<p>We will follow the indentation described in PEP-8.
<a href="http://www.python.org/dev/peps/pep-0008">http://www.python.org/dev/peps/pep-0008/</a>
</p>
<ul>
<li>
use 4 spaces per indentation level

</li><li>
never mix tabs and spaces (for indentation)

</li><li>
Code indented with a mixture of tabs and spaces should be
converted to using spaces exclusively

<p>Once this is done, we should add <code>python -tt</code> to the build
system to avoid such errors in the future.
</p>
</li></ul>

<p>There should be absolutely no tab characters for indentation in
any <code>.py</code> file in lilypond git.  All such files should be
converted to use spaces only.
</p>
<a name="Discussions-5"></a>
<h4 class="subsubheading">Discussions</h4>

<table><tr><td>&nbsp;</td><td><pre class="smallexample"><a href="https://lists.gnu.org/archive/html/lilypond-devel/2011-06/msg00060.html">https://lists.gnu.org/archive/html/lilypond-devel/2011-06/msg00060.html</a>
<a href="https://lists.gnu.org/archive/html/lilypond-devel/2011-06/msg00084.html">https://lists.gnu.org/archive/html/lilypond-devel/2011-06/msg00084.html</a>
<a href="https://lists.gnu.org/archive/html/lilypond-devel/2011-06/msg00310.html">https://lists.gnu.org/archive/html/lilypond-devel/2011-06/msg00310.html</a>
<a href="https://lists.gnu.org/archive/html/lilypond-devel/2011-06/msg00574.html">https://lists.gnu.org/archive/html/lilypond-devel/2011-06/msg00574.html</a>
</pre></td></tr></table>


<hr size="6">
<a name="GOP_002dPROP-2-_002d-mentors-and-frogs"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#administrative-policies" title="Beginning of this chapter or previous chapter"> &lt;&lt; Administrative policies&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#gnu-free-documentation-license" title="Next chapter">&nbsp;GNU Free Documentation License &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#gop_002dprop-1-_002d-python-formatting" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; GOP-PROP 1 - python formatting&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#policy-decisions-_0028finished_0029" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Policy decisions (finished)&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#gop_002dprop-3-_002d-c_002b_002b-formatting" title="Next section in reading order" accesskey="n" rel="next">&nbsp;GOP-PROP 3 - C++ formatting &gt; </a>]</td></tr></table>
<a name="gop_002dprop-2-_002d-mentors-and-frogs"></a>
<h4 class="subsubsection">14.6.4.2 GOP-PROP 2 - mentors and frogs</h4>

<p>Nothing much was decided.  The list of responsibilities was
slightly altered; see the new one in <a href="#mentors">Mentors</a>.  We should
encourage more use of the Frogs mailing list.  There&rsquo;s a list of
contributor-mentor pairs in:
</p>
<table><tr><td>&nbsp;</td><td><pre class="smallexample"><a href="https://github.com/gperciva/lilypond-extra/blob/master/people/mentors.txt">https://github.com/gperciva/lilypond-extra/blob/master/people/mentors.txt</a>
</pre></td></tr></table>

<p>That&rsquo;s pretty much it.
</p>
<a name="Discussions"></a>
<h4 class="subsubheading">Discussions</h4>

<table><tr><td>&nbsp;</td><td><pre class="smallexample"><a href="https://lists.gnu.org/archive/html/lilypond-devel/2011-06/msg00311.html">https://lists.gnu.org/archive/html/lilypond-devel/2011-06/msg00311.html</a>


</pre></td></tr></table>


<hr size="6">
<a name="GOP_002dPROP-3-_002d-C_002b_002b-formatting"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#administrative-policies" title="Beginning of this chapter or previous chapter"> &lt;&lt; Administrative policies&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#gnu-free-documentation-license" title="Next chapter">&nbsp;GNU Free Documentation License &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#gop_002dprop-2-_002d-mentors-and-frogs" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; GOP-PROP 2 - mentors and frogs&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#policy-decisions-_0028finished_0029" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Policy decisions (finished)&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#gop_002dprop-4-_002d-lessons-from-2_002e14" title="Next section in reading order" accesskey="n" rel="next">&nbsp;GOP-PROP 4 - lessons from 2.14 &gt; </a>]</td></tr></table>
<a name="gop_002dprop-3-_002d-c_002b_002b-formatting"></a>
<h4 class="subsubsection">14.6.4.3 GOP-PROP 3 - C++ formatting</h4>

<p>Speaking academically, C++ code style is a &quot;solved problem&quot;. Let&rsquo;s
pick one of the existing solutions, and let a computer deal with
this.  Humans should not waste their time, energy, and creativity
manually adding tabs or spaces to source code.
</p>
<p>We have modified <code>fixcc.py</code> to use astyle, along with extra
regex tweaks.
</p>
<ul>
<li>
the final script will be run <strong>blindly</strong> on the lilypond
source code.  We will accept whatever formatting the final version
of this script produces, with no manual tweaking.

</li><li>
patches which have been run through this tool will not be rejected
for style reasons.  Any code formatting &ldquo;desires&rdquo; which are not
enforced by <code>fixcc.py</code> will not be considered grounds for
rejecting a patch.

</li><li>
for now, this style will not be enforced.  It is not cause for
concern if patches which do not follow the formatting done by
<code>fixcc.py</code> are pushed.  From time to time, Graham will run
the formatter on the entire code base, and commit the resulting
changes.

<p>In a few months, we will tighten up this policy item (with some
sort of automatic processing), but that is outside the scope of
this policy item and is a matter for later discussion.
</p>
</li><li>
after the proposal is accepted, we will leave some time for
existing patches to be accepted and pushed.  The script was
run on the source code on <strong>2011 August 01</strong>.

</li></ul>

<a name="GNU-code"></a>
<h3 class="subheading">GNU code</h3>

<p>LilyPond is a GNU project, so it makes sense to follow the GNU
coding standards.  These standards state:
</p>
<blockquote><p>We dont think of these recommendations as requirements, because
it causes no problems for users if two different programs have
different formatting styles.
</p>
<p>But whatever style you use, please use it consistently, since a
mixture of styles within one program tends to look ugly. If you
are contributing changes to an existing program, please follow the
style of that program. 
</p></blockquote>

<p>(<a href="http://www.gnu.org/prep/standards/html_node/Formatting.html">http://www.gnu.org/prep/standards/html_node/Formatting.html</a>)
</p>
<p>With that in mind, we do not think that we must blindly follow the
formatting given by the currrent version of Emacs.
</p>
<a name="Implementation-notes-1"></a>
<h3 class="subheading">Implementation notes</h3>

<p>We can avoid some of the style change pollution in git history by
ignoring whitespaces changes:
</p>
<blockquote><pre class="example">git diff -w
</pre></blockquote>

<a name="Discussions-4"></a>
<h4 class="subsubheading">Discussions</h4>

<table><tr><td>&nbsp;</td><td><pre class="smallexample"><a href="https://lists.gnu.org/archive/html/lilypond-devel/2011-06/msg00526.html">https://lists.gnu.org/archive/html/lilypond-devel/2011-06/msg00526.html</a>
<a href="https://lists.gnu.org/archive/html/lilypond-devel/2011-06/msg00796.html">https://lists.gnu.org/archive/html/lilypond-devel/2011-06/msg00796.html</a>
<a href="https://lists.gnu.org/archive/html/lilypond-devel/2011-07/msg00200.html">https://lists.gnu.org/archive/html/lilypond-devel/2011-07/msg00200.html</a>
<a href="https://lists.gnu.org/archive/html/lilypond-devel/2011-07/msg00525.html">https://lists.gnu.org/archive/html/lilypond-devel/2011-07/msg00525.html</a>
<a href="https://lists.gnu.org/archive/html/lilypond-devel/2011-07/msg00751.html">https://lists.gnu.org/archive/html/lilypond-devel/2011-07/msg00751.html</a>
<a href="https://lists.gnu.org/archive/html/lilypond-devel/2011-07/msg00751.html">https://lists.gnu.org/archive/html/lilypond-devel/2011-07/msg00751.html</a>
</pre></td></tr></table>


<hr size="6">
<a name="GOP_002dPROP-4-_002d-lessons-from-2_002e14"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#administrative-policies" title="Beginning of this chapter or previous chapter"> &lt;&lt; Administrative policies&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#gnu-free-documentation-license" title="Next chapter">&nbsp;GNU Free Documentation License &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#gop_002dprop-3-_002d-c_002b_002b-formatting" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; GOP-PROP 3 - C++ formatting&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#policy-decisions-_0028finished_0029" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Policy decisions (finished)&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#gop_002dprop-5-_002d-build-system-output-_0028not-accepted_0029" title="Next section in reading order" accesskey="n" rel="next">&nbsp;GOP-PROP 5 - build system output (not accepted) &gt; </a>]</td></tr></table>
<a name="gop_002dprop-4-_002d-lessons-from-2_002e14"></a>
<h4 class="subsubsection">14.6.4.4 GOP-PROP 4 - lessons from 2.14</h4>

<a name="History"></a>
<h3 class="subheading">History</h3>

<p>A brief history of releases:
</p>
<table>
<thead><tr><th width="20%">date (YYYY-MM-DD)</th><th width="20%">version</th><th width="30%">comment</th></tr></thead>
<tr><td width="20%">2008-10-28</td><td width="20%">2.11.63</td><td width="30%">nobody checking regtests</td></tr>
<tr><td width="20%">2008-11-17</td><td width="20%">2.11.64</td></tr>
<tr><td width="20%">2008-11-29</td><td width="20%">2.11.65</td></tr>
<tr><td width="20%">2008-12-23</td><td width="20%">2.12.0</td></tr>
<tr><td width="20%">2009-01-01</td><td width="20%"></td><td width="30%">somewhere around here, Graham becomes
officially release manager, but Han-Wen still builds the actual
releases</td></tr>
<tr><td width="20%">2009-01-01</td><td width="20%">2.12.1</td></tr>
<tr><td width="20%">2009-01-25</td><td width="20%">2.12.2</td></tr>
<tr><td width="20%">2009-02-28</td><td width="20%">2.13.0</td></tr>
<tr><td width="20%">2009-06-01</td><td width="20%">2.13.1</td><td width="30%">note jump in time!</td></tr>
<tr><td width="20%">2009-06-27</td><td width="20%">2.13.2</td><td width="30%">first Graham release?</td></tr>
<tr><td width="20%">2009-07-03</td><td width="20%">2.13.3</td></tr>
<tr><td width="20%">2009-09-09</td><td width="20%"></td><td width="30%">Graham arrives in Glasgow, gets a
powerful desktop computer, and begins serious work on GUB (sending
bug reports to Jan).  It takes approximately 100 hours until GUB
is stable enough to make regular releases.</td></tr>
<tr><td width="20%">2009-09-24</td><td width="20%">2.13.4</td></tr>
<tr><td width="20%">2009-10-02</td><td width="20%">2.13.5</td></tr>
<tr><td width="20%">2009-10-22</td><td width="20%">2.13.6</td></tr>
<tr><td width="20%">2009-11-05</td><td width="20%">2.13.7</td></tr>
<tr><td width="20%">...</td></tr>
<tr><td width="20%">2010-01-13</td><td width="20%">2.12.3</td></tr>
<tr><td width="20%">...</td></tr>
<tr><td width="20%">2010-03-19</td><td width="20%">2.13.16</td><td width="30%">Bug squad starts doing a few
regtest comparisons, but IIRC the effort dies out after a few
weeks (BLUE)</td></tr>
<tr><td width="20%">...</td></tr>
<tr><td width="20%">2010-08-04</td><td width="20%">2.13.29</td><td width="30%">Phil starts checking regtests (BLUE)</td></tr>
<tr><td width="20%">...</td></tr>
<tr><td width="20%">2011-01-12</td><td width="20%">2.13.46</td><td width="30%">release candidate 1 (GREEN)</td></tr>
<tr><td width="20%">...</td></tr>
<tr><td width="20%">2011-05-30</td><td width="20%">2.13.63</td><td width="30%">release candidate 7 (GREEN)</td></tr>
<tr><td width="20%">2011-06-06</td><td width="20%">2.14.0</td></tr>
</table>


<a name="Carl_0027s-analysis-of-the-bugs"></a>
<h3 class="subheading">Carl&rsquo;s analysis of the bugs</h3>

<p>A &lsquo;<tt>csv</tt>&rsquo; spreadsheet is available.
</p>
<table><tr><td>&nbsp;</td><td><pre class="smallexample"><a href="https://lists.gnu.org/archive/html/lilypond-devel/2011-06/msg00852.html">https://lists.gnu.org/archive/html/lilypond-devel/2011-06/msg00852.html</a>
</pre></td></tr></table>

<blockquote><pre class="example"><a href="lilypond-issues-analysis.csv">lilypond-issues-analysis.csv</a>
<a href="lilypond-issues-analysis-trim-duplicates.csv">lilypond-issues-analysis-trim-duplicates.csv</a>
</pre></blockquote>

<p>There 148 issues marked with Priority=Critical in the tracker.
</p>
<p>I&rsquo;ve done an analysis, and it looks to me like there was initially
a backlog of critical issues that weren&rsquo;t fixed, and little work
was being done to eliminate critical issues.
</p>
<p>Somewhere about 2010-08-01, critical issues started to disappear,
but occasional new ones appeared.
</p>
<p>There were a couple of major changes that introduced unanticipated
regressions (new spacing code, beam collision avoidance).  These
produced more than the expected number of regressions.
</p>
<p>It appears to me that we didn&rsquo;t really get serious about
eliminating critical bugs until about 2010-06-15 or so.  After
that point, the number of critical bugs more-or-less steadily
decreased until we got to a release candidate.
</p>
<p>Of particular interest, the first release candidate of 2.14 was
released on 2011-01-12.  Over the next 10 days, about a dozen bugs
were reported and fixed.  Release candidate 2 came out on
2011-02-09.   No surge of bugs occurred with this release.
Candidate 3 came out on 2011-03-13; we got 2 bugs per week.
Candidate 4 came out on 2011-03-29; 2 new bugs.  Candidate 6 came
out on 2011-04-07.  We got a couple of bugs per week.
</p>
<a name="Notes_002c-commentary_002c-and-opinions"></a>
<h3 class="subheading">Notes, commentary, and opinions</h3>

<blockquote><pre class="example">Han-Wen: Overall, I think this cycle took too long
Mike: I agree
Graham: +1
</pre></blockquote>

<a name="Discussions-2"></a>
<h4 class="subsubheading">Discussions</h4>

<table><tr><td>&nbsp;</td><td><pre class="smallexample"><a href="https://lists.gnu.org/archive/html/lilypond-devel/2011-06/msg00797.html">https://lists.gnu.org/archive/html/lilypond-devel/2011-06/msg00797.html</a>
<a href="https://lists.gnu.org/archive/html/lilypond-devel/2011-07/msg00364.html">https://lists.gnu.org/archive/html/lilypond-devel/2011-07/msg00364.html</a>

</pre></td></tr></table>


<hr size="6">
<a name="GOP_002dPROP-5-_002d-build-system-output-_0028not-accepted_0029"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#administrative-policies" title="Beginning of this chapter or previous chapter"> &lt;&lt; Administrative policies&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#gnu-free-documentation-license" title="Next chapter">&nbsp;GNU Free Documentation License &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#gop_002dprop-4-_002d-lessons-from-2_002e14" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; GOP-PROP 4 - lessons from 2.14&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#policy-decisions-_0028finished_0029" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Policy decisions (finished)&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#gop_002dprop-6-_002d-private-mailing-lists" title="Next section in reading order" accesskey="n" rel="next">&nbsp;GOP-PROP 6 - private mailing lists &gt; </a>]</td></tr></table>
<a name="gop_002dprop-5-_002d-build-system-output-_0028not-accepted_0029"></a>
<h4 class="subsubsection">14.6.4.5 GOP-PROP 5 - build system output (not accepted)</h4>

<p>This proposal was too broad; after a month of discussion, Graham
withdrew the proposal.  Portions of it will be introduced in later
proposals.
</p>
<a name="Discussions-6"></a>
<h4 class="subsubheading">Discussions</h4>

<table><tr><td>&nbsp;</td><td><pre class="smallexample"><a href="https://lists.gnu.org/archive/html/lilypond-devel/2011-07/msg00320.html">https://lists.gnu.org/archive/html/lilypond-devel/2011-07/msg00320.html</a>
<a href="https://lists.gnu.org/archive/html/lilypond-devel/2011-07/msg00527.html">https://lists.gnu.org/archive/html/lilypond-devel/2011-07/msg00527.html</a>
<a href="https://lists.gnu.org/archive/html/lilypond-devel/2011-07/msg00753.html">https://lists.gnu.org/archive/html/lilypond-devel/2011-07/msg00753.html</a>
<a href="https://lists.gnu.org/archive/html/lilypond-devel/2011-07/msg01042.html">https://lists.gnu.org/archive/html/lilypond-devel/2011-07/msg01042.html</a>
<a href="https://lists.gnu.org/archive/html/lilypond-devel/2011-08/msg00116.html">https://lists.gnu.org/archive/html/lilypond-devel/2011-08/msg00116.html</a>
<a href="https://lists.gnu.org/archive/html/lilypond-devel/2011-08/msg00310.html">https://lists.gnu.org/archive/html/lilypond-devel/2011-08/msg00310.html</a>
</pre></td></tr></table>


<hr size="6">
<a name="GOP_002dPROP-6-_002d-private-mailing-lists"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#administrative-policies" title="Beginning of this chapter or previous chapter"> &lt;&lt; Administrative policies&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#gnu-free-documentation-license" title="Next chapter">&nbsp;GNU Free Documentation License &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#gop_002dprop-5-_002d-build-system-output-_0028not-accepted_0029" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; GOP-PROP 5 - build system output (not accepted)&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#policy-decisions-_0028finished_0029" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Policy decisions (finished)&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#gop_002dprop-7-_002d-developers-as-resources" title="Next section in reading order" accesskey="n" rel="next">&nbsp;GOP-PROP 7 - developers as resources &gt; </a>]</td></tr></table>
<a name="gop_002dprop-6-_002d-private-mailing-lists"></a>
<h4 class="subsubsection">14.6.4.6 GOP-PROP 6 - private mailing list</h4>

<p>Potentially sensitive or private matters will be referred to
Graham.  He will then decide who should discuss the matter on an
ad-hoc basis, and forward or CC them on future emails.
</p>
<p>For emphasis, the project administrators are Han-Wen, Jan, and
Graham; those three will always be CC&rsquo;d on any important
discussions.
</p>
<p>The lilypond-hackers mailing list will be removed.
</p>
<a name="History-1"></a>
<h3 class="subheading">History</h3>

<p>There is some unhappy history about this idea in our development
community:
</p>
<blockquote><pre class="example"><a href="http://lists.gnu.org/archive/html/lilypond-devel/2010-09/msg00178.html">http://lists.gnu.org/archive/html/lilypond-devel/2010-09/msg00178.html</a>
<a href="http://news.lilynet.net/spip.php?article121">http://news.lilynet.net/spip.php?article121</a>
<a href="http://lists.gnu.org/archive/html/lilypond-devel/2010-11/msg00076.html">http://lists.gnu.org/archive/html/lilypond-devel/2010-11/msg00076.html</a>
</pre></blockquote>

<a name="Other-projects"></a>
<h3 class="subheading">Other projects</h3>

<p>The idea of private mailing lists is hardly uncommon in
open-source software.  For example,
</p>
<blockquote><pre class="example"><a href="http://lwn.net/Articles/394660">http://lwn.net/Articles/394660/</a>   about debian-private
<a href="http://subversion.apache.org/mailing-lists.html">http://subversion.apache.org/mailing-lists.html</a>  private@
<a href="http://www.freebsd.org/administration.html#t-core">http://www.freebsd.org/administration.html#t-core</a>
<a href="http://foundation.gnome.org/legal">http://foundation.gnome.org/legal/</a>   board members pledge
to keep certain matters confidential

every security team of every GNU/Linux distribution and OS
</pre></blockquote>

<p>In fact, Karl Fogel&rsquo;s &ldquo;Producing Open Source Software&rdquo;
explicitly suggests a private mailing list for some circumstances:
</p>
<blockquote><pre class="example">[on granting commit/push access to a contributor]

But here is one of the rare instances where secrecy is
appropriate. You can't have votes about potential committers
posted to a public mailing list, because the candidate's feelings
(and reputation) could be hurt.

<a href="http://producingoss.com/en/consensus-democracy.html#electorate">http://producingoss.com/en/consensus-democracy.html#electorate</a>
</pre></blockquote>

<a name="Board-of-governers_002c-voting_002c-etc_003f"></a>
<h3 class="subheading">Board of governers, voting, etc?</h3>

<p>Many projects have an official board of directors, or a list of
&ldquo;core developers&rdquo;, with set term limits and elections and
stuff.
</p>
<p>I don&rsquo;t think that we&rsquo;re that big.  I think we&rsquo;re still small
enough, and there&rsquo;s enough trust and consensus decisions, that we
can avoid that.  I would rather that we kept on going with
trust+consensus for at least the next 2-3 years, and spent more
time+energy on bug fixes and new features instead of
administrative stuff.
</p>
<p>Project administrators are Han-Wen, Jan, and Graham.
</p>
<a name="Discussions-1"></a>
<h4 class="subsubheading">Discussions</h4>

<table><tr><td>&nbsp;</td><td><pre class="smallexample"><a href="https://lists.gnu.org/archive/html/lilypond-devel/2011-07/msg00783.html">https://lists.gnu.org/archive/html/lilypond-devel/2011-07/msg00783.html</a>
<a href="https://lists.gnu.org/archive/html/lilypond-devel/2011-07/msg01004.html">https://lists.gnu.org/archive/html/lilypond-devel/2011-07/msg01004.html</a>
<a href="https://lists.gnu.org/archive/html/lilypond-devel/2011-08/msg00117.html">https://lists.gnu.org/archive/html/lilypond-devel/2011-08/msg00117.html</a>
</pre></td></tr></table>


<hr size="6">
<a name="GOP_002dPROP-7-_002d-developers-as-resources"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#administrative-policies" title="Beginning of this chapter or previous chapter"> &lt;&lt; Administrative policies&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#gnu-free-documentation-license" title="Next chapter">&nbsp;GNU Free Documentation License &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#gop_002dprop-6-_002d-private-mailing-lists" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; GOP-PROP 6 - private mailing lists&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#policy-decisions-_0028finished_0029" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Policy decisions (finished)&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#gop_002dprop-8-_002d-issue-priorities" title="Next section in reading order" accesskey="n" rel="next">&nbsp;GOP-PROP 8 - issue priorities &gt; </a>]</td></tr></table>
<a name="gop_002dprop-7-_002d-developers-as-resources"></a>
<h4 class="subsubsection">14.6.4.7 GOP-PROP 7 - developers as resources</h4>

<p>We shall treat developers (and contributors) as
<strong>Independent volunteers</strong>: each person does whatever they
want, whenever they want.  We have busy careers and lives; we make
no expectations of action from anybody (with the exception of the
6 people in &ldquo;Meister&rdquo; positions).
</p>
<a name="Discussions-8"></a>
<h4 class="subsubheading">Discussions</h4>

<table><tr><td>&nbsp;</td><td><pre class="smallexample"><a href="https://lists.gnu.org/archive/html/lilypond-devel/2011-07/msg01092.html">https://lists.gnu.org/archive/html/lilypond-devel/2011-07/msg01092.html</a>
<a href="https://lists.gnu.org/archive/html/lilypond-devel/2011-08/msg00087.html">https://lists.gnu.org/archive/html/lilypond-devel/2011-08/msg00087.html</a>
<a href="https://lists.gnu.org/archive/html/lilypond-devel/2011-08/msg00497.html">https://lists.gnu.org/archive/html/lilypond-devel/2011-08/msg00497.html</a>
</pre></td></tr></table>


<hr size="6">
<a name="GOP_002dPROP-8-_002d-issue-priorities"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#administrative-policies" title="Beginning of this chapter or previous chapter"> &lt;&lt; Administrative policies&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#gnu-free-documentation-license" title="Next chapter">&nbsp;GNU Free Documentation License &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#gop_002dprop-7-_002d-developers-as-resources" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; GOP-PROP 7 - developers as resources&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#policy-decisions-_0028finished_0029" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Policy decisions (finished)&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#gop_002dprop-9-_002d-behavior-of-make-doc" title="Next section in reading order" accesskey="n" rel="next">&nbsp;GOP-PROP 9 - behavior of make doc &gt; </a>]</td></tr></table>
<a name="gop_002dprop-8-_002d-issue-priorities"></a>
<h4 class="subsubsection">14.6.4.8 GOP-PROP 8 - issue priorities</h4>

<p>We will delete the &ldquo;priority&rdquo; field of the issue tracker
altogether.  The &ldquo;type&rdquo; system will be tweaked.
</p>
<p>Type-critical:
</p>
<ul>
<li>
a reproducible failure to build either <code>make</code> or <code>make
doc</code>, from an empty build tree, in a first run, if
<code>configure</code> does not report any errors.

</li><li>
any program behaviour which is <strong>unintentionally</strong> worse than
the previous stable version or the current development version.
Developers may always use the &ldquo;this is intentional&rdquo;, or even
the &ldquo;this is an unavoidable effect of an improvement in another
area&rdquo;, reason to move this to a different type.

</li><li>
anything which stops contributors from helping out (e.g.
lily-git.tcl not working, source tree(s) not being available,
LilyDev being unable to compile git master, inaccurate
instructions in the Contributor&rsquo;s Guide 2 Quick start).

<p>To limit this scope of this point, we will assume that the
contributor is using the latest LilyDev and has read the relevant
part(s) of the Contributor&rsquo;s Guide.  Problems in other chapters of
the CG are not sufficient to qualify as Type-Critical.
</p>
</li></ul>

<a name="More-new_002fchanged-types-and-labels"></a>
<h4 class="subsubheading">More new/changed types and labels</h4>

<p>Unless otherwise specified, the current types and labels will
continue to be used.  The new types introduced by this proposal
are:
</p>
<ul>
<li>
Type-crash: any segfault, regardless of what the input file looks
like or which options are given.  Disclaimer: this might not be
possible in some cases, for example certain guile programs (we
certainly can&rsquo;t predict if a piece of scheme will ever stop
running, i.e. the halting problem), or if we rely on other
programs (i.e. ghostscript).  If there are any such cases that
make segfault-prevention impossible, we will document those
exceptions (and the issue will remain as a &quot;crash&quot; instead of
&quot;documentation&quot; until the warning has been pushed).

</li><li>
Type-maintainability: anything which makes it difficult for
serious contributors to help out (e.g. difficult to find the
relevant source tree(s), confusing policies, problems with
automatic indentation tools, etc).

</li><li>
Type-ugly: replaces Type-collision, and it will include things
like bad slurs in addition to actual collision.

</li></ul>

<p>A new label will be added:
</p>
<ul>
<li>
(label) Needs_evidence: it is not clear what the correct output
should look like.  We need scans, references, examples, etc.

</li></ul>

<a name="Reminding-users-about-stars"></a>
<h3 class="subheading">Reminding users about stars</h3>

<p>We can remind users that they can &ldquo;star&rdquo; an issue to indicate
that they care about it.  Since we resolved to treat developers as
independent volunteers, there is no expectation that anybody will
look at those stars, but if any developer want to organize their
work schedule according to the stars, they are welcome to do so.
</p>
<a name="Discussions-3"></a>
<h4 class="subsubheading">Discussions</h4>

<table><tr><td>&nbsp;</td><td><pre class="smallexample"><a href="https://lists.gnu.org/archive/html/lilypond-devel/2011-08/msg00019.html">https://lists.gnu.org/archive/html/lilypond-devel/2011-08/msg00019.html</a>
<a href="https://lists.gnu.org/archive/html/lilypond-devel/2011-08/msg00277.html">https://lists.gnu.org/archive/html/lilypond-devel/2011-08/msg00277.html</a>
<a href="https://lists.gnu.org/archive/html/lilypond-devel/2011-08/msg00413.html">https://lists.gnu.org/archive/html/lilypond-devel/2011-08/msg00413.html</a>
<a href="https://lists.gnu.org/archive/html/lilypond-devel/2011-08/msg00624.html">https://lists.gnu.org/archive/html/lilypond-devel/2011-08/msg00624.html</a>

</pre></td></tr></table>


<hr size="6">
<a name="GOP_002dPROP-9-_002d-behavior-of-make-doc"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#administrative-policies" title="Beginning of this chapter or previous chapter"> &lt;&lt; Administrative policies&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#gnu-free-documentation-license" title="Next chapter">&nbsp;GNU Free Documentation License &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#gop_002dprop-8-_002d-issue-priorities" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; GOP-PROP 8 - issue priorities&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#policy-decisions-_0028finished_0029" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Policy decisions (finished)&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#grand-lilypond-input-syntax-standardization-_0028gliss_0029" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Grand LilyPond Input Syntax Standardization (GLISS) &gt; </a>]</td></tr></table>
<a name="gop_002dprop-9-_002d-behavior-of-make-doc"></a>
<h4 class="subsubsection">14.6.4.9 GOP-PROP 9 - behavior of make doc</h4>

<p>If there are build problems, then it should be easier to find out
why it&rsquo;s failing.  This will be achieved with log files, as well
as possibly including scripts which automatically display portions
of those log files for a failing build.
</p>
<p>We will also add targets for building a specific manual (for
quick+easy checking of doc work), as well as for building all
documentation in a specific language (either English or a
translated language).
</p>
<p>When you run <code>make doc</code>,
</p>
<ul>
<li>
All output will be saved to various log files, with the exception
of output directly from <code>make(1)</code>.

<p>Note that <code>make(1)</code> refers to a specific executable file on
unix computers, and is not a general term for the build system.
</p>
</li><li>
By default, no other output will be displayed on the console, with
one exception: if a build fails, we might display some portion(s)
of log file(s) which give useful clues about the reason for the
failure.

<p>The user may optionally request additional output to be printed;
this is controlled with the <code>VERBOSE=x</code> flag.  In such cases,
all output will still be written to log files; the console output
is strictly additional to the log files.
</p>
</li><li>
Logfiles from calling lilypond (as part of lilypond-book) will go in
the relevant
&lsquo;<tt>$LILYPOND_BUILD_DIR/out/lybook-db/12/lily-123456.log</tt>&rsquo; file.  All
other logfiles will go in the &lsquo;<tt>$LILYPOND_BUILD_DIR/logfiles/</tt>&rsquo;
directory.

<p>A single <code>make doc</code> will therefore result in hundreds of log
files.  Log files produced from individual lilypond runs are not
under our control; apart from that, I anticipate having one or two
dozen log files.  As long as it is clear which log file is
associated with which operation(s), I think this is entirely
appropriate.  The precise implementation will be discussed for
specific patches as they appear.
</p>
</li><li>
Both stderr and stdout will be saved in <code>*.log</code>.  The order
of lines from these streams should be preserved.

</li><li>
There will be no additional &ldquo;progress messages&rdquo; during the
build process.  If you run <code>make --silent</code>, a non-failing
build should print absolutely nothing to the screen.

</li><li>
Assuming that the loglevels patch is accepted, lilypond (inside
lilypond-book) will be run with &ndash;loglevel=WARN.
<a href="http://codereview.appspot.com/4822055">http://codereview.appspot.com/4822055/</a>

</li><li>
Ideally, a failing build should provide hints about the reason why
it failed, or at least hints about which log file(s) to examine.

</li></ul>

<p>If this proposal is accepted, none of these policies will be
assumed to apply to any other aspect of the build system.
Policies for any other aspect of the build system will be
discussed in separate proposals.
</p>
<a name="Don_0027t-cause-more-build-problems"></a>
<h3 class="subheading">Don&rsquo;t cause more build problems</h3>

<p>However, there is a danger in this approach, that vital error
messages can also be lost, thus preventing the cause of the
failure of a make being found.  We therefore need to be
exceptionally careful to move cautiously, include plenty of tests,
and give time for people to experiment/find problems in each stage
before proceeding to the next stage.
</p>
<p>This will be done by starting from individual lilypond calls
within lilypond-book, and slowly moving to &ldquo;larger&rdquo; targets of
the build system &ndash; after the individual lilypond calls are are
producing the appropriate amount of output and this is saved in
the right place and we can automatically isolate parts of a
failing build, we will work on lilypond-book in general, and only
then will we look at the build system itself.
</p>
<a name="Implementation-notes"></a>
<h3 class="subheading">Implementation notes</h3>

<p>There is an existing make variable QUIET_BUILD, which
alter the amount of output being displayed
(<a href="http://lilypond.org/doc/v2.15/Documentation/contributor/useful-make-variables">http://lilypond.org/doc/v2.15/Documentation/contributor/useful-make-variables</a>
).  We are not planning on keeping this make variable.
</p>
<p>The standard way for GNU packages to give more output is with a
<code>V=x</code> option.  Presumably this is done by increasing
<code>x</code>?  If we support this option, we should still write log
files; we would simply print more of the info in those log files
to screen.
</p>
<p>The command <code>tee</code> may be useful to write to a file and
display to stdout (in the case of VERBOSE).
</p>

<a name="Discussions-7"></a>
<h4 class="subsubheading">Discussions</h4>

<table><tr><td>&nbsp;</td><td><pre class="smallexample"><a href="https://lists.gnu.org/archive/html/lilypond-devel/2011-08/msg00378.html">https://lists.gnu.org/archive/html/lilypond-devel/2011-08/msg00378.html</a>
<a href="https://lists.gnu.org/archive/html/lilypond-devel/2011-08/msg00703.html">https://lists.gnu.org/archive/html/lilypond-devel/2011-08/msg00703.html</a>
</pre></td></tr></table>





<hr size="6">
<a name="Grand-LilyPond-Input-Syntax-Standardization-_0028GLISS_0029"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#administrative-policies" title="Beginning of this chapter or previous chapter"> &lt;&lt; Administrative policies&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#gnu-free-documentation-license" title="Next chapter">&nbsp;GNU Free Documentation License &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#gop_002dprop-9-_002d-behavior-of-make-doc" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; GOP-PROP 9 - behavior of make doc&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#administrative-policies" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Administrative policies&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#specific-gliss-issues" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Specific GLISS issues &gt; </a>]</td></tr></table>
<a name="grand-lilypond-input-syntax-standardization-_0028gliss_0029"></a>
<h2 class="section">14.7 Grand LilyPond Input Syntax Standardization (GLISS)</h2>

<a name="Summary"></a>
<h3 class="subheading">Summary</h3>

<ul>
<li>
Start: sortly after 2.14 comes out, which is currently estimated
to happen in January 2011.

</li><li>
Length: 6-12 months.  We&rsquo;re not going to rush this.

</li><li>
Goal: define an input which we commit to being
machine-updateable for the forseeable future.  Any future patches
which change the syntax in a non-convert-ly-able format will be
rejected.  (subject to the limitations, below)
Once this is finished, we will release lilypond 3.0.

</li></ul>


<a name="The-Problem"></a>
<h3 class="subheading">The Problem</h3>

<p>One of the biggest complaints people have with lilypond &ndash; other
than silly thing like &quot;there&rsquo;s no gui&quot; &ndash; is the changing syntax.
Now, inventing a language or standards is difficult.  If you set
it in stone too soon, you risk being stuck with decisions which
may limit matters.  If you keep on updating the syntax,
interaction with older data (and other programs!) becomes complex.
</p>
<a name="Scope-and-Limitations"></a>
<h3 class="subheading">Scope and Limitations</h3>

<ul>
<li>
tweaks will not be included.  Anything with \override, \set,
\overrideProperty, \tweak, \revert, \unset... including even those
command names themselves... is still fair game for NOT_SMART
convert-ly updates.

</li><li>
other than that, everything is on the table.  Is it a problem to
have the tagline inside \header?  What should the default behavior
of \include be?  When we abolish \times, do we move to \tuplet 3:2
or \tuplet 2/3 or what (for typical triplets in 4/4 time)?

</li><li>
we need to get standards for command names.  This will help users
remember them, and reduce the options for future names (and
potential renamings later on).  \commandOn and \commandOff seem to
work well (should we *always* have an Off command?), but what
about the &quot;command&quot; part?  Should it be \nounVerbOn, or
\verbNounOn ?  Or \verbNotesWithExtraInformationOn ?

</li><li>
we need standards for the location of commands.  Ligature
brackets, I&rsquo;m looking at you.  (non-postfix notation must die!)

</li><li>
this Grand Project doesn&rsquo;t affect whether we have a 2.16 or not.
The main problem will be deciding what to do (with a bit of
messiness anticipated for \tuplet); we should definitely release a
2.16 before merging _any_ of these changes.

</li><li>
we obviously can&rsquo;t /guarantee/ that we&rsquo;ll /never/ make any
non-convert-ly changes in the basic format.  But we *can*
guarantee that such changes would force lilypond 4.0, and that we
would only do so for overwhelmingly good reasons.

</li></ul>

<a name="Workflow"></a>
<h3 class="subheading">Workflow</h3>

<ul>
<li>
We&rsquo;re going to have lots and lots of emails flying around.  The
vast majority won&rsquo;t really fit into either -devel or -user, so
we&rsquo;ll use a list devoted to syntax issues.

</li><li>
Once we have a serious proposal that gained general acceptance
from the separate syntax mailing list, I&rsquo;ll bring it to -devel.
We&rsquo;re not going to make any changes without discussing it on
-devel, but if we&rsquo;re going to have huge threads about English
grammar and silly ideas, and I don&rsquo;t want to clutter up -devel.
Once whatever chaotic silliness on the syntax list is settled
down, I&rsquo;ll bring the ideas to -devel.

</li><li>
as with GDP, I&rsquo;ll moderate the discussion.  Not as with mailist
moderation, but rather by introducing issues at specific times.
We don&rsquo;t want a free-for-all discussion of all parts of the syntax
at once; nothing will get resolved.

</li><li>
Whenever possible, we&rsquo;ll decide on policies at the highest level
of abstraction.  For example, consider \numericTimeSignature,
\slurUp, \xNotesOn, \startTextSpan, and \verylongfermata.  One of
them starts with the name of the notation first (slur).  One has
an abbreviation (x instead of cross).  One has the verb at the end
(On), another has it at the beginning (start).  The adjective can
come at the beginning (numeric, x) or end (Up).  Most are in
camelCase, but one isn&rsquo;t (verylongfermata).

</li><li>
Instead of arguing about each individual command, we&rsquo;ll decide on
abstract questions.  Should each command begin the notation-noun,
or the verb?  Should all commands be in camelCase, or should we
make everything other than articulations in camelCase but make
articulations all lower-case?  Are abbreviations allowed?

</li><li>
Once we&rsquo;ve answered such fundamental questions, most of the syntax
should fall into place pretty easily.  There might be a few odd
questions left (&quot;is it a span, or a spanner?&quot;), but those can be
settled fairly quickly.

</li></ul>

<a name="Implementation"></a>
<h3 class="subheading">Implementation</h3>

<p>Nothing until the project is finished, then we declare the next
stable release (2.16.0 or 2.18.0 ?) to be the final 2.x version,
release it, then apply all the GLISS syntax changes and start
testing a beta for 3.0 a week or two later.
</p>
<a name="Discussion"></a>
<h3 class="subheading">Discussion</h3>

<p>Don&rsquo;t respond to any of the specifics yet.  Yes, we all have our
pet irritations (like &quot;what&rsquo;s up with \paper and \layout?!&quot;).
There will be plenty of time to discuss them once GLISS starts.
</p>
<p>That said, we have a list of specific items that people really
wanted to have written down.  See <a href="#specific-gliss-issues">Specific GLISS issues</a>.
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#specific-gliss-issues" accesskey="1">14.7.1 Specific GLISS issues</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>


<hr size="6">
<a name="Specific-GLISS-issues"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#administrative-policies" title="Beginning of this chapter or previous chapter"> &lt;&lt; Administrative policies&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#gnu-free-documentation-license" title="Next chapter">&nbsp;GNU Free Documentation License &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#grand-lilypond-input-syntax-standardization-_0028gliss_0029" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Grand LilyPond Input Syntax Standardization (GLISS)&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#grand-lilypond-input-syntax-standardization-_0028gliss_0029" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Grand LilyPond Input Syntax Standardization (GLISS)&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#unsorted-policies" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Unsorted policies &gt; </a>]</td></tr></table>
<a name="specific-gliss-issues"></a>
<h3 class="subsection">14.7.1 Specific GLISS issues</h3>

<ul>
<li>
add regtests for every piece of syntax (not one-command-per-file,
but making a few files which, between them, use every single piece
of syntax.)  This is a great test for convert-ly.

</li><li>
should GLISS cover suggested conventions?  (indentation,
one-bar-per-line, etc &ndash; the kind of stuff we list for the
lilypond formatting in the docs ?)

</li><li>
how much (if any) syntactic sugar should we add?  i.e.
<blockquote><pre class="example">  \instrumentName #'foo
% instead of
  \set Staff.instrumentName
</pre></blockquote>
<p>?  Carl: maybe yes, Neil: no.  (for example, it fails for
pianostaff)
</p>
</li><li>
the values that are used as arguments to common used overrides.
Sometimes they are a symbol (e.g. #&rsquo;around), sometimes a
predefined variable referring to a Scheme value or object (e.g.
#LEFT, #all-visible ). The main trouble is that for novice users
it is not clear when there should be an apostrophe and when not.

</li><li>
When do we need -\command and when is it just \command ?


</li><li>
Command-line options to the lilypond binary.  -dfoo counts as a
tweak; we won&rsquo;t be trying to pin those down.

</li><li>
<pre class="verbatim">\layout {
  \context { \Score
% vs.
\layout {
  \context {
    \Score
</pre>
</li><li>
If would be pedagogically simpler to realize this difference if
the syntax was separate if you define a context from scratch (as
is the case with \RemoveEmptyStaffContext) or if it&rsquo;s defined by
adding onto an existing context. For example, a syntax like

<pre class="verbatim">\context{
 % Copy the current settings of the Staff context:
 \use Staff
 % do whatever additional settings
}
%%% could be used to distinguish from
\context{
 % Take settings from a variable:
 \Variable
 % do whatever additional settings
}

%%% and

\context{
 % Start from scratch:
 \type ...
 \name ...
 \consists ...
 ...
}
</pre>
</li><li>
Capitalization of identifiers: \VoiceOne ?

</li><li>
<pre class="verbatim">%%% Allow
{ music expression } * 4
%%% instead of
\repeat unfold 4 { music expression }
</pre>
?  patch here:
<table><tr><td>&nbsp;</td><td><pre class="smallexample"><a href="http://lists.gnu.org/archive/html/lilypond-devel/2010-04/msg00467.html">http://lists.gnu.org/archive/html/lilypond-devel/2010-04/msg00467.html</a>
</pre></td></tr></table>

</li><li>
Personally, I find it easier to understand when there&rsquo;s a repeated
8 in the half-bar position; it&rsquo;s much easier to see that you have
two groups of 4:

<blockquote><pre class="example">c8 c c c c8 c c c
%%% instead of one group of eight:
c8 c c c c c c c
</pre></blockquote>

</li><li>
trivially simple bar-lines:

<p>c1 | c1 |
</p>
<p>encourage, allow, or discourage, or disallow?
</p>
</li><li>
indentation of \\ inside a {} construct.


</li><li>
barline checks at the end of line should be preceded by at least 2
spaces?  barline checks should line up if possible (i.e.  if you
can use less than 4, 8, X empty spaces before a barline check to
make them line up?)

</li><li>
Why doesn&rsquo;t \transpose respect \relative mode?


</li><li>
on \score vs. \new Score

<p>But in the light of a consistent syntax and semantic, I see no
reason (from the users POV) to disallow it.  After all, the real
top-level context is a \book {}, isn&rsquo;t it, and I don&rsquo;t see a point
in disallowing a \new Score construct just like \new Staff.
</p>
<p>From a syntactical POV, I see the following pros for \new Score:
- You can write \with { ... } for every other context but \Score,
which (for consistency) should also work with \new Score.
- When there&rsquo;s a \new Foo Bar, there&rsquo;s also a \context Foo Bar,
  which makes the same as a parallel instantiation of all Bar&rsquo;s.
- [Quoting Rune from
<a href="http://www.mail-archive.com/lilypond-devel@gnu.org/msg14713.html">http://www.mail-archive.com/lilypond-devel@gnu.org/msg14713.html</a>
  &quot;I know that the \score-statement is a syntactical construct,
but I think it would be nice to hide this fact from the users.  I
think we could make the use of score-block much more intuitive if
changing the syntax to \new \Score and adding an implicit
sequential-statement to the score.&quot;
</p>

</li><li>
Discussion on
<a href="http://code.google.com/p/lilypond/issues/detail?id=1322">http://code.google.com/p/lilypond/issues/detail?id=1322</a>
about \new vs. \context.


</li><li>
Let users add their own items to the parser?  comment 11 on:
<a href="http://code.google.com/p/lilypond/issues/detail?id=1322">http://code.google.com/p/lilypond/issues/detail?id=1322</a>

</li><li>
should engravers be pluralized (note_heads_engraver) or not
(note_head_engraver) ?

</li><li>
should we allow numbers in identifier names?  Issue:
<a href="http://code.google.com/p/lilypond/issues/detail?id=1670">http://code.google.com/p/lilypond/issues/detail?id=1670</a>

</li><li>
should we officially allow accented characters?  in general, how
do we feel about utf-8 stuff?

</li><li>
for the sake of completeness/simplicity, what about *disallowing*
the &quot;one-note&quot; form of a music expression?  i.e. only allowing
stuff like
<pre class="verbatim">  \transpose c d { e1 }
  \transpose c d &lt;&lt; e1 &gt;&gt;
</pre>
<p>and never allowing
</p><pre class="verbatim">  \transpose c d e1
</pre>
</li><li>
What should be the officially encouraged way of writing music for
transposing instruments? Maybe it should be simplified?
See http://lists.gnu.org/archive/html/lilypond-user/2011-07/msg00130.html

</li></ul>


<hr size="6">
<a name="Unsorted-policies"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#administrative-policies" title="Beginning of this chapter or previous chapter"> &lt;&lt; Administrative policies&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="#gnu-free-documentation-license" title="Next chapter">&nbsp;GNU Free Documentation License &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#specific-gliss-issues" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Specific GLISS issues&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#administrative-policies" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Administrative policies&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#gnu-free-documentation-license" title="Next section in reading order" accesskey="n" rel="next">&nbsp;GNU Free Documentation License &gt; </a>]</td></tr></table>
<a name="unsorted-policies"></a>
<h2 class="section">14.8 Unsorted policies</h2>

<a name="Language_002dspecific-mailing-lists"></a>
<h4 class="subsubheading">Language-specific mailing lists</h4>

<p>A translator can ask for an official lilypond-xy mailing list once
they&rsquo;ve finished all &ldquo;priority 1&rdquo; translation items.
</p>
<a name="Performing-yearly-copyright-update-_0028_201cgrand_002dreplace_201d_0029"></a>
<h4 class="subsubheading">Performing yearly copyright update (&ldquo;grand-replace&rdquo;)</h4>

<p>At the start of each year, copyright notices for all source files
should be refreshed by running the following command from the top of
the source tree:
</p>
<blockquote><pre class="example">make grand-replace
</pre></blockquote>

<p>Internally, this invokes the script &lsquo;<tt>scripts/build/grand-replace.py</tt>&rsquo;,
which performs a regular expression substitution for old-year -&gt; new-year
wherever it finds a valid copyright notice.
</p>
<p>Note that snapshots of third party files such as &lsquo;<tt>texinfo.tex</tt>&rsquo; should
not be included in the automatic update; &lsquo;<tt>grand-replace.py</tt>&rsquo; ignores these
files if they are listed in the variable <code>copied_files</code>.
</p>

<a name="Push-git-access"></a>
<h4 class="subsubheading">Push git access</h4>

<p>Git access is given out when a contributor has a significant
record of patches being accepted without problems.  If existing
developers are tired of pushing patches for a contributor, we&rsquo;ll
discuss giving them push access.  Unsolicited requests from
contributors for access will almost always be turned down.
</p>

<hr size="6">
<a name="GNU-Free-Documentation-License"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="#administrative-policies" title="Beginning of this chapter or previous chapter"> &lt;&lt; Administrative policies&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[&nbsp; &gt;&gt; ]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#unsorted-policies" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Unsorted policies&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#index" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Top&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[&nbsp; &gt; ]</td></tr></table>
<a name="gnu-free-documentation-license"></a>
<h1 class="appendix">A. GNU Free Documentation License</h1>
<p align="center"> Version 1.3, 3 November 2008
</p>

<table><tr><td>&nbsp;</td><td><pre class="display">Copyright &copy; 2000, 2001, 2002, 2007, 2008 Free Software Foundation, Inc.
<a href="http://fsf.org">http://fsf.org/</a>

Everyone is permitted to copy and distribute verbatim copies
of this license document, but changing it is not allowed.
</pre></td></tr></table>

<ol>
<li>
PREAMBLE

<p>The purpose of this License is to make a manual, textbook, or other
functional and useful document <em>free</em> in the sense of freedom: to
assure everyone the effective freedom to copy and redistribute it,
with or without modifying it, either commercially or noncommercially.
Secondarily, this License preserves for the author and publisher a way
to get credit for their work, while not being considered responsible
for modifications made by others.
</p>
<p>This License is a kind of &ldquo;copyleft&rdquo;, which means that derivative
works of the document must themselves be free in the same sense.  It
complements the GNU General Public License, which is a copyleft
license designed for free software.
</p>
<p>We have designed this License in order to use it for manuals for free
software, because free software needs free documentation: a free
program should come with manuals providing the same freedoms that the
software does.  But this License is not limited to software manuals;
it can be used for any textual work, regardless of subject matter or
whether it is published as a printed book.  We recommend this License
principally for works whose purpose is instruction or reference.
</p>
</li><li>
APPLICABILITY AND DEFINITIONS

<p>This License applies to any manual or other work, in any medium, that
contains a notice placed by the copyright holder saying it can be
distributed under the terms of this License.  Such a notice grants a
world-wide, royalty-free license, unlimited in duration, to use that
work under the conditions stated herein.  The &ldquo;Document&rdquo;, below,
refers to any such manual or work.  Any member of the public is a
licensee, and is addressed as &ldquo;you&rdquo;.  You accept the license if you
copy, modify or distribute the work in a way requiring permission
under copyright law.
</p>
<p>A &ldquo;Modified Version&rdquo; of the Document means any work containing the
Document or a portion of it, either copied verbatim, or with
modifications and/or translated into another language.
</p>
<p>A &ldquo;Secondary Section&rdquo; is a named appendix or a front-matter section
of the Document that deals exclusively with the relationship of the
publishers or authors of the Document to the Document&rsquo;s overall
subject (or to related matters) and contains nothing that could fall
directly within that overall subject.  (Thus, if the Document is in
part a textbook of mathematics, a Secondary Section may not explain
any mathematics.)  The relationship could be a matter of historical
connection with the subject or with related matters, or of legal,
commercial, philosophical, ethical or political position regarding
them.
</p>
<p>The &ldquo;Invariant Sections&rdquo; are certain Secondary Sections whose titles
are designated, as being those of Invariant Sections, in the notice
that says that the Document is released under this License.  If a
section does not fit the above definition of Secondary then it is not
allowed to be designated as Invariant.  The Document may contain zero
Invariant Sections.  If the Document does not identify any Invariant
Sections then there are none.
</p>
<p>The &ldquo;Cover Texts&rdquo; are certain short passages of text that are listed,
as Front-Cover Texts or Back-Cover Texts, in the notice that says that
the Document is released under this License.  A Front-Cover Text may
be at most 5 words, and a Back-Cover Text may be at most 25 words.
</p>
<p>A &ldquo;Transparent&rdquo; copy of the Document means a machine-readable copy,
represented in a format whose specification is available to the
general public, that is suitable for revising the document
straightforwardly with generic text editors or (for images composed of
pixels) generic paint programs or (for drawings) some widely available
drawing editor, and that is suitable for input to text formatters or
for automatic translation to a variety of formats suitable for input
to text formatters.  A copy made in an otherwise Transparent file
format whose markup, or absence of markup, has been arranged to thwart
or discourage subsequent modification by readers is not Transparent.
An image format is not Transparent if used for any substantial amount
of text.  A copy that is not &ldquo;Transparent&rdquo; is called &ldquo;Opaque&rdquo;.
</p>
<p>Examples of suitable formats for Transparent copies include plain
<small>ASCII</small> without markup, Texinfo input format, LaTeX input
format, <acronym>SGML</acronym> or <acronym>XML</acronym> using a publicly available
<acronym>DTD</acronym>, and standard-conforming simple <acronym>HTML</acronym>,
PostScript or <acronym>PDF</acronym> designed for human modification.  Examples
of transparent image formats include <acronym>PNG</acronym>, <acronym>XCF</acronym> and
<acronym>JPG</acronym>.  Opaque formats include proprietary formats that can be
read and edited only by proprietary word processors, <acronym>SGML</acronym> or
<acronym>XML</acronym> for which the <acronym>DTD</acronym> and/or processing tools are
not generally available, and the machine-generated <acronym>HTML</acronym>,
PostScript or <acronym>PDF</acronym> produced by some word processors for
output purposes only.
</p>
<p>The &ldquo;Title Page&rdquo; means, for a printed book, the title page itself,
plus such following pages as are needed to hold, legibly, the material
this License requires to appear in the title page.  For works in
formats which do not have any title page as such, &ldquo;Title Page&rdquo; means
the text near the most prominent appearance of the work&rsquo;s title,
preceding the beginning of the body of the text.
</p>
<p>The &ldquo;publisher&rdquo; means any person or entity that distributes copies
of the Document to the public.
</p>
<p>A section &ldquo;Entitled XYZ&rdquo; means a named subunit of the Document whose
title either is precisely XYZ or contains XYZ in parentheses following
text that translates XYZ in another language.  (Here XYZ stands for a
specific section name mentioned below, such as &ldquo;Acknowledgements&rdquo;,
&ldquo;Dedications&rdquo;, &ldquo;Endorsements&rdquo;, or &ldquo;History&rdquo;.)  To &ldquo;Preserve the Title&rdquo;
of such a section when you modify the Document means that it remains a
section &ldquo;Entitled XYZ&rdquo; according to this definition.
</p>
<p>The Document may include Warranty Disclaimers next to the notice which
states that this License applies to the Document.  These Warranty
Disclaimers are considered to be included by reference in this
License, but only as regards disclaiming warranties: any other
implication that these Warranty Disclaimers may have is void and has
no effect on the meaning of this License.
</p>
</li><li>
VERBATIM COPYING

<p>You may copy and distribute the Document in any medium, either
commercially or noncommercially, provided that this License, the
copyright notices, and the license notice saying this License applies
to the Document are reproduced in all copies, and that you add no other
conditions whatsoever to those of this License.  You may not use
technical measures to obstruct or control the reading or further
copying of the copies you make or distribute.  However, you may accept
compensation in exchange for copies.  If you distribute a large enough
number of copies you must also follow the conditions in section 3.
</p>
<p>You may also lend copies, under the same conditions stated above, and
you may publicly display copies.
</p>
</li><li>
COPYING IN QUANTITY

<p>If you publish printed copies (or copies in media that commonly have
printed covers) of the Document, numbering more than 100, and the
Document&rsquo;s license notice requires Cover Texts, you must enclose the
copies in covers that carry, clearly and legibly, all these Cover
Texts: Front-Cover Texts on the front cover, and Back-Cover Texts on
the back cover.  Both covers must also clearly and legibly identify
you as the publisher of these copies.  The front cover must present
the full title with all words of the title equally prominent and
visible.  You may add other material on the covers in addition.
Copying with changes limited to the covers, as long as they preserve
the title of the Document and satisfy these conditions, can be treated
as verbatim copying in other respects.
</p>
<p>If the required texts for either cover are too voluminous to fit
legibly, you should put the first ones listed (as many as fit
reasonably) on the actual cover, and continue the rest onto adjacent
pages.
</p>
<p>If you publish or distribute Opaque copies of the Document numbering
more than 100, you must either include a machine-readable Transparent
copy along with each Opaque copy, or state in or with each Opaque copy
a computer-network location from which the general network-using
public has access to download using public-standard network protocols
a complete Transparent copy of the Document, free of added material.
If you use the latter option, you must take reasonably prudent steps,
when you begin distribution of Opaque copies in quantity, to ensure
that this Transparent copy will remain thus accessible at the stated
location until at least one year after the last time you distribute an
Opaque copy (directly or through your agents or retailers) of that
edition to the public.
</p>
<p>It is requested, but not required, that you contact the authors of the
Document well before redistributing any large number of copies, to give
them a chance to provide you with an updated version of the Document.
</p>
</li><li>
MODIFICATIONS

<p>You may copy and distribute a Modified Version of the Document under
the conditions of sections 2 and 3 above, provided that you release
the Modified Version under precisely this License, with the Modified
Version filling the role of the Document, thus licensing distribution
and modification of the Modified Version to whoever possesses a copy
of it.  In addition, you must do these things in the Modified Version:
</p>
<ol>
<li>
Use in the Title Page (and on the covers, if any) a title distinct
from that of the Document, and from those of previous versions
(which should, if there were any, be listed in the History section
of the Document).  You may use the same title as a previous version
if the original publisher of that version gives permission.

</li><li>
List on the Title Page, as authors, one or more persons or entities
responsible for authorship of the modifications in the Modified
Version, together with at least five of the principal authors of the
Document (all of its principal authors, if it has fewer than five),
unless they release you from this requirement.

</li><li>
State on the Title page the name of the publisher of the
Modified Version, as the publisher.

</li><li>
Preserve all the copyright notices of the Document.

</li><li>
Add an appropriate copyright notice for your modifications
adjacent to the other copyright notices.

</li><li>
Include, immediately after the copyright notices, a license notice
giving the public permission to use the Modified Version under the
terms of this License, in the form shown in the Addendum below.

</li><li>
Preserve in that license notice the full lists of Invariant Sections
and required Cover Texts given in the Document&rsquo;s license notice.

</li><li>
Include an unaltered copy of this License.

</li><li>
Preserve the section Entitled &ldquo;History&rdquo;, Preserve its Title, and add
to it an item stating at least the title, year, new authors, and
publisher of the Modified Version as given on the Title Page.  If
there is no section Entitled &ldquo;History&rdquo; in the Document, create one
stating the title, year, authors, and publisher of the Document as
given on its Title Page, then add an item describing the Modified
Version as stated in the previous sentence.

</li><li>
Preserve the network location, if any, given in the Document for
public access to a Transparent copy of the Document, and likewise
the network locations given in the Document for previous versions
it was based on.  These may be placed in the &ldquo;History&rdquo; section.
You may omit a network location for a work that was published at
least four years before the Document itself, or if the original
publisher of the version it refers to gives permission.

</li><li>
For any section Entitled &ldquo;Acknowledgements&rdquo; or &ldquo;Dedications&rdquo;, Preserve
the Title of the section, and preserve in the section all the
substance and tone of each of the contributor acknowledgements and/or
dedications given therein.

</li><li>
Preserve all the Invariant Sections of the Document,
unaltered in their text and in their titles.  Section numbers
or the equivalent are not considered part of the section titles.

</li><li>
Delete any section Entitled &ldquo;Endorsements&rdquo;.  Such a section
may not be included in the Modified Version.

</li><li>
Do not retitle any existing section to be Entitled &ldquo;Endorsements&rdquo; or
to conflict in title with any Invariant Section.

</li><li>
Preserve any Warranty Disclaimers.
</li></ol>

<p>If the Modified Version includes new front-matter sections or
appendices that qualify as Secondary Sections and contain no material
copied from the Document, you may at your option designate some or all
of these sections as invariant.  To do this, add their titles to the
list of Invariant Sections in the Modified Version&rsquo;s license notice.
These titles must be distinct from any other section titles.
</p>
<p>You may add a section Entitled &ldquo;Endorsements&rdquo;, provided it contains
nothing but endorsements of your Modified Version by various
parties&mdash;for example, statements of peer review or that the text has
been approved by an organization as the authoritative definition of a
standard.
</p>
<p>You may add a passage of up to five words as a Front-Cover Text, and a
passage of up to 25 words as a Back-Cover Text, to the end of the list
of Cover Texts in the Modified Version.  Only one passage of
Front-Cover Text and one of Back-Cover Text may be added by (or
through arrangements made by) any one entity.  If the Document already
includes a cover text for the same cover, previously added by you or
by arrangement made by the same entity you are acting on behalf of,
you may not add another; but you may replace the old one, on explicit
permission from the previous publisher that added the old one.
</p>
<p>The author(s) and publisher(s) of the Document do not by this License
give permission to use their names for publicity for or to assert or
imply endorsement of any Modified Version.
</p>
</li><li>
COMBINING DOCUMENTS

<p>You may combine the Document with other documents released under this
License, under the terms defined in section 4 above for modified
versions, provided that you include in the combination all of the
Invariant Sections of all of the original documents, unmodified, and
list them all as Invariant Sections of your combined work in its
license notice, and that you preserve all their Warranty Disclaimers.
</p>
<p>The combined work need only contain one copy of this License, and
multiple identical Invariant Sections may be replaced with a single
copy.  If there are multiple Invariant Sections with the same name but
different contents, make the title of each such section unique by
adding at the end of it, in parentheses, the name of the original
author or publisher of that section if known, or else a unique number.
Make the same adjustment to the section titles in the list of
Invariant Sections in the license notice of the combined work.
</p>
<p>In the combination, you must combine any sections Entitled &ldquo;History&rdquo;
in the various original documents, forming one section Entitled
&ldquo;History&rdquo;; likewise combine any sections Entitled &ldquo;Acknowledgements&rdquo;,
and any sections Entitled &ldquo;Dedications&rdquo;.  You must delete all
sections Entitled &ldquo;Endorsements.&rdquo;
</p>
</li><li>
COLLECTIONS OF DOCUMENTS

<p>You may make a collection consisting of the Document and other documents
released under this License, and replace the individual copies of this
License in the various documents with a single copy that is included in
the collection, provided that you follow the rules of this License for
verbatim copying of each of the documents in all other respects.
</p>
<p>You may extract a single document from such a collection, and distribute
it individually under this License, provided you insert a copy of this
License into the extracted document, and follow this License in all
other respects regarding verbatim copying of that document.
</p>
</li><li>
AGGREGATION WITH INDEPENDENT WORKS

<p>A compilation of the Document or its derivatives with other separate
and independent documents or works, in or on a volume of a storage or
distribution medium, is called an &ldquo;aggregate&rdquo; if the copyright
resulting from the compilation is not used to limit the legal rights
of the compilation&rsquo;s users beyond what the individual works permit.
When the Document is included in an aggregate, this License does not
apply to the other works in the aggregate which are not themselves
derivative works of the Document.
</p>
<p>If the Cover Text requirement of section 3 is applicable to these
copies of the Document, then if the Document is less than one half of
the entire aggregate, the Document&rsquo;s Cover Texts may be placed on
covers that bracket the Document within the aggregate, or the
electronic equivalent of covers if the Document is in electronic form.
Otherwise they must appear on printed covers that bracket the whole
aggregate.
</p>
</li><li>
TRANSLATION

<p>Translation is considered a kind of modification, so you may
distribute translations of the Document under the terms of section 4.
Replacing Invariant Sections with translations requires special
permission from their copyright holders, but you may include
translations of some or all Invariant Sections in addition to the
original versions of these Invariant Sections.  You may include a
translation of this License, and all the license notices in the
Document, and any Warranty Disclaimers, provided that you also include
the original English version of this License and the original versions
of those notices and disclaimers.  In case of a disagreement between
the translation and the original version of this License or a notice
or disclaimer, the original version will prevail.
</p>
<p>If a section in the Document is Entitled &ldquo;Acknowledgements&rdquo;,
&ldquo;Dedications&rdquo;, or &ldquo;History&rdquo;, the requirement (section 4) to Preserve
its Title (section 1) will typically require changing the actual
title.
</p>
</li><li>
TERMINATION

<p>You may not copy, modify, sublicense, or distribute the Document
except as expressly provided under this License.  Any attempt
otherwise to copy, modify, sublicense, or distribute it is void, and
will automatically terminate your rights under this License.
</p>
<p>However, if you cease all violation of this License, then your license
from a particular copyright holder is reinstated (a) provisionally,
unless and until the copyright holder explicitly and finally
terminates your license, and (b) permanently, if the copyright holder
fails to notify you of the violation by some reasonable means prior to
60 days after the cessation.
</p>
<p>Moreover, your license from a particular copyright holder is
reinstated permanently if the copyright holder notifies you of the
violation by some reasonable means, this is the first time you have
received notice of violation of this License (for any work) from that
copyright holder, and you cure the violation prior to 30 days after
your receipt of the notice.
</p>
<p>Termination of your rights under this section does not terminate the
licenses of parties who have received copies or rights from you under
this License.  If your rights have been terminated and not permanently
reinstated, receipt of a copy of some or all of the same material does
not give you any rights to use it.
</p>
</li><li>
FUTURE REVISIONS OF THIS LICENSE

<p>The Free Software Foundation may publish new, revised versions
of the GNU Free Documentation License from time to time.  Such new
versions will be similar in spirit to the present version, but may
differ in detail to address new problems or concerns.  See
<a href="http://www.gnu.org/copyleft">http://www.gnu.org/copyleft/</a>.
</p>
<p>Each version of the License is given a distinguishing version number.
If the Document specifies that a particular numbered version of this
License &ldquo;or any later version&rdquo; applies to it, you have the option of
following the terms and conditions either of that specified version or
of any later version that has been published (not as a draft) by the
Free Software Foundation.  If the Document does not specify a version
number of this License, you may choose any version ever published (not
as a draft) by the Free Software Foundation.  If the Document
specifies that a proxy can decide which future versions of this
License can be used, that proxy&rsquo;s public statement of acceptance of a
version permanently authorizes you to choose that version for the
Document.
</p>
</li><li>
RELICENSING

<p>&ldquo;Massive Multiauthor Collaboration Site&rdquo; (or &ldquo;MMC Site&rdquo;) means any
World Wide Web server that publishes copyrightable works and also
provides prominent facilities for anybody to edit those works.  A
public wiki that anybody can edit is an example of such a server.  A
&ldquo;Massive Multiauthor Collaboration&rdquo; (or &ldquo;MMC&rdquo;) contained in the
site means any set of copyrightable works thus published on the MMC
site.
</p>
<p>&ldquo;CC-BY-SA&rdquo; means the Creative Commons Attribution-Share Alike 3.0
license published by Creative Commons Corporation, a not-for-profit
corporation with a principal place of business in San Francisco,
California, as well as future copyleft versions of that license
published by that same organization.
</p>
<p>&ldquo;Incorporate&rdquo; means to publish or republish a Document, in whole or
in part, as part of another Document.
</p>
<p>An MMC is &ldquo;eligible for relicensing&rdquo; if it is licensed under this
License, and if all works that were first published under this License
somewhere other than this MMC, and subsequently incorporated in whole
or in part into the MMC, (1) had no cover texts or invariant sections,
and (2) were thus incorporated prior to November 1, 2008.
</p>
<p>The operator of an MMC Site may republish an MMC contained in the site
under CC-BY-SA on the same site at any time before August 1, 2009,
provided the MMC is eligible for relicensing.
</p>
</li></ol>


<a name="ADDENDUM_003a-How-to-use-this-License-for-your-documents"></a>
<h2 class="heading">ADDENDUM: How to use this License for your documents</h2>

<p>To use this License in a document you have written, include a copy of
the License in the document and put the following copyright and
license notices just after the title page:
</p>
<table><tr><td>&nbsp;</td><td><pre class="smallexample">  Copyright (C)  <var>year</var>  <var>your name</var>.
  Permission is granted to copy, distribute and/or modify this document
  under the terms of the GNU Free Documentation License, Version 1.3
  or any later version published by the Free Software Foundation;
  with no Invariant Sections, no Front-Cover Texts, and no Back-Cover
  Texts.  A copy of the license is included in the section entitled ``GNU
  Free Documentation License''.
</pre></td></tr></table>

<p>If you have Invariant Sections, Front-Cover Texts and Back-Cover Texts,
replace the &ldquo;with&hellip;Texts.&rdquo; line with this:
</p>
<table><tr><td>&nbsp;</td><td><pre class="smallexample">    with the Invariant Sections being <var>list their titles</var>, with
    the Front-Cover Texts being <var>list</var>, and with the Back-Cover Texts
    being <var>list</var>.
</pre></td></tr></table>

<p>If you have Invariant Sections without Cover Texts, or some other
combination of the three, merge those two alternatives to suit the
situation.
</p>
<p>If your document contains nontrivial examples of program code, we
recommend releasing these examples in parallel under your choice of
free software license, such as the GNU General Public License,
to permit their use in free software.
</p>


<hr size="6">
<a name="SEC_Contents"></a>
<table class="nav_table">
<tr><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td></tr></table>
<h1>Table of Contents</h1>
<div class="contents">

<ul class="toc">
  <li><a name="toc-Introduction-to-contributing-1" href="#introduction-to-contributing">1. Introduction to contributing</a>
  <ul class="toc">
    <li><a name="toc-Help-us-1" href="#help-us">1.1 Help us</a></li>
    <li><a name="toc-Overview-of-work-flow-1" href="#overview-of-work-flow">1.2 Overview of work flow</a></li>
    <li><a name="toc-Summary-for-experienced-developers-1" href="#summary-for-experienced-developers">1.3 Summary for experienced developers</a></li>
    <li><a name="toc-Mentors-1" href="#mentors">1.4 Mentors</a></li>
  </ul></li>
  <li><a name="toc-Quick-start-1" href="#quick-start">2. Quick start</a>
  <ul class="toc">
    <li><a name="toc-LilyDev-1" href="#lilydev">2.1 LilyDev</a>
    <ul class="toc">
      <li><a name="toc-Where-to-get-LilyDev-1" href="#where-to-get-lilydev">Where to get LilyDev</a></li>
      <li><a name="toc-Installing-LilyDev-in-VirtualBox-1" href="#installing-lilydev-in-virtualbox">Installing LilyDev in VirtualBox</a></li>
      <li><a name="toc-Configuring-LilyDev-in-VirtualBox-1" href="#configuring-lilydev-in-virtualbox">Configuring LilyDev in VirtualBox</a></li>
    </ul></li>
    <li><a name="toc-lily_002dgit-1" href="#lily_002dgit">2.2 lily-git</a>
    <ul class="toc">
      <li><a name="toc-Where-to-get-lily_002dgit-1" href="#where-to-get-lily_002dgit">Where to get lily-git</a></li>
      <li><a name="toc-Configuring-lily_002dgit-and-downloading-the-source-code-1" href="#configuring-lily_002dgit-and-downloading-the-source-code">Configuring lily-git and downloading the source code</a></li>
      <li><a name="toc-How-to-use-lily_002dgit-1" href="#how-to-use-lily_002dgit">How to use lily-git</a></li>
    </ul></li>
    <li><a name="toc-Compiling-with-LilyDev-1" href="#compiling-with-lilydev">2.3 Compiling with LilyDev</a></li>
    <li><a name="toc-Now-start-work_0021-1" href="#now-start-work_0021">2.4 Now start work!</a></li>
  </ul></li>
  <li><a name="toc-Working-with-source-code-1" href="#working-with-source-code">3. Working with source code</a>
  <ul class="toc">
    <li><a name="toc-Manually-installing-lily_002dgit_002etcl-1" href="#manually-installing-lily_002dgit_002etcl">3.1 Manually installing lily-git.tcl</a></li>
    <li><a name="toc-Starting-with-Git-1" href="#starting-with-git">3.2 Starting with Git</a>
    <ul class="toc">
      <li><a name="toc-Setting-up-1" href="#setting-up">3.2.1 Setting up</a>
      <ul class="toc">
        <li><a name="toc-Installing-Git-1" href="#installing-git">Installing Git</a></li>
        <li><a name="toc-Initializing-a-repository-1" href="#initializing-a-repository">Initializing a repository</a></li>
        <li><a name="toc-Configuring-Git-1" href="#configuring-git">Configuring Git</a></li>
      </ul></li>
      <li><a name="toc-Git-for-the-impatient-1" href="#git-for-the-impatient">3.2.2 Git for the impatient</a></li>
      <li><a name="toc-Other-repositories-1" href="#other-repositories">3.2.3 Other repositories</a>
      <ul class="toc">
        <li><a name="toc-lilypond_002dextra-1" href="#lilypond_002dextra">lilypond-extra</a></li>
        <li><a name="toc-Grand-Unified-Builder-_0028GUB_0029-1" href="#grand-unified-builder-_0028gub_0029">Grand Unified Builder (GUB)</a></li>
        <li><a name="toc-lilypad-1" href="#lilypad">lilypad</a></li>
        <li><a name="toc-yet-more-repositories-1" href="#yet-more-repositories">yet more repositories</a></li>
      </ul></li>
      <li><a name="toc-Downloading-remote-branches-1" href="#downloading-remote-branches">3.2.4 Downloading remote branches</a>
      <ul class="toc">
        <li><a name="toc-Organization-of-remote-branches-1" href="#organization-of-remote-branches">Organization of remote branches</a></li>
        <li><a name="toc-LilyPond-repository-sources-1" href="#lilypond-repository-sources">LilyPond repository sources</a></li>
        <li><a name="toc-Downloading-individual-branches-1" href="#downloading-individual-branches">Downloading individual branches</a></li>
        <li><a name="toc-Downloading-all-remote-branches-1" href="#downloading-all-remote-branches">Downloading all remote branches</a></li>
        <li><a name="toc-Other-branches-1" href="#other-branches">Other branches</a></li>
      </ul>
</li>
    </ul></li>
    <li><a name="toc-Basic-Git-procedures-1" href="#basic-git-procedures">3.3 Basic Git procedures</a>
    <ul class="toc">
      <li><a name="toc-The-Git-contributor_0027s-cycle-1" href="#the-git-contributor_0027s-cycle">3.3.1 The Git contributor&rsquo;s cycle</a></li>
      <li><a name="toc-Pulling-and-rebasing-1" href="#pulling-and-rebasing">3.3.2 Pulling and rebasing</a></li>
      <li><a name="toc-Using-local-branches-1" href="#using-local-branches">3.3.3 Using local branches</a>
      <ul class="toc">
        <li><a name="toc-Creating-and-removing-branches-1" href="#creating-and-removing-branches">Creating and removing branches</a></li>
        <li><a name="toc-Listing-branches-and-remotes-1" href="#listing-branches-and-remotes">Listing branches and remotes</a></li>
        <li><a name="toc-Checking-out-branches-1" href="#checking-out-branches">Checking out branches</a></li>
        <li><a name="toc-Merging-branches-1" href="#merging-branches">Merging branches</a></li>
      </ul></li>
      <li><a name="toc-Commits-and-patches-1" href="#commits-and-patches">3.3.4 Commits and patches</a>
      <ul class="toc">
        <li><a name="toc-Understanding-commits-1" href="#understanding-commits">Understanding commits</a></li>
        <li><a name="toc-Making-commits-1" href="#making-commits">Making commits</a></li>
        <li><a name="toc-Commit-messages-1" href="#commit-messages">Commit messages</a></li>
        <li><a name="toc-Making-patches-1" href="#making-patches">Making patches</a></li>
        <li><a name="toc-Uploading-a-patch-for-review-1" href="#uploading-a-patch-for-review">Uploading a patch for review</a></li>
      </ul>
</li>
    </ul></li>
    <li><a name="toc-Advanced-Git-procedures-1" href="#advanced-git-procedures">3.4 Advanced Git procedures</a>
    <ul class="toc">
      <li><a name="toc-Merge-conflicts-1" href="#merge-conflicts">3.4.1 Merge conflicts</a></li>
      <li><a name="toc-Advanced-Git-concepts-1" href="#advanced-git-concepts">3.4.2 Advanced Git concepts</a></li>
      <li><a name="toc-Resolving-conflicts-1" href="#resolving-conflicts">3.4.3 Resolving conflicts</a></li>
      <li><a name="toc-Reverting-all-local-changes-1" href="#reverting-all-local-changes">3.4.4 Reverting all local changes</a></li>
      <li><a name="toc-Working-with-remote-branches-1" href="#working-with-remote-branches">3.4.5 Working with remote branches</a></li>
      <li><a name="toc-Git-log-1" href="#git-log">3.4.6 Git log</a></li>
      <li><a name="toc-Applying-remote-patches-1" href="#applying-remote-patches">3.4.7 Applying remote patches</a></li>
      <li><a name="toc-Sending-and-receiving-patches-via-email-1" href="#sending-and-receiving-patches-via-email">3.4.8 Sending and receiving patches via email</a></li>
      <li><a name="toc-Cleaning-up-multiple-patches-1" href="#cleaning-up-multiple-patches">3.4.9 Cleaning up multiple patches</a></li>
      <li><a name="toc-Commit-access-1" href="#commit-access">3.4.10 Commit access</a></li>
      <li><a name="toc-Pushing-to-staging-1" href="#pushing-to-staging">3.4.11 Pushing to staging</a></li>
    </ul></li>
    <li><a name="toc-Git-on-Windows-1" href="#git-on-windows">3.5 Git on Windows</a>
    <ul class="toc">
      <li><a name="toc-Background-to-nomenclature" href="#git-on-windows">3.5.1 Background to nomenclature</a></li>
      <li><a name="toc-Installing-git" href="#git-on-windows">3.5.2 Installing git</a></li>
      <li><a name="toc-Initialising-Git" href="#git-on-windows">3.5.3 Initialising Git</a></li>
      <li><a name="toc-Git-GUI" href="#git-on-windows">3.5.4 Git GUI</a></li>
      <li><a name="toc-Personalising-your-local-git-repository" href="#git-on-windows">3.5.5 Personalising your local git repository</a></li>
      <li><a name="toc-Checking-out-a-branch" href="#git-on-windows">3.5.6 Checking out a branch</a></li>
      <li><a name="toc-Updating-files-from-_2018remote_002forigin_002fmaster_2019" href="#git-on-windows">3.5.7 Updating files from &lsquo;remote/origin/master&rsquo;</a></li>
      <li><a name="toc-Editing-files" href="#git-on-windows">3.5.8 Editing files</a></li>
      <li><a name="toc-Sending-changes-to-_2018remotes_002forigin_002fmaster_2019" href="#git-on-windows">3.5.9 Sending changes to &lsquo;remotes/origin/master&rsquo;</a></li>
      <li><a name="toc-Resolving-merge-conflicts" href="#git-on-windows">3.5.10 Resolving merge conflicts</a></li>
      <li><a name="toc-Other-actions" href="#git-on-windows">3.5.11 Other actions</a></li>
    </ul></li>
    <li><a name="toc-Repository-directory-structure-1" href="#repository-directory-structure">3.6 Repository directory structure</a></li>
    <li><a name="toc-Other-Git-documentation-1" href="#other-git-documentation">3.7 Other Git documentation</a></li>
  </ul></li>
  <li><a name="toc-Compiling-1" href="#compiling">4. Compiling</a>
  <ul class="toc">
    <li><a name="toc-Overview-of-compiling-1" href="#overview-of-compiling">4.1 Overview of compiling</a></li>
    <li><a name="toc-Requirements-1" href="#requirements">4.2 Requirements</a>
    <ul class="toc">
      <li><a name="toc-Requirements-for-running-LilyPond-1" href="#requirements-for-running-lilypond">4.2.1 Requirements for running LilyPond</a></li>
      <li><a name="toc-Requirements-for-compiling-LilyPond-1" href="#requirements-for-compiling-lilypond">4.2.2 Requirements for compiling LilyPond</a></li>
      <li><a name="toc-Requirements-for-building-documentation-1" href="#requirements-for-building-documentation">4.2.3 Requirements for building documentation</a></li>
    </ul></li>
    <li><a name="toc-Getting-the-source-code-1" href="#getting-the-source-code">4.3 Getting the source code</a></li>
    <li><a name="toc-Configuring-make-1" href="#configuring-make">4.4 Configuring <code>make</code></a>
    <ul class="toc">
      <li><a name="toc-Running-_002e_002fautogen_002esh-1" href="#running-_002e_002fautogen_002esh">4.4.1 Running <code>./autogen.sh</code></a></li>
      <li><a name="toc-Running-_002e_002e_002fconfigure-1" href="#running-_002e_002e_002fconfigure">4.4.2 Running <code>../configure</code></a>
      <ul class="toc">
        <li><a name="toc-Configuration-options-1" href="#configuration-options">Configuration options</a></li>
        <li><a name="toc-Checking-build-dependencies-1" href="#checking-build-dependencies">Checking build dependencies</a></li>
        <li><a name="toc-Configuring-target-directories-1" href="#configuring-target-directories">Configuring target directories</a></li>
      </ul>
</li>
    </ul></li>
    <li><a name="toc-Compiling-LilyPond-1" href="#compiling-lilypond">4.5 Compiling LilyPond</a>
    <ul class="toc">
      <li><a name="toc-Using-make-1" href="#using-make">4.5.1 Using <code>make</code></a></li>
      <li><a name="toc-Saving-time-with-the-_002dj-option-1" href="#saving-time-with-the-_002dj-option">4.5.2 Saving time with the &lsquo;<samp>-j</samp>&rsquo; option</a></li>
      <li><a name="toc-Compiling-for-multiple-platforms-1" href="#compiling-for-multiple-platforms">4.5.3 Compiling for multiple platforms</a></li>
      <li><a name="toc-Useful-make-variables-1" href="#useful-make-variables">4.5.4 Useful <code>make</code> variables</a></li>
    </ul></li>
    <li><a name="toc-Post_002dcompilation-options-1" href="#post_002dcompilation-options">4.6 Post-compilation options</a>
    <ul class="toc">
      <li><a name="toc-Installing-LilyPond-from-a-local-build-1" href="#installing-lilypond-from-a-local-build">4.6.1 Installing LilyPond from a local build</a></li>
      <li><a name="toc-Generating-documentation-1" href="#generating-documentation">4.6.2 Generating documentation</a>
      <ul class="toc">
        <li><a name="toc-Documentation-editor_0027s-edit_002fcompile-cycle-1" href="#documentation-editor_0027s-edit_002fcompile-cycle">Documentation editor&rsquo;s edit/compile cycle</a></li>
        <li><a name="toc-Building-documentation-1" href="#building-documentation">Building documentation</a></li>
        <li><a name="toc-Building-a-single-document-1" href="#building-a-single-document">Building a single document</a></li>
        <li><a name="toc-Saving-time-with-CPU_005fCOUNT-1" href="#saving-time-with-cpu_005fcount">Saving time with <code>CPU_COUNT</code></a></li>
        <li><a name="toc-AJAX-search-1" href="#ajax-search">AJAX search</a></li>
        <li><a name="toc-Installing-documentation-1" href="#installing-documentation">Installing documentation</a></li>
        <li><a name="toc-Building-documentation-without-compiling-1" href="#building-documentation-without-compiling">Building documentation without compiling</a></li>
      </ul></li>
      <li><a name="toc-Testing-LilyPond-binary-1" href="#testing-lilypond-binary">4.6.3 Testing LilyPond binary</a></li>
    </ul></li>
    <li><a name="toc-Problems-1" href="#problems">4.7 Problems</a>
    <ul class="toc">
      <li><a name="toc-Bison-1_002e875" href="#problems">Bison 1.875</a></li>
      <li><a name="toc-Compiling-on-MacOS-X" href="#problems">Compiling on MacOS&nbsp;X</a></li>
      <li><a name="toc-Solaris" href="#problems">Solaris</a></li>
      <li><a name="toc-FreeBSD" href="#problems">FreeBSD</a></li>
      <li><a name="toc-International-fonts" href="#problems">International fonts</a></li>
      <li><a name="toc-Using-lilypond-python-libraries" href="#problems">Using lilypond python libraries</a></li>
    </ul></li>
    <li><a name="toc-Concurrent-stable-and-development-versions-1" href="#concurrent-stable-and-development-versions">4.8 Concurrent stable and development versions</a></li>
    <li><a name="toc-Build-system-1" href="#build-system">4.9 Build system</a></li>
  </ul></li>
  <li><a name="toc-Documentation-work-1" href="#documentation-work">5. Documentation work</a>
  <ul class="toc">
    <li><a name="toc-Introduction-to-documentation-work-1" href="#introduction-to-documentation-work">5.1 Introduction to documentation work</a></li>
    <li><a name="toc-Documentation-suggestions-1" href="#documentation-suggestions">5.2 Documentation suggestions</a></li>
    <li><a name="toc-Texinfo-introduction-and-usage-policy-1" href="#texinfo-introduction-and-usage-policy">5.3 Texinfo introduction and usage policy</a>
    <ul class="toc">
      <li><a name="toc-Texinfo-introduction-1" href="#texinfo-introduction">5.3.1 Texinfo introduction</a></li>
      <li><a name="toc-Documentation-files-1" href="#documentation-files">5.3.2 Documentation files</a></li>
      <li><a name="toc-Sectioning-commands-1" href="#sectioning-commands">5.3.3 Sectioning commands</a></li>
      <li><a name="toc-LilyPond-formatting-1" href="#lilypond-formatting">5.3.4 LilyPond formatting</a></li>
      <li><a name="toc-Text-formatting-1" href="#text-formatting">5.3.5 Text formatting</a></li>
      <li><a name="toc-Syntax-survey-1" href="#syntax-survey">5.3.6 Syntax survey</a>
      <ul class="toc">
        <li><a name="toc-Comments-1" href="#comments">Comments</a></li>
        <li><a name="toc-Cross-references-1" href="#cross-references">Cross references</a></li>
        <li><a name="toc-External-links-1" href="#external-links">External links</a></li>
        <li><a name="toc-Fixed_002dwidth-font-1" href="#fixed_002dwidth-font">Fixed-width font</a></li>
        <li><a name="toc-Indexing-1" href="#indexing">Indexing</a></li>
        <li><a name="toc-Lists-1" href="#lists">Lists</a></li>
        <li><a name="toc-Special-characters-1" href="#special-characters">Special characters</a></li>
        <li><a name="toc-Miscellany-1" href="#miscellany">Miscellany</a></li>
      </ul></li>
      <li><a name="toc-Other-text-concerns-1" href="#other-text-concerns">5.3.7 Other text concerns</a></li>
    </ul></li>
    <li><a name="toc-Documentation-policy-1" href="#documentation-policy">5.4 Documentation policy</a>
    <ul class="toc">
      <li><a name="toc-Books-1" href="#books">5.4.1 Books</a></li>
      <li><a name="toc-Section-organization-1" href="#section-organization">5.4.2 Section organization</a></li>
      <li><a name="toc-Checking-cross_002dreferences-1" href="#checking-cross_002dreferences">5.4.3 Checking cross-references</a></li>
      <li><a name="toc-General-writing-1" href="#general-writing">5.4.4 General writing</a></li>
      <li><a name="toc-Technical-writing-style-1" href="#technical-writing-style">5.4.5 Technical writing style</a></li>
    </ul></li>
    <li><a name="toc-Tips-for-writing-docs-1" href="#tips-for-writing-docs">5.5 Tips for writing docs</a></li>
    <li><a name="toc-Scripts-to-ease-doc-work-1" href="#scripts-to-ease-doc-work">5.6 Scripts to ease doc work</a></li>
    <li><a name="toc-Docstrings-in-scheme-1" href="#docstrings-in-scheme">5.7 Docstrings in scheme</a></li>
    <li><a name="toc-Translating-the-documentation-1" href="#translating-the-documentation">5.8 Translating the documentation</a>
    <ul class="toc">
      <li><a name="toc-Getting-started-with-documentation-translation-1" href="#getting-started-with-documentation-translation">5.8.1 Getting started with documentation translation</a>
      <ul class="toc">
        <li><a name="toc-Translation-requirements-1" href="#translation-requirements">Translation requirements</a></li>
        <li><a name="toc-Which-documentation-can-be-translated-1" href="#which-documentation-can-be-translated">Which documentation can be translated</a></li>
        <li><a name="toc-Starting-translation-in-a-new-language-1" href="#starting-translation-in-a-new-language">Starting translation in a new language</a></li>
      </ul></li>
      <li><a name="toc-Documentation-translation-details-1" href="#documentation-translation-details">5.8.2 Documentation translation details</a>
      <ul class="toc">
        <li><a name="toc-Files-to-be-translated-1" href="#files-to-be-translated">Files to be translated</a></li>
        <li><a name="toc-Translating-the-Web-site-and-other-Texinfo-documentation-1" href="#translating-the-web-site-and-other-texinfo-documentation">Translating the Web site and other Texinfo documentation</a></li>
        <li><a name="toc-Adding-a-Texinfo-manual-1" href="#adding-a-texinfo-manual">Adding a Texinfo manual</a></li>
      </ul></li>
      <li><a name="toc-Documentation-translation-maintenance-1" href="#documentation-translation-maintenance">5.8.3 Documentation translation maintenance</a>
      <ul class="toc">
        <li><a name="toc-Check-state-of-translation-1" href="#check-state-of-translation">Check state of translation</a></li>
        <li><a name="toc-Updating-documentation-translation-1" href="#updating-documentation-translation">Updating documentation translation</a></li>
        <li><a name="toc-Updating-translation-committishes-1" href="#updating-translation-committishes">Updating translation committishes</a></li>
      </ul></li>
      <li><a name="toc-Translations-management-policies-1" href="#translations-management-policies">5.8.4 Translations management policies</a>
      <ul class="toc">
        <li><a name="toc-Maintaining-without-updating-translations-1" href="#maintaining-without-updating-translations">Maintaining without updating translations</a></li>
        <li><a name="toc-Managing-documentation-translation-with-Git-1" href="#managing-documentation-translation-with-git">Managing documentation translation with Git</a></li>
      </ul></li>
      <li><a name="toc-Technical-background-1" href="#technical-background">5.8.5 Technical background</a></li>
    </ul>
</li>
  </ul></li>
  <li><a name="toc-Website-work-1" href="#website-work">6. Website work</a>
  <ul class="toc">
    <li><a name="toc-Introduction-to-website-work-1" href="#introduction-to-website-work">6.1 Introduction to website work</a></li>
    <li><a name="toc-Uploading-and-security-1" href="#uploading-and-security">6.2 Uploading and security</a></li>
    <li><a name="toc-Debugging-website-and-docs-locally-1" href="#debugging-website-and-docs-locally">6.3 Debugging website and docs locally</a></li>
    <li><a name="toc-Translating-the-website-1" href="#translating-the-website">6.4 Translating the website</a></li>
  </ul></li>
  <li><a name="toc-LSR-work-1" href="#lsr-work">7. LSR work</a>
  <ul class="toc">
    <li><a name="toc-Introduction-to-LSR-1" href="#introduction-to-lsr">7.1 Introduction to LSR</a></li>
    <li><a name="toc-Adding-and-editing-snippets-1" href="#adding-and-editing-snippets">7.2 Adding and editing snippets</a></li>
    <li><a name="toc-Approving-snippets-1" href="#approving-snippets">7.3 Approving snippets</a></li>
    <li><a name="toc-LSR-to-Git-1" href="#lsr-to-git">7.4 LSR to Git</a></li>
    <li><a name="toc-Fixing-snippets-in-LilyPond-sources-1" href="#fixing-snippets-in-lilypond-sources">7.5 Fixing snippets in LilyPond sources</a></li>
    <li><a name="toc-Renaming-a-snippet-1" href="#renaming-a-snippet">7.6 Renaming a snippet</a></li>
    <li><a name="toc-Updating-the-LSR-to-a-new-version-1" href="#updating-the-lsr-to-a-new-version">7.7 Updating the LSR to a new version</a></li>
  </ul></li>
  <li><a name="toc-Issues-1" href="#issues">8. Issues</a>
  <ul class="toc">
    <li><a name="toc-Introduction-to-issues-1" href="#introduction-to-issues">8.1 Introduction to issues</a></li>
    <li><a name="toc-Bug-Squad-overview-1" href="#bug-squad-overview">8.2 Bug Squad overview</a></li>
    <li><a name="toc-Bug-Squad-setup-1" href="#bug-squad-setup">8.3 Bug Squad setup</a></li>
    <li><a name="toc-Bug-Squad-checklists-1" href="#bug-squad-checklists">8.4 Bug Squad checklists</a></li>
    <li><a name="toc-Issue-classification-1" href="#issue-classification">8.5 Issue classification</a></li>
    <li><a name="toc-Adding-issues-to-the-tracker-1" href="#adding-issues-to-the-tracker">8.6 Adding issues to the tracker</a></li>
    <li><a name="toc-Patch-handling-1" href="#patch-handling">8.7 Patch handling</a></li>
    <li><a name="toc-Summary-of-project-status-1" href="#summary-of-project-status">8.8 Summary of project status</a></li>
  </ul></li>
  <li><a name="toc-Regression-tests-1" href="#regression-tests">9. Regression tests</a>
  <ul class="toc">
    <li><a name="toc-Introduction-to-regression-tests-1" href="#introduction-to-regression-tests">9.1 Introduction to regression tests</a></li>
    <li><a name="toc-Precompiled-regression-tests-1" href="#precompiled-regression-tests">9.2 Precompiled regression tests</a></li>
    <li><a name="toc-Compiling-regression-tests-1" href="#compiling-regression-tests">9.3 Compiling regression tests</a></li>
    <li><a name="toc-Regtest-comparison-1" href="#regtest-comparison">9.4 Regtest comparison</a></li>
    <li><a name="toc-Finding-the-cause-of-a-regression-1" href="#finding-the-cause-of-a-regression">9.5 Finding the cause of a regression</a></li>
    <li><a name="toc-Memory-and-coverage-tests-1" href="#memory-and-coverage-tests">9.6 Memory and coverage tests</a></li>
    <li><a name="toc-MusicXML-tests-1" href="#musicxml-tests">9.7 MusicXML tests</a></li>
    <li><a name="toc-Grand-Regression-Test-Checking-1" href="#grand-regression-test-checking">9.8 Grand Regression Test Checking</a></li>
  </ul></li>
  <li><a name="toc-Programming-work-1" href="#programming-work">10. Programming work</a>
  <ul class="toc">
    <li><a name="toc-Overview-of-LilyPond-architecture-1" href="#overview-of-lilypond-architecture">10.1 Overview of LilyPond architecture</a></li>
    <li><a name="toc-LilyPond-programming-languages-1" href="#lilypond-programming-languages">10.2 LilyPond programming languages</a>
    <ul class="toc">
      <li><a name="toc-C_002b_002b" href="#lilypond-programming-languages">10.2.1 C++</a></li>
      <li><a name="toc-Flex" href="#lilypond-programming-languages">10.2.2 Flex</a></li>
      <li><a name="toc-GNU-Bison" href="#lilypond-programming-languages">10.2.3 GNU Bison</a></li>
      <li><a name="toc-GNU-Make" href="#lilypond-programming-languages">10.2.4 GNU Make</a></li>
      <li><a name="toc-GUILE-or-Scheme" href="#lilypond-programming-languages">10.2.5 GUILE or Scheme</a></li>
      <li><a name="toc-MetaFont" href="#lilypond-programming-languages">10.2.6 MetaFont</a></li>
      <li><a name="toc-PostScript" href="#lilypond-programming-languages">10.2.7 PostScript</a></li>
      <li><a name="toc-Python" href="#lilypond-programming-languages">10.2.8 Python</a></li>
    </ul></li>
    <li><a name="toc-Programming-without-compiling-1" href="#programming-without-compiling">10.3 Programming without compiling</a>
    <ul class="toc">
      <li><a name="toc-Modifying-distribution-files" href="#programming-without-compiling">10.3.1 Modifying distribution files</a></li>
      <li><a name="toc-Desired-file-formatting" href="#programming-without-compiling">10.3.2 Desired file formatting</a></li>
    </ul></li>
    <li><a name="toc-Finding-functions-1" href="#finding-functions">10.4 Finding functions</a>
    <ul class="toc">
      <li><a name="toc-Using-the-ROADMAP" href="#finding-functions">10.4.1 Using the ROADMAP</a></li>
      <li><a name="toc-Using-grep-to-search" href="#finding-functions">10.4.2 Using grep to search</a></li>
      <li><a name="toc-Using-git-grep-to-search" href="#finding-functions">10.4.3 Using git grep to search</a></li>
      <li><a name="toc-Searching-on-the-git-repository-at-Savannah" href="#finding-functions">10.4.4 Searching on the git repository at Savannah</a></li>
    </ul></li>
    <li><a name="toc-Code-style-1" href="#code-style">10.5 Code style</a>
    <ul class="toc">
      <li><a name="toc-Languages-1" href="#languages">10.5.1 Languages</a></li>
      <li><a name="toc-Filenames-1" href="#filenames">10.5.2 Filenames</a></li>
      <li><a name="toc-Indentation-1" href="#indentation">10.5.3 Indentation</a></li>
      <li><a name="toc-Naming-Conventions" href="#naming-conventions">10.5.4 Naming Conventions</a></li>
      <li><a name="toc-Broken-code-1" href="#broken-code">10.5.5 Broken code</a></li>
      <li><a name="toc-Code-comments-1" href="#code-comments">10.5.6 Code comments</a></li>
      <li><a name="toc-Handling-errors-1" href="#handling-errors">10.5.7 Handling errors</a></li>
      <li><a name="toc-Localization-1" href="#localization">10.5.8 Localization</a></li>
    </ul></li>
    <li><a name="toc-Warnings_002c-Errors_002c-Progress-and-Debug-Output" href="#warnings-errors-progress-and-debug-output">10.6 Warnings, Errors, Progress and Debug Output</a>
    <ul class="toc">
      <li><a name="toc-Available-log-levels" href="#warnings-errors-progress-and-debug-output">Available log levels</a></li>
      <li><a name="toc-Functions-for-debug-and-log-output" href="#warnings-errors-progress-and-debug-output">Functions for debug and log output</a></li>
      <li><a name="toc-All-logging-functions-at-a-glance" href="#warnings-errors-progress-and-debug-output">All logging functions at a glance</a></li>
    </ul></li>
    <li><a name="toc-Debugging-LilyPond-1" href="#debugging-lilypond">10.7 Debugging LilyPond</a>
    <ul class="toc">
      <li><a name="toc-Debugging-overview-1" href="#debugging-overview">10.7.1 Debugging overview</a></li>
      <li><a name="toc-Debugging-C_002b_002b-code-1" href="#debugging-c_002b_002b-code">10.7.2 Debugging C++ code</a></li>
      <li><a name="toc-Debugging-Scheme-code-1" href="#debugging-scheme-code">10.7.3 Debugging Scheme code</a></li>
    </ul></li>
    <li><a name="toc-Tracing-object-relationships-1" href="#tracing-object-relationships">10.8 Tracing object relationships</a></li>
    <li><a name="toc-Adding-or-modifying-features-1" href="#adding-or-modifying-features">10.9 Adding or modifying features</a>
    <ul class="toc">
      <li><a name="toc-Write-the-code-1" href="#write-the-code">10.9.1 Write the code</a></li>
      <li><a name="toc-Write-regression-tests-1" href="#write-regression-tests">10.9.2 Write regression tests</a></li>
      <li><a name="toc-Write-convert_002dly-rule-1" href="#write-convert_002dly-rule">10.9.3 Write convert-ly rule</a></li>
      <li><a name="toc-Automatically-update-documentation-1" href="#automatically-update-documentation">10.9.4 Automatically update documentation</a></li>
      <li><a name="toc-Manually-update-documentation-1" href="#manually-update-documentation">10.9.5 Manually update documentation</a></li>
      <li><a name="toc-Edit-changes_002etely-1" href="#edit-changes_002etely">10.9.6 Edit changes.tely</a></li>
      <li><a name="toc-Verify-successful-build-1" href="#verify-successful-build">10.9.7 Verify successful build</a></li>
      <li><a name="toc-Verify-regression-tests-1" href="#verify-regression-tests">10.9.8 Verify regression tests</a></li>
      <li><a name="toc-Post-patch-for-comments-1" href="#post-patch-for-comments">10.9.9 Post patch for comments</a></li>
      <li><a name="toc-Push-patch-1" href="#push-patch">10.9.10 Push patch</a></li>
      <li><a name="toc-Closing-the-issues-1" href="#closing-the-issues">10.9.11 Closing the issues</a></li>
    </ul></li>
    <li><a name="toc-Iterator-tutorial-1" href="#iterator-tutorial">10.10 Iterator tutorial</a></li>
    <li><a name="toc-Engraver-tutorial-1" href="#engraver-tutorial">10.11 Engraver tutorial</a>
    <ul class="toc">
      <li><a name="toc-Useful-methods-for-information-processing-1" href="#useful-methods-for-information-processing">10.11.1 Useful methods for information processing</a></li>
      <li><a name="toc-Translation-process-1" href="#translation-process">10.11.2 Translation process</a></li>
      <li><a name="toc-Preventing-garbage-collection-for-SCM-member-variables-1" href="#preventing-garbage-collection-for-scm-member-variables">10.11.3 Preventing garbage collection for SCM member variables</a></li>
      <li><a name="toc-Listening-to-music-events-1" href="#listening-to-music-events">10.11.4 Listening to music events</a></li>
      <li><a name="toc-Acknowledging-grobs-1" href="#acknowledging-grobs">10.11.5 Acknowledging grobs</a></li>
      <li><a name="toc-Engraver-declaration_002fdocumentation-1" href="#engraver-declaration_002fdocumentation">10.11.6 Engraver declaration/documentation</a></li>
    </ul></li>
    <li><a name="toc-Callback-tutorial-1" href="#callback-tutorial">10.12 Callback tutorial</a></li>
    <li><a name="toc-Understanding-pure-properties-1" href="#understanding-pure-properties">10.13 Understanding pure properties</a>
    <ul class="toc">
      <li><a name="toc-Purity-in-LilyPond-1" href="#purity-in-lilypond">10.13.1 Purity in LilyPond</a></li>
      <li><a name="toc-Writing-a-pure-function-1" href="#writing-a-pure-function">10.13.2 Writing a pure function</a></li>
      <li><a name="toc-How-purity-is-defined-and-stored-1" href="#how-purity-is-defined-and-stored">10.13.3 How purity is defined and stored</a></li>
      <li><a name="toc-Where-purity-is-used-1" href="#where-purity-is-used">10.13.4 Where purity is used</a></li>
      <li><a name="toc-Case-studies-1" href="#case-studies">10.13.5 Case studies</a></li>
      <li><a name="toc-Debugging-tips-1" href="#debugging-tips">10.13.6 Debugging tips</a></li>
    </ul></li>
    <li><a name="toc-LilyPond-scoping-1" href="#lilypond-scoping">10.14 LilyPond scoping</a></li>
    <li><a name="toc-Scheme_002d_003eC-interface-1" href="#scheme_002d_003ec-interface">10.15 Scheme-&gt;C interface</a>
    <ul class="toc">
      <li><a name="toc-Comparison-1" href="#comparison">10.15.1 Comparison</a></li>
      <li><a name="toc-Conversion-1" href="#conversion">10.15.2 Conversion</a></li>
    </ul></li>
    <li><a name="toc-LilyPond-miscellany-1" href="#lilypond-miscellany">10.16 LilyPond miscellany</a>
    <ul class="toc">
      <li><a name="toc-Spacing-algorithms-1" href="#spacing-algorithms">10.16.1 Spacing algorithms</a></li>
      <li><a name="toc-Info-from-Han_002dWen-email-1" href="#info-from-han_002dwen-email">10.16.2 Info from Han-Wen email</a></li>
      <li><a name="toc-Music-functions-and-GUILE-debugging-1" href="#music-functions-and-guile-debugging">10.16.3 Music functions and GUILE debugging</a></li>
      <li><a name="toc-Articulations-on-EventChord-1" href="#articulations-on-eventchord">10.16.4 Articulations on EventChord</a></li>
    </ul>
</li>
  </ul></li>
  <li><a name="toc-Release-work-1" href="#release-work">11. Release work</a>
  <ul class="toc">
    <li><a name="toc-Development-phases-1" href="#development-phases">11.1 Development phases</a></li>
    <li><a name="toc-Minor-release-checklist-1" href="#minor-release-checklist">11.2 Minor release checklist</a></li>
    <li><a name="toc-Major-release-checklist-1" href="#major-release-checklist">11.3 Major release checklist</a></li>
    <li><a name="toc-Release-extra-notes-1" href="#release-extra-notes">11.4 Release extra notes</a></li>
  </ul></li>
  <li><a name="toc-Build-system-notes-1" href="#build-system-notes">12. Build system notes</a>
  <ul class="toc">
    <li><a name="toc-Build-system-overview-1" href="#build-system-overview">12.1 Build system overview</a></li>
    <li><a name="toc-Tips-for-working-on-the-build-system-1" href="#tips-for-working-on-the-build-system">12.2 Tips for working on the build system</a></li>
    <li><a name="toc-General-build-system-notes-1" href="#general-build-system-notes">12.3 General build system notes</a>
    <ul class="toc">
      <li><a name="toc-How-stepmake-works-1" href="#how-stepmake-works">12.3.1 How stepmake works</a></li>
    </ul></li>
    <li><a name="toc-Doc-build-1" href="#doc-build">12.4 Doc build</a>
    <ul class="toc">
      <li><a name="toc-The-function-of-make-doc-1" href="#the-function-of-make-doc">12.4.1 The function of make doc</a></li>
      <li><a name="toc-Building-a-bibliography-1" href="#building-a-bibliography">12.4.2 Building a bibliography</a></li>
    </ul></li>
    <li><a name="toc-Website-build-1" href="#website-build">12.5 Website build</a></li>
    <li><a name="toc-Building-an-Ubuntu-distro-1" href="#building-an-ubuntu-distro">12.6 Building an Ubuntu distro</a></li>
    <li><a name="toc-Building-GUB-1" href="#building-gub">12.7 Building GUB</a></li>
  </ul></li>
  <li><a name="toc-Modifying-the-feta-font-1" href="#modifying-the-feta-font">13. Modifying the feta font</a>
  <ul class="toc">
    <li><a name="toc-Overview-of-the-feta-font-1" href="#overview-of-the-feta-font">13.1 Overview of the feta font</a></li>
    <li><a name="toc-Font-creation-tools-1" href="#font-creation-tools">13.2 Font creation tools</a></li>
    <li><a name="toc-Adding-a-new-font-section-1" href="#adding-a-new-font-section">13.3 Adding a new font section</a></li>
    <li><a name="toc-Adding-a-new-glyph-1" href="#adding-a-new-glyph">13.4 Adding a new glyph</a></li>
    <li><a name="toc-Building-the-changed-font-1" href="#building-the-changed-font">13.5 Building the changed font</a></li>
    <li><a name="toc-METAFONT-formatting-rules-1" href="#metafont-formatting-rules">13.6 METAFONT formatting rules</a></li>
  </ul></li>
  <li><a name="toc-Administrative-policies-1" href="#administrative-policies">14. Administrative policies</a>
  <ul class="toc">
    <li><a name="toc-Meta_002dpolicy-for-this-document-1" href="#meta_002dpolicy-for-this-document">14.1 Meta-policy for this document</a></li>
    <li><a name="toc-Environment-variables-1" href="#environment-variables">14.2 Environment variables</a></li>
    <li><a name="toc-Meisters-1" href="#meisters">14.3 Meisters</a></li>
    <li><a name="toc-Patchy-1" href="#patchy">14.4 Patchy</a></li>
    <li><a name="toc-Administrative-mailing-list-1" href="#administrative-mailing-list">14.5 Administrative mailing list</a></li>
    <li><a name="toc-Grand-Organization-Project-_0028GOP_0029-1" href="#grand-organization-project-_0028gop_0029">14.6 Grand Organization Project (GOP)</a>
    <ul class="toc">
      <li><a name="toc-Motivation-1" href="#motivation">14.6.1 Motivation</a></li>
      <li><a name="toc-Ongoing-jobs-1" href="#ongoing-jobs">14.6.2 Ongoing jobs</a></li>
      <li><a name="toc-Policy-decisions-1" href="#policy-decisions">14.6.3 Policy decisions</a></li>
      <li><a name="toc-Policy-decisions-_0028finished_0029-1" href="#policy-decisions-_0028finished_0029">14.6.4 Policy decisions (finished)</a>
      <ul class="toc">
        <li><a name="toc-GOP_002dPROP-1-_002d-python-formatting-1" href="#gop_002dprop-1-_002d-python-formatting">14.6.4.1 GOP-PROP 1 - python formatting</a></li>
        <li><a name="toc-GOP_002dPROP-2-_002d-mentors-and-frogs-1" href="#gop_002dprop-2-_002d-mentors-and-frogs">14.6.4.2 GOP-PROP 2 - mentors and frogs</a></li>
        <li><a name="toc-GOP_002dPROP-3-_002d-C_002b_002b-formatting-1" href="#gop_002dprop-3-_002d-c_002b_002b-formatting">14.6.4.3 GOP-PROP 3 - C++ formatting</a></li>
        <li><a name="toc-GOP_002dPROP-4-_002d-lessons-from-2_002e14-1" href="#gop_002dprop-4-_002d-lessons-from-2_002e14">14.6.4.4 GOP-PROP 4 - lessons from 2.14</a></li>
        <li><a name="toc-GOP_002dPROP-5-_002d-build-system-output-_0028not-accepted_0029-1" href="#gop_002dprop-5-_002d-build-system-output-_0028not-accepted_0029">14.6.4.5 GOP-PROP 5 - build system output (not accepted)</a></li>
        <li><a name="toc-GOP_002dPROP-6-_002d-private-mailing-list" href="#gop_002dprop-6-_002d-private-mailing-lists">14.6.4.6 GOP-PROP 6 - private mailing list</a></li>
        <li><a name="toc-GOP_002dPROP-7-_002d-developers-as-resources-1" href="#gop_002dprop-7-_002d-developers-as-resources">14.6.4.7 GOP-PROP 7 - developers as resources</a></li>
        <li><a name="toc-GOP_002dPROP-8-_002d-issue-priorities-1" href="#gop_002dprop-8-_002d-issue-priorities">14.6.4.8 GOP-PROP 8 - issue priorities</a></li>
        <li><a name="toc-GOP_002dPROP-9-_002d-behavior-of-make-doc-1" href="#gop_002dprop-9-_002d-behavior-of-make-doc">14.6.4.9 GOP-PROP 9 - behavior of make doc</a></li>
      </ul>
</li>
    </ul></li>
    <li><a name="toc-Grand-LilyPond-Input-Syntax-Standardization-_0028GLISS_0029-1" href="#grand-lilypond-input-syntax-standardization-_0028gliss_0029">14.7 Grand LilyPond Input Syntax Standardization (GLISS)</a>
    <ul class="toc">
      <li><a name="toc-Specific-GLISS-issues-1" href="#specific-gliss-issues">14.7.1 Specific GLISS issues</a></li>
    </ul></li>
    <li><a name="toc-Unsorted-policies-1" href="#unsorted-policies">14.8 Unsorted policies</a></li>
  </ul></li>
  <li><a name="toc-GNU-Free-Documentation-License-1" href="#gnu-free-documentation-license">A. GNU Free Documentation License</a></li>
</ul>
</div>
<hr size="1">
<a name="SEC_About"></a>
<table class="nav_table">
<tr><td valign="middle" align="center" colspan="3">[<a href="#index" title="Cover (top) of document" rel="start">Top</a>][<a href="#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][Index][<a href="#SEC_About" title="About (help)" rel="help"> ? </a>]</td></tr></table>
<h1>About This Document</h1>
<p>
  This document was generated by <em>Build Daemon user</em> on <em>January 1, 2014</em> using <a href="http://www.nongnu.org/texi2html/"><em>texi2html 1.82</em></a>.
</p>
<p>
  The buttons in the navigation panels have the following meaning:
</p>
<table border="1">
  <tr>
    <th> Button </th>
    <th> Name </th>
    <th> Go to </th>
    <th> From 1.2.3 go to</th>
  </tr>
  <tr>
    <td align="center"> [] </td>
    <td align="center"></td>
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td align="center"> [ &lt;&lt; ] </td>
    <td align="center">FastBack</td>
    <td>Beginning of this chapter or previous chapter</td>
    <td>1</td>
  </tr>
  <tr>
    <td align="center"> [] </td>
    <td align="center"></td>
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td align="center"> [Top] </td>
    <td align="center">Top</td>
    <td>Cover (top) of document</td>
    <td> &nbsp; </td>
  </tr>
  <tr>
    <td align="center"> [Contents] </td>
    <td align="center">Contents</td>
    <td>Table of contents</td>
    <td> &nbsp; </td>
  </tr>
  <tr>
    <td align="center"> [Index] </td>
    <td align="center">Index</td>
    <td>Index</td>
    <td> &nbsp; </td>
  </tr>
  <tr>
    <td align="center"> [ ? ] </td>
    <td align="center">About</td>
    <td>About (help)</td>
    <td> &nbsp; </td>
  </tr>
  <tr>
    <td align="center"> [] </td>
    <td align="center"></td>
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td align="center"> [ &gt;&gt; ] </td>
    <td align="center">FastForward</td>
    <td>Next chapter</td>
    <td>2</td>
  </tr>
  <tr>
    <td align="center"> [] </td>
    <td align="center"></td>
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td align="center"> [] </td>
    <td align="center"></td>
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td align="center"> [ &lt; ] </td>
    <td align="center">Back</td>
    <td>Previous section in reading order</td>
    <td>1.2.2</td>
  </tr>
  <tr>
    <td align="center"> [] </td>
    <td align="center"></td>
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td align="center"> [ Up ] </td>
    <td align="center">Up</td>
    <td>Up section</td>
    <td>1.2</td>
  </tr>
  <tr>
    <td align="center"> [] </td>
    <td align="center"></td>
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td align="center"> [ &gt; ] </td>
    <td align="center">Forward</td>
    <td>Next section in reading order</td>
    <td>1.2.4</td>
  </tr>
</table>

<p>
  where the <strong> Example </strong> assumes that the current position is at <strong> Subsubsection One-Two-Three </strong> of a document of the following structure:
</p>

<ul>
  <li> 1. Section One
    <ul>
      <li>1.1 Subsection One-One
        <ul>
          <li>...</li>
        </ul>
      </li>
      <li>1.2 Subsection One-Two
        <ul>
          <li>1.2.1 Subsubsection One-Two-One</li>
          <li>1.2.2 Subsubsection One-Two-Two</li>
          <li>1.2.3 Subsubsection One-Two-Three &nbsp; &nbsp;
            <strong>&lt;== Current Position </strong></li>
          <li>1.2.4 Subsubsection One-Two-Four</li>
        </ul>
      </li>
      <li>1.3 Subsection One-Three
        <ul>
          <li>...</li>
        </ul>
      </li>
      <li>1.4 Subsection One-Four</li>
    </ul>
  </li>
</ul>

<hr size="1">
<!-- footer_tag -->
<div class="footer">
<!-- This footer was autogenerated by /build/buildd/lilypond-2.16.2/scripts/build/out/www_post -->
<p class="footer_version">
This page is for LilyPond-2.16.2 (stable-branch).
</p>
<p class="footer_report">
We welcome your aid; please <a href="http://lilypond.org/help-us.html">help us</a> by reporting errors to our <a href="http://post.gmane.org/post.php?group=gmane.comp.gnu.lilypond.bugs">bug list</a>.
</p>
</div>


<!-- FOOTER -->

<!-- end div#main here -->
</div>



<div id="tocframe">
<p class="toc_uplink"><a href="../Documentation/web/manuals.html"
         title="Documentation Index">&lt;&lt; Back to Documentation Index</a></p>
<h4 class="toc_header"> <a href="#index" title="Start of the manual">LilyPond &mdash; Contributor&rsquo;s Guide</a></h4>
<div class="contents">
<ul class="toc">
  <li class=""><a name="toc-Introduction-to-contributing-1" href="contributor-big-page.html#introduction-to-contributing">1. Introduction to contributing</a>
  <ul class="toc">
    <li class=""><a name="toc-Help-us-1" href="contributor-big-page.html#help-us">1.1 Help us</a>    </li>
    <li class=""><a name="toc-Overview-of-work-flow-1" href="contributor-big-page.html#overview-of-work-flow">1.2 Overview of work flow</a>    </li>
    <li class=""><a name="toc-Summary-for-experienced-developers-1" href="contributor-big-page.html#summary-for-experienced-developers">1.3 Summary for experienced developers</a>    </li>
    <li class=""><a name="toc-Mentors-1" href="contributor-big-page.html#mentors">1.4 Mentors</a>    </li>
  </ul>
  </li>
  <li class=""><a name="toc-Quick-start-1" href="contributor-big-page.html#quick-start">2. Quick start</a>
  <ul class="toc">
    <li class=""><a name="toc-LilyDev-1" href="contributor-big-page.html#lilydev">2.1 LilyDev</a>    </li>
    <li class=""><a name="toc-lily_002dgit-1" href="contributor-big-page.html#lily_002dgit">2.2 lily-git</a>    </li>
    <li class=""><a name="toc-Compiling-with-LilyDev-1" href="contributor-big-page.html#compiling-with-lilydev">2.3 Compiling with LilyDev</a>    </li>
    <li class=""><a name="toc-Now-start-work_0021-1" href="contributor-big-page.html#now-start-work_0021">2.4 Now start work!</a>    </li>
  </ul>
  </li>
  <li class=""><a name="toc-Working-with-source-code-1" href="contributor-big-page.html#working-with-source-code">3. Working with source code</a>
  <ul class="toc">
    <li class=""><a name="toc-Manually-installing-lily_002dgit_002etcl-1" href="contributor-big-page.html#manually-installing-lily_002dgit_002etcl">3.1 Manually installing lily-git.tcl</a>    </li>
    <li class=""><a name="toc-Starting-with-Git-1" href="contributor-big-page.html#starting-with-git">3.2 Starting with Git</a>    </li>
    <li class=""><a name="toc-Basic-Git-procedures-1" href="contributor-big-page.html#basic-git-procedures">3.3 Basic Git procedures</a>    </li>
    <li class=""><a name="toc-Advanced-Git-procedures-1" href="contributor-big-page.html#advanced-git-procedures">3.4 Advanced Git procedures</a>    </li>
    <li class=""><a name="toc-Git-on-Windows-1" href="contributor-big-page.html#git-on-windows">3.5 Git on Windows</a>    </li>
    <li class=""><a name="toc-Repository-directory-structure-1" href="contributor-big-page.html#repository-directory-structure">3.6 Repository directory structure</a>    </li>
    <li class=""><a name="toc-Other-Git-documentation-1" href="contributor-big-page.html#other-git-documentation">3.7 Other Git documentation</a>    </li>
  </ul>
  </li>
  <li class=""><a name="toc-Compiling-1" href="contributor-big-page.html#compiling">4. Compiling</a>
  <ul class="toc">
    <li class=""><a name="toc-Overview-of-compiling-1" href="contributor-big-page.html#overview-of-compiling">4.1 Overview of compiling</a>    </li>
    <li class=""><a name="toc-Requirements-1" href="contributor-big-page.html#requirements">4.2 Requirements</a>    </li>
    <li class=""><a name="toc-Getting-the-source-code-1" href="contributor-big-page.html#getting-the-source-code">4.3 Getting the source code</a>    </li>
    <li class=""><a name="toc-Configuring-make-1" href="contributor-big-page.html#configuring-make">4.4 Configuring <code>make</code></a>    </li>
    <li class=""><a name="toc-Compiling-LilyPond-1" href="contributor-big-page.html#compiling-lilypond">4.5 Compiling LilyPond</a>    </li>
    <li class=""><a name="toc-Post_002dcompilation-options-1" href="contributor-big-page.html#post_002dcompilation-options">4.6 Post-compilation options</a>    </li>
    <li class=""><a name="toc-Problems-1" href="contributor-big-page.html#problems">4.7 Problems</a>    </li>
    <li class=""><a name="toc-Concurrent-stable-and-development-versions-1" href="contributor-big-page.html#concurrent-stable-and-development-versions">4.8 Concurrent stable and development versions</a>    </li>
    <li class=""><a name="toc-Build-system-1" href="contributor-big-page.html#build-system">4.9 Build system</a>    </li>
  </ul>
  </li>
  <li class=""><a name="toc-Documentation-work-1" href="contributor-big-page.html#documentation-work">5. Documentation work</a>
  <ul class="toc">
    <li class=""><a name="toc-Introduction-to-documentation-work-1" href="contributor-big-page.html#introduction-to-documentation-work">5.1 Introduction to documentation work</a>    </li>
    <li class=""><a name="toc-Documentation-suggestions-1" href="contributor-big-page.html#documentation-suggestions">5.2 Documentation suggestions</a>    </li>
    <li class=""><a name="toc-Texinfo-introduction-and-usage-policy-1" href="contributor-big-page.html#texinfo-introduction-and-usage-policy">5.3 Texinfo introduction and usage policy</a>    </li>
    <li class=""><a name="toc-Documentation-policy-1" href="contributor-big-page.html#documentation-policy">5.4 Documentation policy</a>    </li>
    <li class=""><a name="toc-Tips-for-writing-docs-1" href="contributor-big-page.html#tips-for-writing-docs">5.5 Tips for writing docs</a>    </li>
    <li class=""><a name="toc-Scripts-to-ease-doc-work-1" href="contributor-big-page.html#scripts-to-ease-doc-work">5.6 Scripts to ease doc work</a>    </li>
    <li class=""><a name="toc-Docstrings-in-scheme-1" href="contributor-big-page.html#docstrings-in-scheme">5.7 Docstrings in scheme</a>    </li>
    <li class=""><a name="toc-Translating-the-documentation-1" href="contributor-big-page.html#translating-the-documentation">5.8 Translating the documentation</a>    </li>
  </ul>
  </li>
  <li class=""><a name="toc-Website-work-1" href="contributor-big-page.html#website-work">6. Website work</a>
  <ul class="toc">
    <li class=""><a name="toc-Introduction-to-website-work-1" href="contributor-big-page.html#introduction-to-website-work">6.1 Introduction to website work</a>    </li>
    <li class=""><a name="toc-Uploading-and-security-1" href="contributor-big-page.html#uploading-and-security">6.2 Uploading and security</a>    </li>
    <li class=""><a name="toc-Debugging-website-and-docs-locally-1" href="contributor-big-page.html#debugging-website-and-docs-locally">6.3 Debugging website and docs locally</a>    </li>
    <li class=""><a name="toc-Translating-the-website-1" href="contributor-big-page.html#translating-the-website">6.4 Translating the website</a>    </li>
  </ul>
  </li>
  <li class=""><a name="toc-LSR-work-1" href="contributor-big-page.html#lsr-work">7. LSR work</a>
  <ul class="toc">
    <li class=""><a name="toc-Introduction-to-LSR-1" href="contributor-big-page.html#introduction-to-lsr">7.1 Introduction to LSR</a>    </li>
    <li class=""><a name="toc-Adding-and-editing-snippets-1" href="contributor-big-page.html#adding-and-editing-snippets">7.2 Adding and editing snippets</a>    </li>
    <li class=""><a name="toc-Approving-snippets-1" href="contributor-big-page.html#approving-snippets">7.3 Approving snippets</a>    </li>
    <li class=""><a name="toc-LSR-to-Git-1" href="contributor-big-page.html#lsr-to-git">7.4 LSR to Git</a>    </li>
    <li class=""><a name="toc-Fixing-snippets-in-LilyPond-sources-1" href="contributor-big-page.html#fixing-snippets-in-lilypond-sources">7.5 Fixing snippets in LilyPond sources</a>    </li>
    <li class=""><a name="toc-Renaming-a-snippet-1" href="contributor-big-page.html#renaming-a-snippet">7.6 Renaming a snippet</a>    </li>
    <li class=""><a name="toc-Updating-the-LSR-to-a-new-version-1" href="contributor-big-page.html#updating-the-lsr-to-a-new-version">7.7 Updating the LSR to a new version</a>    </li>
  </ul>
  </li>
  <li class=""><a name="toc-Issues-1" href="contributor-big-page.html#issues">8. Issues</a>
  <ul class="toc">
    <li class=""><a name="toc-Introduction-to-issues-1" href="contributor-big-page.html#introduction-to-issues">8.1 Introduction to issues</a>    </li>
    <li class=""><a name="toc-Bug-Squad-overview-1" href="contributor-big-page.html#bug-squad-overview">8.2 Bug Squad overview</a>    </li>
    <li class=""><a name="toc-Bug-Squad-setup-1" href="contributor-big-page.html#bug-squad-setup">8.3 Bug Squad setup</a>    </li>
    <li class=""><a name="toc-Bug-Squad-checklists-1" href="contributor-big-page.html#bug-squad-checklists">8.4 Bug Squad checklists</a>    </li>
    <li class=""><a name="toc-Issue-classification-1" href="contributor-big-page.html#issue-classification">8.5 Issue classification</a>    </li>
    <li class=""><a name="toc-Adding-issues-to-the-tracker-1" href="contributor-big-page.html#adding-issues-to-the-tracker">8.6 Adding issues to the tracker</a>    </li>
    <li class=""><a name="toc-Patch-handling-1" href="contributor-big-page.html#patch-handling">8.7 Patch handling</a>    </li>
    <li class=""><a name="toc-Summary-of-project-status-1" href="contributor-big-page.html#summary-of-project-status">8.8 Summary of project status</a>    </li>
  </ul>
  </li>
  <li class=""><a name="toc-Regression-tests-1" href="contributor-big-page.html#regression-tests">9. Regression tests</a>
  <ul class="toc">
    <li class=""><a name="toc-Introduction-to-regression-tests-1" href="contributor-big-page.html#introduction-to-regression-tests">9.1 Introduction to regression tests</a>    </li>
    <li class=""><a name="toc-Precompiled-regression-tests-1" href="contributor-big-page.html#precompiled-regression-tests">9.2 Precompiled regression tests</a>    </li>
    <li class=""><a name="toc-Compiling-regression-tests-1" href="contributor-big-page.html#compiling-regression-tests">9.3 Compiling regression tests</a>    </li>
    <li class=""><a name="toc-Regtest-comparison-1" href="contributor-big-page.html#regtest-comparison">9.4 Regtest comparison</a>    </li>
    <li class=""><a name="toc-Finding-the-cause-of-a-regression-1" href="contributor-big-page.html#finding-the-cause-of-a-regression">9.5 Finding the cause of a regression</a>    </li>
    <li class=""><a name="toc-Memory-and-coverage-tests-1" href="contributor-big-page.html#memory-and-coverage-tests">9.6 Memory and coverage tests</a>    </li>
    <li class=""><a name="toc-MusicXML-tests-1" href="contributor-big-page.html#musicxml-tests">9.7 MusicXML tests</a>    </li>
    <li class=""><a name="toc-Grand-Regression-Test-Checking-1" href="contributor-big-page.html#grand-regression-test-checking">9.8 Grand Regression Test Checking</a>    </li>
  </ul>
  </li>
  <li class=""><a name="toc-Programming-work-1" href="contributor-big-page.html#programming-work">10. Programming work</a>
  <ul class="toc">
    <li class=""><a name="toc-Overview-of-LilyPond-architecture-1" href="contributor-big-page.html#overview-of-lilypond-architecture">10.1 Overview of LilyPond architecture</a>    </li>
    <li class=""><a name="toc-LilyPond-programming-languages-1" href="contributor-big-page.html#lilypond-programming-languages">10.2 LilyPond programming languages</a>    </li>
    <li class=""><a name="toc-Programming-without-compiling-1" href="contributor-big-page.html#programming-without-compiling">10.3 Programming without compiling</a>    </li>
    <li class=""><a name="toc-Finding-functions-1" href="contributor-big-page.html#finding-functions">10.4 Finding functions</a>    </li>
    <li class=""><a name="toc-Code-style-1" href="contributor-big-page.html#code-style">10.5 Code style</a>    </li>
    <li class=""><a name="toc-Warnings_002c-Errors_002c-Progress-and-Debug-Output" href="contributor-big-page.html#warnings-errors-progress-and-debug-output">10.6 Warnings, Errors, Progress and Debug Output</a>    </li>
    <li class=""><a name="toc-Debugging-LilyPond-1" href="contributor-big-page.html#debugging-lilypond">10.7 Debugging LilyPond</a>    </li>
    <li class=""><a name="toc-Tracing-object-relationships-1" href="contributor-big-page.html#tracing-object-relationships">10.8 Tracing object relationships</a>    </li>
    <li class=""><a name="toc-Adding-or-modifying-features-1" href="contributor-big-page.html#adding-or-modifying-features">10.9 Adding or modifying features</a>    </li>
    <li class=""><a name="toc-Iterator-tutorial-1" href="contributor-big-page.html#iterator-tutorial">10.10 Iterator tutorial</a>    </li>
    <li class=""><a name="toc-Engraver-tutorial-1" href="contributor-big-page.html#engraver-tutorial">10.11 Engraver tutorial</a>    </li>
    <li class=""><a name="toc-Callback-tutorial-1" href="contributor-big-page.html#callback-tutorial">10.12 Callback tutorial</a>    </li>
    <li class=""><a name="toc-Understanding-pure-properties-1" href="contributor-big-page.html#understanding-pure-properties">10.13 Understanding pure properties</a>    </li>
    <li class=""><a name="toc-LilyPond-scoping-1" href="contributor-big-page.html#lilypond-scoping">10.14 LilyPond scoping</a>    </li>
    <li class=""><a name="toc-Scheme_002d_003eC-interface-1" href="contributor-big-page.html#scheme_002d_003ec-interface">10.15 Scheme-&gt;C interface</a>    </li>
    <li class=""><a name="toc-LilyPond-miscellany-1" href="contributor-big-page.html#lilypond-miscellany">10.16 LilyPond miscellany</a>    </li>
  </ul>
  </li>
  <li class=""><a name="toc-Release-work-1" href="contributor-big-page.html#release-work">11. Release work</a>
  <ul class="toc">
    <li class=""><a name="toc-Development-phases-1" href="contributor-big-page.html#development-phases">11.1 Development phases</a>    </li>
    <li class=""><a name="toc-Minor-release-checklist-1" href="contributor-big-page.html#minor-release-checklist">11.2 Minor release checklist</a>    </li>
    <li class=""><a name="toc-Major-release-checklist-1" href="contributor-big-page.html#major-release-checklist">11.3 Major release checklist</a>    </li>
    <li class=""><a name="toc-Release-extra-notes-1" href="contributor-big-page.html#release-extra-notes">11.4 Release extra notes</a>    </li>
  </ul>
  </li>
  <li class=""><a name="toc-Build-system-notes-1" href="contributor-big-page.html#build-system-notes">12. Build system notes</a>
  <ul class="toc">
    <li class=""><a name="toc-Build-system-overview-1" href="contributor-big-page.html#build-system-overview">12.1 Build system overview</a>    </li>
    <li class=""><a name="toc-Tips-for-working-on-the-build-system-1" href="contributor-big-page.html#tips-for-working-on-the-build-system">12.2 Tips for working on the build system</a>    </li>
    <li class=""><a name="toc-General-build-system-notes-1" href="contributor-big-page.html#general-build-system-notes">12.3 General build system notes</a>    </li>
    <li class=""><a name="toc-Doc-build-1" href="contributor-big-page.html#doc-build">12.4 Doc build</a>    </li>
    <li class=""><a name="toc-Website-build-1" href="contributor-big-page.html#website-build">12.5 Website build</a>    </li>
    <li class=""><a name="toc-Building-an-Ubuntu-distro-1" href="contributor-big-page.html#building-an-ubuntu-distro">12.6 Building an Ubuntu distro</a>    </li>
    <li class=""><a name="toc-Building-GUB-1" href="contributor-big-page.html#building-gub">12.7 Building GUB</a>    </li>
  </ul>
  </li>
  <li class=""><a name="toc-Modifying-the-feta-font-1" href="contributor-big-page.html#modifying-the-feta-font">13. Modifying the feta font</a>
  <ul class="toc">
    <li class=""><a name="toc-Overview-of-the-feta-font-1" href="contributor-big-page.html#overview-of-the-feta-font">13.1 Overview of the feta font</a>    </li>
    <li class=""><a name="toc-Font-creation-tools-1" href="contributor-big-page.html#font-creation-tools">13.2 Font creation tools</a>    </li>
    <li class=""><a name="toc-Adding-a-new-font-section-1" href="contributor-big-page.html#adding-a-new-font-section">13.3 Adding a new font section</a>    </li>
    <li class=""><a name="toc-Adding-a-new-glyph-1" href="contributor-big-page.html#adding-a-new-glyph">13.4 Adding a new glyph</a>    </li>
    <li class=""><a name="toc-Building-the-changed-font-1" href="contributor-big-page.html#building-the-changed-font">13.5 Building the changed font</a>    </li>
    <li class=""><a name="toc-METAFONT-formatting-rules-1" href="contributor-big-page.html#metafont-formatting-rules">13.6 METAFONT formatting rules</a>    </li>
  </ul>
  </li>
  <li class=""><a name="toc-Administrative-policies-1" href="contributor-big-page.html#administrative-policies">14. Administrative policies</a>
  <ul class="toc">
    <li class=""><a name="toc-Meta_002dpolicy-for-this-document-1" href="contributor-big-page.html#meta_002dpolicy-for-this-document">14.1 Meta-policy for this document</a>    </li>
    <li class=""><a name="toc-Environment-variables-1" href="contributor-big-page.html#environment-variables">14.2 Environment variables</a>    </li>
    <li class=""><a name="toc-Meisters-1" href="contributor-big-page.html#meisters">14.3 Meisters</a>    </li>
    <li class=""><a name="toc-Patchy-1" href="contributor-big-page.html#patchy">14.4 Patchy</a>    </li>
    <li class=""><a name="toc-Administrative-mailing-list-1" href="contributor-big-page.html#administrative-mailing-list">14.5 Administrative mailing list</a>    </li>
    <li class=""><a name="toc-Grand-Organization-Project-_0028GOP_0029-1" href="contributor-big-page.html#grand-organization-project-_0028gop_0029">14.6 Grand Organization Project (GOP)</a>    </li>
    <li class=""><a name="toc-Grand-LilyPond-Input-Syntax-Standardization-_0028GLISS_0029-1" href="contributor-big-page.html#grand-lilypond-input-syntax-standardization-_0028gliss_0029">14.7 Grand LilyPond Input Syntax Standardization (GLISS)</a>    </li>
    <li class=""><a name="toc-Unsorted-policies-1" href="contributor-big-page.html#unsorted-policies">14.8 Unsorted policies</a>    </li>
  </ul>
  </li>
  <li class=""><a name="toc-GNU-Free-Documentation-License-1" href="contributor-big-page.html#gnu-free-documentation-license">A. GNU Free Documentation License</a>  </li>
<li>
<!--
we depend on an external entity here, which we cannot control.  Suppose
we go from 2.16.x to 2.17.x and put the documentation under "v2.17".
For some time, Google won't have the new location in its index, so the
search would get nothing.  It would be better to keep "v2.16" in the
search for a while and have a redirection from "v2.16" to "v2.17".
-->

<form action="http://google.com/search"
      method="get"
      name="search"
      onSubmit="search.q.value='site:lilypond.org/doc/v2.16 '
		+ search.brute_query.value"
      onMouseMove="search.q.value='site:lilypond.org/doc/v2.16 '
		   + search.brute_query.value"
      onKeyUp="search.q.value='site:lilypond.org/doc/v2.16 '
	       + search.brute_query.value">
  <input type="hidden" name="btnG" value="Google Search">
  <input type="text" name="brute_query" onfocus="this.value=''" value="Search">
  <input type="hidden" name="q" value="">
</form>
</li>
</ul>
</div>
</div>

</body>
</html>
