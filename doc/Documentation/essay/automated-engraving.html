<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- Copyright C 2002-2012 by the authors.

Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.1
or any later version published by the Free Software Foundation;
with no Invariant Sections.
A copy of the license is included in the section entitled "GNU
Free Documentation License".

 -->
<!-- Created on January 1, 2014 by texi2html 1.82
texi2html was written by: 
            Lionel Cons <Lionel.Cons@cern.ch> (original author)
            Karl Berry  <karl@freefriends.org>
            Olaf Bachmann <obachman@mathematik.uni-kl.de>
            and many others.
Maintained by: Many creative people.
Send bugs and suggestions to <texi2html-bug@nongnu.org>
-->
<head>
<title>Essay on automated music engraving: 1.3 Automated engraving</title>

<meta name="description" content="Essay on automated music engraving: 1.3 Automated engraving">
<meta name="keywords" content="Essay on automated music engraving: 1.3 Automated engraving">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="texi2html 1.82">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link href="index.html#index" rel="start" title="LilyPond &mdash; Essay on automated music engraving">
<link href="lilypond-index.html#lilypond-index" rel="index" title="B. LilyPond index">
<link href="index_toc.html#SEC_Contents" rel="contents" title="Table of Contents">
<link href="index_abt.html#SEC_About" rel="help" title="About This Document">
<link href="music-engraving.html#music-engraving" rel="up" title="1. Music engraving">
<link href="lilypond-index.html#lilypond-index" rel="next" title="B. LilyPond index">
<link href="engraving-details.html#engraving-details" rel="previous" title="1.2 Engraving details">
<link rel="stylesheet" type="text/css" title="Default style" href="../../Documentation/css/lilypond-manuals.css">
<!--[if lte IE 7]>
<link href="../../Documentation/css/lilypond-ie-fixes.css" rel="stylesheet" type="text/css">
<![endif]-->


</head>

<body lang="en" bgcolor="#FFFFFF" text="#000000" link="#0000FF" vlink="#800080" alink="#FF0000">


<div id="main">
<a name="Automated-engraving"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="music-engraving.html" title="Beginning of this chapter or previous chapter"> &lt;&lt; Music engraving&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="index.html" title="Cover (top) of document" rel="start">Top</a>][<a href="index_toc.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="lilypond-index.html" title="Index" rel="index">Index</a>][<a href="index_abt.html#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="literature-list.html" title="Next chapter">&nbsp;Literature list &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="engraving-details.html#why-work-so-hard_003f" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Why work so hard?&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="music-engraving.html" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Music engraving&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#beauty-contests" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Beauty contests &gt; </a>]</td></tr></table>
<a name="automated-engraving"></a>
<h2 class="section">1.3 Automated engraving</h2>

<a name="index-engraving_002c-automated"></a>
<a name="index-automated-engraving"></a>

<p>Here we describe what is required to create software that can mimic the
layout of engraved scores: a method of describing good layouts to the
computer and a lot of detailed comparisons with real engravings.
</p>
<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#beauty-contests" accesskey="1">Beauty contests</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#improvement-by-benchmarking" accesskey="2">Improvement by benchmarking</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#getting-things-right" accesskey="3">Getting things right</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
</table>

<hr size="6">
<a name="Beauty-contests"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="music-engraving.html" title="Beginning of this chapter or previous chapter"> &lt;&lt; Music engraving&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="index.html" title="Cover (top) of document" rel="start">Top</a>][<a href="index_toc.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="lilypond-index.html" title="Index" rel="index">Index</a>][<a href="index_abt.html#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="literature-list.html" title="Next chapter">&nbsp;Literature list &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#automated-engraving" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Automated engraving&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#automated-engraving" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Automated engraving&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#improvement-by-benchmarking" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Improvement by benchmarking &gt; </a>]</td></tr></table>
<a name="beauty-contests"></a>
<h3 class="unnumberedsubsec">Beauty contests</h3>

<p>How do we actually make formatting decisions?  In other words, which
of the three configurations should we choose for the following slur?
</p>
<p>
 <a href="../3e/lily-b1e70a53.ly">
  <img align="middle"
       border="0"
       src="../3e/lily-b1e70a53.png"
       alt="[image of music]">
 </a>
</p>



<p>There are a few books on the art of music engraving
available.  Unfortunately, they contain simple rules of thumb and some
examples.  Such rules can be instructive, but they are a far cry from
an algorithm that we could readily implement in a computer.  Following
the instructions from literature leads to algorithms with lots of
hand-coded exceptions.  Doing all this case analysis is a lot of work,
and often not all cases are covered completely:
</p>
<blockquote><img src="../pictures/ross-beam-scan.jpg" alt=".jpg">
</blockquote>

<p>(Image source: Ted Ross, <em>The Art of Music Engraving</em>)
</p>
<p>Rather than trying to write detailed layout rules for every possible
scenario, we only have to describe the objectives well enough that
LilyPond can judge the attractiveness of several alternatives.  Then,
for each possible configuration we compute an ugliness score and we
choose the least ugly configuration.
</p>
<p>For example, here are three possible slur configurations, and LilyPond
has given each one a score in &lsquo;ugly points&rsquo;.  The first example gets
15.39 points for grazing one of the noteheads:
</p>
<p>
 <a href="../0a/lily-4b26313d.ly">
  <img align="middle"
       border="0"
       src="../0a/lily-4b26313d.png"
       alt="[image of music]">
 </a>
</p>



<p>The
second one is nicer, but the slur doesn&rsquo;t start or end on the note heads.
It gets 1.71 points for the left side and 9.37 points for the right
side, plus another 2 points because the slur ascends while the melody
descends for a total of 13.08 ugly points:
</p>
<p>
 <a href="../6c/lily-bacfac14.ly">
  <img align="middle"
       border="0"
       src="../6c/lily-bacfac14.png"
       alt="[image of music]">
 </a>
</p>



<p>The final slur gets 10.04
points for the gap on the right and 2 points for the upward slope, but
it is the most attractive of the three configurations, so LilyPond
selects this one:
</p>
<p>
 <a href="../bb/lily-c49506a3.ly">
  <img align="middle"
       border="0"
       src="../bb/lily-c49506a3.png"
       alt="[image of music]">
 </a>
</p>



<p>This technique is quite general, and is used to make optimal decisions
for beam configurations, ties and dots in chords, line breaks, and page
breaks.  The results of these decisions can be judged by comparison to
real engravings.
</p>
<hr size="6">
<a name="Improvement-by-benchmarking"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="music-engraving.html" title="Beginning of this chapter or previous chapter"> &lt;&lt; Music engraving&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="index.html" title="Cover (top) of document" rel="start">Top</a>][<a href="index_toc.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="lilypond-index.html" title="Index" rel="index">Index</a>][<a href="index_abt.html#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="literature-list.html" title="Next chapter">&nbsp;Literature list &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#beauty-contests" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Beauty contests&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#automated-engraving" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Automated engraving&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="#getting-things-right" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Getting things right &gt; </a>]</td></tr></table>
<a name="improvement-by-benchmarking"></a>
<h3 class="unnumberedsubsec">Improvement by benchmarking</h3>

<p>LilyPond&rsquo;s output has improved gradually over time, and it continues to
improve by comparing its output to hand-engraved scores.
</p>
<p>For example, here is one line of a benchmark piece from a
hand-engraved edition (Bärenreiter BA320):
</p>
<img src="../pictures/baer-sarabande.png" alt="png">

<p>and the same quotation as engraved by a very old version of LilyPond
(version 1.4, May 2001):
</p>
<img src="../pictures/lily14-sarabande.png" alt="png">

<p>The LilyPond 1.4 output is certainly readable, but close
comparison with the hand-engraved score showed a lot of errors in the
formatting details:
</p>
<img src="../pictures/lily14-sarabande-annotated.png" alt="png">

<ul>
<li> there is too much space before the time signature
</li><li> the stems of the beamed notes are too long
</li><li> the second and fourth measures are too narrow
</li><li> the slur is awkward-looking
</li><li> the trill marks are too big
</li><li> the stems are too thin
</li></ul>

<p>(There were also two missing note heads, several missing editorial
annotations, and an incorrect pitch!)
</p>
<p>By adjusting the layout rules and font design, the output has improved
considerably.  Compare the same reference score and the output
from the current version of LilyPond (2.16.2):
</p>
<img src="../pictures/baer-sarabande.png" alt="png">

<p>
 <a href="../64/lily-9356cf70.ly">
  <img align="middle"
       border="0"
       src="../64/lily-9356cf70.png"
       alt="[image of music]">
 </a>
</p>



<p>The current output is not a clone of the reference edition, but it is
much closer to publication quality that the earlier output.
</p>
<hr size="6">
<a name="Getting-things-right"></a>
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="music-engraving.html" title="Beginning of this chapter or previous chapter"> &lt;&lt; Music engraving&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="index.html" title="Cover (top) of document" rel="start">Top</a>][<a href="index_toc.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="lilypond-index.html" title="Index" rel="index">Index</a>][<a href="index_abt.html#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="literature-list.html" title="Next chapter">&nbsp;Literature list &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#improvement-by-benchmarking" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Improvement by benchmarking&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#automated-engraving" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Automated engraving&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="building-software.html" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Building software &gt; </a>]</td></tr></table>
<a name="getting-things-right"></a>
<h3 class="unnumberedsubsec">Getting things right</h3>

<p>We can also measure LilyPond&rsquo;s ability to make music engraving decisions
automatically by comparing LilyPond&rsquo;s output to the output of a
commercial software product.  In this case we have chosen Finale 2008,
which is one of the most popular commercial score writers, particularly
in North America.  Sibelius is its major rival and appears to be
especially strong in the European market.
</p>
<p>For our comparison we selected Bach&rsquo;s Fugue in G minor from the
Well-Tempered Clavier, Book I, BWV 861, whose opening subject is
</p>
<p>
 <a href="../5a/lily-ec6edb7a.ly">
  <img align="middle"
       border="0"
       src="../5a/lily-ec6edb7a.png"
       alt="[image of music]">
 </a>
</p>




<p>We made our comparison by engraving the last seven measures of the piece
(28&ndash;34) in Finale and LilyPond.  This is the point in the piece where
the subject returns in a three-part stretto and leads into the closing
section.  In the Finale version, we have resisted the temptation to make
any adjustments to the default output because we are trying to show the
things that each software package gets right without assistance.  The
only major edits that we made were adjusting the page size to match this
essay and forcing the music onto two systems to make the comparison
easier.  By default Finale would have engraved two systems of three
measures each and a final, full-width system containing a single
measure.
</p>
<p>Many of the differences between the two engravings are visible in
measures 28&ndash;29, as shown here with Finale first and LilyPond second:
</p>
<img src="../pictures/bwv861mm28-29.png" alt="png">

<p>
 <a href="../8d/lily-780b6e15.ly">
  <img align="middle"
       border="0"
       src="../8d/lily-780b6e15.png"
       alt="[image of music]">
 </a>
</p>



<p>Some shortcomings in the unedited Finale output include:
</p><ul>
<li> Most of the beams extend too far off the staff.  A beam that points
towards the center of the staff should have a length of about one
octave, but engravers shorten this when the beam points away from the
staff in multi-voice music.  The Finale beaming can easily be improved
with their Patterson Beams plug-in, but we elected to skip that step for
this example.
</li><li> Finale doesn&rsquo;t adjust the positions of interlocking note heads,
which makes the music extremely difficult to read when the upper and
lower voices exchange positions temporarily:

<p>
 <a href="../bf/lily-96dec236.ly">
  <img align="middle"
       border="0"
       src="../bf/lily-96dec236.png"
       alt="[image of music]">
 </a>
</p>



</li><li> Finale has placed all of the rests at fixed heights on the staff.
The user is free to adjust them as needed, but the software makes no
attempt to consider the content of the other voice.  As luck would have
it, there are no true collisions between notes and rests in this example,
but that has more to do with the positions of the notes than the rest.
In other words, Bach deserves more credit for avoiding a complete
collision than Finale does.

</li></ul>

<p>This example is not intended to suggest that Finale cannot be used to
produce publication-quality output.  On the contrary, in the hands of a
skilled user it can and does, but it requires skill and time.  One of the
fundamental differences between LilyPond and commercial scorewriters is
that LilyPond hopes to reduce the amount of human intervention to an
absolute minimum, while other packages try to provide an attractive
interface in which to make these types of edits.
</p>
<p>One particularly glaring omission we found from Finale is a missing flat
in measure 33:
</p>
<blockquote><img src="../pictures/bwv861mm33-34-annotate.png" alt="png">
</blockquote>

<p>The flat symbol is required to cancel out the natural in the same
measure, but Finale misses it because it occurred in a different voice.
So in addition to running a beaming plug-in and checking the spacing on
the noteheads and rests, the user must also check each measure for
cross-voice accidentals to avoid interrupting a rehearsal over an
engraving error.
</p>
<p>If you are interested in examining these examples in more detail, the
full seven-measure excerpt can be found at the end of this essay along
with four different published engravings.  Close examination reveals that
there is some acceptable variation among the hand-engravings, but that
LilyPond compares reasonably well to that acceptable range.  There are
still some shortcomings in the LilyPond output, for example, it appears
a bit too aggressive in shortening some of the stems, so there is room
for further development and fine-tuning.
</p>
<p>Of course, typography relies on human judgment of appearance, so people
cannot be replaced completely.  However, much of the dull work can be
automated.  If LilyPond solves most of the common situations correctly,
this will be a huge improvement over existing software.  Over the course
of years, the software can be refined to do more and more things
automatically, so manual overrides are less and less necessary.  Where
manual adjustments are needed, LilyPond&rsquo;s structure has been designed
with that flexibility in mind.
</p>
<hr size="6">
<table class="nav_table">
<tr><td valign="middle" align="left" colspan="1">[<a href="music-engraving.html" title="Beginning of this chapter or previous chapter"> &lt;&lt; Music engraving&nbsp;</a>]</td><td valign="middle" align="center" colspan="3">[<a href="index.html" title="Cover (top) of document" rel="start">Top</a>][<a href="index_toc.html#SEC_Contents" title="Table of contents" rel="contents">Contents</a>][<a href="lilypond-index.html" title="Index" rel="index">Index</a>][<a href="index_abt.html#SEC_About" title="About (help)" rel="help"> ? </a>]</td><td valign="middle" align="right" colspan="1">[<a href="literature-list.html" title="Next chapter">&nbsp;Literature list &gt;&gt; </a>]</td></tr><tr><td valign="middle" align="left" colspan="2">[<a href="#improvement-by-benchmarking" title="Previous section in reading order" accesskey="p" rel="previous"> &lt; Improvement by benchmarking&nbsp;</a>]</td><td valign="middle" align="center" colspan="1">[<a href="#automated-engraving" title="Up section" accesskey="u" rel="up">&nbsp; Up :&nbsp;Automated engraving&nbsp;</a>]</td><td valign="middle" align="right" colspan="2">[<a href="building-software.html" title="Next section in reading order" accesskey="n" rel="next">&nbsp;Building software &gt; </a>]</td></tr></table>
<!-- footer_tag -->
<div class="footer">
<!-- This footer was autogenerated by /build/buildd/lilypond-2.16.2/scripts/build/out/www_post -->
<p class="footer_version">
This page is for LilyPond-2.16.2 (stable-branch).
</p>
<p class="footer_report">
We welcome your aid; please <a href="http://lilypond.org/help-us.html">help us</a> by reporting errors to our <a href="http://post.gmane.org/post.php?group=gmane.comp.gnu.lilypond.bugs">bug list</a>.
</p>
</div>


<p id="languages">
<!-- These links were autogenerated by /build/buildd/lilypond-2.16.2/scripts/build/out/www_post -->
 Other languages: <a href="automated-engraving.de.html">deutsch</a>, <a href="automated-engraving.es.html">español</a>, <a href="automated-engraving.fr.html">français</a>.
 <br>
 About <a href="http://www.lilypond.org/website/misc/browser-language">automatic language selection</a>.
</p>

<!-- FOOTER -->

<!-- end div#main here -->
</div>



<div id="tocframe">
<p class="toc_uplink"><a href="../../Documentation/web/manuals.html"
         title="Documentation Index">&lt;&lt; Back to Documentation Index</a></p>
<h4 class="toc_header"> <a href="index.html" title="Start of the manual">LilyPond &mdash; Essay on automated music engraving</a></h4>
<div class="contents">
<ul class="toc">
  <li class=" toc_current"><a name="toc-Music-engraving-1" href="music-engraving.html">1. Music engraving</a>
  <ul class="toc">
    <li class=""><a name="toc-The-LilyPond-story-1" href="the-lilypond-story.html">1.1 The LilyPond story</a>    </li>
    <li class=""><a name="toc-Engraving-details-1" href="engraving-details.html">1.2 Engraving details</a>    </li>
    <li class=" toc_current"><a name="toc-Automated-engraving-1" href="automated-engraving.html">1.3 Automated engraving</a>
    <ul class="toc">
      <li class=""><a name="toc-Beauty-contests-1" href="automated-engraving.html#beauty-contests">Beauty contests</a>      </li>
      <li class=""><a name="toc-Improvement-by-benchmarking-1" href="automated-engraving.html#improvement-by-benchmarking">Improvement by benchmarking</a>      </li>
      <li class=""><a name="toc-Getting-things-right-1" href="automated-engraving.html#getting-things-right">Getting things right</a>      </li>
    </ul>
    </li>
    <li class=""><a name="toc-Building-software-1" href="building-software.html">1.4 Building software</a>    </li>
    <li class=""><a name="toc-Putting-LilyPond-to-work-1" href="putting-lilypond-to-work.html">1.5 Putting LilyPond to work</a>    </li>
    <li class=""><a name="toc-Engraved-examples-_0028BWV-861_0029-1" href="engraved-examples-_0028bwv-861_0029.html">1.6 Engraved examples (BWV 861)</a>    </li>
  </ul>
  </li>
  <li class=""><a name="toc-Literature-list-1" href="literature-list.html">2. Literature list</a>
  <ul class="toc">
    <li class=""><a name="toc-Short-literature-list-1" href="short-literature-list.html">2.1 Short literature list</a>    </li>
    <li class=""><a name="toc-Long-literature-list-1" href="long-literature-list.html">2.2 Long literature list</a>    </li>
  </ul>
  </li>
  <li class=""><a name="toc-GNU-Free-Documentation-License-1" href="gnu-free-documentation-license.html">A. GNU Free Documentation License</a>  </li>
  <li class=""><a name="toc-LilyPond-index-1" href="lilypond-index.html">B. LilyPond index</a>  </li>
<li>
<!--
we depend on an external entity here, which we cannot control.  Suppose
we go from 2.16.x to 2.17.x and put the documentation under "v2.17".
For some time, Google won't have the new location in its index, so the
search would get nothing.  It would be better to keep "v2.16" in the
search for a while and have a redirection from "v2.16" to "v2.17".
-->

<form action="http://google.com/search"
      method="get"
      name="search"
      onSubmit="search.q.value='site:lilypond.org/doc/v2.16 '
		+ search.brute_query.value"
      onMouseMove="search.q.value='site:lilypond.org/doc/v2.16 '
		   + search.brute_query.value"
      onKeyUp="search.q.value='site:lilypond.org/doc/v2.16 '
	       + search.brute_query.value">
  <input type="hidden" name="btnG" value="Google Search">
  <input type="text" name="brute_query" onfocus="this.value=''" value="Search">
  <input type="hidden" name="q" value="">
</form>
</li>
</ul>
</div>
</div>

</body>
</html>
